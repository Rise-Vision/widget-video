if("undefined"==typeof config){var config={};"undefined"!=typeof angular&&(angular.module("risevision.common.i18n.config",[]).constant("LOCALES_PREFIX","components/rv-common-i18n/dist/locales/translation_").constant("LOCALES_SUFIX",".json"),angular.module("risevision.widget.common.storage-selector.config").value("STORAGE_MODAL","https://storage-stage.risevision.com/rva-test/dist/storage-modal.html#/files/"))}var RiseVision=RiseVision||{};RiseVision.Video={},RiseVision.Video=function(e,t){"use strict";function n(){t.rpc.call("","rsevent_done",null,l.getString("id"))}function i(){t.rpc.call("","rsevent_ready",null,l.getString("id"),!0,!0,!0,!0,!0)}function o(){p=new RiseVision.Video.Player(g),p.init()}function a(){p.pause()}function s(){p.isInitialPlay()?g.video.autoplay&&p.play():p.userPaused()||p.play()}function r(){i()}function d(n){l=new t.Prefs,g=n,e.getElementById("videoContainer").style.height=l.getInt("rsH")+"px",m=new RiseVision.Common.Background(g),m.init(o)}function u(){a()}function c(){n()}var l=null,g={},m=null,p=null;return{pause:a,play:s,setAdditionalParams:d,playerReady:r,stop:u,videoEnded:c}}(document,gadgets);var RiseVision=RiseVision||{};RiseVision.Common=RiseVision.Common||{},RiseVision.Common.Background=function(e){"use strict";function t(){setTimeout(function(){d.style.backgroundImage="url("+e.background.image.url+g+"cb="+(new Date).getTime()+")",t()},c)}function n(){r=!0,e.background.useImage&&!l&&t(),s&&"function"==typeof s&&s()}function i(e){u.removeEventListener("rise-storage-response",i),d.style.backgroundImage=Array.isArray(e.detail)?"url("+e.detail[0]+")":"url("+e.detail+")",n()}function o(){var t;d=document.getElementById("background"),u=document.getElementById("backgroundStorage"),document.body.style.background=e.background.color,d?e.background.useImage?(d.className=e.background.image.position,d.className=e.background.image.scale?d.className+" scale-to-fit":d.className,l=0!==Object.keys(e.backgroundStorage).length,l?u?(u.addEventListener("rise-storage-response",i),u.setAttribute("folder",e.backgroundStorage.folder),u.setAttribute("fileName",e.backgroundStorage.fileName),u.setAttribute("companyId",e.backgroundStorage.companyId),u.go()):console.log("Missing element with id value of 'backgroundStorage'"):(t=e.background.image.url.split("?"),g=1===t.length?"?":"&",d.style.backgroundImage="url("+e.background.image.url+")",n())):n():console.log("Missing element with id value of 'background'")}function a(e){r?e&&"function"==typeof e&&e():(e&&(s=e),o())}var s=null,r=!1,d=null,u=null,c=9e5,l=!1,g="";return{init:a}};var RiseVision=RiseVision||{};RiseVision.Video=RiseVision.Video||{},RiseVision.Video.Player=function(e){"use strict";function t(e){E.removeEventListener("rise-storage-response",t),v.value=Array.isArray(e.detail)?e.detail[0]:e.detail,b.setAttributeNode(v),V.appendChild(y)}function n(){var t=e.url.substr(e.url.lastIndexOf(".")+1);return"ogv"===t&&(t="ogg"),t}function i(){A.style.visibility="visible",V.removeEventListener("loadeddata",i,!1)}function o(){N=!0,L||(RiseVision.Video.playerReady(),L=!0),V.removeEventListener("canplay",o,!1),_||c(I)}function a(){k=!1,!_&&S&&(S=!1,u()),RiseVision.Video.videoEnded()}function s(){k=!h}function r(){R=!1,k=!1}function d(){setTimeout(function(){N?V.play():d()},200)}function u(){V.addEventListener("canplay",o,!1),V.addEventListener("loadeddata",i,!1),A.style.visibility="hidden",b.setAttribute("src",e.url+w+"cb="+(new Date).getTime()),N=!1,V.load()}function c(e){setTimeout(function(){V.paused&&V.currentTime<=0?u():S=!0},e)}function l(){return R}function g(){var d,u=document.createAttribute("type");y=document.createDocumentFragment(),b=y.appendChild(document.createElement("source")),v=document.createAttribute("src"),e.video.autoplay||V.setAttribute("controls",""),V.className=e.video.scaleToFit?V.className+" scale-to-fit":V.className+" no-scale",V.volume=e.video.volume/100,u.value="video/"+n(),b.setAttributeNode(u),V.addEventListener("loadeddata",i,!1),V.addEventListener("canplay",o,!1),V.addEventListener("ended",a,!1),V.addEventListener("pause",s,!1),V.addEventListener("play",r,!1),_=0!==Object.keys(e.videoStorage).length,_?(E.addEventListener("rise-storage-response",t),E.setAttribute("folder",e.videoStorage.folder),E.setAttribute("fileName",e.videoStorage.fileName),E.setAttribute("companyId",e.videoStorage.companyId),E.go()):(d=e.url.split("?"),w=1===d.length?"?":"&",v.value=e.url,b.setAttributeNode(v),V.appendChild(y))}function m(){h=!0,V.pause()}function p(){R=!1,h=!1,N?V.play():d()}function f(){return k}var v,y,b,V=document.getElementById("video"),A=document.getElementById("videoContainer"),E=document.getElementById("videoStorage"),R=!0,k=!1,h=!1,I=9e5,_=!1,S=!1,L=!1,N=!1,w="";return{isInitialPlay:l,init:g,pause:m,play:p,userPaused:f}},function(e,t){"use strict";function n(){RiseVision.Video.play()}function i(){RiseVision.Video.pause()}function o(){RiseVision.Video.stop()}function a(e,t){Array.isArray(e)&&e.length>0&&"additionalParams"===e[0]&&Array.isArray(t)&&t.length>0&&RiseVision.Video.setAdditionalParams(JSON.parse(t[0]))}var s=new t.Prefs,r=s.getString("id");e.oncontextmenu=function(){return!1},r&&""!==r&&(t.rpc.register("rscmd_play_"+r,n),t.rpc.register("rscmd_pause_"+r,i),t.rpc.register("rscmd_stop_"+r,o),t.rpc.register("rsparam_set_"+r,a),t.rpc.call("","rsparam_get",null,r,["additionalParams"]))}(window,gadgets);var _gaq=_gaq||[];_gaq.push(["_setAccount","UA-57092159-2"]),_gaq.push(["_trackPageview"]),function(){var e=document.createElement("script");e.type="text/javascript",e.async=!0,e.src=("https:"==document.location.protocol?"https://ssl":"http://www")+".google-analytics.com/ga.js";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImpzL3dpZGdldC5taW4uanMiXSwibmFtZXMiOlsiY29uZmlnIiwiYW5ndWxhciIsIm1vZHVsZSIsImNvbnN0YW50IiwidmFsdWUiLCJSaXNlVmlzaW9uIiwiVmlkZW8iLCJkb2N1bWVudCIsImdhZGdldHMiLCJfZG9uZSIsInJwYyIsImNhbGwiLCJfcHJlZnMiLCJnZXRTdHJpbmciLCJfcmVhZHkiLCJfYmFja2dyb3VuZFJlYWR5IiwiX3BsYXllciIsIlBsYXllciIsIl9hZGRpdGlvbmFsUGFyYW1zIiwiaW5pdCIsInBhdXNlIiwicGxheSIsImlzSW5pdGlhbFBsYXkiLCJ2aWRlbyIsImF1dG9wbGF5IiwidXNlclBhdXNlZCIsInBsYXllclJlYWR5Iiwic2V0QWRkaXRpb25hbFBhcmFtcyIsInBhcmFtcyIsIlByZWZzIiwiZ2V0RWxlbWVudEJ5SWQiLCJzdHlsZSIsImhlaWdodCIsImdldEludCIsIl9iYWNrZ3JvdW5kIiwiQ29tbW9uIiwiQmFja2dyb3VuZCIsInN0b3AiLCJ2aWRlb0VuZGVkIiwiZGF0YSIsIl9yZWZyZXNoVGltZXIiLCJzZXRUaW1lb3V0IiwiYmFja2dyb3VuZEltYWdlIiwiYmFja2dyb3VuZCIsImltYWdlIiwidXJsIiwiX3NlcGFyYXRvciIsIkRhdGUiLCJnZXRUaW1lIiwiX3JlZnJlc2hEdXJhdGlvbiIsInVzZUltYWdlIiwiX2lzU3RvcmFnZUZpbGUiLCJfY2FsbGJhY2siLCJfc3RvcmFnZVJlc3BvbnNlIiwiZSIsIl9zdG9yYWdlIiwicmVtb3ZlRXZlbnRMaXN0ZW5lciIsIkFycmF5IiwiaXNBcnJheSIsImRldGFpbCIsIl9jb25maWd1cmUiLCJzdHIiLCJib2R5IiwiY29sb3IiLCJjbGFzc05hbWUiLCJwb3NpdGlvbiIsInNjYWxlIiwiT2JqZWN0Iiwia2V5cyIsImJhY2tncm91bmRTdG9yYWdlIiwibGVuZ3RoIiwiYWRkRXZlbnRMaXN0ZW5lciIsInNldEF0dHJpYnV0ZSIsImZvbGRlciIsImZpbGVOYW1lIiwiY29tcGFueUlkIiwiZ28iLCJjb25zb2xlIiwibG9nIiwic3BsaXQiLCJjYiIsIl9zcmNBdHRyIiwiX3NvdXJjZSIsInNldEF0dHJpYnV0ZU5vZGUiLCJfdmlkZW8iLCJhcHBlbmRDaGlsZCIsIl9mcmFnbWVudCIsIl9nZXRWaWRlb0ZpbGVUeXBlIiwidHlwZSIsInN1YnN0ciIsImxhc3RJbmRleE9mIiwiX29uTG9hZGVkRGF0YSIsIl92aWRlb0NvbnRhaW5lciIsInZpc2liaWxpdHkiLCJfb25DYW5QbGF5IiwiX2NhblBsYXkiLCJfbm90aWZpZWRSZWFkeSIsIl9vbkVuZGVkIiwiX3VzZXJQYXVzZWQiLCJfcmVmcmVzaFdhaXRpbmciLCJfcmVmcmVzaCIsIl9vblBhdXNlIiwiX3ZpZXdlclBhdXNlZCIsIl9vblBsYXkiLCJfaW5pdGlhbFBsYXkiLCJfY2FuUGxheVRpbWVyIiwibG9hZCIsImR1cmF0aW9uIiwicGF1c2VkIiwiY3VycmVudFRpbWUiLCJ0eXBlQXR0ciIsImNyZWF0ZUF0dHJpYnV0ZSIsImNyZWF0ZURvY3VtZW50RnJhZ21lbnQiLCJjcmVhdGVFbGVtZW50Iiwic2NhbGVUb0ZpdCIsInZvbHVtZSIsInZpZGVvU3RvcmFnZSIsIndpbmRvdyIsImFkZGl0aW9uYWxQYXJhbXMiLCJuYW1lcyIsInZhbHVlcyIsIkpTT04iLCJwYXJzZSIsInByZWZzIiwiaWQiLCJvbmNvbnRleHRtZW51IiwicmVnaXN0ZXIiLCJfZ2FxIiwicHVzaCIsImdhIiwiYXN5bmMiLCJzcmMiLCJsb2NhdGlvbiIsInByb3RvY29sIiwicyIsImdldEVsZW1lbnRzQnlUYWdOYW1lIiwicGFyZW50Tm9kZSIsImluc2VydEJlZm9yZSJdLCJtYXBwaW5ncyI6IkFBRUEsR0FBc0IsbUJBQVhBLFFBQXdCLENBQ2pDLEdBQUlBLFVBSW1CLG9CQUFaQyxXQUNUQSxRQUFRQyxPQUFPLG9DQUNaQyxTQUFTLGlCQUFrQix1REFDM0JBLFNBQVMsZ0JBQWlCLFNBRTdCRixRQUFRQyxPQUFPLG9EQUNaRSxNQUFNLGdCQUFpQixrRkFNOUIsR0FBSUMsWUFB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QyxFQUFPQyxHQUMzQi9ELE1BQU1DLFFBQVE2RCxJQUFVQSxFQUFNakQsT0FBUyxHQUFrQixxQkFBYmlELEVBQU0sSUFDaEQ5RCxNQUFNQyxRQUFROEQsSUFBV0EsRUFBT2xELE9BQVMsR0FDM0NqRSxXQUFXQyxNQUFNcUIsb0JBQW9COEYsS0FBS0MsTUFBTUYsRUFBTyxLQXZCN0QsR0FBSUcsR0FBUSxHQUFJbkgsR0FBUXFCLE1BQ3RCK0YsRUFBS0QsRUFBTTlHLFVBQVUsS0FHdkJ3RyxHQUFPUSxjQUFnQixXQUNyQixPQUFPLEdBdUJMRCxHQUFhLEtBQVBBLElBQ1JwSCxFQUFRRSxJQUFJb0gsU0FBUyxjQUFnQkYsRUFBSXZHLEdBQ3pDYixFQUFRRSxJQUFJb0gsU0FBUyxlQUFpQkYsRUFBSXhHLEdBQzFDWixFQUFRRSxJQUFJb0gsU0FBUyxjQUFnQkYsRUFBSXZGLEdBRXpDN0IsRUFBUUUsSUFBSW9ILFNBQVMsZUFBaUJGLEVBQUlOLEdBQzFDOUcsRUFBUUUsSUFBSUMsS0FBSyxHQUFJLGNBQWUsS0FBTWlILEdBQUssdUJBSWhEUCxPQUFRN0csUUFLWCxJQUFJdUgsTUFBT0EsUUFFWEEsTUFBS0MsTUFBTSxjQUFlLGtCQUMxQkQsS0FBS0MsTUFBTSxtQkFFWCxXQUNFLEdBQUlDLEdBQUsxSCxTQUFTMEcsY0FBYyxTQUFXZ0IsR0FBR3pDLEtBQU8sa0JBQW1CeUMsRUFBR0MsT0FBUSxFQUNuRkQsRUFBR0UsS0FBTyxVQUFZNUgsU0FBUzZILFNBQVNDLFNBQVcsY0FBZ0IsY0FBZ0IsNkJBQ25GLElBQUlDLEdBQUkvSCxTQUFTZ0kscUJBQXFCLFVBQVUsRUFBSUQsR0FBRUUsV0FBV0MsYUFBYVIsRUFBSUsiLCJmaWxlIjoianMvd2lkZ2V0Lm1pbi5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8qIGdsb2JhbCBjb25maWc6IHRydWUgKi9cbi8qIGV4cG9ydGVkIGNvbmZpZyAqL1xuaWYgKHR5cGVvZiBjb25maWcgPT09IFwidW5kZWZpbmVkXCIpIHtcbiAgdmFyIGNvbmZpZyA9IHtcbiAgICAvLyB2YXJpYWJsZXMgZ28gaGVyZVxuICB9O1xuXG4gIGlmICh0eXBlb2YgYW5ndWxhciAhPT0gXCJ1bmRlZmluZWRcIikge1xuICAgIGFuZ3VsYXIubW9kdWxlKFwicmlzZXZpc2lvbi5jb21tb24uaTE4bi5jb25maWdcIiwgW10pXG4gICAgICAuY29uc3RhbnQoXCJMT0NBTEVTX1BSRUZJWFwiLCBcImNvbXBvbmVudHMvcnYtY29tbW9uLWkxOG4vZGlzdC9sb2NhbGVzL3RyYW5zbGF0aW9uX1wiKVxuICAgICAgLmNvbnN0YW50KFwiTE9DQUxFU19TVUZJWFwiLCBcIi5qc29uXCIpO1xuXG4gICAgYW5ndWxhci5tb2R1bGUoXCJyaXNldmlzaW9uLndpZGdldC5jb21tb24uc3RvcmFnZS1zZWxlY3Rvci5jb25maWdcIilcbiAgICAgIC52YWx1ZShcIlNUT1JBR0VfTU9EQUxcIiwgXCJodHRwczovL3N0b3JhZ2Utc3RhZ2UucmlzZXZpc2lvbi5jb20vcnZhLXRlc3QvZGlzdC9zdG9yYWdlLW1vZGFsLmh0bWwjL2ZpbGVzL1wiKTtcbiAgfVxufVxuXG4vKiBnbG9iYWwgZ2FkZ2V0cyAqL1xuXG52YXIgUmlzZVZpc2lvbiA9IFJpc2VWaXNpb24gfHwge307XG5SaXNlVmlzaW9uLlZpZGVvID0ge307XG5cblJpc2VWaXNpb24uVmlkZW8gPSAoZnVuY3Rpb24gKGRvY3VtZW50LCBnYWRnZXRzKSB7XG4gIFwidXNlIHN0cmljdFwiO1xuXG4gIHZhciBfcHJlZnMgPSBudWxsLFxuICAgIF9hZGRpdGlvbmFsUGFyYW1zID0ge30sXG4gICAgX2JhY2tncm91bmQgPSBudWxsLFxuICAgIF9wbGF5ZXIgPSBudWxsO1xuXG4gIC8qXG4gICAqICBQcml2YXRlIE1ldGhvZHNcbiAgICovXG4gIGZ1bmN0aW9uIF9kb25lKCkge1xuICAgIGdhZGdldHMucnBjLmNhbGwoXCJcIiwgXCJyc2V2ZW50X2RvbmVcIiwgbnVsbCwgX3ByZWZzLmdldFN0cmluZyhcImlkXCIpKTtcblxuICB9XG5cbiAgZnVuY3Rpb24gX3JlYWR5KCkge1xuICAgIGdhZGdldHMucnBjLmNhbGwoXCJcIiwgXCJyc2V2ZW50X3JlYWR5XCIsIG51bGwsIF9wcmVmcy5nZXRTdHJpbmcoXCJpZFwiKSxcbiAgICAgIHRydWUsIHRydWUsIHRydWUsIHRydWUsIHRydWUpO1xuICB9XG5cbiAgZnVuY3Rpb24gX2JhY2tncm91bmRSZWFkeSgpIHtcbiAgICAvLyBjcmVhdGUgYW5kIGluaXRpYWxpemUgdGhlIFBsYXllciBpbnN0YW5jZVxuICAgIF9wbGF5ZXIgPSBuZXcgUmlzZVZpc2lvbi5WaWRlby5QbGF5ZXIoX2FkZGl0aW9uYWxQYXJhbXMpO1xuICAgIF9wbGF5ZXIuaW5pdCgpO1xuICB9XG5cbiAgLypcbiAgICogIFB1YmxpYyBNZXRob2RzXG4gICAqL1xuICBmdW5jdGlvbiBwYXVzZSgpIHtcbiAgICBfcGxheWVyLnBhdXNlKCk7XG4gIH1cblxuICBmdW5jdGlvbiBwbGF5KCkge1xuICAgIGlmIChfcGxheWVyLmlzSW5pdGlhbFBsYXkoKSkge1xuICAgICAgLy8gXCJhdXRvcGxheVwiIHdhcyBzZWxlY3RlZCBpbiBzZXR0aW5nc1xuICAgICAgaWYgKF9hZGRpdGlvbmFsUGFyYW1zLnZpZGVvLmF1dG9wbGF5KSB7XG4gICAgICAgIF9wbGF5ZXIucGxheSgpO1xuICAgICAgfVxuICAgIH0gZWxzZSB7XG4gICAgICBpZiAoIV9wbGF5ZXIudXNlclBhdXNlZCgpKSB7XG4gICAgICAgIF9wbGF5ZXIucGxheSgpO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIGZ1bmN0aW9uIHBsYXllclJlYWR5KCkge1xuICAgIF9yZWFkeSgpO1xuICB9XG5cbiAgZnVuY3Rpb24gc2V0QWRkaXRpb25hbFBhcmFtcyhwYXJhbXMpIHtcbiAgICBfcHJlZnMgPSBuZXcgZ2FkZ2V0cy5QcmVmcygpO1xuICAgIF9hZGRpdGlvbmFsUGFyYW1zID0gcGFyYW1zO1xuXG4gICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJ2aWRlb0NvbnRhaW5lclwiKS5zdHlsZS5oZWlnaHQgPSBfcHJlZnMuZ2V0SW50KFwicnNIXCIpICsgXCJweFwiO1xuXG4gICAgLy8gY3JlYXRlIGFuZCBpbml0aWFsaXplIHRoZSBCYWNrZ3JvdW5kIGluc3RhbmNlXG4gICAgX2JhY2tncm91bmQgPSBuZXcgUmlzZVZpc2lvbi5Db21tb24uQmFja2dyb3VuZChfYWRkaXRpb25hbFBhcmFtcyk7XG4gICAgX2JhY2tncm91bmQuaW5pdChfYmFja2dyb3VuZFJlYWR5KTtcbiAgfVxuXG4gIGZ1bmN0aW9uIHN0b3AoKSB7XG4gICAgLy8gaHR0cHM6Ly9naXRodWIuY29tL1Jpc2UtVmlzaW9uL3ZpZXdlci9pc3N1ZXMvMzBcbiAgICAvLyBIYXZlIHRvIGNhbGwgcGF1c2UoKSBkdWUgdG8gVmlld2VyIGlzc3VlXG4gICAgcGF1c2UoKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIHZpZGVvRW5kZWQoKSB7XG4gICAgX2RvbmUoKTtcbiAgfVxuXG4gIHJldHVybiB7XG4gICAgXCJwYXVzZVwiOiBwYXVzZSxcbiAgICBcInBsYXlcIjogcGxheSxcbiAgICBcInNldEFkZGl0aW9uYWxQYXJhbXNcIjogc2V0QWRkaXRpb25hbFBhcmFtcyxcbiAgICBcInBsYXllclJlYWR5XCI6IHBsYXllclJlYWR5LFxuICAgIFwic3RvcFwiOiBzdG9wLFxuICAgIFwidmlkZW9FbmRlZFwiOiB2aWRlb0VuZGVkXG4gIH07XG5cbn0pKGRvY3VtZW50LCBnYWRnZXRzKTtcblxudmFyIFJpc2VWaXNpb24gPSBSaXNlVmlzaW9uIHx8IHt9O1xuUmlzZVZpc2lvbi5Db21tb24gPSBSaXNlVmlzaW9uLkNvbW1vbiB8fCB7fTtcblxuUmlzZVZpc2lvbi5Db21tb24uQmFja2dyb3VuZCA9IGZ1bmN0aW9uIChkYXRhKSB7XG4gIFwidXNlIHN0cmljdFwiO1xuXG4gIHZhciBfY2FsbGJhY2sgPSBudWxsLFxuICAgIF9yZWFkeSA9IGZhbHNlLFxuICAgIF9iYWNrZ3JvdW5kID0gbnVsbCxcbiAgICBfc3RvcmFnZSA9IG51bGwsXG4gICAgX3JlZnJlc2hEdXJhdGlvbiA9IDkwMDAwMCwgLy8gMTUgbWludXRlc1xuICAgIF9pc1N0b3JhZ2VGaWxlID0gZmFsc2UsXG4gICAgX3NlcGFyYXRvciA9IFwiXCI7XG5cbiAgLypcbiAgICogUHJpdmF0ZSBNZXRob2RzXG4gICAqL1xuICBmdW5jdGlvbiBfcmVmcmVzaFRpbWVyKCkge1xuICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gYmFja2dyb3VuZFJlZnJlc2goKSB7XG4gICAgICBfYmFja2dyb3VuZC5zdHlsZS5iYWNrZ3JvdW5kSW1hZ2UgPSBcInVybChcIiArIGRhdGEuYmFja2dyb3VuZC5pbWFnZS51cmwgKyBfc2VwYXJhdG9yICsgXCJjYj1cIiArIG5ldyBEYXRlKCkuZ2V0VGltZSgpICsgXCIpXCI7XG4gICAgICBfcmVmcmVzaFRpbWVyKCk7XG4gICAgfSwgX3JlZnJlc2hEdXJhdGlvbik7XG4gIH1cblxuICBmdW5jdGlvbiBfYmFja2dyb3VuZFJlYWR5KCkge1xuICAgIF9yZWFkeSA9IHRydWU7XG5cbiAgICBpZiAoZGF0YS5iYWNrZ3JvdW5kLnVzZUltYWdlICYmICFfaXNTdG9yYWdlRmlsZSkge1xuICAgICAgLy8gc3RhcnQgdGhlIHJlZnJlc2ggcG9sbCBmb3Igbm9uLXN0b3JhZ2UgYmFja2dyb3VuZCBpbWFnZVxuICAgICAgX3JlZnJlc2hUaW1lcigpO1xuICAgIH1cblxuICAgIGlmIChfY2FsbGJhY2sgJiYgdHlwZW9mIF9jYWxsYmFjayA9PT0gXCJmdW5jdGlvblwiKSB7XG4gICAgICBfY2FsbGJhY2soKTtcbiAgICB9XG4gIH1cblxuICBmdW5jdGlvbiBfc3RvcmFnZVJlc3BvbnNlKGUpIHtcbiAgICBfc3RvcmFnZS5yZW1vdmVFdmVudExpc3RlbmVyKFwicmlzZS1zdG9yYWdlLXJlc3BvbnNlXCIsIF9zdG9yYWdlUmVzcG9uc2UpO1xuXG4gICAgaWYgKEFycmF5LmlzQXJyYXkoZS5kZXRhaWwpKSB7XG4gICAgICBfYmFja2dyb3VuZC5zdHlsZS5iYWNrZ3JvdW5kSW1hZ2UgPSBcInVybChcIiArIGUuZGV0YWlsWzBdICsgXCIpXCI7XG4gICAgfSBlbHNlIHtcbiAgICAgIF9iYWNrZ3JvdW5kLnN0eWxlLmJhY2tncm91bmRJbWFnZSA9IFwidXJsKFwiICsgZS5kZXRhaWwgKyBcIilcIjtcbiAgICB9XG4gICAgX2JhY2tncm91bmRSZWFkeSgpO1xuICB9XG5cbiAgZnVuY3Rpb24gX2NvbmZpZ3VyZSgpIHtcbiAgICB2YXIgc3RyO1xuXG4gICAgX2JhY2tncm91bmQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcImJhY2tncm91bmRcIik7XG4gICAgX3N0b3JhZ2UgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcImJhY2tncm91bmRTdG9yYWdlXCIpO1xuXG4gICAgLy8gc2V0IHRoZSBkb2N1bWVudCBiYWNrZ3JvdW5kXG4gICAgZG9jdW1lbnQuYm9keS5zdHlsZS5iYWNrZ3JvdW5kID0gZGF0YS5iYWNrZ3JvdW5kLmNvbG9yO1xuXG4gICAgaWYgKF9iYWNrZ3JvdW5kKSB7XG4gICAgICBpZiAoZGF0YS5iYWNrZ3JvdW5kLnVzZUltYWdlKSB7XG4gICAgICAgIF9iYWNrZ3JvdW5kLmNsYXNzTmFtZSA9IGRhdGEuYmFja2dyb3VuZC5pbWFnZS5wb3NpdGlvbjtcbiAgICAgICAgX2JhY2tncm91bmQuY2xhc3NOYW1lID0gZGF0YS5iYWNrZ3JvdW5kLmltYWdlLnNjYWxlID8gX2JhY2tncm91bmQuY2xhc3NOYW1lICsgXCIgc2NhbGUtdG8tZml0XCJcbiAgICAgICAgICA6IF9iYWNrZ3JvdW5kLmNsYXNzTmFtZTtcblxuICAgICAgICBfaXNTdG9yYWdlRmlsZSA9IChPYmplY3Qua2V5cyhkYXRhLmJhY2tncm91bmRTdG9yYWdlKS5sZW5ndGggIT09IDApO1xuXG4gICAgICAgIGlmICghX2lzU3RvcmFnZUZpbGUpIHtcbiAgICAgICAgICBzdHIgPSBkYXRhLmJhY2tncm91bmQuaW1hZ2UudXJsLnNwbGl0KFwiP1wiKTtcblxuICAgICAgICAgIC8vIHN0b3JlIHRoaXMgZm9yIHRoZSByZWZyZXNoIHRpbWVyXG4gICAgICAgICAgX3NlcGFyYXRvciA9IChzdHIubGVuZ3RoID09PSAxKSA/IFwiP1wiIDogXCImXCI7XG5cbiAgICAgICAgICBfYmFja2dyb3VuZC5zdHlsZS5iYWNrZ3JvdW5kSW1hZ2UgPSBcInVybChcIiArIGRhdGEuYmFja2dyb3VuZC5pbWFnZS51cmwgKyBcIilcIjtcbiAgICAgICAgICBfYmFja2dyb3VuZFJlYWR5KCk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgaWYgKF9zdG9yYWdlKSB7XG4gICAgICAgICAgICAvLyBSaXNlIFN0b3JhZ2VcbiAgICAgICAgICAgIF9zdG9yYWdlLmFkZEV2ZW50TGlzdGVuZXIoXCJyaXNlLXN0b3JhZ2UtcmVzcG9uc2VcIiwgX3N0b3JhZ2VSZXNwb25zZSk7XG5cbiAgICAgICAgICAgIF9zdG9yYWdlLnNldEF0dHJpYnV0ZShcImZvbGRlclwiLCBkYXRhLmJhY2tncm91bmRTdG9yYWdlLmZvbGRlcik7XG4gICAgICAgICAgICBfc3RvcmFnZS5zZXRBdHRyaWJ1dGUoXCJmaWxlTmFtZVwiLCBkYXRhLmJhY2tncm91bmRTdG9yYWdlLmZpbGVOYW1lKTtcbiAgICAgICAgICAgIF9zdG9yYWdlLnNldEF0dHJpYnV0ZShcImNvbXBhbnlJZFwiLCBkYXRhLmJhY2tncm91bmRTdG9yYWdlLmNvbXBhbnlJZCk7XG4gICAgICAgICAgICBfc3RvcmFnZS5nbygpO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZyhcIk1pc3NpbmcgZWxlbWVudCB3aXRoIGlkIHZhbHVlIG9mICdiYWNrZ3JvdW5kU3RvcmFnZSdcIik7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBfYmFja2dyb3VuZFJlYWR5KCk7XG4gICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgIGNvbnNvbGUubG9nKFwiTWlzc2luZyBlbGVtZW50IHdpdGggaWQgdmFsdWUgb2YgJ2JhY2tncm91bmQnXCIpO1xuICAgIH1cbiAgfVxuXG4gIC8qXG4gICAqICBQdWJsaWMgTWV0aG9kc1xuICAgKi9cbiAgZnVuY3Rpb24gaW5pdChjYikge1xuICAgIGlmICghX3JlYWR5KSB7XG4gICAgICBpZiAoY2IpIHtcbiAgICAgICAgX2NhbGxiYWNrID0gY2I7XG4gICAgICB9XG5cbiAgICAgIF9jb25maWd1cmUoKTtcblxuICAgIH0gZWxzZSBpZiAoY2IgJiYgdHlwZW9mIGNiID09PSBcImZ1bmN0aW9uXCIpIHtcbiAgICAgIGNiKCk7XG4gICAgfVxuICB9XG5cbiAgcmV0dXJuIHtcbiAgICBcImluaXRcIjogaW5pdFxuICB9O1xufTtcblxudmFyIFJpc2VWaXNpb24gPSBSaXNlVmlzaW9uIHx8IHt9O1xuUmlzZVZpc2lvbi5WaWRlbyA9IFJpc2VWaXNpb24uVmlkZW8gfHwge307XG5cblJpc2VWaXNpb24uVmlkZW8uUGxheWVyID0gZnVuY3Rpb24gKGRhdGEpIHtcbiAgXCJ1c2Ugc3RyaWN0XCI7XG5cbiAgdmFyIF92aWRlbyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwidmlkZW9cIiksXG4gICAgX3ZpZGVvQ29udGFpbmVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJ2aWRlb0NvbnRhaW5lclwiKSxcbiAgICBfc3RvcmFnZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwidmlkZW9TdG9yYWdlXCIpLFxuICAgIF9pbml0aWFsUGxheSA9IHRydWUsXG4gICAgX3VzZXJQYXVzZWQgPSBmYWxzZSxcbiAgICBfdmlld2VyUGF1c2VkID0gZmFsc2UsXG4gICAgX3JlZnJlc2hEdXJhdGlvbiA9IDkwMDAwMCwgLy8gMTUgbWludXRlc1xuICAgIF9pc1N0b3JhZ2VGaWxlID0gZmFsc2UsXG4gICAgX3JlZnJlc2hXYWl0aW5nID0gZmFsc2UsXG4gICAgX25vdGlmaWVkUmVhZHkgPSBmYWxzZSxcbiAgICBfY2FuUGxheSA9IGZhbHNlLFxuICAgIF9zZXBhcmF0b3IgPSBcIlwiLFxuICAgIF9zcmNBdHRyLCBfZnJhZ21lbnQsIF9zb3VyY2U7XG5cbiAgLypcbiAgICogUHJpdmF0ZSBNZXRob2RzXG4gICAqL1xuICBmdW5jdGlvbiBfc3RvcmFnZVJlc3BvbnNlKGUpIHtcbiAgICBfc3RvcmFnZS5yZW1vdmVFdmVudExpc3RlbmVyKFwicmlzZS1zdG9yYWdlLXJlc3BvbnNlXCIsIF9zdG9yYWdlUmVzcG9uc2UpO1xuXG4gICAgaWYgKEFycmF5LmlzQXJyYXkoZS5kZXRhaWwpKSB7XG4gICAgICBfc3JjQXR0ci52YWx1ZSA9IGUuZGV0YWlsWzBdO1xuICAgIH0gZWxzZSB7XG4gICAgICBfc3JjQXR0ci52YWx1ZSA9IGUuZGV0YWlsO1xuICAgIH1cblxuICAgIF9zb3VyY2Uuc2V0QXR0cmlidXRlTm9kZShfc3JjQXR0cik7XG4gICAgX3ZpZGVvLmFwcGVuZENoaWxkKF9mcmFnbWVudCk7XG4gIH1cblxuICBmdW5jdGlvbiBfZ2V0VmlkZW9GaWxlVHlwZSgpIHtcbiAgICB2YXIgdHlwZSA9IGRhdGEudXJsLnN1YnN0cihkYXRhLnVybC5sYXN0SW5kZXhPZihcIi5cIikgKyAxKTtcblxuICAgIGlmICh0eXBlID09PSBcIm9ndlwiKSB7XG4gICAgICB0eXBlID0gXCJvZ2dcIjtcbiAgICB9XG5cbiAgICByZXR1cm4gdHlwZTtcbiAgfVxuXG4gIGZ1bmN0aW9uIF9vbkxvYWRlZERhdGEoKSB7XG4gICAgLy8gYXQgbGVhc3QgMXN0IGZyYW1lIG9mIHZpZGVvIGhhcyBsb2FkZWRcbiAgICBfdmlkZW9Db250YWluZXIuc3R5bGUudmlzaWJpbGl0eSA9IFwidmlzaWJsZVwiO1xuICAgIC8vIHJlbW92ZSB0aGlzIGxpc3RlbmVyXG4gICAgX3ZpZGVvLnJlbW92ZUV2ZW50TGlzdGVuZXIoXCJsb2FkZWRkYXRhXCIsIF9vbkxvYWRlZERhdGEsIGZhbHNlKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIF9vbkNhblBsYXkoKSB7XG4gICAgLy8gZW5vdWdoIGRhdGEgaGFzIGxvYWRlZCB0byBzYWZlbHkgcGxheSB3aXRob3V0IGludGVycnVwdGlvblxuICAgIF9jYW5QbGF5ID0gdHJ1ZTtcblxuICAgIC8vIG9ubHkgY2FsbCBwbGF5ZXJSZWFkeSgpIG9uY2VcbiAgICBpZiAoIV9ub3RpZmllZFJlYWR5KSB7XG4gICAgICBSaXNlVmlzaW9uLlZpZGVvLnBsYXllclJlYWR5KCk7XG4gICAgICBfbm90aWZpZWRSZWFkeSA9IHRydWU7XG4gICAgfVxuXG4gICAgLy8gcmVtb3ZlIHRoaXMgbGlzdGVuZXJcbiAgICBfdmlkZW8ucmVtb3ZlRXZlbnRMaXN0ZW5lcihcImNhbnBsYXlcIiwgX29uQ2FuUGxheSwgZmFsc2UpO1xuXG4gICAgaWYgKCFfaXNTdG9yYWdlRmlsZSkge1xuICAgICAgLy8gY2FsbCB0aGUgcmVmcmVzaCB0aW1lciBmdW5jdGlvbiBmb3IgYSBub24tc3RvcmFnZSB2aWRlb1xuICAgICAgX3JlZnJlc2hUaW1lcihfcmVmcmVzaER1cmF0aW9uKTtcbiAgICB9XG4gIH1cblxuICBmdW5jdGlvbiBfb25FbmRlZCgpIHtcbiAgICAvLyBhIFwicGF1c2VcIiBldmVudCBpcyBhbHdheXMgZmlyZWQgYmVmb3JlIFwiZW5kZWRcIiBldmVudCwgZW5zdXJlIF91c2VyUGF1c2VkIGlzIGZhbHNlXG4gICAgX3VzZXJQYXVzZWQgPSBmYWxzZTtcblxuICAgIGlmICghX2lzU3RvcmFnZUZpbGUgJiYgX3JlZnJlc2hXYWl0aW5nKSB7XG4gICAgICBfcmVmcmVzaFdhaXRpbmcgPSBmYWxzZTtcbiAgICAgIF9yZWZyZXNoKCk7XG4gICAgfVxuXG4gICAgLy8gdmlkZW8gZW5kZWRcbiAgICBSaXNlVmlzaW9uLlZpZGVvLnZpZGVvRW5kZWQoKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIF9vblBhdXNlKCkge1xuICAgIC8vIHRoaXMgaGFuZGxlciBhbHNvIGdldHMgY2FsbGVkIHZpYSBwdWJsaWMgXCJwYXVzZSgpXCIgZnVuY3Rpb24sIG9ubHkgc2V0IFwiX3VzZXJQYXVzZWQgPSB0cnVlXCIgaWYgbm90IHRoZSBjYXNlXG4gICAgX3VzZXJQYXVzZWQgPSAhX3ZpZXdlclBhdXNlZDtcbiAgfVxuXG4gIGZ1bmN0aW9uIF9vblBsYXkoKSB7XG4gICAgX2luaXRpYWxQbGF5ID0gZmFsc2U7XG4gICAgX3VzZXJQYXVzZWQgPSBmYWxzZTtcbiAgfVxuXG4gIGZ1bmN0aW9uIF9jYW5QbGF5VGltZXIoKSB7XG4gICAgc2V0VGltZW91dChmdW5jdGlvbiB3YWl0VG9QbGF5KCkge1xuXG4gICAgICBpZiAoX2NhblBsYXkpIHtcbiAgICAgICAgX3ZpZGVvLnBsYXkoKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIF9jYW5QbGF5VGltZXIoKTtcbiAgICAgIH1cblxuICAgIH0sIDIwMCk7XG4gIH1cblxuICBmdW5jdGlvbiBfcmVmcmVzaCgpIHtcbiAgICBfdmlkZW8uYWRkRXZlbnRMaXN0ZW5lcihcImNhbnBsYXlcIiwgX29uQ2FuUGxheSwgZmFsc2UpO1xuICAgIF92aWRlby5hZGRFdmVudExpc3RlbmVyKFwibG9hZGVkZGF0YVwiLCBfb25Mb2FkZWREYXRhLCBmYWxzZSk7XG5cbiAgICAvLyBoaWRlIHRoZSB2aWRlbyB3aGlsZSBpdCBnZXRzIGEgZGF0YSByZWZyZXNoIHRvIGF2b2lkIHZpc3VhbCB1Z2xpbmVzc1xuICAgIF92aWRlb0NvbnRhaW5lci5zdHlsZS52aXNpYmlsaXR5ID0gXCJoaWRkZW5cIjtcblxuICAgIC8vIHNldCBuZXcgc3JjIHZhbHVlIHdpdGggYSBjYWNoZWJ1c3RlclxuICAgIF9zb3VyY2Uuc2V0QXR0cmlidXRlKFwic3JjXCIsIGRhdGEudXJsICsgX3NlcGFyYXRvciArIFwiY2I9XCIgKyBuZXcgRGF0ZSgpLmdldFRpbWUoKSk7XG5cbiAgICAvLyBmbGFnIGFzc29jaWF0ZWQgd2l0aCBcImNhbnBsYXlcIiBldmVudCwgZW5zdXJlcyB2aWRlbyB3b24ndCBiZSBwbGF5ZWQgdW50aWwgaXQgaGFzIGxvYWRlZCBlbm91Z2hcbiAgICBfY2FuUGxheSA9IGZhbHNlO1xuXG4gICAgX3ZpZGVvLmxvYWQoKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIF9yZWZyZXNoVGltZXIoZHVyYXRpb24pIHtcbiAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uIHZpZGVvUmVmcmVzaCgpIHtcblxuICAgICAgaWYgKF92aWRlby5wYXVzZWQgJiYgX3ZpZGVvLmN1cnJlbnRUaW1lIDw9IDApIHtcbiAgICAgICAgLy8gT25seSByZWZyZXNoaW5nIGltbWVkaWF0ZWx5IHdoZW4gaW4gYSBwYXVzZWQgc3RhdGUgYW5kIHRoZSB2aWRlbyBpcyBhdCB0aGUgYmVnaW5uaW5nXG4gICAgICAgIF9yZWZyZXNoKCk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBfcmVmcmVzaFdhaXRpbmcgPSB0cnVlO1xuICAgICAgfVxuXG4gICAgfSwgZHVyYXRpb24pO1xuICB9XG5cbiAgLypcbiAgICogIFB1YmxpYyBNZXRob2RzXG4gICAqL1xuICBmdW5jdGlvbiBpc0luaXRpYWxQbGF5KCkge1xuICAgIHJldHVybiBfaW5pdGlhbFBsYXk7XG4gIH1cblxuICBmdW5jdGlvbiBpbml0KCkge1xuICAgIHZhciB0eXBlQXR0ciA9IGRvY3VtZW50LmNyZWF0ZUF0dHJpYnV0ZShcInR5cGVcIiksXG4gICAgICBzdHI7XG5cbiAgICBfZnJhZ21lbnQgPSBkb2N1bWVudC5jcmVhdGVEb2N1bWVudEZyYWdtZW50KCk7XG4gICAgX3NvdXJjZSA9IF9mcmFnbWVudC5hcHBlbmRDaGlsZChkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwic291cmNlXCIpKTtcbiAgICBfc3JjQXR0ciA9IGRvY3VtZW50LmNyZWF0ZUF0dHJpYnV0ZShcInNyY1wiKTtcblxuICAgIC8vIHVzZSBkZWZhdWx0IGNvbnRyb2xzIGlmIG5vdCBzZXQgdG8gYXV0b3BsYXlcbiAgICBpZiAoIWRhdGEudmlkZW8uYXV0b3BsYXkpIHtcbiAgICAgIF92aWRlby5zZXRBdHRyaWJ1dGUoXCJjb250cm9sc1wiLCBcIlwiKTtcbiAgICB9XG5cbiAgICAvLyBzZXQgYXBwcm9wcmlhdGUgc2l6aW5nIGNsYXNzIGJhc2VkIG9uIHNjYWxlVG9GaXQgdmFsdWVcbiAgICBfdmlkZW8uY2xhc3NOYW1lID0gZGF0YS52aWRlby5zY2FsZVRvRml0ID8gX3ZpZGVvLmNsYXNzTmFtZSArIFwiIHNjYWxlLXRvLWZpdFwiXG4gICAgICA6IF92aWRlby5jbGFzc05hbWUgKyBcIiBuby1zY2FsZVwiO1xuXG4gICAgLy8gc2V0IGluaXRpYWwgdm9sdW1lIG9uIDx2aWRlbz5cbiAgICBfdmlkZW8udm9sdW1lID0gZGF0YS52aWRlby52b2x1bWUgLyAxMDA7XG5cbiAgICAvLyBzZXQgdGhlIFwidHlwZVwiIGF0dHJpYnV0ZSBvbiA8c291cmNlPlxuICAgIHR5cGVBdHRyLnZhbHVlID0gXCJ2aWRlby9cIiArIF9nZXRWaWRlb0ZpbGVUeXBlKCk7XG4gICAgX3NvdXJjZS5zZXRBdHRyaWJ1dGVOb2RlKHR5cGVBdHRyKTtcblxuICAgIC8vIHZpZGVvIGV2ZW50c1xuICAgIF92aWRlby5hZGRFdmVudExpc3RlbmVyKFwibG9hZGVkZGF0YVwiLCBfb25Mb2FkZWREYXRhLCBmYWxzZSk7XG4gICAgX3ZpZGVvLmFkZEV2ZW50TGlzdGVuZXIoXCJjYW5wbGF5XCIsIF9vbkNhblBsYXksIGZhbHNlKTtcbiAgICBfdmlkZW8uYWRkRXZlbnRMaXN0ZW5lcihcImVuZGVkXCIsIF9vbkVuZGVkLCBmYWxzZSk7XG4gICAgX3ZpZGVvLmFkZEV2ZW50TGlzdGVuZXIoXCJwYXVzZVwiLCBfb25QYXVzZSwgZmFsc2UpO1xuICAgIF92aWRlby5hZGRFdmVudExpc3RlbmVyKFwicGxheVwiLCBfb25QbGF5LCBmYWxzZSk7XG5cbiAgICBfaXNTdG9yYWdlRmlsZSA9IChPYmplY3Qua2V5cyhkYXRhLnZpZGVvU3RvcmFnZSkubGVuZ3RoICE9PSAwKTtcblxuICAgIGlmICghX2lzU3RvcmFnZUZpbGUpIHtcbiAgICAgIHN0ciA9IGRhdGEudXJsLnNwbGl0KFwiP1wiKTtcblxuICAgICAgLy8gc3RvcmUgdGhpcyBmb3IgdGhlIHJlZnJlc2ggdGltZXJcbiAgICAgIF9zZXBhcmF0b3IgPSAoc3RyLmxlbmd0aCA9PT0gMSkgPyBcIj9cIiA6IFwiJlwiO1xuXG4gICAgICAvLyBOb24gc3RvcmFnZSBVUkxcbiAgICAgIF9zcmNBdHRyLnZhbHVlID0gZGF0YS51cmw7XG4gICAgICBfc291cmNlLnNldEF0dHJpYnV0ZU5vZGUoX3NyY0F0dHIpO1xuICAgICAgX3ZpZGVvLmFwcGVuZENoaWxkKF9mcmFnbWVudCk7XG5cbiAgICB9IGVsc2Uge1xuICAgICAgLy8gUmlzZSBTdG9yYWdlXG4gICAgICBfc3RvcmFnZS5hZGRFdmVudExpc3RlbmVyKFwicmlzZS1zdG9yYWdlLXJlc3BvbnNlXCIsIF9zdG9yYWdlUmVzcG9uc2UpO1xuXG4gICAgICBfc3RvcmFnZS5zZXRBdHRyaWJ1dGUoXCJmb2xkZXJcIiwgZGF0YS52aWRlb1N0b3JhZ2UuZm9sZGVyKTtcbiAgICAgIF9zdG9yYWdlLnNldEF0dHJpYnV0ZShcImZpbGVOYW1lXCIsIGRhdGEudmlkZW9TdG9yYWdlLmZpbGVOYW1lKTtcbiAgICAgIF9zdG9yYWdlLnNldEF0dHJpYnV0ZShcImNvbXBhbnlJZFwiLCBkYXRhLnZpZGVvU3RvcmFnZS5jb21wYW55SWQpO1xuICAgICAgX3N0b3JhZ2UuZ28oKTtcbiAgICB9XG4gIH1cblxuICBmdW5jdGlvbiBwYXVzZSgpIHtcbiAgICBfdmlld2VyUGF1c2VkID0gdHJ1ZTtcbiAgICBfdmlkZW8ucGF1c2UoKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIHBsYXkoKSB7XG4gICAgX2luaXRpYWxQbGF5ID0gZmFsc2U7XG4gICAgX3ZpZXdlclBhdXNlZCA9IGZhbHNlO1xuXG4gICAgaWYgKCFfY2FuUGxheSkge1xuICAgICAgX2NhblBsYXlUaW1lcigpO1xuICAgIH0gZWxzZSB7XG4gICAgICBfdmlkZW8ucGxheSgpO1xuICAgIH1cblxuICB9XG5cbiAgZnVuY3Rpb24gdXNlclBhdXNlZCgpIHtcbiAgICByZXR1cm4gX3VzZXJQYXVzZWQ7XG4gIH1cblxuICByZXR1cm4ge1xuICAgIFwiaXNJbml0aWFsUGxheVwiOiBpc0luaXRpYWxQbGF5LFxuICAgIFwiaW5pdFwiOiBpbml0LFxuICAgIFwicGF1c2VcIjogcGF1c2UsXG4gICAgXCJwbGF5XCI6IHBsYXksXG4gICAgXCJ1c2VyUGF1c2VkXCI6IHVzZXJQYXVzZWRcbiAgfTtcbn07XG5cbi8qIGdsb2JhbCBnYWRnZXRzLCBSaXNlVmlzaW9uICovXG5cbihmdW5jdGlvbiAod2luZG93LCBnYWRnZXRzKSB7XG4gIFwidXNlIHN0cmljdFwiO1xuXG4gIHZhciBwcmVmcyA9IG5ldyBnYWRnZXRzLlByZWZzKCksXG4gICAgaWQgPSBwcmVmcy5nZXRTdHJpbmcoXCJpZFwiKTtcblxuICAvLyBEaXNhYmxlIGNvbnRleHQgbWVudSAocmlnaHQgY2xpY2sgbWVudSlcbiAgd2luZG93Lm9uY29udGV4dG1lbnUgPSBmdW5jdGlvbiAoKSB7XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9O1xuXG4gIGZ1bmN0aW9uIHBsYXkoKSB7XG4gICAgUmlzZVZpc2lvbi5WaWRlby5wbGF5KCk7XG4gIH1cblxuICBmdW5jdGlvbiBwYXVzZSgpIHtcbiAgICBSaXNlVmlzaW9uLlZpZGVvLnBhdXNlKCk7XG4gIH1cblxuICBmdW5jdGlvbiBzdG9wKCkge1xuICAgIFJpc2VWaXNpb24uVmlkZW8uc3RvcCgpO1xuICB9XG5cbiAgZnVuY3Rpb24gYWRkaXRpb25hbFBhcmFtcyhuYW1lcywgdmFsdWVzKSB7XG4gICAgaWYgKEFycmF5LmlzQXJyYXkobmFtZXMpICYmIG5hbWVzLmxlbmd0aCA+IDAgJiYgbmFtZXNbMF0gPT09IFwiYWRkaXRpb25hbFBhcmFtc1wiKSB7XG4gICAgICBpZiAoQXJyYXkuaXNBcnJheSh2YWx1ZXMpICYmIHZhbHVlcy5sZW5ndGggPiAwKSB7XG4gICAgICAgIFJpc2VWaXNpb24uVmlkZW8uc2V0QWRkaXRpb25hbFBhcmFtcyhKU09OLnBhcnNlKHZhbHVlc1swXSkpO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIGlmIChpZCAmJiBpZCAhPT0gXCJcIikge1xuICAgIGdhZGdldHMucnBjLnJlZ2lzdGVyKFwicnNjbWRfcGxheV9cIiArIGlkLCBwbGF5KTtcbiAgICBnYWRnZXRzLnJwYy5yZWdpc3RlcihcInJzY21kX3BhdXNlX1wiICsgaWQsIHBhdXNlKTtcbiAgICBnYWRnZXRzLnJwYy5yZWdpc3RlcihcInJzY21kX3N0b3BfXCIgKyBpZCwgc3RvcCk7XG5cbiAgICBnYWRnZXRzLnJwYy5yZWdpc3RlcihcInJzcGFyYW1fc2V0X1wiICsgaWQsIGFkZGl0aW9uYWxQYXJhbXMpO1xuICAgIGdhZGdldHMucnBjLmNhbGwoXCJcIiwgXCJyc3BhcmFtX2dldFwiLCBudWxsLCBpZCwgW1wiYWRkaXRpb25hbFBhcmFtc1wiXSk7XG5cbiAgfVxuXG59KSh3aW5kb3csIGdhZGdldHMpO1xuXG5cblxuLyoganNoaW50IGlnbm9yZTpzdGFydCAqL1xudmFyIF9nYXEgPSBfZ2FxIHx8IFtdO1xuXG5fZ2FxLnB1c2goWydfc2V0QWNjb3VudCcsICdVQS01NzA5MjE1OS0yJ10pO1xuX2dhcS5wdXNoKFsnX3RyYWNrUGFnZXZpZXcnXSk7XG5cbihmdW5jdGlvbigpIHtcbiAgdmFyIGdhID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnc2NyaXB0Jyk7IGdhLnR5cGUgPSAndGV4dC9qYXZhc2NyaXB0JzsgZ2EuYXN5bmMgPSB0cnVlO1xuICBnYS5zcmMgPSAoJ2h0dHBzOicgPT0gZG9jdW1lbnQubG9jYXRpb24ucHJvdG9jb2wgPyAnaHR0cHM6Ly9zc2wnIDogJ2h0dHA6Ly93d3cnKSArICcuZ29vZ2xlLWFuYWx5dGljcy5jb20vZ2EuanMnO1xuICB2YXIgcyA9IGRvY3VtZW50LmdldEVsZW1lbnRzQnlUYWdOYW1lKCdzY3JpcHQnKVswXTsgcy5wYXJlbnROb2RlLmluc2VydEJlZm9yZShnYSwgcyk7XG59KSgpO1xuLyoganNoaW50IGlnbm9yZTplbmQgKi9cbiJdLCJzb3VyY2VSb290IjoiL3NvdXJjZS8ifQ==