if("undefined"==typeof config){var config={SKIN:"skin/RVSkin.xml"};"undefined"!=typeof angular&&angular.module("risevision.common.i18n.config",[]).constant("LOCALES_PREFIX","locales/translation_").constant("LOCALES_SUFIX",".json")}var RiseVision=RiseVision||{};RiseVision.Video={},RiseVision.Video=function(e){"use strict";function t(){e.rpc.call("","rsevent_done",null,y.getString("id"))}function i(){e.rpc.call("","rsevent_ready",null,y.getString("id"),!0,!0,!0,!0,!0)}function n(e){V.remove(e,function(){V.add(e),V.hide(e),V.createFramePlayer(e,f,g,config.SKIN,"player.html")})}function o(e){g=e,V=new RiseVision.Common.Video.FrameController,V.add(0),p=0,S=1,V.createFramePlayer(0,f,g,config.SKIN,"player.html")}function r(e){var t,i=V.getFrameObject(p),o=0===p?1:0;g=e,i&&(f.video.controls||(t=i.getPlaybackData(),t.duration-t.position>=15&&n(o)))}function a(){var e=V.getFrameObject(p);e&&e.pause()}function s(){var e=V.getFrameObject(p);R?t():e?e.play():(p=0===p?1:0,e=V.getFrameObject(p),e.play(),V.add(0===p?1:0),V.hide(0===p?1:0),V.createFramePlayer(0===p?1:0,f,g,config.SKIN,"player.html"))}function c(){R?(V.remove(p),V.remove(0===p?1:0),t()):(V.show(0===p?1:0),V.remove(p,function(){t()}))}function l(){h||(2===S?(h=!0,i()):(V.add(1),V.hide(1),S=2,V.createFramePlayer(1,f,g,config.SKIN,"player.html")))}function d(t,i){Array.isArray(t)&&t.length>0&&"additionalParams"===t[0]&&Array.isArray(i)&&i.length>0&&(f=JSON.parse(i[0]),y=new e.Prefs,document.getElementById("videoContainer").style.height=y.getInt("rsH")+"px",f.width=y.getInt("rsW"),f.height=y.getInt("rsH"),v=new RiseVision.Video.Storage(f),v.init())}function u(e){console.debug("video-folder::playerError()",e),h?R=!0:V.remove(p)}function m(){a()}var f,g,p,y=null,v=null,V=null,h=!1,R=!1,S=0;return{onStorageInit:o,onStorageRefresh:r,pause:a,play:s,setAdditionalParams:d,playerEnded:c,playerReady:l,playerError:u,stop:m}}(gadgets);var RiseVision=RiseVision||{};RiseVision.Video=RiseVision.Video||{},RiseVision.Video.Storage=function(e){"use strict";function t(){var t=document.getElementById("videoStorage");t&&(t.addEventListener("rise-storage-response",function(e){var t;e.detail&&e.detail.files&&e.detail.files.length>0&&(t=e.detail.files[0].url,i?(i=!1,RiseVision.Video.onStorageInit(t)):RiseVision.Video.onStorageRefresh(t))}),t.setAttribute("folder",e.storage.folder),t.setAttribute("fileName",e.storage.fileName),t.setAttribute("companyId",e.storage.companyId),t.go())}var i=!0;return{init:t}};var RiseVision=RiseVision||{};RiseVision.Common=RiseVision.Common||{},RiseVision.Common.Video=RiseVision.Common.Video||{},RiseVision.Common.Video.FrameController=function(){"use strict";function e(e){return document.getElementById(c+e)}function t(t){var i,n=e(t);return i=n.querySelector("iframe"),i?i.contentWindow?i.contentWindow:i.contentDocument.document?i.contentDocument.document:i.contentDocument:null}function i(i){var n,o=e(i),r=t(i);r&&(n=o.querySelector("iframe"),r.remove(),n.setAttribute("src","about:blank"))}function n(t){var i=e(t),n=document.createElement("iframe");n.setAttribute("allowTransparency",!0),n.setAttribute("frameborder","0"),n.setAttribute("scrolling","no"),i.appendChild(n)}function o(i,n,o,r,a){var s,c=e(i),l=t(i);l&&(s=c.querySelector("iframe"),s.onload=function(){s.onload=null,l.init(n,o,r),l.load()},s.setAttribute("src",a))}function r(t){var i=e(t);i.style.visibility="hidden"}function a(e,t){var n=document.getElementById(c+e);i(e),setTimeout(function(){for(;n.firstChild;)n.removeChild(n.firstChild);t&&"function"==typeof t&&t()},200)}function s(t){var i=e(t);i.style.visibility="visible"}var c="if_";return{add:n,createFramePlayer:o,getFrameContainer:e,getFrameObject:t,hide:r,remove:a,show:s}},function(e,t){"use strict";function i(){RiseVision.Video.play()}function n(){RiseVision.Video.pause()}function o(){RiseVision.Video.stop()}function r(){e.removeEventListener("polymer-ready",r),s&&""!==s&&(t.rpc.register("rscmd_play_"+s,i),t.rpc.register("rscmd_pause_"+s,n),t.rpc.register("rscmd_stop_"+s,o),t.rpc.register("rsparam_set_"+s,RiseVision.Video.setAdditionalParams),t.rpc.call("","rsparam_get",null,s,["additionalParams"]))}var a=new t.Prefs,s=a.getString("id");e.oncontextmenu=function(){return!1},e.addEventListener("polymer-ready",r)}(window,gadgets);var _gaq=_gaq||[];_gaq.push(["_setAccount","UA-57092159-2"]),_gaq.push(["_trackPageview"]),function(){var e=document.createElement("script");e.type="text/javascript",e.async=!0,e.src=("https:"==document.location.protocol?"https://ssl":"http://www")+".google-analytics.com/ga.js";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImpzL3dpZGdldC5taW4uanMiXSwibmFtZXMiOlsiY29uZmlnIiwiU0tJTiIsImFuZ3VsYXIiLCJtb2R1bGUiLCJjb25zdGFudCIsIlJpc2VWaXNpb24iLCJWaWRlbyIsImdhZGdldHMiLCJfZG9uZSIsInJwYyIsImNhbGwiLCJfcHJlZnMiLCJnZXRTdHJpbmciLCJfcmVhZHkiLCJfcmVmcmVzaEZyYW1lIiwiZnJhbWVJbmRleCIsIl9mcmFtZUNvbnRyb2xsZXIiLCJyZW1vdmUiLCJhZGQiLCJoaWRlIiwiY3JlYXRlRnJhbWVQbGF5ZXIiLCJfYWRkaXRpb25hbFBhcmFtcyIsIl9jdXJyZW50RmlsZSIsIm9uU3RvcmFnZUluaXQiLCJ1cmwiLCJDb21tb24iLCJGcmFtZUNvbnRyb2xsZXIiLCJfY3VycmVudEZyYW1lIiwiX2ZyYW1lQ291bnQiLCJvblN0b3JhZ2VSZWZyZXNoIiwiY3VycmVudEZyYW1lRGF0YSIsImN1cnJlbnRGcmFtZU9iaiIsImdldEZyYW1lT2JqZWN0IiwiaGlkZGVuRnJhbWVJbmRleCIsInZpZGVvIiwiY29udHJvbHMiLCJnZXRQbGF5YmFja0RhdGEiLCJkdXJhdGlvbiIsInBvc2l0aW9uIiwicGF1c2UiLCJmcmFtZU9iaiIsInBsYXkiLCJfcGxheWJhY2tFcnJvciIsInBsYXllckVuZGVkIiwic2hvdyIsInBsYXllclJlYWR5IiwiX2luaXRpYWxpemVkIiwic2V0QWRkaXRpb25hbFBhcmFtcyIsIm5hbWVzIiwidmFsdWVzIiwiQXJyYXkiLCJpc0FycmF5IiwibGVuZ3RoIiwiSlNPTiIsInBhcnNlIiwiUHJlZnMiLCJkb2N1bWVudCIsImdldEVsZW1lbnRCeUlkIiwic3R5bGUiLCJoZWlnaHQiLCJnZXRJbnQiLCJ3aWR0aCIsIl9zdG9yYWdlIiwiU3RvcmFnZSIsImluaXQiLCJwbGF5ZXJFcnJvciIsImVycm9yIiwiY29uc29sZSIsImRlYnVnIiwic3RvcCIsImRhdGEiLCJzdG9yYWdlIiwiYWRkRXZlbnRMaXN0ZW5lciIsImUiLCJkZXRhaWwiLCJmaWxlcyIsIl9pbml0aWFsTG9hZCIsInNldEF0dHJpYnV0ZSIsImZvbGRlciIsImZpbGVOYW1lIiwiY29tcGFueUlkIiwiZ28iLCJnZXRGcmFtZUNvbnRhaW5lciIsImluZGV4IiwiUFJFRklYIiwiaWZyYW1lIiwiZnJhbWVDb250YWluZXIiLCJxdWVyeVNlbGVjdG9yIiwiY29udGVudFdpbmRvdyIsImNvbnRlbnREb2N1bWVudCIsIl9jbGVhciIsImNyZWF0ZUVsZW1lbnQiLCJhcHBlbmRDaGlsZCIsInBhcmFtcyIsInNraW4iLCJzcmMiLCJvbmxvYWQiLCJsb2FkIiwidmlzaWJpbGl0eSIsImNhbGxiYWNrIiwic2V0VGltZW91dCIsImZpcnN0Q2hpbGQiLCJyZW1vdmVDaGlsZCIsIndpbmRvdyIsInBvbHltZXJSZWFkeSIsInJlbW92ZUV2ZW50TGlzdGVuZXIiLCJpZCIsInJlZ2lzdGVyIiwicHJlZnMiLCJvbmNvbnRleHRtZW51IiwiX2dhcSIsInB1c2giLCJnYSIsInR5cGUiLCJhc3luYyIsImxvY2F0aW9uIiwicHJvdG9jb2wiLCJzIiwiZ2V0RWxlbWVudHNCeVRhZ05hbWUiLCJwYXJlbnROb2RlIiwiaW5zZXJ0QmVmb3JlIl0sIm1hcHBpbmdzIjoiQUFFQSxHQUFzQixtQkFBWEEsUUFBd0IsQ0FDakMsR0FBSUEsU0FDRkMsS0FBTSxrQkFHZSxvQkFBWkMsVUFDVEEsUUFBUUMsT0FBTyxvQ0FDWkMsU0FBUyxpQkFBa0Isd0JBQzNCQSxTQUFTLGdCQUFpQixTQU1qQyxHQUFJQyxZQUFhQSxjQUNqQkEsWUFBV0MsU0FFWEQsV0FBV0MsTUFBUSxTQUFXQyxHQUM1QixZQWtCQSxTQUFTQyxLQUNQRCxFQUFRRSxJQUFJQyxLQUFLLEdBQUksZUFBZ0IsS0FBTUMsRUFBT0MsVUFBVSxPQUk5RCxRQUFTQyxLQUNQTixFQUFRRSxJQUFJQyxLQUFLLEdBQUksZ0JBQWlCLEtBQU1DLEVBQU9DLFVBQVUsT0FDM0QsR0FBTSxHQUFNLEdBQU0sR0FBTSxHQUc1QixRQUFTRSxHQUFjQyxHQUNyQkMsRUFB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bCBjb25maWc6IHRydWUgKi9cbi8qIGV4cG9ydGVkIGNvbmZpZyAqL1xuaWYgKHR5cGVvZiBjb25maWcgPT09IFwidW5kZWZpbmVkXCIpIHtcbiAgdmFyIGNvbmZpZyA9IHtcbiAgICBTS0lOOiBcInNraW4vUlZTa2luLnhtbFwiXG4gIH07XG5cbiAgaWYgKHR5cGVvZiBhbmd1bGFyICE9PSBcInVuZGVmaW5lZFwiKSB7XG4gICAgYW5ndWxhci5tb2R1bGUoXCJyaXNldmlzaW9uLmNvbW1vbi5pMThuLmNvbmZpZ1wiLCBbXSlcbiAgICAgIC5jb25zdGFudChcIkxPQ0FMRVNfUFJFRklYXCIsIFwibG9jYWxlcy90cmFuc2xhdGlvbl9cIilcbiAgICAgIC5jb25zdGFudChcIkxPQ0FMRVNfU1VGSVhcIiwgXCIuanNvblwiKTtcbiAgfVxufVxuXG4vKiBnbG9iYWwgZ2FkZ2V0cywgY29uZmlnICovXG5cbnZhciBSaXNlVmlzaW9uID0gUmlzZVZpc2lvbiB8fCB7fTtcblJpc2VWaXNpb24uVmlkZW8gPSB7fTtcblxuUmlzZVZpc2lvbi5WaWRlbyA9IChmdW5jdGlvbiAoZ2FkZ2V0cykge1xuICBcInVzZSBzdHJpY3RcIjtcblxuICB2YXIgX2FkZGl0aW9uYWxQYXJhbXM7XG5cbiAgdmFyIF9wcmVmcyA9IG51bGwsXG4gICAgX3N0b3JhZ2UgPSBudWxsLFxuICAgIF9mcmFtZUNvbnRyb2xsZXIgPSBudWxsO1xuXG4gIHZhciBfaW5pdGlhbGl6ZWQgPSBmYWxzZSxcbiAgICBfcGxheWJhY2tFcnJvciA9IGZhbHNlO1xuXG4gIHZhciBfY3VycmVudEZpbGUsIF9jdXJyZW50RnJhbWU7XG5cbiAgdmFyIF9mcmFtZUNvdW50ID0gMDtcblxuICAvKlxuICAgKiAgUHJpdmF0ZSBNZXRob2RzXG4gICAqL1xuICBmdW5jdGlvbiBfZG9uZSgpIHtcbiAgICBnYWRnZXRzLnJwYy5jYWxsKFwiXCIsIFwicnNldmVudF9kb25lXCIsIG51bGwsIF9wcmVmcy5nZXRTdHJpbmcoXCJpZFwiKSk7XG5cbiAgfVxuXG4gIGZ1bmN0aW9uIF9yZWFkeSgpIHtcbiAgICBnYWRnZXRzLnJwYy5jYWxsKFwiXCIsIFwicnNldmVudF9yZWFkeVwiLCBudWxsLCBfcHJlZnMuZ2V0U3RyaW5nKFwiaWRcIiksXG4gICAgICB0cnVlLCB0cnVlLCB0cnVlLCB0cnVlLCB0cnVlKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIF9yZWZyZXNoRnJhbWUoZnJhbWVJbmRleCkge1xuICAgIF9mcmFtZUNvbnRyb2xsZXIucmVtb3ZlKGZyYW1lSW5kZXgsIGZ1bmN0aW9uICgpIHtcbiAgICAgIF9mcmFtZUNvbnRyb2xsZXIuYWRkKGZyYW1lSW5kZXgpO1xuICAgICAgX2ZyYW1lQ29udHJvbGxlci5oaWRlKGZyYW1lSW5kZXgpO1xuICAgICAgX2ZyYW1lQ29udHJvbGxlci5jcmVhdGVGcmFtZVBsYXllcihmcmFtZUluZGV4LCBfYWRkaXRpb25hbFBhcmFtcywgX2N1cnJlbnRGaWxlLCBjb25maWcuU0tJTiwgXCJwbGF5ZXIuaHRtbFwiKTtcbiAgICB9KTtcbiAgfVxuXG4gIC8qXG4gICAqICBQdWJsaWMgTWV0aG9kc1xuICAgKi9cbiAgZnVuY3Rpb24gb25TdG9yYWdlSW5pdCh1cmwpIHtcbiAgICBfY3VycmVudEZpbGUgPSB1cmw7XG5cbiAgICBfZnJhbWVDb250cm9sbGVyID0gbmV3IFJpc2VWaXNpb24uQ29tbW9uLlZpZGVvLkZyYW1lQ29udHJvbGxlcigpO1xuXG4gICAgLy8gYWRkIHRoZSBmaXJzdCBmcmFtZSBhbmQgY3JlYXRlIGl0cyBwbGF5ZXJcbiAgICBfZnJhbWVDb250cm9sbGVyLmFkZCgwKTtcbiAgICBfY3VycmVudEZyYW1lID0gMDtcbiAgICBfZnJhbWVDb3VudCA9IDE7XG4gICAgX2ZyYW1lQ29udHJvbGxlci5jcmVhdGVGcmFtZVBsYXllcigwLCBfYWRkaXRpb25hbFBhcmFtcywgX2N1cnJlbnRGaWxlLCBjb25maWcuU0tJTiwgXCJwbGF5ZXIuaHRtbFwiKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIG9uU3RvcmFnZVJlZnJlc2godXJsKSB7XG4gICAgdmFyIGN1cnJlbnRGcmFtZU9iaiA9IF9mcmFtZUNvbnRyb2xsZXIuZ2V0RnJhbWVPYmplY3QoX2N1cnJlbnRGcmFtZSksXG4gICAgICBoaWRkZW5GcmFtZUluZGV4ID0gKF9jdXJyZW50RnJhbWUgPT09IDApID8gMSA6IDAsXG4gICAgICBjdXJyZW50RnJhbWVEYXRhO1xuXG4gICAgX2N1cnJlbnRGaWxlID0gdXJsO1xuXG4gICAgLy8gSXQgaXMgYmVzdCB0byBsZXQgcmVmcmVzaGluZyB0aGUgZnJhbWUgcGxheWxpc3QgaGFwcGVuIGluIHRoZSBub3JtYWwgY3ljbGUgb2YgZnJhbWUgc3dhcHBpbmcgKHBsYXlsaXN0IGNvbXBsZXRpb24pXG4gICAgLy8gQmVsb3cgaXMgdGhlIG9ubHkgY3JpdGVyaWEgZm9yIHNhZmVseSBmb3JjaW5nIGEgcmVmcmVzaCBvZiBoaWRkZW4gZnJhbWUgd2hpbGUgV2lkZ2V0IGlzIGluIGEgXCJwbGF5XCIgb3IgXCJwYXVzZVwiIHN0YXRlXG5cbiAgICAvLyBXaWRnZXQgaXMgaW4gYSBzdGF0ZSBvZiBcInBsYXlcIiBvciBcInBhdXNlXCIgYW5kIHBsYXlsaXN0IGhhcyBub3QgY29tcGxldGVkLiBBIGhpZGRlbiBmcmFtZSBkZWZpbml0ZWx5IGV4aXN0c1xuICAgIGlmIChjdXJyZW50RnJhbWVPYmopIHtcbiAgICAgIC8vIE9ubHkgaWYgdGhlcmUgYXJlIG5vIHZpZGVvIGNvbnRyb2xzLlxuICAgICAgLy8gVXNlciBpbnRlcmFjdGluZyB3aXRoIGNvbnRyb2xzLCBwYXJ0aWN1bGFybHkgc2Vla2luZyB0aGUgdmlkZW8gdG8gZW5kLCB3b3VsZCBjYXVzZSBpc3N1ZXNcbiAgICAgIGlmICghX2FkZGl0aW9uYWxQYXJhbXMudmlkZW8uY29udHJvbHMpIHtcbiAgICAgICAgY3VycmVudEZyYW1lRGF0YSA9IGN1cnJlbnRGcmFtZU9iai5nZXRQbGF5YmFja0RhdGEoKTtcblxuICAgICAgICAvLyBUbyBiZSBzYWZlLCBvbmx5IHJlZnJlc2ggdGhlIGZyYW1lIHRoYXQncyBjdXJyZW50bHkgaGlkZGVuIGlmIGF0IGxlYXN0IDE1IHNlY29uZHMgYXJlIGxlZnQgb2YgdmlkZW9cbiAgICAgICAgaWYgKChjdXJyZW50RnJhbWVEYXRhLmR1cmF0aW9uIC0gY3VycmVudEZyYW1lRGF0YS5wb3NpdGlvbikgPj0gMTUpIHtcbiAgICAgICAgICBfcmVmcmVzaEZyYW1lKGhpZGRlbkZyYW1lSW5kZXgpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgZnVuY3Rpb24gcGF1c2UoKSB7XG4gICAgdmFyIGZyYW1lT2JqID0gX2ZyYW1lQ29udHJvbGxlci5nZXRGcmFtZU9iamVjdChfY3VycmVudEZyYW1lKTtcblxuICAgIGlmIChmcmFtZU9iaikge1xuICAgICAgZnJhbWVPYmoucGF1c2UoKTtcbiAgICB9XG4gIH1cblxuICBmdW5jdGlvbiBwbGF5KCkge1xuICAgIHZhciBmcmFtZU9iaiA9IF9mcmFtZUNvbnRyb2xsZXIuZ2V0RnJhbWVPYmplY3QoX2N1cnJlbnRGcmFtZSk7XG5cbiAgICBpZiAoIV9wbGF5YmFja0Vycm9yKSB7XG4gICAgICBpZiAoZnJhbWVPYmopIHtcbiAgICAgICAgZnJhbWVPYmoucGxheSgpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgLy8gc2V0IGN1cnJlbnQgZnJhbWUgdG8gYmUgdGhlIG9uZSB2aXNpYmxlXG4gICAgICAgIF9jdXJyZW50RnJhbWUgPSAoX2N1cnJlbnRGcmFtZSA9PT0gMCkgPyAxIDogMDtcblxuICAgICAgICAvLyBwbGF5IHRoZSBjdXJyZW50IGZyYW1lIHZpZGVvXG4gICAgICAgIGZyYW1lT2JqID0gX2ZyYW1lQ29udHJvbGxlci5nZXRGcmFtZU9iamVjdChfY3VycmVudEZyYW1lKTtcbiAgICAgICAgZnJhbWVPYmoucGxheSgpO1xuXG4gICAgICAgIC8vIHJlLWFkZCBwcmV2aW91c2x5IHJlbW92ZWQgZnJhbWUgYW5kIGNyZWF0ZSB0aGUgcGxheWVyLCBidXQgaGlkZSB2aXNpYmlsaXR5XG4gICAgICAgIF9mcmFtZUNvbnRyb2xsZXIuYWRkKCgoX2N1cnJlbnRGcmFtZSA9PT0gMCkgPyAxIDogMCkpO1xuICAgICAgICBfZnJhbWVDb250cm9sbGVyLmhpZGUoKChfY3VycmVudEZyYW1lID09PSAwKSA/IDEgOiAwKSk7XG4gICAgICAgIF9mcmFtZUNvbnRyb2xsZXIuY3JlYXRlRnJhbWVQbGF5ZXIoKChfY3VycmVudEZyYW1lID09PSAwKSA/IDEgOiAwKSwgX2FkZGl0aW9uYWxQYXJhbXMsIF9jdXJyZW50RmlsZSwgY29uZmlnLlNLSU4sIFwicGxheWVyLmh0bWxcIik7XG4gICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgIC8vIFRoaXMgZmxhZyBvbmx5IGdvdCBzZXQgdXBvbiBhIHJlZnJlc2ggb2YgaGlkZGVuIGZyYW1lIGFuZCB0aGVyZSB3YXMgYW4gZXJyb3IgaW4gc2V0dXAgb3IgdmlkZW9cbiAgICAgIC8vIFNlbmQgVmlld2VyIFwiZG9uZVwiXG4gICAgICBfZG9uZSgpO1xuICAgIH1cbiAgfVxuXG4gIGZ1bmN0aW9uIHBsYXllckVuZGVkKCkge1xuICAgIGlmIChfcGxheWJhY2tFcnJvcikge1xuICAgICAgLy8gVGhpcyBmbGFnIG9ubHkgZ2V0cyBzZXQgdXBvbiBhIHJlZnJlc2ggb2YgaGlkZGVuIGZyYW1lIGFuZCB0aGVyZSB3YXMgYW4gZXJyb3IgaW4gc2V0dXAgb3IgdmlkZW9cbiAgICAgIF9mcmFtZUNvbnRyb2xsZXIucmVtb3ZlKF9jdXJyZW50RnJhbWUpO1xuICAgICAgX2ZyYW1lQ29udHJvbGxlci5yZW1vdmUoKF9jdXJyZW50RnJhbWUgPT09IDApID8gMSA6IDApO1xuXG4gICAgICBfZG9uZSgpO1xuXG4gICAgfSBlbHNlIHtcbiAgICAgIF9mcmFtZUNvbnRyb2xsZXIuc2hvdygoX2N1cnJlbnRGcmFtZSA9PT0gMCkgPyAxIDogMCk7XG4gICAgICBfZnJhbWVDb250cm9sbGVyLnJlbW92ZShfY3VycmVudEZyYW1lLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgIF9kb25lKCk7XG4gICAgICB9KTtcbiAgICB9XG5cbiAgfVxuXG4gIGZ1bmN0aW9uIHBsYXllclJlYWR5KCkge1xuICAgIGlmICghX2luaXRpYWxpemVkKSB7XG4gICAgICBpZiAoX2ZyYW1lQ291bnQgPT09IDIpIHtcbiAgICAgICAgLy8gYm90aCBmcmFtZXMgaGF2ZSBiZWVuIGNyZWF0ZWQgYW5kIGxvYWRlZCwgY2FuIG5vdGlmeSBWaWV3ZXIgd2lkZ2V0IGlzIHJlYWR5XG4gICAgICAgIF9pbml0aWFsaXplZCA9IHRydWU7XG4gICAgICAgIF9yZWFkeSgpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgLy8gZmlyc3QgZnJhbWUgcGxheWVyIHdhcyBzdWNjZXNzZnVsIGFuZCByZWFkeSwgY3JlYXRlIHRoZSBzZWNvbmQgb25lIGJ1dCBoaWRlIGl0XG4gICAgICAgIF9mcmFtZUNvbnRyb2xsZXIuYWRkKDEpO1xuICAgICAgICBfZnJhbWVDb250cm9sbGVyLmhpZGUoMSk7XG4gICAgICAgIF9mcmFtZUNvdW50ID0gMjtcbiAgICAgICAgX2ZyYW1lQ29udHJvbGxlci5jcmVhdGVGcmFtZVBsYXllcigxLCBfYWRkaXRpb25hbFBhcmFtcywgX2N1cnJlbnRGaWxlLCBjb25maWcuU0tJTiwgXCJwbGF5ZXIuaHRtbFwiKTtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICBmdW5jdGlvbiBzZXRBZGRpdGlvbmFsUGFyYW1zKG5hbWVzLCB2YWx1ZXMpIHtcbiAgICBpZiAoQXJyYXkuaXNBcnJheShuYW1lcykgJiYgbmFtZXMubGVuZ3RoID4gMCAmJiBuYW1lc1swXSA9PT0gXCJhZGRpdGlvbmFsUGFyYW1zXCIpIHtcbiAgICAgIGlmIChBcnJheS5pc0FycmF5KHZhbHVlcykgJiYgdmFsdWVzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgX2FkZGl0aW9uYWxQYXJhbXMgPSBKU09OLnBhcnNlKHZhbHVlc1swXSk7XG4gICAgICAgIF9wcmVmcyA9IG5ldyBnYWRnZXRzLlByZWZzKCk7XG5cbiAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJ2aWRlb0NvbnRhaW5lclwiKS5zdHlsZS5oZWlnaHQgPSBfcHJlZnMuZ2V0SW50KFwicnNIXCIpICsgXCJweFwiO1xuXG4gICAgICAgIF9hZGRpdGlvbmFsUGFyYW1zLndpZHRoID0gX3ByZWZzLmdldEludChcInJzV1wiKTtcbiAgICAgICAgX2FkZGl0aW9uYWxQYXJhbXMuaGVpZ2h0ID0gX3ByZWZzLmdldEludChcInJzSFwiKTtcblxuICAgICAgICAvLyBjcmVhdGUgYW5kIGluaXRpYWxpemUgdGhlIFN0b3JhZ2UgbW9kdWxlIGluc3RhbmNlXG4gICAgICAgIF9zdG9yYWdlID0gbmV3IFJpc2VWaXNpb24uVmlkZW8uU3RvcmFnZShfYWRkaXRpb25hbFBhcmFtcyk7XG4gICAgICAgIF9zdG9yYWdlLmluaXQoKTtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICBmdW5jdGlvbiBwbGF5ZXJFcnJvcihlcnJvcikge1xuICAgIGNvbnNvbGUuZGVidWcoXCJ2aWRlby1mb2xkZXI6OnBsYXllckVycm9yKClcIiwgZXJyb3IpO1xuXG4gICAgaWYgKCFfaW5pdGlhbGl6ZWQpIHtcbiAgICAgIC8vIFdpZGdldCBoYXMgbm90IHNlbnQgXCJyZWFkeVwiIHlldCBhbmQgdGhlcmUgaXMgYW4gZXJyb3IgKHNldHVwIG9yIHBsYXliYWNrIG9mIHZpZGVvKVxuICAgICAgX2ZyYW1lQ29udHJvbGxlci5yZW1vdmUoX2N1cnJlbnRGcmFtZSk7XG5cbiAgICAgIC8vIGRvIG5vdGhpbmcgbW9yZSwgZW5zdXJlIFwicmVhZHlcIiBpcyBub3Qgc2VudCB0byBWaWV3ZXIgc28gdGhhdCB0aGlzIHdpZGdldCBjYW4gYmUgc2tpcHBlZFxuXG4gICAgfSBlbHNlIHtcbiAgICAgIC8vIFRoaXMgb25seSBoYXBwZW5zIGluIHRoZSBldmVudCBvZiBhIHJlZnJlc2guIE5ldyBmaWxlIGNhdXNlZCBhbiBlcnJvciBpbiBzZXR1cCBvciB2aWRlbyBoYXMgYW4gaXNzdWVcbiAgICAgIC8vIFRoZSBlcnJvciBldmVudCB3aWxsIGJlIGNvbWluZyBmcm9tIHRoZSBjdXJyZW50bHkgaGlkZGVuIGZyYW1lIHdoZW4gaXQgZ290IHJlY3JlYXRlZCB3aXRoIGEgbmV3IGZpbGUgdG8gdXNlXG4gICAgICBfcGxheWJhY2tFcnJvciA9IHRydWU7XG4gICAgfVxuXG4gIH1cblxuICBmdW5jdGlvbiBzdG9wKCkge1xuICAgIHBhdXNlKCk7XG4gIH1cblxuICByZXR1cm4ge1xuICAgIFwib25TdG9yYWdlSW5pdFwiOiBvblN0b3JhZ2VJbml0LFxuICAgIFwib25TdG9yYWdlUmVmcmVzaFwiOiBvblN0b3JhZ2VSZWZyZXNoLFxuICAgIFwicGF1c2VcIjogcGF1c2UsXG4gICAgXCJwbGF5XCI6IHBsYXksXG4gICAgXCJzZXRBZGRpdGlvbmFsUGFyYW1zXCI6IHNldEFkZGl0aW9uYWxQYXJhbXMsXG4gICAgXCJwbGF5ZXJFbmRlZFwiOiBwbGF5ZXJFbmRlZCxcbiAgICBcInBsYXllclJlYWR5XCI6IHBsYXllclJlYWR5LFxuICAgIFwicGxheWVyRXJyb3JcIjogcGxheWVyRXJyb3IsXG4gICAgXCJzdG9wXCI6IHN0b3BcbiAgfTtcblxufSkoZ2FkZ2V0cyk7XG5cbnZhciBSaXNlVmlzaW9uID0gUmlzZVZpc2lvbiB8fCB7fTtcblJpc2VWaXNpb24uVmlkZW8gPSBSaXNlVmlzaW9uLlZpZGVvIHx8IHt9O1xuXG5SaXNlVmlzaW9uLlZpZGVvLlN0b3JhZ2UgPSBmdW5jdGlvbiAoZGF0YSkge1xuICBcInVzZSBzdHJpY3RcIjtcblxuICB2YXIgX2luaXRpYWxMb2FkID0gdHJ1ZTtcblxuICAvKlxuICAgKiAgUHVibGljIE1ldGhvZHNcbiAgICovXG4gIGZ1bmN0aW9uIGluaXQoKSB7XG4gICAgdmFyIHN0b3JhZ2UgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcInZpZGVvU3RvcmFnZVwiKTtcblxuICAgIGlmICghc3RvcmFnZSkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIHN0b3JhZ2UuYWRkRXZlbnRMaXN0ZW5lcihcInJpc2Utc3RvcmFnZS1yZXNwb25zZVwiLCBmdW5jdGlvbihlKSB7XG4gICAgICB2YXIgdXJsO1xuXG4gICAgICBpZiAoZS5kZXRhaWwgJiYgZS5kZXRhaWwuZmlsZXMgJiYgZS5kZXRhaWwuZmlsZXMubGVuZ3RoID4gMCkge1xuICAgICAgICB1cmwgPSBlLmRldGFpbC5maWxlc1swXS51cmw7XG5cbiAgICAgICAgaWYgKF9pbml0aWFsTG9hZCkge1xuICAgICAgICAgIF9pbml0aWFsTG9hZCA9IGZhbHNlO1xuXG4gICAgICAgICAgUmlzZVZpc2lvbi5WaWRlby5vblN0b3JhZ2VJbml0KHVybCk7XG5cbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBSaXNlVmlzaW9uLlZpZGVvLm9uU3RvcmFnZVJlZnJlc2godXJsKTtcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgfSk7XG5cbiAgICBzdG9yYWdlLnNldEF0dHJpYnV0ZShcImZvbGRlclwiLCBkYXRhLnN0b3JhZ2UuZm9sZGVyKTtcbiAgICBzdG9yYWdlLnNldEF0dHJpYnV0ZShcImZpbGVOYW1lXCIsIGRhdGEuc3RvcmFnZS5maWxlTmFtZSk7XG4gICAgc3RvcmFnZS5zZXRBdHRyaWJ1dGUoXCJjb21wYW55SWRcIiwgZGF0YS5zdG9yYWdlLmNvbXBhbnlJZCk7XG4gICAgc3RvcmFnZS5nbygpO1xuICB9XG5cbiAgcmV0dXJuIHtcbiAgICBcImluaXRcIjogaW5pdFxuICB9O1xufTtcblxudmFyIFJpc2VWaXNpb24gPSBSaXNlVmlzaW9uIHx8IHt9O1xuUmlzZVZpc2lvbi5Db21tb24gPSBSaXNlVmlzaW9uLkNvbW1vbiB8fCB7fTtcblxuUmlzZVZpc2lvbi5Db21tb24uVmlkZW8gPSBSaXNlVmlzaW9uLkNvbW1vbi5WaWRlbyB8fCB7fTtcblxuUmlzZVZpc2lvbi5Db21tb24uVmlkZW8uRnJhbWVDb250cm9sbGVyID0gZnVuY3Rpb24gKCkge1xuICBcInVzZSBzdHJpY3RcIjtcblxuICB2YXIgUFJFRklYID0gXCJpZl9cIjtcblxuICBmdW5jdGlvbiBnZXRGcmFtZUNvbnRhaW5lcihpbmRleCkge1xuICAgIHJldHVybiBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChQUkVGSVggKyBpbmRleCk7XG4gIH1cblxuICBmdW5jdGlvbiBnZXRGcmFtZU9iamVjdChpbmRleCkge1xuICAgIHZhciBmcmFtZUNvbnRhaW5lciA9IGdldEZyYW1lQ29udGFpbmVyKGluZGV4KSxcbiAgICAgIGlmcmFtZTtcblxuICAgIGlmcmFtZSA9IGZyYW1lQ29udGFpbmVyLnF1ZXJ5U2VsZWN0b3IoXCJpZnJhbWVcIik7XG5cbiAgICBpZiAoaWZyYW1lKSB7XG4gICAgICByZXR1cm4gKGlmcmFtZS5jb250ZW50V2luZG93KSA/IGlmcmFtZS5jb250ZW50V2luZG93IDpcbiAgICAgICAgKGlmcmFtZS5jb250ZW50RG9jdW1lbnQuZG9jdW1lbnQpID8gaWZyYW1lLmNvbnRlbnREb2N1bWVudC5kb2N1bWVudCA6IGlmcmFtZS5jb250ZW50RG9jdW1lbnQ7XG4gICAgfVxuXG4gICAgcmV0dXJuIG51bGw7XG4gIH1cblxuICBmdW5jdGlvbiBfY2xlYXIoaW5kZXgpIHtcbiAgICB2YXIgZnJhbWVDb250YWluZXIgPSBnZXRGcmFtZUNvbnRhaW5lcihpbmRleCksXG4gICAgICBmcmFtZU9iaiA9IGdldEZyYW1lT2JqZWN0KGluZGV4KSxcbiAgICAgIGlmcmFtZTtcblxuICAgIGlmIChmcmFtZU9iaikge1xuICAgICAgaWZyYW1lID0gZnJhbWVDb250YWluZXIucXVlcnlTZWxlY3RvcihcImlmcmFtZVwiKTtcbiAgICAgIGZyYW1lT2JqLnJlbW92ZSgpO1xuICAgICAgaWZyYW1lLnNldEF0dHJpYnV0ZShcInNyY1wiLCBcImFib3V0OmJsYW5rXCIpO1xuICAgIH1cbiAgfVxuXG4gIGZ1bmN0aW9uIGFkZChpbmRleCkge1xuICAgIHZhciBmcmFtZUNvbnRhaW5lciA9IGdldEZyYW1lQ29udGFpbmVyKGluZGV4KSxcbiAgICAgIGlmcmFtZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJpZnJhbWVcIik7XG5cbiAgICBpZnJhbWUuc2V0QXR0cmlidXRlKFwiYWxsb3dUcmFuc3BhcmVuY3lcIiwgdHJ1ZSk7XG4gICAgaWZyYW1lLnNldEF0dHJpYnV0ZShcImZyYW1lYm9yZGVyXCIsIFwiMFwiKTtcbiAgICBpZnJhbWUuc2V0QXR0cmlidXRlKFwic2Nyb2xsaW5nXCIsIFwibm9cIik7XG5cbiAgICBmcmFtZUNvbnRhaW5lci5hcHBlbmRDaGlsZChpZnJhbWUpO1xuICB9XG5cbiAgZnVuY3Rpb24gY3JlYXRlRnJhbWVQbGF5ZXIoaW5kZXgsIHBhcmFtcywgZmlsZXMsIHNraW4sIHNyYykge1xuICAgIHZhciBmcmFtZUNvbnRhaW5lciA9IGdldEZyYW1lQ29udGFpbmVyKGluZGV4KSxcbiAgICAgIGZyYW1lT2JqID0gZ2V0RnJhbWVPYmplY3QoaW5kZXgpLFxuICAgICAgaWZyYW1lO1xuXG4gICAgaWYgKGZyYW1lT2JqKSB7XG4gICAgICBpZnJhbWUgPSBmcmFtZUNvbnRhaW5lci5xdWVyeVNlbGVjdG9yKFwiaWZyYW1lXCIpO1xuXG4gICAgICBpZnJhbWUub25sb2FkID0gZnVuY3Rpb24gKCkge1xuICAgICAgICBpZnJhbWUub25sb2FkID0gbnVsbDtcblxuICAgICAgICAvLyBpbml0aWFsaXplIGFuZCBsb2FkIHRoZSBwbGF5ZXIgaW5zaWRlIHRoZSBpZnJhbWVcbiAgICAgICAgZnJhbWVPYmouaW5pdChwYXJhbXMsIGZpbGVzLCBza2luKTtcbiAgICAgICAgZnJhbWVPYmoubG9hZCgpO1xuICAgICAgfTtcblxuICAgICAgaWZyYW1lLnNldEF0dHJpYnV0ZShcInNyY1wiLCBzcmMpO1xuICAgIH1cblxuICB9XG5cbiAgZnVuY3Rpb24gaGlkZShpbmRleCkge1xuICAgIHZhciBmcmFtZUNvbnRhaW5lciA9IGdldEZyYW1lQ29udGFpbmVyKGluZGV4KTtcblxuICAgIGZyYW1lQ29udGFpbmVyLnN0eWxlLnZpc2liaWxpdHkgPSBcImhpZGRlblwiO1xuICB9XG5cbiAgZnVuY3Rpb24gcmVtb3ZlKGluZGV4LCBjYWxsYmFjaykge1xuICAgIHZhciBmcmFtZUNvbnRhaW5lciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFBSRUZJWCArIGluZGV4KTtcblxuICAgIF9jbGVhcihpbmRleCk7XG5cbiAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHtcbiAgICAgIC8vIHJlbW92ZSB0aGUgaWZyYW1lIGJ5IGNsZWFyaW5nIGFsbCBlbGVtZW50cyBpbnNpZGUgZGl2IGNvbnRhaW5lclxuICAgICAgd2hpbGUgKGZyYW1lQ29udGFpbmVyLmZpcnN0Q2hpbGQpIHtcbiAgICAgICAgZnJhbWVDb250YWluZXIucmVtb3ZlQ2hpbGQoZnJhbWVDb250YWluZXIuZmlyc3RDaGlsZCk7XG4gICAgICB9XG5cbiAgICAgIGlmIChjYWxsYmFjayAmJiB0eXBlb2YgY2FsbGJhY2sgPT09IFwiZnVuY3Rpb25cIikge1xuICAgICAgICBjYWxsYmFjaygpO1xuICAgICAgfVxuICAgIH0sIDIwMCk7XG4gIH1cblxuICBmdW5jdGlvbiBzaG93KGluZGV4KSB7XG4gICAgdmFyIGZyYW1lQ29udGFpbmVyID0gZ2V0RnJhbWVDb250YWluZXIoaW5kZXgpO1xuXG4gICAgZnJhbWVDb250YWluZXIuc3R5bGUudmlzaWJpbGl0eSA9IFwidmlzaWJsZVwiO1xuICB9XG5cbiAgcmV0dXJuIHtcbiAgICBhZGQ6IGFkZCxcbiAgICBjcmVhdGVGcmFtZVBsYXllcjogY3JlYXRlRnJhbWVQbGF5ZXIsXG4gICAgZ2V0RnJhbWVDb250YWluZXI6IGdldEZyYW1lQ29udGFpbmVyLFxuICAgIGdldEZyYW1lT2JqZWN0OiBnZXRGcmFtZU9iamVjdCxcbiAgICBoaWRlOiBoaWRlLFxuICAgIHJlbW92ZTogcmVtb3ZlLFxuICAgIHNob3c6IHNob3dcbiAgfTtcbn07XG5cbi8qIGdsb2JhbCBnYWRnZXRzLCBSaXNlVmlzaW9uICovXG5cbihmdW5jdGlvbiAod2luZG93LCBnYWRnZXRzKSB7XG4gIFwidXNlIHN0cmljdFwiO1xuXG4gIHZhciBwcmVmcyA9IG5ldyBnYWRnZXRzLlByZWZzKCksXG4gICAgaWQgPSBwcmVmcy5nZXRTdHJpbmcoXCJpZFwiKTtcblxuICAvLyBEaXNhYmxlIGNvbnRleHQgbWVudSAocmlnaHQgY2xpY2sgbWVudSlcbiAgd2luZG93Lm9uY29udGV4dG1lbnUgPSBmdW5jdGlvbiAoKSB7XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9O1xuXG4gIGZ1bmN0aW9uIHBsYXkoKSB7XG4gICAgUmlzZVZpc2lvbi5WaWRlby5wbGF5KCk7XG4gIH1cblxuICBmdW5jdGlvbiBwYXVzZSgpIHtcbiAgICBSaXNlVmlzaW9uLlZpZGVvLnBhdXNlKCk7XG4gIH1cblxuICBmdW5jdGlvbiBzdG9wKCkge1xuICAgIFJpc2VWaXNpb24uVmlkZW8uc3RvcCgpO1xuICB9XG5cbiAgZnVuY3Rpb24gcG9seW1lclJlYWR5KCkge1xuICAgIHdpbmRvdy5yZW1vdmVFdmVudExpc3RlbmVyKFwicG9seW1lci1yZWFkeVwiLCBwb2x5bWVyUmVhZHkpO1xuXG4gICAgaWYgKGlkICYmIGlkICE9PSBcIlwiKSB7XG4gICAgICBnYWRnZXRzLnJwYy5yZWdpc3RlcihcInJzY21kX3BsYXlfXCIgKyBpZCwgcGxheSk7XG4gICAgICBnYWRnZXRzLnJwYy5yZWdpc3RlcihcInJzY21kX3BhdXNlX1wiICsgaWQsIHBhdXNlKTtcbiAgICAgIGdhZGdldHMucnBjLnJlZ2lzdGVyKFwicnNjbWRfc3RvcF9cIiArIGlkLCBzdG9wKTtcblxuICAgICAgZ2FkZ2V0cy5ycGMucmVnaXN0ZXIoXCJyc3BhcmFtX3NldF9cIiArIGlkLCBSaXNlVmlzaW9uLlZpZGVvLnNldEFkZGl0aW9uYWxQYXJhbXMpO1xuICAgICAgZ2FkZ2V0cy5ycGMuY2FsbChcIlwiLCBcInJzcGFyYW1fZ2V0XCIsIG51bGwsIGlkLCBbXCJhZGRpdGlvbmFsUGFyYW1zXCJdKTtcbiAgICB9XG4gIH1cblxuICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcihcInBvbHltZXItcmVhZHlcIiwgcG9seW1lclJlYWR5KTtcblxufSkod2luZG93LCBnYWRnZXRzKTtcblxuXG5cbi8qIGpzaGludCBpZ25vcmU6c3RhcnQgKi9cbnZhciBfZ2FxID0gX2dhcSB8fCBbXTtcblxuX2dhcS5wdXNoKFsnX3NldEFjY291bnQnLCAnVUEtNTcwOTIxNTktMiddKTtcbl9nYXEucHVzaChbJ190cmFja1BhZ2V2aWV3J10pO1xuXG4oZnVuY3Rpb24oKSB7XG4gIHZhciBnYSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3NjcmlwdCcpOyBnYS50eXBlID0gJ3RleHQvamF2YXNjcmlwdCc7IGdhLmFzeW5jID0gdHJ1ZTtcbiAgZ2Euc3JjID0gKCdodHRwczonID09IGRvY3VtZW50LmxvY2F0aW9uLnByb3RvY29sID8gJ2h0dHBzOi8vc3NsJyA6ICdodHRwOi8vd3d3JykgKyAnLmdvb2dsZS1hbmFseXRpY3MuY29tL2dhLmpzJztcbiAgdmFyIHMgPSBkb2N1bWVudC5nZXRFbGVtZW50c0J5VGFnTmFtZSgnc2NyaXB0JylbMF07IHMucGFyZW50Tm9kZS5pbnNlcnRCZWZvcmUoZ2EsIHMpO1xufSkoKTtcbi8qIGpzaGludCBpZ25vcmU6ZW5kICovXG4iXSwic291cmNlUm9vdCI6Ii9zb3VyY2UvIn0=