var WIDGET_COMMON_CONFIG={AUTH_PATH_URL:"v1/widget/auth",LOGGER_CLIENT_ID:"1088527147109-6q1o2vtihn34292pjt4ckhmhck0rk0o7.apps.googleusercontent.com",LOGGER_CLIENT_SECRET:"nlZyrcPLg6oEwO9f9Wfn29Wh",LOGGER_REFRESH_TOKEN:"1/xzt4kwzE1H7W9VnKB8cAaCx6zb4Es4nKEoqaYHdTD15IgOrJDtdun6zK6XiATCKT",STORAGE_ENV:"prod",STORE_URL:"https://store-dot-rvaserver2.appspot.com/"},RiseVision=RiseVision||{};RiseVision.Common=RiseVision.Common||{},RiseVision.Common.LoggerUtils=function(e){"use strict";function n(e,n){Array.isArray(e)&&e.length>0&&Array.isArray(n)&&n.length>0&&("companyId"===e[0]&&(l=n[0]),"displayId"===e[1]&&(a=n[1]?n[1]:"preview"),d(l,a))}function t(t){t&&"function"==typeof t&&(d=t,l&&a?d(l,a):s&&""!==s&&(e.rpc.register("rsparam_set_"+s,n),e.rpc.call("","rsparam_get",null,s,["companyId","displayId"])))}function i(e){var n,t=/[?#&]/;return e&&"string"==typeof e?(n=e.substr(e.lastIndexOf(".")+1),t.test(n)&&(n=n.substr(0,-1!==n.indexOf("?")?n.indexOf("?"):n.length),n=n.substr(0,-1!==n.indexOf("#")?n.indexOf("#"):n.length),n=n.substr(0,-1!==n.indexOf("&")?n.indexOf("&"):n.length)),n.toLowerCase()):null}function o(e){var n=JSON.parse(JSON.stringify(u));return n.rows[0].insertId=Math.random().toString(36).substr(2).toUpperCase(),n.rows[0].json=JSON.parse(JSON.stringify(e)),n.rows[0].json.ts=(new Date).toISOString(),n}function r(e){var n=new Date,t=n.getUTCFullYear(),i=n.getUTCMonth()+1,o=n.getUTCDate();return 10>i&&(i="0"+i),10>o&&(o="0"+o),e+t+i+o}var s=(new e.Prefs).getString("id"),a="",l="",d=null,u={kind:"bigquery#tableDataInsertAllRequest",skipInvalidRows:!1,ignoreUnknownValues:!1,rows:[{insertId:""}]};return{getIds:t,getInsertData:o,getFileFormat:i,getTable:r}}(gadgets),RiseVision.Common.Logger=function(e){"use strict";function n(e){var n=new XMLHttpRequest;return new Date-d<358e4?e({}):(n.open("POST",o,!0),n.onloadend=function(){var t=JSON.parse(n.response);e({token:t.access_token,refreshedAt:new Date})},n.send(),void 0)}function t(e){return s&&l===e}function i(i,o){function c(n){var t,s,a=new XMLHttpRequest;s=r.replace("TABLE_ID",e.getTable(i)),d=n.refreshedAt||d,u=n.token||u,t=e.getInsertData(o),a.open("POST",s,!0),a.setRequestHeader("Content-Type","application/json"),a.setRequestHeader("Authorization","Bearer "+u),o.cb&&"function"==typeof o.cb&&(a.onloadend=function(){o.cb(a.response)}),a.send(JSON.stringify(t))}if(i&&o&&o.event&&!t(o.event))return s=!0,l=o.event,setTimeout(function(){s=!1},a),n(c)}var o="https://www.googleapis.com/oauth2/v3/token?client_id="+WIDGET_COMMON_CONFIG.LOGGER_CLIENT_ID+"&client_secret="+WIDGET_COMMON_CONFIG.LOGGER_CLIENT_SECRET+"&refresh_token="+WIDGET_COMMON_CONFIG.LOGGER_REFRESH_TOKEN+"&grant_type=refresh_token",r="https://www.googleapis.com/bigquery/v2/projects/client-side-events/datasets/Widget_Events/tables/TABLE_ID/insertAll",s=!1,a=1e3,l="",d=0,u="";return{log:i}}(RiseVision.Common.LoggerUtils);var RiseVision=RiseVision||{};if(RiseVision.Common=RiseVision.Common||{},RiseVision.Common.RiseCache=function(){"use strict";function e(e){var n=new XMLHttpRequest;e&&"function"==typeof e&&(n.open("GET",t+"ping?callback=_",!0),n.onreadystatechange=function(){try{4===n.readyState&&(i=!0,200===n.status?(o=!0,e(!0,n.responseText)):(console.debug("Rise Cache is not running"),o=!1,e(!1,null)))}catch(t){console.debug("Caught exception: ",t.description)}},n.send())}function n(e,n,r){function s(i){var o,s,a,l,d=new XMLHttpRequest;i?(o=r?t+"?url="+encodeURIComponent(e):t+"cb="+(new Date).getTime()+"?url="+encodeURIComponent(e),l={xhr:d,url:o},d.open("GET",o,!0),d.addEventListener("loadend",function(){var e=d.status||0;0===e||e>=200&&300>e?n(l):n(l,new Error("The request failed with status code: "+e))}),d.send()):(r?o=e:(s=e.split("?"),a=1===s.length?"?":"&",o=e+a+"cb="+(new Date).getTime()),l={xhr:null,url:o},n(l))}if(e&&n&&"function"==typeof n)return i?s(o):this.ping(s)}var t="http://localhost:9494/",i=!1,o=!1;return{getFile:n,ping:e}}(),"undefined"==typeof config){var config={SKIN:"skin/RVSkin.xml",STORAGE_ENV:"prod"};"undefined"!=typeof angular&&angular.module("risevision.common.i18n.config",[]).constant("LOCALES_PREFIX","locales/translation_").constant("LOCALES_SUFIX",".json")}var RiseVision=RiseVision||{};RiseVision.Video={},RiseVision.Video=function(e){"use strict";function n(){e.rpc.call("","rsevent_done",null,y.getString("id")),null!==A&&l(A,!0),l({event:"done"},!1)}function t(){e.rpc.call("","rsevent_ready",null,y.getString("id"),!0,!0,!0,!0,!0)}function i(){clearTimeout(L),L=null}function o(){i(),L=setTimeout(function(){n()},5e3)}function r(){var e=b.getFrameObject(T);return e?e.getPlaybackData():null}function s(e,n){var t={},i=RiseVision.Common.LoggerUtils,o=null,s=null;e.event&&(t.event=e.event),e.event_details&&(t.event_details=e.event_details),e.url?o=e.url:S&&S.length>0&&("file"===h?o=S[0]:"folder"===h&&(s=r(),s&&(o=S[s.index]))),t.file_url=o,t.file_format=i.getFileFormat(o),i.getIds(function(e,i){t.company_id=e,t.display_id=i,n(t)})}function a(e){F=!0,w.show(e),b.remove(T,function(){O||o()})}function l(e,n){n&&(A=e),s(e,function(e){N.log("video_events",e)})}function d(e){"file"===h?S[0]=e:"folder"===h&&(S=e),w.hide(),O||f()}function u(e){"file"===h?S[0]=e:"folder"===h&&(S=e),I=!1,A=null}function c(){var e=b.getFrameObject(T);return O=!0,F?(i(),void 0):(e&&e.pause(),void 0)}function f(){var e=b.getFrameObject(T);return O=!1,l({event:"play"},!1),F?(o(),void 0):(I||(e?e.play():S&&S.length>0&&("file"===h?(b.add(0),b.createFramePlayer(0,R,S[0],config.SKIN,"player-file.html")):"folder"===h&&(b.add(0),b.createFramePlayer(0,R,S,config.SKIN,"player-folder.html")))),void 0)}function g(){b.remove(T,function(){n()})}function m(){var e;w.hide(),O||(e=b.getFrameObject(T),e&&e.play())}function v(n,i){var o;R=_.clone(n),h=i,y=new e.Prefs,document.getElementById("videoContainer").style.height=y.getInt("rsH")+"px",R.width=y.getInt("rsW"),R.height=y.getInt("rsH"),w=new RiseVision.Common.Message(document.getElementById("videoContainer"),document.getElementById("messageContainer")),w.show("Please wait while your video is downloaded."),b=new RiseVision.Common.Video.FrameController,"file"===h?(o=0!==Object.keys(R.storage).length,o?(E=new RiseVision.Video.StorageFile(R),E.init()):(C=new RiseVision.Video.NonStorage(R),C.init())):"folder"===h&&(E=new RiseVision.Video.StorageFolder(R),E.init()),t()}function p(e){var n=null,t={},i="Sorry, there was a problem playing the video.";I=!0,e&&(e.type&&e.message?n=e.type+" - "+e.message:e.type?n=e.type:e.message&&(n=e.message),e.message&&"Error loading media: File could not be played"===e.message&&(i="There was a problem playing that video. It could be that we don't support that format or it is not encoded correctly.")),t.event="player error",t.event_details=n,l(t,!0),a(i)}function V(){c()}var R,h,y=null,E=null,C=null,w=null,b=null,I=!1,O=!0,T=0,S=[],A=null,L=null,F=!1,N=RiseVision.Common.Logger;return{logEvent:l,onFileInit:d,onFileRefresh:u,pause:c,play:f,setAdditionalParams:v,showError:a,playerEnded:g,playerReady:m,playerError:p,stop:V}}(gadgets);var RiseVision=RiseVision||{};RiseVision.Video=RiseVision.Video||{},RiseVision.Video.StorageFile=function(e){"use strict";function n(){var n=document.getElementById("videoStorage");n&&(n.addEventListener("rise-storage-response",function(e){e.detail&&e.detail.url&&(t?(t=!1,RiseVision.Video.onFileInit(e.detail.url)):e.detail.hasOwnProperty("changed")&&e.detail.changed&&RiseVision.Video.onFileRefresh(e.detail.url))}),n.addEventListener("rise-storage-no-file",function(){var e={event:"storage file not found"};RiseVision.Video.logEvent(e,!0),RiseVision.Video.showError("The selected video does not exist or has been moved to Trash.")}),n.addEventListener("rise-storage-file-throttled",function(e){var n={event:"storage file throttled",url:e.detail};RiseVision.Video.logEvent(n,!0),RiseVision.Video.showError("The selected video is temporarily unavailable.")}),n.addEventListener("rise-storage-error",function(){var e={event:"storage error"};RiseVision.Video.logEvent(e,!0),RiseVision.Video.showError("Sorry, there was a problem playing the video from Storage.")}),n.setAttribute("folder",e.storage.folder),n.setAttribute("fileName",e.storage.fileName),n.setAttribute("companyId",e.storage.companyId),n.setAttribute("env",config.STORAGE_ENV),n.go())}var t=!0;return{init:n}};var RiseVision=RiseVision||{};RiseVision.Video=RiseVision.Video||{},RiseVision.Video.StorageFolder=function(e){"use strict";function n(){return _.pluck(l,"url")}function t(e){return _.find(l,function(n){return e.name===n.name})}function i(e){var n=t(e);n&&l.splice(l.indexOf(n),1)}function o(e){var n=t(e);n&&(n.url=e.url)}function r(e){var n=t(e);n||(e.fileName=e.name.slice(e.name.lastIndexOf("/")+1,e.name.lastIndexOf(".")).toLowerCase(),l.splice(_.sortedIndex(l,e,"fileName"),0,e))}function s(){var t=document.getElementById("videoStorage");t&&(t.addEventListener("rise-storage-response",function(e){var t=e.detail;return t.added&&(r(t),a)?(a=!1,RiseVision.Video.onFileInit(n()),void 0):(t.changed&&o(t),t.deleted&&i(t),RiseVision.Video.onFileRefresh(n()),void 0)}),t.addEventListener("rise-storage-empty-folder",function(){var e={event:"storage folder empty"};RiseVision.Video.logEvent(e,!0),RiseVision.Video.showError("The selected folder does not contain any videos.")}),t.addEventListener("rise-storage-no-folder",function(){var e={event:"storage folder doesn't exist"};RiseVision.Video.logEvent(e,!0),RiseVision.Video.showError("The selected folder does not exist.")}),t.addEventListener("rise-storage-error",function(){var e={event:"storage error"};RiseVision.Video.logEvent(e,!0),RiseVision.Video.showError("Sorry, there was a problem playing the video from Storage.")}),t.setAttribute("fileType","video"),t.setAttribute("companyId",e.storage.companyId),t.setAttribute("folder",e.storage.folder),t.setAttribute("env",config.STORAGE_ENV),t.go())}var a=!0,l=[];return{init:s}};var RiseVision=RiseVision||{};RiseVision.Video=RiseVision.Video||{},RiseVision.Video.NonStorage=function(e){"use strict";function n(n){o.getFile(e.url,function(e,n){n?RiseVision.Video.logEvent({event:"non-storage error",event_details:n.message,url:e.url}):a?(a=!1,RiseVision.Video.onFileInit(e.url),t()):RiseVision.Video.onFileRefresh(e.url)},n)}function t(){null===s&&(s=setInterval(function(){n(!1)},r))}function i(){n(!0)}var o=RiseVision.Common.RiseCache,r=9e5,s=null,a=!0;return{init:i}};var RiseVision=RiseVision||{};RiseVision.Common=RiseVision.Common||{},RiseVision.Common.Video=RiseVision.Common.Video||{},RiseVision.Common.Video.FrameController=function(){"use strict";function e(e){return document.getElementById(l+e)}function n(n){var t,i=e(n);return t=i.querySelector("iframe"),t?t.contentWindow?t.contentWindow:t.contentDocument.document?t.contentDocument.document:t.contentDocument:null}function t(t){var i,o=e(t),r=n(t);r&&(i=o.querySelector("iframe"),r.remove(),i.setAttribute("src","about:blank"))}function i(n){var t=e(n),i=document.createElement("iframe");i.setAttribute("allowTransparency",!0),i.setAttribute("frameborder","0"),i.setAttribute("scrolling","no"),t.appendChild(i)}function o(t,i,o,r,s){var a,l=e(t),d=n(t);d&&(a=l.querySelector("iframe"),a.onload=function(){a.onload=null,d.init(i,o,r),d.load()},a.setAttribute("src",s))}function r(n){var t=e(n);t.style.visibility="hidden"}function s(e,n){var i=document.getElementById(l+e);t(e),setTimeout(function(){for(;i.firstChild;)i.removeChild(i.firstChild);n&&"function"==typeof n&&n()},200)}function a(n){var t=e(n);t.style.visibility="visible"}var l="if_";return{add:i,createFramePlayer:o,getFrameContainer:e,getFrameObject:n,hide:r,remove:s,show:a}};var RiseVision=RiseVision||{};RiseVision.Common=RiseVision.Common||{},RiseVision.Common.Message=function(e,n){"use strict";function t(){try{n.style.height=e.style.height}catch(t){console.warn("Can't initialize Message - ",t.message)}}function i(){if(r){for(;n.firstChild;)n.removeChild(n.firstChild);n.style.display="none",e.style.visibility="visible",r=!1}}function o(t){var i,o=document.createDocumentFragment();r?(i=n.querySelector(".message"),i.innerHTML=t):(e.style.visibility="hidden",n.style.display="block",i=document.createElement("p"),i.innerHTML=t,i.setAttribute("class","message"),o.appendChild(i),n.appendChild(o),r=!0)}var r=!1;return t(),{hide:i,show:o}},function(e,n){"use strict";function t(e,n){var t,i;Array.isArray(e)&&e.length>0&&"additionalParams"===e[0]&&Array.isArray(n)&&n.length>0&&(t=JSON.parse(n[0]),i=0!==Object.keys(t.storage).length?t.storage.fileName?"file":"folder":"file",RiseVision.Video.setAdditionalParams(t,i))}function i(){RiseVision.Video.play()}function o(){RiseVision.Video.pause()}function r(){RiseVision.Video.stop()}function s(){e.removeEventListener("WebComponentsReady",s),l&&""!==l&&(n.rpc.register("rscmd_play_"+l,i),n.rpc.register("rscmd_pause_"+l,o),n.rpc.register("rscmd_stop_"+l,r),n.rpc.register("rsparam_set_"+l,t),n.rpc.call("","rsparam_get",null,l,["additionalParams"]))}var a=new n.Prefs,l=a.getString("id");e.oncontextmenu=function(){return!1},e.addEventListener("WebComponentsReady",s)}(window,gadgets);var _gaq=_gaq||[];_gaq.push(["_setAccount","UA-57092159-2"]),_gaq.push(["_trackPageview"]),function(){var e=document.createElement("script");e.type="text/javascript",e.async=!0,e.src=("https:"==document.location.protocol?"https://ssl":"http://www")+".google-analytics.com/ga.js";var n=document.getElementsByTagName("script")[0];n.parentNode.insertBefore(e,n)}();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImpzL3dpZGdldC5taW4uanMiXSwibmFtZXMiOlsiV0lER0VUX0NPTU1PTl9DT05GSUciLCJBVVRIX1BBVEhfVVJMIiwiTE9HR0VSX0NMSUVOVF9JRCIsIkxPR0dFUl9DTElFTlRfU0VDUkVUIiwiTE9HR0VSX1JFRlJFU0hfVE9LRU4iLCJTVE9SQUdFX0VOViIsIlNUT1JFX1VSTCIsIlJpc2VWaXNpb24iLCJDb21tb24iLCJMb2dnZXJVdGlscyIsImdhZGdldHMiLCJzZXRJZHMiLCJuYW1lcyIsInZhbHVlcyIsIkFycmF5IiwiaXNBcnJheSIsImxlbmd0aCIsImNvbXBhbnlJZCIsImRpc3BsYXlJZCIsImNhbGxiYWNrIiwiZ2V0SWRzIiwiY2IiLCJpZCIsInJwYyIsInJlZ2lzdGVyIiwiY2FsbCIsImdldEZpbGVGb3JtYXQiLCJ1cmwiLCJzdHIiLCJoYXNQYXJhbXMiLCJzdWJzdHIiLCJsYXN0SW5kZXhPZiIsInRlc3QiLCJpbmRleE9mIiwidG9Mb3dlckNhc2UiLCJnZXRJbnNlcnREYXRhIiwicGFyYW1zIiwiZGF0YSIsIkpTT04iLCJwYXJzZSIsInN0cmluZ2lmeSIsIkJBU0VfSU5TRVJUX1NDSEVNQSIsInJvd3MiLCJpbnNlcnRJZCIsIk1hdGgiLCJyYW5kb20iLCJ0b1N0cmluZyIsInRvVXBwZXJDYXNlIiwianNvbiIsInRzIiwiRGF0ZSIsInRvSVNPU3RyaW5nIiwiZ2V0VGFibGUiLCJuYW1lIiwiZGF0ZSIsInllYXIiLCJnZXRVVENGdWxsWWVhciIsIm1vbnRoIiwiZ2V0VVRDTW9udGgiLCJkYXkiLCJnZXRVVENEYXRlIiwiUHJlZnMiLCJnZXRTdHJpbmciLCJraW5kIiwic2tpcEludmFsaWRSb3dzIiwiaWdub3JlVW5rbm93blZhbHVlcyIsIkxvZ2dlciIsInV0aWxzIiwicmVmcmVzaFRva2VuIiwieGhyIiwiWE1MSHR0cFJlcXVlc3QiLCJyZWZyZXNoRGF0ZSIsIm9wZW4iLCJSRUZSRVNIX1VSTCIsIm9ubG9hZGVuZCIsInJlc3AiLCJyZXNwb25zZSIsInRva2VuIiwiYWNjZXNzX3Rva2VuIiwicmVmcmVzaGVkQXQiLCJzZW5kIiwiaXNUaHJvdHRsZWQiLCJldmVudCIsInRocm90dGxlIiwibGFzdEV2ZW50IiwibG9nIiwidGFibGVOYW1lIiwiaW5zZXJ0V2l0aFRva2VuIiwicmVmcmVzaERhdGEiLCJpbnNlcnREYXRhIiwic2VydmljZVVybCIsInJlcGxhY2UiLCJzZXRSZXF1ZXN0SGVhZGVyIiwic2V0VGltZW91dCIsInRocm90dGxlRGVsYXkiLCJSaXNlQ2FjaGUiLCJwaW5nIiwiciIsIkJBU0VfQ0FDSEVfVVJMIiwib25yZWFkeXN0YXRlY2hhbmdlIiwicmVhZHlTdGF0ZSIsIl9waW5nUmVjZWl2ZWQiLCJzdGF0dXMiLCJfaXNDYWNoZVJ1bm5pbmciLCJyZXNwb25zZVRleHQiLCJjb25zb2xlIiwiZGVidWciLCJlIiwiZGVzY3JpcHRpb24iLCJnZXRGaWxlIiwiZmlsZVVybCIsIm5vY2FjaGVidXN0ZXIiLCJmaWxlUmVxdWVzdCIsImlzQ2FjaGVSdW5uaW5nIiwic2VwYXJhdG9yIiwicmVxdWVzdCIsImVuY29kZVVSSUNvbXBvbmVudCIsImdldFRpbWUiLCJhZGRFdmVudExpc3RlbmVyIiwiRXJyb3IiLCJzcGxpdCIsInRoaXMiLCJjb25maWciLCJTS0lOIiwiYW5ndWxhciIsIm1vZHVsZSIsImNvbnN0YW50IiwiVmlkZW8iLCJfZG9uZSIsIl9wcmVmcyIsIl9lcnJvciIsImxvZ0V2ZW50IiwiX3JlYWR5IiwiX2NsZWFyRXJyb3JUaW1lciIsImNsZWFyVGltZW91dCIsIl9lcnJvclRpbWVyIiwiX3N0YXJ0RXJyb3JUaW1lciIsIl9nZXRDdXJyZW50RmlsZURhdGEiLCJmcmFtZU9iaiIsIl9mcmFtZUNvbnRyb2xsZXIiLCJnZXRGcmFtZU9iamVjdCIsIl9jdXJyZW50RnJhbWUiLCJnZXRQbGF5YmFja0RhdGEiLCJfZ2V0TG9nZ2VyUGFyYW1zIiwiZmlsZURhdGEiLCJldmVudF9kZXRhaWxzIiwiX2N1cnJlbnRGaWxlcyIsIl9tb2RlIiwiaW5kZXgiLCJmaWxlX3VybCIsImZpbGVfZm9ybWF0IiwiY29tcGFueV9pZCIsImRpc3BsYXlfaWQiLCJzaG93RXJyb3IiLCJtZXNzYWdlIiwiX2Vycm9yRmxhZyIsIl9tZXNzYWdlIiwic2hvdyIsInJlbW92ZSIsIl92aWV3ZXJQYXVzZWQiLCJpc0Vycm9yIiwiX2xvZ2dlciIsIm9uRmlsZUluaXQiLCJ1cmxzIiwiaGlkZSIsInBsYXkiLCJvbkZpbGVSZWZyZXNoIiwiX3BsYXliYWNrRXJyb3IiLCJwYXVzZSIsImFkZCIsImNyZWF0ZUZyYW1lUGxheWVyIiwiX2FkZGl0aW9uYWxQYXJhbXMiLCJwbGF5ZXJFbmRlZCIsInBsYXllclJlYWR5Iiwic2V0QWRkaXRpb25hbFBhcmFtcyIsIm1vZGUiLCJpc1N0b3JhZ2VGaWxlIiwiXyIsImNsb25lIiwiZG9jdW1lbnQiLCJnZXRFbGVtZW50QnlJZCIsInN0eWxlIiwiaGVpZ2h0IiwiZ2V0SW50Iiwid2lkdGgiLCJNZXNzYWdlIiwiRnJhbWVDb250cm9sbGVyIiwiT2JqZWN0Iiwia2V5cyIsInN0b3JhZ2UiLCJfc3RvcmFnZSIsIlN0b3JhZ2VGaWxlIiwiaW5pdCIsIl9ub25TdG9yYWdlIiwiTm9uU3RvcmFnZSIsIlN0b3JhZ2VGb2xkZXIiLCJwbGF5ZXJFcnJvciIsImVycm9yIiwiZGV0YWlscyIsInR5cGUiLCJzdG9wIiwiZGV0YWlsIiwiX2luaXRpYWxMb2FkIiwiaGFzT3duUHJvcGVydHkiLCJjaGFuZ2VkIiwic2V0QXR0cmlidXRlIiwiZm9sZGVyIiwiZmlsZU5hbWUiLCJnbyIsIl9nZXRVcmxzIiwicGx1Y2siLCJfZmlsZXMiLCJfZ2V0RXhpc3RpbmdGaWxlIiwiZmlsZSIsImZpbmQiLCJmIiwiX2RlbGV0ZUZpbGUiLCJleGlzdGluZyIsInNwbGljZSIsIl9jaGFuZ2VGaWxlIiwiX2FkZEZpbGUiLCJzbGljZSIsInNvcnRlZEluZGV4IiwiYWRkZWQiLCJkZWxldGVkIiwiX2dldEZpbGUiLCJvbWl0Q2FjaGVCdXN0ZXIiLCJyaXNlQ2FjaGUiLCJfaXNMb2FkaW5nIiwiX3N0YXJ0UmVmcmVzaEludGVydmFsIiwiX3JlZnJlc2hJbnRlcnZhbElkIiwic2V0SW50ZXJ2YWwiLCJfcmVmcmVzaER1cmF0aW9uIiwiZ2V0RnJhbWVDb250YWluZXIiLCJQUkVGSVgiLCJpZnJhbWUiLCJmcmFtZUNvbnRhaW5lciIsInF1ZXJ5U2VsZWN0b3IiLCJjb250ZW50V2luZG93IiwiY29udGVudERvY3VtZW50IiwiX2NsZWFyIiwiY3JlYXRlRWxlbWVudCIsImFwcGVuZENoaWxkIiwiZmlsZXMiLCJza2luIiwic3JjIiwib25sb2FkIiwibG9hZCIsInZpc2liaWxpdHkiLCJmaXJzdENoaWxkIiwicmVtb3ZlQ2hpbGQiLCJtYWluQ29udGFpbmVyIiwibWVzc2FnZUNvbnRhaW5lciIsIl9pbml0Iiwid2FybiIsIl9hY3RpdmUiLCJkaXNwbGF5IiwicCIsImZyYWdtZW50IiwiY3JlYXRlRG9jdW1lbnRGcmFnbWVudCIsImlubmVySFRNTCIsIndpbmRvdyIsImNvbmZpZ3VyZSIsImFkZGl0aW9uYWxQYXJhbXMiLCJwb2x5bWVyUmVhZHkiLCJyZW1vdmVFdmVudExpc3RlbmVyIiwicHJlZnMiLCJvbmNvbnRleHRtZW51IiwiX2dhcSIsInB1c2giLCJnYSIsImFzeW5jIiwibG9jYXRpb24iLCJwcm90b2NvbCIsInMiLCJnZXRFbGVtZW50c0J5VGFnTmFtZSIsInBhcmVudE5vZGUiLCJpbnNlcnRCZWZvcmUiXSwibWFwcGluZ3MiOiJBQUFBLEdBQUlBLHVCQUNGQyxjQUFlLGlCQUNmQyxpQkFBa0IsNEVBQ2xCQyxxQkFBc0IsMkJBQ3RCQyxxQkFBc0IscUVBQ3RCQyxZQUFhLE9BQ2JDLFVBQVcsNkNBSVRDLFdBQWFBLGNBQ2pCQSxZQUFXQyxPQUFTRCxXQUFXQyxXQUUvQkQsV0FBV0MsT0FBT0MsWUFBYyxTQUFVQyxHQUN4QyxZQXNCQSxTQUFTQyxHQUFPQyxFQUFPQyxHQUNqQkMsTUFBTUMsUUFBUUgsSUFBVUEsRUFBTUksT0FBUyxHQUNyQ0YsTUFBTUMsUUFBUUYsSUFBV0EsRUFBT0cs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LEVBQUdDLE9BQVEsRUFDbkZELEVBQUd6QixLQUFPLFVBQVlsRSxTQUFTNkYsU0FBU0MsU0FBVyxjQUFnQixjQUFnQiw2QkFDbkYsSUFBSUMsR0FBSS9GLFNBQVNnRyxxQkFBcUIsVUFBVSxFQUFJRCxHQUFFRSxXQUFXQyxhQUFhUCxFQUFJSSIsImZpbGUiOiJqcy93aWRnZXQubWluLmpzIiwic291cmNlc0NvbnRlbnQiOlsidmFyIFdJREdFVF9DT01NT05fQ09ORklHID0ge1xuICBBVVRIX1BBVEhfVVJMOiBcInYxL3dpZGdldC9hdXRoXCIsXG4gIExPR0dFUl9DTElFTlRfSUQ6IFwiMTA4ODUyNzE0NzEwOS02cTFvMnZ0aWhuMzQyOTJwanQ0Y2tobWhjazByazBvNy5hcHBzLmdvb2dsZXVzZXJjb250ZW50LmNvbVwiLFxuICBMT0dHRVJfQ0xJRU5UX1NFQ1JFVDogXCJubFp5cmNQTGc2b0V3TzlmOVdmbjI5V2hcIixcbiAgTE9HR0VSX1JFRlJFU0hfVE9LRU46IFwiMS94enQ0a3d6RTFIN1c5Vm5LQjhjQWFDeDZ6YjRFczRuS0VvcWFZSGRURDE1SWdPckpEdGR1bjZ6SzZYaUFUQ0tUXCIsXG4gIFNUT1JBR0VfRU5WOiBcInByb2RcIixcbiAgU1RPUkVfVVJMOiBcImh0dHBzOi8vc3RvcmUtZG90LXJ2YXNlcnZlcjIuYXBwc3BvdC5jb20vXCJcbn07XG4vKiBnbG9iYWwgZ2FkZ2V0cyAqL1xuXG52YXIgUmlzZVZpc2lvbiA9IFJpc2VWaXNpb24gfHwge307XG5SaXNlVmlzaW9uLkNvbW1vbiA9IFJpc2VWaXNpb24uQ29tbW9uIHx8IHt9O1xuXG5SaXNlVmlzaW9uLkNvbW1vbi5Mb2dnZXJVdGlscyA9IChmdW5jdGlvbihnYWRnZXRzKSB7XG4gIFwidXNlIHN0cmljdFwiO1xuXG4gICB2YXIgaWQgPSBuZXcgZ2FkZ2V0cy5QcmVmcygpLmdldFN0cmluZyhcImlkXCIpLFxuICAgIGRpc3BsYXlJZCA9IFwiXCIsXG4gICAgY29tcGFueUlkID0gXCJcIixcbiAgICBjYWxsYmFjayA9IG51bGw7XG5cbiAgdmFyIEJBU0VfSU5TRVJUX1NDSEVNQSA9XG4gIHtcbiAgICBcImtpbmRcIjogXCJiaWdxdWVyeSN0YWJsZURhdGFJbnNlcnRBbGxSZXF1ZXN0XCIsXG4gICAgXCJza2lwSW52YWxpZFJvd3NcIjogZmFsc2UsXG4gICAgXCJpZ25vcmVVbmtub3duVmFsdWVzXCI6IGZhbHNlLFxuICAgIFwicm93c1wiOiBbe1xuICAgICAgXCJpbnNlcnRJZFwiOiBcIlwiXG4gICAgfV1cbiAgfTtcblxuICAvKlxuICAgKiAgUHJpdmF0ZSBNZXRob2RzXG4gICAqL1xuXG4gIC8qIFNldCB0aGUgQ29tcGFueSBhbmQgRGlzcGxheSBJRHMuICovXG4gIGZ1bmN0aW9uIHNldElkcyhuYW1lcywgdmFsdWVzKSB7XG4gICAgaWYgKEFycmF5LmlzQXJyYXkobmFtZXMpICYmIG5hbWVzLmxlbmd0aCA+IDApIHtcbiAgICAgIGlmIChBcnJheS5pc0FycmF5KHZhbHVlcykgJiYgdmFsdWVzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgaWYgKG5hbWVzWzBdID09PSBcImNvbXBhbnlJZFwiKSB7XG4gICAgICAgICAgY29tcGFueUlkID0gdmFsdWVzWzBdO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKG5hbWVzWzFdID09PSBcImRpc3BsYXlJZFwiKSB7XG4gICAgICAgICAgaWYgKHZhbHVlc1sxXSkge1xuICAgICAgICAgICAgZGlzcGxheUlkID0gdmFsdWVzWzFdO1xuICAgICAgICAgIH1cbiAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIGRpc3BsYXlJZCA9IFwicHJldmlld1wiO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIGNhbGxiYWNrKGNvbXBhbnlJZCwgZGlzcGxheUlkKTtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICAvKlxuICAgKiAgUHVibGljIE1ldGhvZHNcbiAgICovXG4gIGZ1bmN0aW9uIGdldElkcyhjYikge1xuICAgIGlmICghY2IgfHwgdHlwZW9mIGNiICE9PSBcImZ1bmN0aW9uXCIpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICBjYWxsYmFjayA9IGNiO1xuICAgIH1cblxuICAgIGlmIChjb21wYW55SWQgJiYgZGlzcGxheUlkKSB7XG4gICAgICBjYWxsYmFjayhjb21wYW55SWQsIGRpc3BsYXlJZCk7XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgaWYgKGlkICYmIGlkICE9PSBcIlwiKSB7XG4gICAgICAgIGdhZGdldHMucnBjLnJlZ2lzdGVyKFwicnNwYXJhbV9zZXRfXCIgKyBpZCwgc2V0SWRzKTtcbiAgICAgICAgZ2FkZ2V0cy5ycGMuY2FsbChcIlwiLCBcInJzcGFyYW1fZ2V0XCIsIG51bGwsIGlkLCBbXCJjb21wYW55SWRcIiwgXCJkaXNwbGF5SWRcIl0pO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIGZ1bmN0aW9uIGdldEZpbGVGb3JtYXQodXJsKSB7XG4gICAgdmFyIGhhc1BhcmFtcyA9IC9bPyMmXS8sXG4gICAgICBzdHI7XG5cbiAgICBpZiAoIXVybCB8fCB0eXBlb2YgdXJsICE9PSBcInN0cmluZ1wiKSB7XG4gICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG5cbiAgICBzdHIgPSB1cmwuc3Vic3RyKHVybC5sYXN0SW5kZXhPZihcIi5cIikgKyAxKTtcblxuICAgIC8vIGRvbid0IGluY2x1ZGUgYW55IHBhcmFtcyBhZnRlciB0aGUgZmlsZW5hbWVcbiAgICBpZiAoaGFzUGFyYW1zLnRlc3Qoc3RyKSkge1xuICAgICAgc3RyID0gc3RyLnN1YnN0cigwICwoc3RyLmluZGV4T2YoXCI/XCIpICE9PSAtMSkgPyBzdHIuaW5kZXhPZihcIj9cIikgOiBzdHIubGVuZ3RoKTtcblxuICAgICAgc3RyID0gc3RyLnN1YnN0cigwLCAoc3RyLmluZGV4T2YoXCIjXCIpICE9PSAtMSkgPyBzdHIuaW5kZXhPZihcIiNcIikgOiBzdHIubGVuZ3RoKTtcblxuICAgICAgc3RyID0gc3RyLnN1YnN0cigwLCAoc3RyLmluZGV4T2YoXCImXCIpICE9PSAtMSkgPyBzdHIuaW5kZXhPZihcIiZcIikgOiBzdHIubGVuZ3RoKTtcbiAgICB9XG5cbiAgICByZXR1cm4gc3RyLnRvTG93ZXJDYXNlKCk7XG4gIH1cblxuICBmdW5jdGlvbiBnZXRJbnNlcnREYXRhKHBhcmFtcykge1xuICAgIHZhciBkYXRhID0gSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeShCQVNFX0lOU0VSVF9TQ0hFTUEpKTtcblxuICAgIGRhdGEucm93c1swXS5pbnNlcnRJZCA9IE1hdGgucmFuZG9tKCkudG9TdHJpbmcoMzYpLnN1YnN0cigyKS50b1VwcGVyQ2FzZSgpO1xuICAgIGRhdGEucm93c1swXS5qc29uID0gSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeShwYXJhbXMpKTtcbiAgICBkYXRhLnJvd3NbMF0uanNvbi50cyA9IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKTtcblxuICAgIHJldHVybiBkYXRhO1xuICB9XG5cbiAgZnVuY3Rpb24gZ2V0VGFibGUobmFtZSkge1xuICAgIHZhciBkYXRlID0gbmV3IERhdGUoKSxcbiAgICAgIHllYXIgPSBkYXRlLmdldFVUQ0Z1bGxZZWFyKCksXG4gICAgICBtb250aCA9IGRhdGUuZ2V0VVRDTW9udGgoKSArIDEsXG4gICAgICBkYXkgPSBkYXRlLmdldFVUQ0RhdGUoKTtcblxuICAgIGlmIChtb250aCA8IDEwKSB7XG4gICAgICBtb250aCA9IFwiMFwiICsgbW9udGg7XG4gICAgfVxuXG4gICAgaWYgKGRheSA8IDEwKSB7XG4gICAgICBkYXkgPSBcIjBcIiArIGRheTtcbiAgICB9XG5cbiAgICByZXR1cm4gbmFtZSArIHllYXIgKyBtb250aCArIGRheTtcbiAgfVxuXG4gIHJldHVybiB7XG4gICAgXCJnZXRJZHNcIjogZ2V0SWRzLFxuICAgIFwiZ2V0SW5zZXJ0RGF0YVwiOiBnZXRJbnNlcnREYXRhLFxuICAgIFwiZ2V0RmlsZUZvcm1hdFwiOiBnZXRGaWxlRm9ybWF0LFxuICAgIFwiZ2V0VGFibGVcIjogZ2V0VGFibGVcbiAgfTtcbn0pKGdhZGdldHMpO1xuXG5SaXNlVmlzaW9uLkNvbW1vbi5Mb2dnZXIgPSAoZnVuY3Rpb24odXRpbHMpIHtcbiAgXCJ1c2Ugc3RyaWN0XCI7XG5cbiAgdmFyIFJFRlJFU0hfVVJMID0gXCJodHRwczovL3d3dy5nb29nbGVhcGlzLmNvbS9vYXV0aDIvdjMvdG9rZW4/Y2xpZW50X2lkPVwiICsgV0lER0VUX0NPTU1PTl9DT05GSUcuTE9HR0VSX0NMSUVOVF9JRCArXG4gICAgICBcIiZjbGllbnRfc2VjcmV0PVwiICsgV0lER0VUX0NPTU1PTl9DT05GSUcuTE9HR0VSX0NMSUVOVF9TRUNSRVQgK1xuICAgICAgXCImcmVmcmVzaF90b2tlbj1cIiArIFdJREdFVF9DT01NT05fQ09ORklHLkxPR0dFUl9SRUZSRVNIX1RPS0VOICtcbiAgICAgIFwiJmdyYW50X3R5cGU9cmVmcmVzaF90b2tlblwiO1xuXG4gIHZhciBzZXJ2aWNlVXJsID0gXCJodHRwczovL3d3dy5nb29nbGVhcGlzLmNvbS9iaWdxdWVyeS92Mi9wcm9qZWN0cy9jbGllbnQtc2lkZS1ldmVudHMvZGF0YXNldHMvV2lkZ2V0X0V2ZW50cy90YWJsZXMvVEFCTEVfSUQvaW5zZXJ0QWxsXCIsXG4gICAgdGhyb3R0bGUgPSBmYWxzZSxcbiAgICB0aHJvdHRsZURlbGF5ID0gMTAwMCxcbiAgICBsYXN0RXZlbnQgPSBcIlwiLFxuICAgIHJlZnJlc2hEYXRlID0gMCxcbiAgICB0b2tlbiA9IFwiXCI7XG5cbiAgLypcbiAgICogIFByaXZhdGUgTWV0aG9kc1xuICAgKi9cbiAgZnVuY3Rpb24gcmVmcmVzaFRva2VuKGNiKSB7XG4gICAgdmFyIHhociA9IG5ldyBYTUxIdHRwUmVxdWVzdCgpO1xuXG4gICAgaWYgKG5ldyBEYXRlKCkgLSByZWZyZXNoRGF0ZSA8IDM1ODAwMDApIHtcbiAgICAgIHJldHVybiBjYih7fSk7XG4gICAgfVxuXG4gICAgeGhyLm9wZW4oXCJQT1NUXCIsIFJFRlJFU0hfVVJMLCB0cnVlKTtcbiAgICB4aHIub25sb2FkZW5kID0gZnVuY3Rpb24oKSB7XG4gICAgICB2YXIgcmVzcCA9IEpTT04ucGFyc2UoeGhyLnJlc3BvbnNlKTtcblxuICAgICAgY2IoeyB0b2tlbjogcmVzcC5hY2Nlc3NfdG9rZW4sIHJlZnJlc2hlZEF0OiBuZXcgRGF0ZSgpIH0pO1xuICAgIH07XG5cbiAgICB4aHIuc2VuZCgpO1xuICB9XG5cbiAgZnVuY3Rpb24gaXNUaHJvdHRsZWQoZXZlbnQpIHtcbiAgICByZXR1cm4gdGhyb3R0bGUgJiYgKGxhc3RFdmVudCA9PT0gZXZlbnQpO1xuICB9XG5cbiAgLypcbiAgICogIFB1YmxpYyBNZXRob2RzXG4gICAqL1xuICBmdW5jdGlvbiBsb2codGFibGVOYW1lLCBwYXJhbXMpIHtcbiAgICBpZiAoIXRhYmxlTmFtZSB8fCAhcGFyYW1zIHx8ICFwYXJhbXMuZXZlbnQgfHwgaXNUaHJvdHRsZWQocGFyYW1zLmV2ZW50KSkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIHRocm90dGxlID0gdHJ1ZTtcbiAgICBsYXN0RXZlbnQgPSBwYXJhbXMuZXZlbnQ7XG5cbiAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHtcbiAgICAgIHRocm90dGxlID0gZmFsc2U7XG4gICAgfSwgdGhyb3R0bGVEZWxheSk7XG5cbiAgICBmdW5jdGlvbiBpbnNlcnRXaXRoVG9rZW4ocmVmcmVzaERhdGEpIHtcbiAgICAgIHZhciB4aHIgPSBuZXcgWE1MSHR0cFJlcXVlc3QoKSxcbiAgICAgICAgaW5zZXJ0RGF0YSwgdXJsO1xuXG4gICAgICB1cmwgPSBzZXJ2aWNlVXJsLnJlcGxhY2UoXCJUQUJMRV9JRFwiLCB1dGlscy5nZXRUYWJsZSh0YWJsZU5hbWUpKTtcbiAgICAgIHJlZnJlc2hEYXRlID0gcmVmcmVzaERhdGEucmVmcmVzaGVkQXQgfHwgcmVmcmVzaERhdGU7XG4gICAgICB0b2tlbiA9IHJlZnJlc2hEYXRhLnRva2VuIHx8IHRva2VuO1xuICAgICAgaW5zZXJ0RGF0YSA9IHV0aWxzLmdldEluc2VydERhdGEocGFyYW1zKTtcblxuICAgICAgLy8gSW5zZXJ0IHRoZSBkYXRhLlxuICAgICAgeGhyLm9wZW4oXCJQT1NUXCIsIHVybCwgdHJ1ZSk7XG4gICAgICB4aHIuc2V0UmVxdWVzdEhlYWRlcihcIkNvbnRlbnQtVHlwZVwiLCBcImFwcGxpY2F0aW9uL2pzb25cIik7XG4gICAgICB4aHIuc2V0UmVxdWVzdEhlYWRlcihcIkF1dGhvcml6YXRpb25cIiwgXCJCZWFyZXIgXCIgKyB0b2tlbik7XG5cbiAgICAgIGlmIChwYXJhbXMuY2IgJiYgdHlwZW9mIHBhcmFtcy5jYiA9PT0gXCJmdW5jdGlvblwiKSB7XG4gICAgICAgIHhoci5vbmxvYWRlbmQgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICBwYXJhbXMuY2IoeGhyLnJlc3BvbnNlKTtcbiAgICAgICAgfTtcbiAgICAgIH1cblxuICAgICAgeGhyLnNlbmQoSlNPTi5zdHJpbmdpZnkoaW5zZXJ0RGF0YSkpO1xuICAgIH1cblxuICAgIHJldHVybiByZWZyZXNoVG9rZW4oaW5zZXJ0V2l0aFRva2VuKTtcbiAgfVxuXG4gIHJldHVybiB7XG4gICAgXCJsb2dcIjogbG9nXG4gIH07XG59KShSaXNlVmlzaW9uLkNvbW1vbi5Mb2dnZXJVdGlscyk7XG52YXIgUmlzZVZpc2lvbiA9IFJpc2VWaXNpb24gfHwge307XG5SaXNlVmlzaW9uLkNvbW1vbiA9IFJpc2VWaXNpb24uQ29tbW9uIHx8IHt9O1xuXG5SaXNlVmlzaW9uLkNvbW1vbi5SaXNlQ2FjaGUgPSAoZnVuY3Rpb24gKCkge1xuICBcInVzZSBzdHJpY3RcIjtcblxuICB2YXIgQkFTRV9DQUNIRV9VUkwgPSBcImh0dHA6Ly9sb2NhbGhvc3Q6OTQ5NC9cIjtcblxuICB2YXIgX3BpbmdSZWNlaXZlZCA9IGZhbHNlLFxuICAgIF9pc0NhY2hlUnVubmluZyA9IGZhbHNlO1xuXG4gIGZ1bmN0aW9uIHBpbmcoY2FsbGJhY2spIHtcbiAgICB2YXIgciA9IG5ldyBYTUxIdHRwUmVxdWVzdCgpO1xuXG4gICAgaWYgKCFjYWxsYmFjayB8fCB0eXBlb2YgY2FsbGJhY2sgIT09IFwiZnVuY3Rpb25cIikge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIHIub3BlbihcIkdFVFwiLCBCQVNFX0NBQ0hFX1VSTCArIFwicGluZz9jYWxsYmFjaz1fXCIsIHRydWUpO1xuICAgIHIub25yZWFkeXN0YXRlY2hhbmdlID0gZnVuY3Rpb24gKCkge1xuICAgICAgdHJ5IHtcbiAgICAgICAgaWYgKHIucmVhZHlTdGF0ZSA9PT0gNCApIHtcbiAgICAgICAgICAvLyBzYXZlIHRoaXMgcmVzdWx0IGZvciB1c2UgaW4gZ2V0RmlsZSgpXG4gICAgICAgICAgX3BpbmdSZWNlaXZlZCA9IHRydWU7XG5cbiAgICAgICAgICBpZihyLnN0YXR1cyA9PT0gMjAwKXtcbiAgICAgICAgICAgIF9pc0NhY2hlUnVubmluZyA9IHRydWU7XG5cbiAgICAgICAgICAgIGNhbGxiYWNrKHRydWUsIHIucmVzcG9uc2VUZXh0KTtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgY29uc29sZS5kZWJ1ZyhcIlJpc2UgQ2FjaGUgaXMgbm90IHJ1bm5pbmdcIik7XG4gICAgICAgICAgICBfaXNDYWNoZVJ1bm5pbmcgPSBmYWxzZTtcblxuICAgICAgICAgICAgY2FsbGJhY2soZmFsc2UsIG51bGwpO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgY2F0Y2ggKGUpIHtcbiAgICAgICAgY29uc29sZS5kZWJ1ZyhcIkNhdWdodCBleGNlcHRpb246IFwiLCBlLmRlc2NyaXB0aW9uKTtcbiAgICAgIH1cblxuICAgIH07XG4gICAgci5zZW5kKCk7XG4gIH1cblxuICBmdW5jdGlvbiBnZXRGaWxlKGZpbGVVcmwsIGNhbGxiYWNrLCBub2NhY2hlYnVzdGVyKSB7XG4gICAgaWYgKCFmaWxlVXJsIHx8ICFjYWxsYmFjayB8fCB0eXBlb2YgY2FsbGJhY2sgIT09IFwiZnVuY3Rpb25cIikge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIGZpbGVSZXF1ZXN0KGlzQ2FjaGVSdW5uaW5nKSB7XG4gICAgICB2YXIgeGhyID0gbmV3IFhNTEh0dHBSZXF1ZXN0KCksXG4gICAgICAgIHVybCwgc3RyLCBzZXBhcmF0b3IsIHJlcXVlc3Q7XG5cbiAgICAgIGlmIChpc0NhY2hlUnVubmluZykge1xuICAgICAgICAvLyBjb25maWd1cmUgdXJsIHdpdGggY2FjaGVidXN0ZXIgb3Igbm90XG4gICAgICAgIHVybCA9IChub2NhY2hlYnVzdGVyKSA/IEJBU0VfQ0FDSEVfVVJMICsgXCI/dXJsPVwiICsgZW5jb2RlVVJJQ29tcG9uZW50KGZpbGVVcmwpIDpcbiAgICAgICAgICBCQVNFX0NBQ0hFX1VSTCArIFwiY2I9XCIgKyBuZXcgRGF0ZSgpLmdldFRpbWUoKSArIFwiP3VybD1cIiArIGVuY29kZVVSSUNvbXBvbmVudChmaWxlVXJsKTtcblxuICAgICAgICAvLyBjdXN0b20gcmVxdWVzdCBvYmplY3QgdG8gcHJvdmlkZSBpbiByZXNwb25zZVxuICAgICAgICByZXF1ZXN0ID0ge1xuICAgICAgICAgIHhocjogeGhyLFxuICAgICAgICAgIHVybDogdXJsXG4gICAgICAgIH07XG5cbiAgICAgICAgeGhyLm9wZW4oXCJHRVRcIiwgdXJsLCB0cnVlKTtcblxuICAgICAgICB4aHIuYWRkRXZlbnRMaXN0ZW5lcignbG9hZGVuZCcsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICB2YXIgc3RhdHVzID0geGhyLnN0YXR1cyB8fCAwO1xuXG4gICAgICAgICAgaWYgKHN0YXR1cyA9PT0gMCB8fCAoc3RhdHVzID49IDIwMCAmJiBzdGF0dXMgPCAzMDApKSB7XG4gICAgICAgICAgICBjYWxsYmFjayhyZXF1ZXN0KTtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgY2FsbGJhY2socmVxdWVzdCwgbmV3IEVycm9yKFwiVGhlIHJlcXVlc3QgZmFpbGVkIHdpdGggc3RhdHVzIGNvZGU6IFwiICsgc3RhdHVzKSk7XG4gICAgICAgICAgfVxuICAgICAgICB9KTtcblxuICAgICAgICB4aHIuc2VuZCgpO1xuXG4gICAgICB9IGVsc2Uge1xuXG4gICAgICAgIGlmIChub2NhY2hlYnVzdGVyKSB7XG4gICAgICAgICAgdXJsID0gZmlsZVVybDtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBzdHIgPSBmaWxlVXJsLnNwbGl0KFwiP1wiKTtcbiAgICAgICAgICBzZXBhcmF0b3IgPSAoc3RyLmxlbmd0aCA9PT0gMSkgPyBcIj9cIiA6IFwiJlwiO1xuXG4gICAgICAgICAgdXJsID0gZmlsZVVybCArIHNlcGFyYXRvciArIFwiY2I9XCIgKyBuZXcgRGF0ZSgpLmdldFRpbWUoKTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIGN1c3RvbSByZXF1ZXN0IG9iamVjdCB0byBwcm92aWRlIGluIHJlc3BvbnNlXG4gICAgICAgIHJlcXVlc3QgPSB7XG4gICAgICAgICAgeGhyOiBudWxsLFxuICAgICAgICAgIHVybDogdXJsXG4gICAgICAgIH07XG5cbiAgICAgICAgY2FsbGJhY2socmVxdWVzdCk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgaWYgKCFfcGluZ1JlY2VpdmVkKSB7XG4gICAgICAvKiBqc2hpbnQgdmFsaWR0aGlzOiB0cnVlICovXG4gICAgICByZXR1cm4gdGhpcy5waW5nKGZpbGVSZXF1ZXN0KTtcbiAgICB9IGVsc2Uge1xuICAgICAgcmV0dXJuIGZpbGVSZXF1ZXN0KF9pc0NhY2hlUnVubmluZyk7XG4gICAgfVxuXG4gIH1cblxuICByZXR1cm4ge1xuICAgIGdldEZpbGU6IGdldEZpbGUsXG4gICAgcGluZzogcGluZ1xuICB9O1xuXG59KSgpO1xuXG4vKiBnbG9iYWwgY29uZmlnOiB0cnVlICovXG4vKiBleHBvcnRlZCBjb25maWcgKi9cbmlmICh0eXBlb2YgY29uZmlnID09PSBcInVuZGVmaW5lZFwiKSB7XG4gIHZhciBjb25maWcgPSB7XG4gICAgU0tJTjogXCJza2luL1JWU2tpbi54bWxcIixcbiAgICBTVE9SQUdFX0VOVjogXCJwcm9kXCJcbiAgfTtcblxuICBpZiAodHlwZW9mIGFuZ3VsYXIgIT09IFwidW5kZWZpbmVkXCIpIHtcbiAgICBhbmd1bGFyLm1vZHVsZShcInJpc2V2aXNpb24uY29tbW9uLmkxOG4uY29uZmlnXCIsIFtdKVxuICAgICAgLmNvbnN0YW50KFwiTE9DQUxFU19QUkVGSVhcIiwgXCJsb2NhbGVzL3RyYW5zbGF0aW9uX1wiKVxuICAgICAgLmNvbnN0YW50KFwiTE9DQUxFU19TVUZJWFwiLCBcIi5qc29uXCIpO1xuICB9XG59XG5cbi8qIGdsb2JhbCBnYWRnZXRzLCBjb25maWcsIF8gKi9cblxudmFyIFJpc2VWaXNpb24gPSBSaXNlVmlzaW9uIHx8IHt9O1xuUmlzZVZpc2lvbi5WaWRlbyA9IHt9O1xuXG5SaXNlVmlzaW9uLlZpZGVvID0gKGZ1bmN0aW9uIChnYWRnZXRzKSB7XG4gIFwidXNlIHN0cmljdFwiO1xuXG4gIHZhciBfYWRkaXRpb25hbFBhcmFtcywgX21vZGU7XG5cbiAgdmFyIF9wcmVmcyA9IG51bGwsXG4gICAgX3N0b3JhZ2UgPSBudWxsLFxuICAgIF9ub25TdG9yYWdlID0gbnVsbCxcbiAgICBfbWVzc2FnZSA9IG51bGwsXG4gICAgX2ZyYW1lQ29udHJvbGxlciA9IG51bGw7XG5cbiAgdmFyIF9wbGF5YmFja0Vycm9yID0gZmFsc2UsXG4gICAgX3ZpZXdlclBhdXNlZCA9IHRydWU7XG5cbiAgdmFyIF9jdXJyZW50RnJhbWUgPSAwO1xuXG4gIHZhciBfY3VycmVudEZpbGVzID0gW107XG5cbiAgdmFyIF9lcnJvciA9IG51bGwsXG4gICAgX2Vycm9yVGltZXIgPSBudWxsLFxuICAgIF9lcnJvckZsYWcgPSBmYWxzZTtcblxuICB2YXIgX2xvZ2dlciA9IFJpc2VWaXNpb24uQ29tbW9uLkxvZ2dlcjtcblxuICAvKlxuICAgKiAgUHJpdmF0ZSBNZXRob2RzXG4gICAqL1xuICBmdW5jdGlvbiBfZG9uZSgpIHtcbiAgICBnYWRnZXRzLnJwYy5jYWxsKFwiXCIsIFwicnNldmVudF9kb25lXCIsIG51bGwsIF9wcmVmcy5nZXRTdHJpbmcoXCJpZFwiKSk7XG5cbiAgICAvLyBBbnkgZXJyb3JzIG5lZWQgdG8gYmUgbG9nZ2VkIGJlZm9yZSB0aGUgZG9uZSBldmVudC5cbiAgICBpZiAoX2Vycm9yICE9PSBudWxsKSB7XG4gICAgICBsb2dFdmVudChfZXJyb3IsIHRydWUpO1xuICAgIH1cblxuICAgIGxvZ0V2ZW50KHsgXCJldmVudFwiOiBcImRvbmVcIiB9LCBmYWxzZSk7XG4gIH1cblxuICBmdW5jdGlvbiBfcmVhZHkoKSB7XG4gICAgZ2FkZ2V0cy5ycGMuY2FsbChcIlwiLCBcInJzZXZlbnRfcmVhZHlcIiwgbnVsbCwgX3ByZWZzLmdldFN0cmluZyhcImlkXCIpLFxuICAgICAgdHJ1ZSwgdHJ1ZSwgdHJ1ZSwgdHJ1ZSwgdHJ1ZSk7XG4gIH1cblxuICBmdW5jdGlvbiBfY2xlYXJFcnJvclRpbWVyKCkge1xuICAgIGNsZWFyVGltZW91dChfZXJyb3JUaW1lcik7XG4gICAgX2Vycm9yVGltZXIgPSBudWxsO1xuICB9XG5cbiAgZnVuY3Rpb24gX3N0YXJ0RXJyb3JUaW1lcigpIHtcbiAgICBfY2xlYXJFcnJvclRpbWVyKCk7XG5cbiAgICBfZXJyb3JUaW1lciA9IHNldFRpbWVvdXQoZnVuY3Rpb24gKCkge1xuICAgICAgLy8gbm90aWZ5IFZpZXdlciB3aWRnZXQgaXMgZG9uZVxuICAgICAgX2RvbmUoKTtcbiAgICB9LCA1MDAwKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIF9nZXRDdXJyZW50RmlsZURhdGEoKSB7XG4gICAgdmFyIGZyYW1lT2JqID0gX2ZyYW1lQ29udHJvbGxlci5nZXRGcmFtZU9iamVjdChfY3VycmVudEZyYW1lKTtcblxuICAgIGlmIChmcmFtZU9iaikge1xuICAgICAgcmV0dXJuIGZyYW1lT2JqLmdldFBsYXliYWNrRGF0YSgpO1xuICAgIH1cblxuICAgIHJldHVybiBudWxsO1xuICB9XG5cbiAgLy8gR2V0IHRoZSBwYXJhbWV0ZXJzIHRvIHBhc3MgdG8gdGhlIGV2ZW50IGxvZ2dlci5cbiAgZnVuY3Rpb24gX2dldExvZ2dlclBhcmFtcyhwYXJhbXMsIGNiKSB7XG4gICAgdmFyIGpzb24gPSB7fSxcbiAgICAgIHV0aWxzID0gUmlzZVZpc2lvbi5Db21tb24uTG9nZ2VyVXRpbHMsXG4gICAgICB1cmwgPSBudWxsLFxuICAgICAgZmlsZURhdGEgPSBudWxsO1xuXG4gICAgaWYgKHBhcmFtcy5ldmVudCkge1xuICAgICAganNvbi5ldmVudCA9IHBhcmFtcy5ldmVudDtcbiAgICB9XG5cbiAgICBpZiAocGFyYW1zLmV2ZW50X2RldGFpbHMpIHtcbiAgICAgIGpzb24uZXZlbnRfZGV0YWlscyA9IHBhcmFtcy5ldmVudF9kZXRhaWxzO1xuICAgIH1cblxuICAgIGlmIChwYXJhbXMudXJsKSB7XG4gICAgICB1cmwgPSBwYXJhbXMudXJsO1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgIGlmIChfY3VycmVudEZpbGVzICYmIF9jdXJyZW50RmlsZXMubGVuZ3RoID4gMCkge1xuICAgICAgICBpZiAoX21vZGUgPT09IFwiZmlsZVwiKSB7XG4gICAgICAgICAgdXJsID0gX2N1cnJlbnRGaWxlc1swXTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmIChfbW9kZSA9PT0gXCJmb2xkZXJcIikge1xuICAgICAgICAgIC8vIHJldHJpZXZlIHRoZSBjdXJyZW50bHkgcGxheWVkIGZpbGUgaW5mbyBmcm9tIHBsYXllclxuICAgICAgICAgIGZpbGVEYXRhID0gX2dldEN1cnJlbnRGaWxlRGF0YSgpO1xuXG4gICAgICAgICAgaWYgKGZpbGVEYXRhKSB7XG4gICAgICAgICAgICB1cmwgPSBfY3VycmVudEZpbGVzW2ZpbGVEYXRhLmluZGV4XTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG5cbiAgICBqc29uLmZpbGVfdXJsID0gdXJsO1xuICAgIGpzb24uZmlsZV9mb3JtYXQgPSB1dGlscy5nZXRGaWxlRm9ybWF0KHVybCk7XG5cbiAgICB1dGlscy5nZXRJZHMoZnVuY3Rpb24oY29tcGFueUlkLCBkaXNwbGF5SWQpIHtcbiAgICAgIGpzb24uY29tcGFueV9pZCA9IGNvbXBhbnlJZDtcbiAgICAgIGpzb24uZGlzcGxheV9pZCA9IGRpc3BsYXlJZDtcblxuICAgICAgY2IoanNvbik7XG4gICAgfSk7XG4gIH1cblxuICAvKlxuICAgKiAgUHVibGljIE1ldGhvZHNcbiAgICovXG4gIGZ1bmN0aW9uIHNob3dFcnJvcihtZXNzYWdlKSB7XG4gICAgX2Vycm9yRmxhZyA9IHRydWU7XG5cbiAgICBfbWVzc2FnZS5zaG93KG1lc3NhZ2UpO1xuXG4gICAgX2ZyYW1lQ29udHJvbGxlci5yZW1vdmUoX2N1cnJlbnRGcmFtZSwgZnVuY3Rpb24gKCkge1xuICAgICAgLy8gaWYgV2lkZ2V0IGlzIHBsYXlpbmcgcmlnaHQgbm93LCBydW4gdGhlIHRpbWVyXG4gICAgICBpZiAoIV92aWV3ZXJQYXVzZWQpIHtcbiAgICAgICAgX3N0YXJ0RXJyb3JUaW1lcigpO1xuICAgICAgfVxuICAgIH0pO1xuICB9XG5cbiAgZnVuY3Rpb24gbG9nRXZlbnQocGFyYW1zLCBpc0Vycm9yKSB7XG4gICAgaWYgKGlzRXJyb3IpIHtcbiAgICAgIF9lcnJvciA9IHBhcmFtcztcbiAgICB9XG5cbiAgICBfZ2V0TG9nZ2VyUGFyYW1zKHBhcmFtcywgZnVuY3Rpb24oanNvbikge1xuICAgICAgX2xvZ2dlci5sb2coXCJ2aWRlb19ldmVudHNcIiwganNvbik7XG4gICAgfSk7XG4gIH1cblxuICBmdW5jdGlvbiBvbkZpbGVJbml0KHVybHMpIHtcbiAgICBpZiAoX21vZGUgPT09IFwiZmlsZVwiKSB7XG4gICAgICAvLyB1cmxzIHZhbHVlIHdpbGwgYmUgYSBzdHJpbmdcbiAgICAgIF9jdXJyZW50RmlsZXNbMF0gPSB1cmxzO1xuICAgIH0gZWxzZSBpZiAoX21vZGUgPT09IFwiZm9sZGVyXCIpIHtcbiAgICAgIC8vIHVybHMgdmFsdWUgd2lsbCBiZSBhbiBhcnJheVxuICAgICAgX2N1cnJlbnRGaWxlcyA9IHVybHM7XG4gICAgfVxuXG4gICAgX21lc3NhZ2UuaGlkZSgpO1xuXG4gICAgaWYgKCFfdmlld2VyUGF1c2VkKSB7XG4gICAgICBwbGF5KCk7XG4gICAgfVxuICB9XG5cbiAgZnVuY3Rpb24gb25GaWxlUmVmcmVzaCh1cmxzKSB7XG4gICAgaWYgKF9tb2RlID09PSBcImZpbGVcIikge1xuICAgICAgLy8gdXJscyB2YWx1ZSB3aWxsIGJlIGEgc3RyaW5nIG9mIG9uZSB1cmxcbiAgICAgIF9jdXJyZW50RmlsZXNbMF0gPSB1cmxzO1xuICAgIH0gZWxzZSBpZiAoX21vZGUgPT09IFwiZm9sZGVyXCIpIHtcbiAgICAgIC8vIHVybHMgdmFsdWUgd2lsbCBiZSBhbiBhcnJheSBvZiB1cmxzXG4gICAgICBfY3VycmVudEZpbGVzID0gdXJscztcbiAgICB9XG5cbiAgICAvLyBpbiBjYXNlIHJlZnJlc2hlZCBmaWxlIGZpeGVzIGFuIGVycm9yIHdpdGggcHJldmlvdXMgZmlsZSwgZW5zdXJlIGZsYWcgaXMgcmVtb3ZlZCBzbyBwbGF5YmFjayBpcyBhdHRlbXB0ZWQgYWdhaW5cbiAgICBfcGxheWJhY2tFcnJvciA9IGZhbHNlO1xuICAgIF9lcnJvciA9IG51bGw7XG4gIH1cblxuICBmdW5jdGlvbiBwYXVzZSgpIHtcbiAgICB2YXIgZnJhbWVPYmogPSBfZnJhbWVDb250cm9sbGVyLmdldEZyYW1lT2JqZWN0KF9jdXJyZW50RnJhbWUpO1xuXG4gICAgX3ZpZXdlclBhdXNlZCA9IHRydWU7XG5cbiAgICBpZiAoX2Vycm9yRmxhZykge1xuICAgICAgX2NsZWFyRXJyb3JUaW1lcigpO1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIGlmIChmcmFtZU9iaikge1xuICAgICAgZnJhbWVPYmoucGF1c2UoKTtcbiAgICB9XG4gIH1cblxuICBmdW5jdGlvbiBwbGF5KCkge1xuICAgIHZhciBmcmFtZU9iaiA9IF9mcmFtZUNvbnRyb2xsZXIuZ2V0RnJhbWVPYmplY3QoX2N1cnJlbnRGcmFtZSk7XG5cbiAgICBfdmlld2VyUGF1c2VkID0gZmFsc2U7XG5cbiAgICBsb2dFdmVudCh7IFwiZXZlbnRcIjogXCJwbGF5XCIgfSwgZmFsc2UpO1xuXG4gICAgaWYgKF9lcnJvckZsYWcpIHtcbiAgICAgIF9zdGFydEVycm9yVGltZXIoKTtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBpZiAoIV9wbGF5YmFja0Vycm9yKSB7XG4gICAgICBpZiAoZnJhbWVPYmopIHtcbiAgICAgICAgZnJhbWVPYmoucGxheSgpO1xuICAgICAgfSBlbHNlIHtcblxuICAgICAgICBpZiAoX2N1cnJlbnRGaWxlcyAmJiBfY3VycmVudEZpbGVzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICBpZiAoX21vZGUgPT09IFwiZmlsZVwiKSB7XG4gICAgICAgICAgICAvLyBhZGQgZnJhbWUgYW5kIGNyZWF0ZSB0aGUgcGxheWVyXG4gICAgICAgICAgICBfZnJhbWVDb250cm9sbGVyLmFkZCgwKTtcbiAgICAgICAgICAgIF9mcmFtZUNvbnRyb2xsZXIuY3JlYXRlRnJhbWVQbGF5ZXIoMCwgX2FkZGl0aW9uYWxQYXJhbXMsIF9jdXJyZW50RmlsZXNbMF0sIGNvbmZpZy5TS0lOLCBcInBsYXllci1maWxlLmh0bWxcIik7XG4gICAgICAgICAgfVxuICAgICAgICAgIGVsc2UgaWYgKF9tb2RlID09PSBcImZvbGRlclwiKSB7XG4gICAgICAgICAgICBfZnJhbWVDb250cm9sbGVyLmFkZCgwKTtcbiAgICAgICAgICAgIF9mcmFtZUNvbnRyb2xsZXIuY3JlYXRlRnJhbWVQbGF5ZXIoMCwgX2FkZGl0aW9uYWxQYXJhbXMsIF9jdXJyZW50RmlsZXMsIGNvbmZpZy5TS0lOLCBcInBsYXllci1mb2xkZXIuaHRtbFwiKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIGZ1bmN0aW9uIHBsYXllckVuZGVkKCkge1xuICAgIF9mcmFtZUNvbnRyb2xsZXIucmVtb3ZlKF9jdXJyZW50RnJhbWUsIGZ1bmN0aW9uICgpIHtcbiAgICAgIF9kb25lKCk7XG4gICAgfSk7XG4gIH1cblxuICBmdW5jdGlvbiBwbGF5ZXJSZWFkeSgpIHtcbiAgICB2YXIgZnJhbWVPYmo7XG5cbiAgICAvLyBFbnN1cmVzIG1lc3NhZ2luZyBpcyBoaWRkZW4gZm9yIG5vbi1zdG9yYWdlIHZpZGVvIGZpbGVcbiAgICBfbWVzc2FnZS5oaWRlKCk7XG5cbiAgICBpZiAoIV92aWV3ZXJQYXVzZWQpIHtcbiAgICAgIGZyYW1lT2JqID0gX2ZyYW1lQ29udHJvbGxlci5nZXRGcmFtZU9iamVjdChfY3VycmVudEZyYW1lKTtcblxuICAgICAgaWYgKGZyYW1lT2JqKSB7XG4gICAgICAgIGZyYW1lT2JqLnBsYXkoKTtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICBmdW5jdGlvbiBzZXRBZGRpdGlvbmFsUGFyYW1zKHBhcmFtcywgbW9kZSkge1xuICAgIHZhciBpc1N0b3JhZ2VGaWxlO1xuXG4gICAgX2FkZGl0aW9uYWxQYXJhbXMgPSBfLmNsb25lKHBhcmFtcyk7XG4gICAgX21vZGUgPSBtb2RlO1xuICAgIF9wcmVmcyA9IG5ldyBnYWRnZXRzLlByZWZzKCk7XG5cbiAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcInZpZGVvQ29udGFpbmVyXCIpLnN0eWxlLmhlaWdodCA9IF9wcmVmcy5nZXRJbnQoXCJyc0hcIikgKyBcInB4XCI7XG5cbiAgICBfYWRkaXRpb25hbFBhcmFtcy53aWR0aCA9IF9wcmVmcy5nZXRJbnQoXCJyc1dcIik7XG4gICAgX2FkZGl0aW9uYWxQYXJhbXMuaGVpZ2h0ID0gX3ByZWZzLmdldEludChcInJzSFwiKTtcblxuICAgIF9tZXNzYWdlID0gbmV3IFJpc2VWaXNpb24uQ29tbW9uLk1lc3NhZ2UoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJ2aWRlb0NvbnRhaW5lclwiKSxcbiAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwibWVzc2FnZUNvbnRhaW5lclwiKSk7XG5cbiAgICAvLyBzaG93IHdhaXQgbWVzc2FnZSB3aGlsZSBTdG9yYWdlIGluaXRpYWxpemVzXG4gICAgX21lc3NhZ2Uuc2hvdyhcIlBsZWFzZSB3YWl0IHdoaWxlIHlvdXIgdmlkZW8gaXMgZG93bmxvYWRlZC5cIik7XG5cbiAgICBfZnJhbWVDb250cm9sbGVyID0gbmV3IFJpc2VWaXNpb24uQ29tbW9uLlZpZGVvLkZyYW1lQ29udHJvbGxlcigpO1xuXG4gICAgaWYgKF9tb2RlID09PSBcImZpbGVcIikge1xuICAgICAgaXNTdG9yYWdlRmlsZSA9IChPYmplY3Qua2V5cyhfYWRkaXRpb25hbFBhcmFtcy5zdG9yYWdlKS5sZW5ndGggIT09IDApO1xuXG4gICAgICBpZiAoIWlzU3RvcmFnZUZpbGUpIHtcbiAgICAgICAgX25vblN0b3JhZ2UgPSBuZXcgUmlzZVZpc2lvbi5WaWRlby5Ob25TdG9yYWdlKF9hZGRpdGlvbmFsUGFyYW1zKTtcbiAgICAgICAgX25vblN0b3JhZ2UuaW5pdCgpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgLy8gY3JlYXRlIGFuZCBpbml0aWFsaXplIHRoZSBTdG9yYWdlIGZpbGUgaW5zdGFuY2VcbiAgICAgICAgX3N0b3JhZ2UgPSBuZXcgUmlzZVZpc2lvbi5WaWRlby5TdG9yYWdlRmlsZShfYWRkaXRpb25hbFBhcmFtcyk7XG4gICAgICAgIF9zdG9yYWdlLmluaXQoKTtcbiAgICAgIH1cbiAgICB9XG4gICAgZWxzZSBpZiAoX21vZGUgPT09IFwiZm9sZGVyXCIpIHtcbiAgICAgIC8vIGNyZWF0ZSBhbmQgaW5pdGlhbGl6ZSB0aGUgU3RvcmFnZSBmb2xkZXIgaW5zdGFuY2VcbiAgICAgIF9zdG9yYWdlID0gbmV3IFJpc2VWaXNpb24uVmlkZW8uU3RvcmFnZUZvbGRlcihfYWRkaXRpb25hbFBhcmFtcyk7XG4gICAgICBfc3RvcmFnZS5pbml0KCk7XG4gICAgfVxuXG4gICAgX3JlYWR5KCk7XG4gIH1cblxuICAvLyBBbiBlcnJvciBvY2N1cnJlZCB3aXRoIEpXIFBsYXllci5cbiAgZnVuY3Rpb24gcGxheWVyRXJyb3IoZXJyb3IpIHtcbiAgICB2YXIgZGV0YWlscyA9IG51bGwsXG4gICAgICBwYXJhbXMgPSB7fSxcbiAgICAgIG1lc3NhZ2UgPSBcIlNvcnJ5LCB0aGVyZSB3YXMgYSBwcm9ibGVtIHBsYXlpbmcgdGhlIHZpZGVvLlwiO1xuXG4gICAgX3BsYXliYWNrRXJyb3IgPSB0cnVlO1xuXG4gICAgaWYgKGVycm9yKSB7XG4gICAgICBpZiAoZXJyb3IudHlwZSAmJiBlcnJvci5tZXNzYWdlKSB7XG4gICAgICAgIGRldGFpbHMgPSBlcnJvci50eXBlICsgXCIgLSBcIiArIGVycm9yLm1lc3NhZ2U7XG4gICAgICB9XG4gICAgICBlbHNlIGlmIChlcnJvci50eXBlKSB7XG4gICAgICAgIGRldGFpbHMgPSBlcnJvci50eXBlO1xuICAgICAgfVxuICAgICAgZWxzZSBpZiAoZXJyb3IubWVzc2FnZSkge1xuICAgICAgICBkZXRhaWxzID0gZXJyb3IubWVzc2FnZTtcbiAgICAgIH1cblxuICAgICAgLy8gQ2hlY2sgaWYgdGhlcmUgaXMgYW4gaXNzdWUgd2l0aCB0aGUgZm9ybWF0LlxuICAgICAgaWYgKGVycm9yLm1lc3NhZ2UgJiYgKGVycm9yLm1lc3NhZ2UgPT09IFwiRXJyb3IgbG9hZGluZyBtZWRpYTogRmlsZSBjb3VsZCBub3QgYmUgcGxheWVkXCIpKSB7XG4gICAgICAgIG1lc3NhZ2UgPSBcIlRoZXJlIHdhcyBhIHByb2JsZW0gcGxheWluZyB0aGF0IHZpZGVvLiBJdCBjb3VsZCBiZSB0aGF0IHdlIGRvbid0IFwiICtcbiAgICAgICAgICBcInN1cHBvcnQgdGhhdCBmb3JtYXQgb3IgaXQgaXMgbm90IGVuY29kZWQgY29ycmVjdGx5LlwiO1xuICAgICAgfVxuICAgIH1cblxuICAgIHBhcmFtcy5ldmVudCA9IFwicGxheWVyIGVycm9yXCI7XG4gICAgcGFyYW1zLmV2ZW50X2RldGFpbHMgPSBkZXRhaWxzO1xuXG4gICAgbG9nRXZlbnQocGFyYW1zLCB0cnVlKTtcbiAgICBzaG93RXJyb3IobWVzc2FnZSk7XG4gIH1cblxuICBmdW5jdGlvbiBzdG9wKCkge1xuICAgIHBhdXNlKCk7XG4gIH1cblxuICByZXR1cm4ge1xuICAgIFwibG9nRXZlbnRcIjogbG9nRXZlbnQsXG4gICAgXCJvbkZpbGVJbml0XCI6IG9uRmlsZUluaXQsXG4gICAgXCJvbkZpbGVSZWZyZXNoXCI6IG9uRmlsZVJlZnJlc2gsXG4gICAgXCJwYXVzZVwiOiBwYXVzZSxcbiAgICBcInBsYXlcIjogcGxheSxcbiAgICBcInNldEFkZGl0aW9uYWxQYXJhbXNcIjogc2V0QWRkaXRpb25hbFBhcmFtcyxcbiAgICBcInNob3dFcnJvclwiOiBzaG93RXJyb3IsXG4gICAgXCJwbGF5ZXJFbmRlZFwiOiBwbGF5ZXJFbmRlZCxcbiAgICBcInBsYXllclJlYWR5XCI6IHBsYXllclJlYWR5LFxuICAgIFwicGxheWVyRXJyb3JcIjogcGxheWVyRXJyb3IsXG4gICAgXCJzdG9wXCI6IHN0b3BcbiAgfTtcblxufSkoZ2FkZ2V0cyk7XG5cbi8qIGdsb2JhbCBjb25maWcgKi9cblxudmFyIFJpc2VWaXNpb24gPSBSaXNlVmlzaW9uIHx8IHt9O1xuUmlzZVZpc2lvbi5WaWRlbyA9IFJpc2VWaXNpb24uVmlkZW8gfHwge307XG5cblJpc2VWaXNpb24uVmlkZW8uU3RvcmFnZUZpbGUgPSBmdW5jdGlvbiAoZGF0YSkge1xuICBcInVzZSBzdHJpY3RcIjtcblxuICB2YXIgX2luaXRpYWxMb2FkID0gdHJ1ZTtcblxuICAvKlxuICAgKiAgUHVibGljIE1ldGhvZHNcbiAgICovXG4gIGZ1bmN0aW9uIGluaXQoKSB7XG4gICAgdmFyIHN0b3JhZ2UgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcInZpZGVvU3RvcmFnZVwiKTtcblxuICAgIGlmICghc3RvcmFnZSkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIHN0b3JhZ2UuYWRkRXZlbnRMaXN0ZW5lcihcInJpc2Utc3RvcmFnZS1yZXNwb25zZVwiLCBmdW5jdGlvbihlKSB7XG4gICAgICBpZiAoZS5kZXRhaWwgJiYgZS5kZXRhaWwudXJsKSB7XG5cbiAgICAgICAgaWYgKF9pbml0aWFsTG9hZCkge1xuICAgICAgICAgIF9pbml0aWFsTG9hZCA9IGZhbHNlO1xuXG4gICAgICAgICAgUmlzZVZpc2lvbi5WaWRlby5vbkZpbGVJbml0KGUuZGV0YWlsLnVybCk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgLy8gY2hlY2sgZm9yIFwiY2hhbmdlZFwiIHByb3BlcnR5IGFuZCBlbnN1cmUgaXQgaXMgdHJ1ZVxuICAgICAgICAgIGlmIChlLmRldGFpbC5oYXNPd25Qcm9wZXJ0eShcImNoYW5nZWRcIikgJiYgZS5kZXRhaWwuY2hhbmdlZCkge1xuICAgICAgICAgICAgUmlzZVZpc2lvbi5WaWRlby5vbkZpbGVSZWZyZXNoKGUuZGV0YWlsLnVybCk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG4gICAgfSk7XG5cbiAgICBzdG9yYWdlLmFkZEV2ZW50TGlzdGVuZXIoXCJyaXNlLXN0b3JhZ2Utbm8tZmlsZVwiLCBmdW5jdGlvbigpIHtcbiAgICAgIHZhciBwYXJhbXMgPSB7IFwiZXZlbnRcIjogXCJzdG9yYWdlIGZpbGUgbm90IGZvdW5kXCIgfTtcblxuICAgICAgUmlzZVZpc2lvbi5WaWRlby5sb2dFdmVudChwYXJhbXMsIHRydWUpO1xuICAgICAgUmlzZVZpc2lvbi5WaWRlby5zaG93RXJyb3IoXCJUaGUgc2VsZWN0ZWQgdmlkZW8gZG9lcyBub3QgZXhpc3Qgb3IgaGFzIGJlZW4gbW92ZWQgdG8gVHJhc2guXCIpO1xuICAgIH0pO1xuXG4gICAgc3RvcmFnZS5hZGRFdmVudExpc3RlbmVyKFwicmlzZS1zdG9yYWdlLWZpbGUtdGhyb3R0bGVkXCIsIGZ1bmN0aW9uKGUpIHtcbiAgICAgIHZhciBwYXJhbXMgPSB7IFwiZXZlbnRcIjogXCJzdG9yYWdlIGZpbGUgdGhyb3R0bGVkXCIsIFwidXJsXCI6IGUuZGV0YWlsIH07XG5cbiAgICAgIFJpc2VWaXNpb24uVmlkZW8ubG9nRXZlbnQocGFyYW1zLCB0cnVlKTtcbiAgICAgIFJpc2VWaXNpb24uVmlkZW8uc2hvd0Vycm9yKFwiVGhlIHNlbGVjdGVkIHZpZGVvIGlzIHRlbXBvcmFyaWx5IHVuYXZhaWxhYmxlLlwiKTtcbiAgICB9KTtcblxuICAgIHN0b3JhZ2UuYWRkRXZlbnRMaXN0ZW5lcihcInJpc2Utc3RvcmFnZS1lcnJvclwiLCBmdW5jdGlvbigpIHtcbiAgICAgIHZhciBwYXJhbXMgPSB7IFwiZXZlbnRcIjogXCJzdG9yYWdlIGVycm9yXCIgfTtcblxuICAgICAgUmlzZVZpc2lvbi5WaWRlby5sb2dFdmVudChwYXJhbXMsIHRydWUpO1xuICAgICAgUmlzZVZpc2lvbi5WaWRlby5zaG93RXJyb3IoXCJTb3JyeSwgdGhlcmUgd2FzIGEgcHJvYmxlbSBwbGF5aW5nIHRoZSB2aWRlbyBmcm9tIFN0b3JhZ2UuXCIpO1xuICAgIH0pO1xuXG4gICAgc3RvcmFnZS5zZXRBdHRyaWJ1dGUoXCJmb2xkZXJcIiwgZGF0YS5zdG9yYWdlLmZvbGRlcik7XG4gICAgc3RvcmFnZS5zZXRBdHRyaWJ1dGUoXCJmaWxlTmFtZVwiLCBkYXRhLnN0b3JhZ2UuZmlsZU5hbWUpO1xuICAgIHN0b3JhZ2Uuc2V0QXR0cmlidXRlKFwiY29tcGFueUlkXCIsIGRhdGEuc3RvcmFnZS5jb21wYW55SWQpO1xuICAgIHN0b3JhZ2Uuc2V0QXR0cmlidXRlKFwiZW52XCIsIGNvbmZpZy5TVE9SQUdFX0VOVik7XG4gICAgc3RvcmFnZS5nbygpO1xuICB9XG5cbiAgcmV0dXJuIHtcbiAgICBcImluaXRcIjogaW5pdFxuICB9O1xufTtcblxuLyogZ2xvYmFsIGNvbmZpZywgXyAqL1xuXG52YXIgUmlzZVZpc2lvbiA9IFJpc2VWaXNpb24gfHwge307XG5SaXNlVmlzaW9uLlZpZGVvID0gUmlzZVZpc2lvbi5WaWRlbyB8fCB7fTtcblxuUmlzZVZpc2lvbi5WaWRlby5TdG9yYWdlRm9sZGVyID0gZnVuY3Rpb24gKGRhdGEpIHtcbiAgXCJ1c2Ugc3RyaWN0XCI7XG5cbiAgdmFyIF9pbml0aWFsTG9hZCA9IHRydWU7XG5cbiAgdmFyIF9maWxlcyA9IFtdO1xuXG4gIGZ1bmN0aW9uIF9nZXRVcmxzKCkge1xuICAgIHJldHVybiBfLnBsdWNrKF9maWxlcywgXCJ1cmxcIik7XG4gIH1cblxuICBmdW5jdGlvbiBfZ2V0RXhpc3RpbmdGaWxlKGZpbGUpIHtcbiAgICByZXR1cm4gXy5maW5kKF9maWxlcywgZnVuY3Rpb24gKGYpIHtcbiAgICAgIHJldHVybiBmaWxlLm5hbWUgPT09IGYubmFtZTtcbiAgICB9KTtcbiAgfVxuXG4gIGZ1bmN0aW9uIF9kZWxldGVGaWxlKGZpbGUpIHtcbiAgICB2YXIgZXhpc3RpbmcgPSBfZ2V0RXhpc3RpbmdGaWxlKGZpbGUpO1xuXG4gICAgaWYgKGV4aXN0aW5nKSB7XG4gICAgICBfZmlsZXMuc3BsaWNlKF9maWxlcy5pbmRleE9mKGV4aXN0aW5nKSwgMSk7XG4gICAgfVxuICB9XG5cbiAgZnVuY3Rpb24gX2NoYW5nZUZpbGUoZmlsZSkge1xuICAgIHZhciBleGlzdGluZyA9IF9nZXRFeGlzdGluZ0ZpbGUoZmlsZSk7XG5cbiAgICBpZiAoZXhpc3RpbmcpIHtcbiAgICAgIGV4aXN0aW5nLnVybCA9IGZpbGUudXJsO1xuICAgIH1cbiAgfVxuXG4gIGZ1bmN0aW9uIF9hZGRGaWxlKGZpbGUpIHtcbiAgICB2YXIgZXhpc3RpbmcgPSBfZ2V0RXhpc3RpbmdGaWxlKGZpbGUpO1xuXG4gICAgaWYgKCFleGlzdGluZykge1xuICAgICAgLy8gZXh0cmFjdCB0aGUgYWN0dWFsIGZpbGUgbmFtZSBhbmQgc3RvcmUgaW4gbmV3IHByb3BlcnR5IG9uIGZpbGUgb2JqZWN0XG4gICAgICBmaWxlLmZpbGVOYW1lID0gZmlsZS5uYW1lLnNsaWNlKGZpbGUubmFtZS5sYXN0SW5kZXhPZihcIi9cIikgKyAxLCBmaWxlLm5hbWUubGFzdEluZGV4T2YoXCIuXCIpKS50b0xvd2VyQ2FzZSgpO1xuXG4gICAgICAvLyBpbnNlcnQgZmlsZSB0byBfZmlsZXMgbGlzdCBhdCBzcGVjaWZpYyBpbmRleCBiYXNlZCBvbiBhbHBoYWJldGljYWwgb3JkZXIgb2YgZmlsZSBuYW1lXG4gICAgICBfZmlsZXMuc3BsaWNlKF8uc29ydGVkSW5kZXgoX2ZpbGVzLCBmaWxlLCBcImZpbGVOYW1lXCIpLCAwLCBmaWxlKTtcbiAgICB9XG4gIH1cblxuICAvKlxuICAgKiAgUHVibGljIE1ldGhvZHNcbiAgICovXG4gIGZ1bmN0aW9uIGluaXQoKSB7XG4gICAgdmFyIHN0b3JhZ2UgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcInZpZGVvU3RvcmFnZVwiKTtcblxuICAgIGlmICghc3RvcmFnZSkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIHN0b3JhZ2UuYWRkRXZlbnRMaXN0ZW5lcihcInJpc2Utc3RvcmFnZS1yZXNwb25zZVwiLCBmdW5jdGlvbihlKSB7XG4gICAgICB2YXIgZmlsZSA9IGUuZGV0YWlsO1xuXG4gICAgICAvLyBBZGRlZFxuICAgICAgaWYoZmlsZS5hZGRlZCkge1xuICAgICAgICBfYWRkRmlsZShmaWxlKTtcblxuICAgICAgICBpZiAoX2luaXRpYWxMb2FkKSB7XG4gICAgICAgICAgX2luaXRpYWxMb2FkID0gZmFsc2U7XG4gICAgICAgICAgUmlzZVZpc2lvbi5WaWRlby5vbkZpbGVJbml0KF9nZXRVcmxzKCkpO1xuXG4gICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIC8vIENoYW5nZWRcbiAgICAgIGlmKGZpbGUuY2hhbmdlZCkge1xuICAgICAgICBfY2hhbmdlRmlsZShmaWxlKTtcbiAgICAgIH1cblxuICAgICAgLy8gRGVsZXRlZFxuICAgICAgaWYoZmlsZS5kZWxldGVkKSB7XG4gICAgICAgIF9kZWxldGVGaWxlKGZpbGUpO1xuICAgICAgfVxuXG4gICAgICBSaXNlVmlzaW9uLlZpZGVvLm9uRmlsZVJlZnJlc2goX2dldFVybHMoKSk7XG5cbiAgICB9KTtcblxuICAgIHN0b3JhZ2UuYWRkRXZlbnRMaXN0ZW5lcihcInJpc2Utc3RvcmFnZS1lbXB0eS1mb2xkZXJcIiwgZnVuY3Rpb24gKCkge1xuICAgICAgdmFyIHBhcmFtcyA9IHsgXCJldmVudFwiOiBcInN0b3JhZ2UgZm9sZGVyIGVtcHR5XCIgfTtcblxuICAgICAgUmlzZVZpc2lvbi5WaWRlby5sb2dFdmVudChwYXJhbXMsIHRydWUpO1xuICAgICAgUmlzZVZpc2lvbi5WaWRlby5zaG93RXJyb3IoXCJUaGUgc2VsZWN0ZWQgZm9sZGVyIGRvZXMgbm90IGNvbnRhaW4gYW55IHZpZGVvcy5cIik7XG4gICAgfSk7XG5cbiAgICBzdG9yYWdlLmFkZEV2ZW50TGlzdGVuZXIoXCJyaXNlLXN0b3JhZ2Utbm8tZm9sZGVyXCIsIGZ1bmN0aW9uICgpIHtcbiAgICAgIHZhciBwYXJhbXMgPSB7IFwiZXZlbnRcIjogXCJzdG9yYWdlIGZvbGRlciBkb2Vzbid0IGV4aXN0XCIgfTtcblxuICAgICAgUmlzZVZpc2lvbi5WaWRlby5sb2dFdmVudChwYXJhbXMsIHRydWUpO1xuICAgICAgUmlzZVZpc2lvbi5WaWRlby5zaG93RXJyb3IoXCJUaGUgc2VsZWN0ZWQgZm9sZGVyIGRvZXMgbm90IGV4aXN0LlwiKTtcbiAgICB9KTtcblxuICAgIHN0b3JhZ2UuYWRkRXZlbnRMaXN0ZW5lcihcInJpc2Utc3RvcmFnZS1lcnJvclwiLCBmdW5jdGlvbigpIHtcbiAgICAgIHZhciBwYXJhbXMgPSB7IFwiZXZlbnRcIjogXCJzdG9yYWdlIGVycm9yXCIgfTtcblxuICAgICAgUmlzZVZpc2lvbi5WaWRlby5sb2dFdmVudChwYXJhbXMsIHRydWUpO1xuICAgICAgUmlzZVZpc2lvbi5WaWRlby5zaG93RXJyb3IoXCJTb3JyeSwgdGhlcmUgd2FzIGEgcHJvYmxlbSBwbGF5aW5nIHRoZSB2aWRlbyBmcm9tIFN0b3JhZ2UuXCIpO1xuICAgIH0pO1xuXG4gICAgc3RvcmFnZS5zZXRBdHRyaWJ1dGUoXCJmaWxlVHlwZVwiLCBcInZpZGVvXCIpO1xuICAgIHN0b3JhZ2Uuc2V0QXR0cmlidXRlKFwiY29tcGFueUlkXCIsIGRhdGEuc3RvcmFnZS5jb21wYW55SWQpO1xuICAgIHN0b3JhZ2Uuc2V0QXR0cmlidXRlKFwiZm9sZGVyXCIsIGRhdGEuc3RvcmFnZS5mb2xkZXIpO1xuICAgIHN0b3JhZ2Uuc2V0QXR0cmlidXRlKFwiZW52XCIsIGNvbmZpZy5TVE9SQUdFX0VOVik7XG5cbiAgICBzdG9yYWdlLmdvKCk7XG4gIH1cblxuICByZXR1cm4ge1xuICAgIFwiaW5pdFwiOiBpbml0XG4gIH07XG59O1xuXG52YXIgUmlzZVZpc2lvbiA9IFJpc2VWaXNpb24gfHwge307XG5SaXNlVmlzaW9uLlZpZGVvID0gUmlzZVZpc2lvbi5WaWRlbyB8fCB7fTtcblxuUmlzZVZpc2lvbi5WaWRlby5Ob25TdG9yYWdlID0gZnVuY3Rpb24gKGRhdGEpIHtcbiAgXCJ1c2Ugc3RyaWN0XCI7XG5cbiAgdmFyIHJpc2VDYWNoZSA9IFJpc2VWaXNpb24uQ29tbW9uLlJpc2VDYWNoZTtcblxuICB2YXIgX3JlZnJlc2hEdXJhdGlvbiA9IDkwMDAwMCwgIC8vIDE1IG1pbnV0ZXNcbiAgICBfcmVmcmVzaEludGVydmFsSWQgPSBudWxsO1xuXG4gIHZhciBfaXNMb2FkaW5nID0gdHJ1ZTtcblxuICBmdW5jdGlvbiBfZ2V0RmlsZShvbWl0Q2FjaGVCdXN0ZXIpIHtcbiAgICByaXNlQ2FjaGUuZ2V0RmlsZShkYXRhLnVybCwgZnVuY3Rpb24gKHJlc3BvbnNlLCBlcnJvcikge1xuICAgICAgaWYgKCFlcnJvcikge1xuXG4gICAgICAgIGlmIChfaXNMb2FkaW5nKSB7XG4gICAgICAgICAgX2lzTG9hZGluZyA9IGZhbHNlO1xuXG4gICAgICAgICAgUmlzZVZpc2lvbi5WaWRlby5vbkZpbGVJbml0KHJlc3BvbnNlLnVybCk7XG5cbiAgICAgICAgICAvLyBzdGFydCB0aGUgcmVmcmVzaCBpbnRlcnZhbFxuICAgICAgICAgIF9zdGFydFJlZnJlc2hJbnRlcnZhbCgpO1xuXG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgUmlzZVZpc2lvbi5WaWRlby5vbkZpbGVSZWZyZXNoKHJlc3BvbnNlLnVybCk7XG4gICAgICAgIH1cblxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgLy8gZXJyb3Igb2NjdXJyZWRcbiAgICAgICAgUmlzZVZpc2lvbi5WaWRlby5sb2dFdmVudCh7XG4gICAgICAgICAgXCJldmVudFwiOiBcIm5vbi1zdG9yYWdlIGVycm9yXCIsXG4gICAgICAgICAgXCJldmVudF9kZXRhaWxzXCI6IGVycm9yLm1lc3NhZ2UsXG4gICAgICAgICAgXCJ1cmxcIjogcmVzcG9uc2UudXJsXG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgIH0sIG9taXRDYWNoZUJ1c3Rlcik7XG4gIH1cblxuICBmdW5jdGlvbiBfc3RhcnRSZWZyZXNoSW50ZXJ2YWwoKSB7XG4gICAgaWYgKF9yZWZyZXNoSW50ZXJ2YWxJZCA9PT0gbnVsbCkge1xuICAgICAgX3JlZnJlc2hJbnRlcnZhbElkID0gc2V0SW50ZXJ2YWwoZnVuY3Rpb24gKCkge1xuICAgICAgICBfZ2V0RmlsZShmYWxzZSk7XG4gICAgICB9LCBfcmVmcmVzaER1cmF0aW9uKTtcbiAgICB9XG4gIH1cblxuICAvKlxuICAgKiAgUHVibGljIE1ldGhvZHNcbiAgICovXG4gIGZ1bmN0aW9uIGluaXQoKSB7XG4gICAgX2dldEZpbGUodHJ1ZSk7XG4gIH1cblxuICByZXR1cm4ge1xuICAgIFwiaW5pdFwiOiBpbml0XG4gIH07XG59O1xuXG52YXIgUmlzZVZpc2lvbiA9IFJpc2VWaXNpb24gfHwge307XG5SaXNlVmlzaW9uLkNvbW1vbiA9IFJpc2VWaXNpb24uQ29tbW9uIHx8IHt9O1xuXG5SaXNlVmlzaW9uLkNvbW1vbi5WaWRlbyA9IFJpc2VWaXNpb24uQ29tbW9uLlZpZGVvIHx8IHt9O1xuXG5SaXNlVmlzaW9uLkNvbW1vbi5WaWRlby5GcmFtZUNvbnRyb2xsZXIgPSBmdW5jdGlvbiAoKSB7XG4gIFwidXNlIHN0cmljdFwiO1xuXG4gIHZhciBQUkVGSVggPSBcImlmX1wiO1xuXG4gIGZ1bmN0aW9uIGdldEZyYW1lQ29udGFpbmVyKGluZGV4KSB7XG4gICAgcmV0dXJuIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFBSRUZJWCArIGluZGV4KTtcbiAgfVxuXG4gIGZ1bmN0aW9uIGdldEZyYW1lT2JqZWN0KGluZGV4KSB7XG4gICAgdmFyIGZyYW1lQ29udGFpbmVyID0gZ2V0RnJhbWVDb250YWluZXIoaW5kZXgpLFxuICAgICAgaWZyYW1lO1xuXG4gICAgaWZyYW1lID0gZnJhbWVDb250YWluZXIucXVlcnlTZWxlY3RvcihcImlmcmFtZVwiKTtcblxuICAgIGlmIChpZnJhbWUpIHtcbiAgICAgIHJldHVybiAoaWZyYW1lLmNvbnRlbnRXaW5kb3cpID8gaWZyYW1lLmNvbnRlbnRXaW5kb3cgOlxuICAgICAgICAoaWZyYW1lLmNvbnRlbnREb2N1bWVudC5kb2N1bWVudCkgPyBpZnJhbWUuY29udGVudERvY3VtZW50LmRvY3VtZW50IDogaWZyYW1lLmNvbnRlbnREb2N1bWVudDtcbiAgICB9XG5cbiAgICByZXR1cm4gbnVsbDtcbiAgfVxuXG4gIGZ1bmN0aW9uIF9jbGVhcihpbmRleCkge1xuICAgIHZhciBmcmFtZUNvbnRhaW5lciA9IGdldEZyYW1lQ29udGFpbmVyKGluZGV4KSxcbiAgICAgIGZyYW1lT2JqID0gZ2V0RnJhbWVPYmplY3QoaW5kZXgpLFxuICAgICAgaWZyYW1lO1xuXG4gICAgaWYgKGZyYW1lT2JqKSB7XG4gICAgICBpZnJhbWUgPSBmcmFtZUNvbnRhaW5lci5xdWVyeVNlbGVjdG9yKFwiaWZyYW1lXCIpO1xuICAgICAgZnJhbWVPYmoucmVtb3ZlKCk7XG4gICAgICBpZnJhbWUuc2V0QXR0cmlidXRlKFwic3JjXCIsIFwiYWJvdXQ6YmxhbmtcIik7XG4gICAgfVxuICB9XG5cbiAgZnVuY3Rpb24gYWRkKGluZGV4KSB7XG4gICAgdmFyIGZyYW1lQ29udGFpbmVyID0gZ2V0RnJhbWVDb250YWluZXIoaW5kZXgpLFxuICAgICAgaWZyYW1lID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImlmcmFtZVwiKTtcblxuICAgIGlmcmFtZS5zZXRBdHRyaWJ1dGUoXCJhbGxvd1RyYW5zcGFyZW5jeVwiLCB0cnVlKTtcbiAgICBpZnJhbWUuc2V0QXR0cmlidXRlKFwiZnJhbWVib3JkZXJcIiwgXCIwXCIpO1xuICAgIGlmcmFtZS5zZXRBdHRyaWJ1dGUoXCJzY3JvbGxpbmdcIiwgXCJub1wiKTtcblxuICAgIGZyYW1lQ29udGFpbmVyLmFwcGVuZENoaWxkKGlmcmFtZSk7XG4gIH1cblxuICBmdW5jdGlvbiBjcmVhdGVGcmFtZVBsYXllcihpbmRleCwgcGFyYW1zLCBmaWxlcywgc2tpbiwgc3JjKSB7XG4gICAgdmFyIGZyYW1lQ29udGFpbmVyID0gZ2V0RnJhbWVDb250YWluZXIoaW5kZXgpLFxuICAgICAgZnJhbWVPYmogPSBnZXRGcmFtZU9iamVjdChpbmRleCksXG4gICAgICBpZnJhbWU7XG5cbiAgICBpZiAoZnJhbWVPYmopIHtcbiAgICAgIGlmcmFtZSA9IGZyYW1lQ29udGFpbmVyLnF1ZXJ5U2VsZWN0b3IoXCJpZnJhbWVcIik7XG5cbiAgICAgIGlmcmFtZS5vbmxvYWQgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGlmcmFtZS5vbmxvYWQgPSBudWxsO1xuXG4gICAgICAgIC8vIGluaXRpYWxpemUgYW5kIGxvYWQgdGhlIHBsYXllciBpbnNpZGUgdGhlIGlmcmFtZVxuICAgICAgICBmcmFtZU9iai5pbml0KHBhcmFtcywgZmlsZXMsIHNraW4pO1xuICAgICAgICBmcmFtZU9iai5sb2FkKCk7XG4gICAgICB9O1xuXG4gICAgICBpZnJhbWUuc2V0QXR0cmlidXRlKFwic3JjXCIsIHNyYyk7XG4gICAgfVxuXG4gIH1cblxuICBmdW5jdGlvbiBoaWRlKGluZGV4KSB7XG4gICAgdmFyIGZyYW1lQ29udGFpbmVyID0gZ2V0RnJhbWVDb250YWluZXIoaW5kZXgpO1xuXG4gICAgZnJhbWVDb250YWluZXIuc3R5bGUudmlzaWJpbGl0eSA9IFwiaGlkZGVuXCI7XG4gIH1cblxuICBmdW5jdGlvbiByZW1vdmUoaW5kZXgsIGNhbGxiYWNrKSB7XG4gICAgdmFyIGZyYW1lQ29udGFpbmVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoUFJFRklYICsgaW5kZXgpO1xuXG4gICAgX2NsZWFyKGluZGV4KTtcblxuICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkge1xuICAgICAgLy8gcmVtb3ZlIHRoZSBpZnJhbWUgYnkgY2xlYXJpbmcgYWxsIGVsZW1lbnRzIGluc2lkZSBkaXYgY29udGFpbmVyXG4gICAgICB3aGlsZSAoZnJhbWVDb250YWluZXIuZmlyc3RDaGlsZCkge1xuICAgICAgICBmcmFtZUNvbnRhaW5lci5yZW1vdmVDaGlsZChmcmFtZUNvbnRhaW5lci5maXJzdENoaWxkKTtcbiAgICAgIH1cblxuICAgICAgaWYgKGNhbGxiYWNrICYmIHR5cGVvZiBjYWxsYmFjayA9PT0gXCJmdW5jdGlvblwiKSB7XG4gICAgICAgIGNhbGxiYWNrKCk7XG4gICAgICB9XG4gICAgfSwgMjAwKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIHNob3coaW5kZXgpIHtcbiAgICB2YXIgZnJhbWVDb250YWluZXIgPSBnZXRGcmFtZUNvbnRhaW5lcihpbmRleCk7XG5cbiAgICBmcmFtZUNvbnRhaW5lci5zdHlsZS52aXNpYmlsaXR5ID0gXCJ2aXNpYmxlXCI7XG4gIH1cblxuICByZXR1cm4ge1xuICAgIGFkZDogYWRkLFxuICAgIGNyZWF0ZUZyYW1lUGxheWVyOiBjcmVhdGVGcmFtZVBsYXllcixcbiAgICBnZXRGcmFtZUNvbnRhaW5lcjogZ2V0RnJhbWVDb250YWluZXIsXG4gICAgZ2V0RnJhbWVPYmplY3Q6IGdldEZyYW1lT2JqZWN0LFxuICAgIGhpZGU6IGhpZGUsXG4gICAgcmVtb3ZlOiByZW1vdmUsXG4gICAgc2hvdzogc2hvd1xuICB9O1xufTtcblxudmFyIFJpc2VWaXNpb24gPSBSaXNlVmlzaW9uIHx8IHt9O1xuUmlzZVZpc2lvbi5Db21tb24gPSBSaXNlVmlzaW9uLkNvbW1vbiB8fCB7fTtcblxuUmlzZVZpc2lvbi5Db21tb24uTWVzc2FnZSA9IGZ1bmN0aW9uIChtYWluQ29udGFpbmVyLCBtZXNzYWdlQ29udGFpbmVyKSB7XG4gIFwidXNlIHN0cmljdFwiO1xuXG4gIHZhciBfYWN0aXZlID0gZmFsc2U7XG5cbiAgZnVuY3Rpb24gX2luaXQoKSB7XG4gICAgdHJ5IHtcbiAgICAgIG1lc3NhZ2VDb250YWluZXIuc3R5bGUuaGVpZ2h0ID0gbWFpbkNvbnRhaW5lci5zdHlsZS5oZWlnaHQ7XG4gICAgfSBjYXRjaCAoZSkge1xuICAgICAgY29uc29sZS53YXJuKFwiQ2FuJ3QgaW5pdGlhbGl6ZSBNZXNzYWdlIC0gXCIsIGUubWVzc2FnZSk7XG4gICAgfVxuICB9XG5cbiAgLypcbiAgICogIFB1YmxpYyBNZXRob2RzXG4gICAqL1xuICBmdW5jdGlvbiBoaWRlKCkge1xuICAgIGlmIChfYWN0aXZlKSB7XG4gICAgICAvLyBjbGVhciBjb250ZW50IG9mIG1lc3NhZ2UgY29udGFpbmVyXG4gICAgICB3aGlsZSAobWVzc2FnZUNvbnRhaW5lci5maXJzdENoaWxkKSB7XG4gICAgICAgIG1lc3NhZ2VDb250YWluZXIucmVtb3ZlQ2hpbGQobWVzc2FnZUNvbnRhaW5lci5maXJzdENoaWxkKTtcbiAgICAgIH1cblxuICAgICAgLy8gaGlkZSBtZXNzYWdlIGNvbnRhaW5lclxuICAgICAgbWVzc2FnZUNvbnRhaW5lci5zdHlsZS5kaXNwbGF5ID0gXCJub25lXCI7XG5cbiAgICAgIC8vIHNob3cgbWFpbiBjb250YWluZXJcbiAgICAgIG1haW5Db250YWluZXIuc3R5bGUudmlzaWJpbGl0eSA9IFwidmlzaWJsZVwiO1xuXG4gICAgICBfYWN0aXZlID0gZmFsc2U7XG4gICAgfVxuICB9XG5cbiAgZnVuY3Rpb24gc2hvdyhtZXNzYWdlKSB7XG4gICAgdmFyIGZyYWdtZW50ID0gZG9jdW1lbnQuY3JlYXRlRG9jdW1lbnRGcmFnbWVudCgpLFxuICAgICAgcDtcblxuICAgIGlmICghX2FjdGl2ZSkge1xuICAgICAgLy8gaGlkZSBtYWluIGNvbnRhaW5lclxuICAgICAgbWFpbkNvbnRhaW5lci5zdHlsZS52aXNpYmlsaXR5ID0gXCJoaWRkZW5cIjtcblxuICAgICAgbWVzc2FnZUNvbnRhaW5lci5zdHlsZS5kaXNwbGF5ID0gXCJibG9ja1wiO1xuXG4gICAgICAvLyBjcmVhdGUgbWVzc2FnZSBlbGVtZW50XG4gICAgICBwID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcInBcIik7XG4gICAgICBwLmlubmVySFRNTCA9IG1lc3NhZ2U7XG4gICAgICBwLnNldEF0dHJpYnV0ZShcImNsYXNzXCIsIFwibWVzc2FnZVwiKTtcblxuICAgICAgZnJhZ21lbnQuYXBwZW5kQ2hpbGQocCk7XG4gICAgICBtZXNzYWdlQ29udGFpbmVyLmFwcGVuZENoaWxkKGZyYWdtZW50KTtcblxuICAgICAgX2FjdGl2ZSA9IHRydWU7XG4gICAgfSBlbHNlIHtcbiAgICAgIC8vIG1lc3NhZ2UgYWxyZWFkeSBiZWluZyBzaG93biwgdXBkYXRlIG1lc3NhZ2UgdGV4dFxuICAgICAgcCA9IG1lc3NhZ2VDb250YWluZXIucXVlcnlTZWxlY3RvcihcIi5tZXNzYWdlXCIpO1xuICAgICAgcC5pbm5lckhUTUwgPSBtZXNzYWdlO1xuICAgIH1cbiAgfVxuXG4gIF9pbml0KCk7XG5cbiAgcmV0dXJuIHtcbiAgICBcImhpZGVcIjogaGlkZSxcbiAgICBcInNob3dcIjogc2hvd1xuICB9O1xufTtcblxuLyogZ2xvYmFsIGdhZGdldHMsIFJpc2VWaXNpb24gKi9cblxuKGZ1bmN0aW9uICh3aW5kb3csIGdhZGdldHMpIHtcbiAgXCJ1c2Ugc3RyaWN0XCI7XG5cbiAgdmFyIHByZWZzID0gbmV3IGdhZGdldHMuUHJlZnMoKSxcbiAgICBpZCA9IHByZWZzLmdldFN0cmluZyhcImlkXCIpO1xuXG4gIC8vIERpc2FibGUgY29udGV4dCBtZW51IChyaWdodCBjbGljayBtZW51KVxuICB3aW5kb3cub25jb250ZXh0bWVudSA9IGZ1bmN0aW9uICgpIHtcbiAgICByZXR1cm4gZmFsc2U7XG4gIH07XG5cbiAgZnVuY3Rpb24gY29uZmlndXJlKG5hbWVzLCB2YWx1ZXMpIHtcbiAgICB2YXIgYWRkaXRpb25hbFBhcmFtcywgbW9kZTtcblxuICAgIGlmIChBcnJheS5pc0FycmF5KG5hbWVzKSAmJiBuYW1lcy5sZW5ndGggPiAwICYmIG5hbWVzWzBdID09PSBcImFkZGl0aW9uYWxQYXJhbXNcIikge1xuICAgICAgaWYgKEFycmF5LmlzQXJyYXkodmFsdWVzKSAmJiB2YWx1ZXMubGVuZ3RoID4gMCkge1xuICAgICAgICBhZGRpdGlvbmFsUGFyYW1zID0gSlNPTi5wYXJzZSh2YWx1ZXNbMF0pO1xuXG4gICAgICAgIGlmIChPYmplY3Qua2V5cyhhZGRpdGlvbmFsUGFyYW1zLnN0b3JhZ2UpLmxlbmd0aCAhPT0gMCkge1xuICAgICAgICAgIC8vIHN0b3JhZ2UgZmlsZSBvciBmb2xkZXIgc2VsZWN0ZWRcbiAgICAgICAgICBpZiAoIWFkZGl0aW9uYWxQYXJhbXMuc3RvcmFnZS5maWxlTmFtZSkge1xuICAgICAgICAgICAgLy8gZm9sZGVyIHdhcyBzZWxlY3RlZFxuICAgICAgICAgICAgbW9kZSA9IFwiZm9sZGVyXCI7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIC8vIGZpbGUgd2FzIHNlbGVjdGVkXG4gICAgICAgICAgICBtb2RlID0gXCJmaWxlXCI7XG4gICAgICAgICAgfVxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIC8vIG5vbi1zdG9yYWdlIGZpbGUgd2FzIHNlbGVjdGVkXG4gICAgICAgICAgbW9kZSA9IFwiZmlsZVwiO1xuICAgICAgICB9XG5cbiAgICAgICAgUmlzZVZpc2lvbi5WaWRlby5zZXRBZGRpdGlvbmFsUGFyYW1zKGFkZGl0aW9uYWxQYXJhbXMsIG1vZGUpO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIGZ1bmN0aW9uIHBsYXkoKSB7XG4gICAgUmlzZVZpc2lvbi5WaWRlby5wbGF5KCk7XG4gIH1cblxuICBmdW5jdGlvbiBwYXVzZSgpIHtcbiAgICBSaXNlVmlzaW9uLlZpZGVvLnBhdXNlKCk7XG4gIH1cblxuICBmdW5jdGlvbiBzdG9wKCkge1xuICAgIFJpc2VWaXNpb24uVmlkZW8uc3RvcCgpO1xuICB9XG5cbiAgZnVuY3Rpb24gcG9seW1lclJlYWR5KCkge1xuICAgIHdpbmRvdy5yZW1vdmVFdmVudExpc3RlbmVyKFwiV2ViQ29tcG9uZW50c1JlYWR5XCIsIHBvbHltZXJSZWFkeSk7XG5cbiAgICBpZiAoaWQgJiYgaWQgIT09IFwiXCIpIHtcbiAgICAgIGdhZGdldHMucnBjLnJlZ2lzdGVyKFwicnNjbWRfcGxheV9cIiArIGlkLCBwbGF5KTtcbiAgICAgIGdhZGdldHMucnBjLnJlZ2lzdGVyKFwicnNjbWRfcGF1c2VfXCIgKyBpZCwgcGF1c2UpO1xuICAgICAgZ2FkZ2V0cy5ycGMucmVnaXN0ZXIoXCJyc2NtZF9zdG9wX1wiICsgaWQsIHN0b3ApO1xuXG4gICAgICBnYWRnZXRzLnJwYy5yZWdpc3RlcihcInJzcGFyYW1fc2V0X1wiICsgaWQsIGNvbmZpZ3VyZSk7XG4gICAgICBnYWRnZXRzLnJwYy5jYWxsKFwiXCIsIFwicnNwYXJhbV9nZXRcIiwgbnVsbCwgaWQsIFtcImFkZGl0aW9uYWxQYXJhbXNcIl0pO1xuICAgIH1cbiAgfVxuXG4gIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKFwiV2ViQ29tcG9uZW50c1JlYWR5XCIsIHBvbHltZXJSZWFkeSk7XG5cbn0pKHdpbmRvdywgZ2FkZ2V0cyk7XG5cblxuXG4vKiBqc2hpbnQgaWdub3JlOnN0YXJ0ICovXG52YXIgX2dhcSA9IF9nYXEgfHwgW107XG5cbl9nYXEucHVzaChbJ19zZXRBY2NvdW50JywgJ1VBLTU3MDkyMTU5LTInXSk7XG5fZ2FxLnB1c2goWydfdHJhY2tQYWdldmlldyddKTtcblxuKGZ1bmN0aW9uKCkge1xuICB2YXIgZ2EgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdzY3JpcHQnKTsgZ2EudHlwZSA9ICd0ZXh0L2phdmFzY3JpcHQnOyBnYS5hc3luYyA9IHRydWU7XG4gIGdhLnNyYyA9ICgnaHR0cHM6JyA9PSBkb2N1bWVudC5sb2NhdGlvbi5wcm90b2NvbCA/ICdodHRwczovL3NzbCcgOiAnaHR0cDovL3d3dycpICsgJy5nb29nbGUtYW5hbHl0aWNzLmNvbS9nYS5qcyc7XG4gIHZhciBzID0gZG9jdW1lbnQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoJ3NjcmlwdCcpWzBdOyBzLnBhcmVudE5vZGUuaW5zZXJ0QmVmb3JlKGdhLCBzKTtcbn0pKCk7XG4vKiBqc2hpbnQgaWdub3JlOmVuZCAqL1xuIl0sInNvdXJjZVJvb3QiOiIvc291cmNlLyJ9
