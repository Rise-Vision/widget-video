if("undefined"==typeof config){var config={};"undefined"!=typeof angular&&(angular.module("risevision.common.i18n.config",[]).constant("LOCALES_PREFIX","components/rv-common-i18n/dist/locales/translation_").constant("LOCALES_SUFIX",".json"),angular.module("risevision.widget.common.storage-selector.config").value("STORAGE_MODAL","https://storage-stage.risevision.com/rva-test/dist/storage-modal.html#/files/"))}var RiseVision=RiseVision||{};RiseVision.Video={},RiseVision.Video=function(e,t){"use strict";function n(){t.rpc.call("","rsevent_done",null,l.getString("id"))}function i(){t.rpc.call("","rsevent_ready",null,l.getString("id"),!0,!0,!0,!0,!0)}function o(){p=new RiseVision.Video.Player(g),p.init()}function a(){p.pause()}function s(){p.isInitialPlay()?g.video.autoplay&&p.play():p.userPaused()||p.play()}function r(){i()}function d(n){l=new t.Prefs,g=n,e.getElementById("videoContainer").style.height=l.getInt("rsH")+"px",m=new RiseVision.Common.Background(g),m.init(o)}function u(){a()}function c(){n()}var l=null,g={},m=null,p=null;return{pause:a,play:s,setAdditionalParams:d,playerReady:r,stop:u,videoEnded:c}}(document,gadgets);var RiseVision=RiseVision||{};RiseVision.Common=RiseVision.Common||{},RiseVision.Common.Background=function(e){"use strict";function t(){s=!0,a&&"function"==typeof a&&a()}function n(e){d.removeEventListener("rise-storage-response",n),r.style.backgroundImage=Array.isArray(e.detail)?"url("+e.detail[0]+")":"url("+e.detail+")",t()}function i(){r=document.getElementById("background"),d=document.getElementById("backgroundStorage"),document.body.style.background=e.background.color,r?e.background.useImage?(r.className=e.background.image.position,r.className=e.background.image.scale?r.className+" scale-to-fit":r.className,0===Object.keys(e.backgroundStorage).length?(r.style.backgroundImage="url("+e.background.image.url+")",t()):d?(d.addEventListener("rise-storage-response",n),d.setAttribute("folder",e.backgroundStorage.folder),d.setAttribute("fileName",e.backgroundStorage.fileName),d.setAttribute("companyId",e.backgroundStorage.companyId),d.go()):console.log("Missing element with id value of 'backgroundStorage'")):t():console.log("Missing element with id value of 'background'")}function o(e){s?e&&"function"==typeof e&&e():(e&&(a=e),i())}var a=null,s=!1,r=null,d=null;return{init:o}};var RiseVision=RiseVision||{};RiseVision.Video=RiseVision.Video||{},RiseVision.Video.Player=function(e){"use strict";function t(e){E.removeEventListener("rise-storage-response",t),v.value=Array.isArray(e.detail)?e.detail[0]:e.detail,b.setAttributeNode(v),V.appendChild(y)}function n(){var t=e.url.substr(e.url.lastIndexOf(".")+1);return"ogv"===t&&(t="ogg"),t}function i(){A.style.visibility="visible",V.removeEventListener("loadeddata",i,!1)}function o(){N=!0,L||(RiseVision.Video.playerReady(),L=!0),V.removeEventListener("canplay",o,!1),I||c(h)}function a(){k=!1,!I&&S&&(S=!1,u()),RiseVision.Video.videoEnded()}function s(){k=!_}function r(){R=!1,k=!1}function d(){setTimeout(function(){N?V.play():d()},200)}function u(){V.addEventListener("canplay",o,!1),V.addEventListener("loadeddata",i,!1),A.style.visibility="hidden",b.setAttribute("src",e.url+w+"cb="+(new Date).getTime()),N=!1,V.load()}function c(e){setTimeout(function(){V.paused&&V.currentTime<=0?u():S=!0},e)}function l(){return R}function g(){var d,u=document.createAttribute("type");y=document.createDocumentFragment(),b=y.appendChild(document.createElement("source")),v=document.createAttribute("src"),e.video.autoplay||V.setAttribute("controls",""),V.className=e.video.scaleToFit?V.className+" scale-to-fit":V.className+" no-scale",V.volume=e.video.volume/100,u.value="video/"+n(),b.setAttributeNode(u),V.addEventListener("loadeddata",i,!1),V.addEventListener("canplay",o,!1),V.addEventListener("ended",a,!1),V.addEventListener("pause",s,!1),V.addEventListener("play",r,!1),I=0!==Object.keys(e.videoStorage).length,I?(E.addEventListener("rise-storage-response",t),E.setAttribute("folder",e.videoStorage.folder),E.setAttribute("fileName",e.videoStorage.fileName),E.setAttribute("companyId",e.videoStorage.companyId),E.go()):(d=e.url.split("?"),w=1===d.length?"?":"&",v.value=e.url,b.setAttributeNode(v),V.appendChild(y))}function m(){_=!0,V.pause()}function p(){R=!1,_=!1,N?V.play():d()}function f(){return k}var v,y,b,V=document.getElementById("video"),A=document.getElementById("videoContainer"),E=document.getElementById("videoStorage"),R=!0,k=!1,_=!1,h=9e5,I=!1,S=!1,L=!1,N=!1,w="";return{isInitialPlay:l,init:g,pause:m,play:p,userPaused:f}},function(e,t){"use strict";function n(){RiseVision.Video.play()}function i(){RiseVision.Video.pause()}function o(){RiseVision.Video.stop()}function a(e,t){Array.isArray(e)&&e.length>0&&"additionalParams"===e[0]&&Array.isArray(t)&&t.length>0&&RiseVision.Video.setAdditionalParams(JSON.parse(t[0]))}var s=new t.Prefs,r=s.getString("id");e.oncontextmenu=function(){return!1},r&&""!==r&&(t.rpc.register("rscmd_play_"+r,n),t.rpc.register("rscmd_pause_"+r,i),t.rpc.register("rscmd_stop_"+r,o),t.rpc.register("rsparam_set_"+r,a),t.rpc.call("","rsparam_get",null,r,["additionalParams"]))}(window,gadgets);var _gaq=_gaq||[];_gaq.push(["_setAccount","UA-57092159-2"]),_gaq.push(["_trackPageview"]),function(){var e=document.createElement("script");e.type="text/javascript",e.async=!0,e.src=("https:"==document.location.protocol?"https://ssl":"http://www")+".google-analytics.com/ga.js";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImpzL3dpZGdldC5taW4uanMiXSwibmFtZXMiOlsiY29uZmlnIiwiYW5ndWxhciIsIm1vZHVsZSIsImNvbnN0YW50IiwidmFsdWUiLCJSaXNlVmlzaW9uIiwiVmlkZW8iLCJkb2N1bWVudCIsImdhZGdldHMiLCJfZG9uZSIsInJwYyIsImNhbGwiLCJfcHJlZnMiLCJnZXRTdHJpbmciLCJfcmVhZHkiLCJfYmFja2dyb3VuZFJlYWR5IiwiX3BsYXllciIsIlBsYXllciIsIl9hZGRpdGlvbmFsUGFyYW1zIiwiaW5pdCIsInBhdXNlIiwicGxheSIsImlzSW5pdGlhbFBsYXkiLCJ2aWRlbyIsImF1dG9wbGF5IiwidXNlclBhdXNlZCIsInBsYXllclJlYWR5Iiwic2V0QWRkaXRpb25hbFBhcmFtcyIsInBhcmFtcyIsIlByZWZzIiwiZ2V0RWxlbWVudEJ5SWQiLCJzdHlsZSIsImhlaWdodCIsImdldEludCIsIl9iYWNrZ3JvdW5kIiwiQ29tbW9uIiwiQmFja2dyb3VuZCIsInN0b3AiLCJ2aWRlb0VuZGVkIiwiZGF0YSIsIl9jYWxsYmFjayIsIl9zdG9yYWdlUmVzcG9uc2UiLCJlIiwiX3N0b3JhZ2UiLCJyZW1vdmVFdmVudExpc3RlbmVyIiwiYmFja2dyb3VuZEltYWdlIiwiQXJyYXkiLCJpc0FycmF5IiwiZGV0YWlsIiwiX2NvbmZpZ3VyZSIsImJvZHkiLCJiYWNrZ3JvdW5kIiwiY29sb3IiLCJ1c2VJbWFnZSIsImNsYXNzTmFtZSIsImltYWdlIiwicG9zaXRpb24iLCJzY2FsZSIsIk9iamVjdCIsImtleXMiLCJiYWNrZ3JvdW5kU3RvcmFnZSIsImxlbmd0aCIsInVybCIsImFkZEV2ZW50TGlzdGVuZXIiLCJzZXRBdHRyaWJ1dGUiLCJmb2xkZXIiLCJmaWxlTmFtZSIsImNvbXBhbnlJZCIsImdvIiwiY29uc29sZSIsImxvZyIsImNiIiwiX3NyY0F0dHIiLCJfc291cmNlIiwic2V0QXR0cmlidXRlTm9kZSIsIl92aWRlbyIsImFwcGVuZENoaWxkIiwiX2ZyYWdtZW50IiwiX2dldFZpZGVvRmlsZVR5cGUiLCJ0eXBlIiwic3Vic3RyIiwibGFzdEluZGV4T2YiLCJfb25Mb2FkZWREYXRhIiwiX3ZpZGVvQ29udGFpbmVyIiwidmlzaWJpbGl0eSIsIl9vbkNhblBsYXkiLCJfY2FuUGxheSIsIl9ub3RpZmllZFJlYWR5IiwiX2lzU3RvcmFnZUZpbGUiLCJfcmVmcmVzaFRpbWVyIiwiX3JlZnJlc2hEdXJhdGlvbiIsIl9vbkVuZGVkIiwiX3VzZXJQYXVzZWQiLCJfcmVmcmVzaFdhaXRpbmciLCJfcmVmcmVzaCIsIl9vblBhdXNlIiwiX3ZpZXdlclBhdXNlZCIsIl9vblBsYXkiLCJfaW5pdGlhbFBsYXkiLCJfY2FuUGxheVRpbWVyIiwic2V0VGltZW91dCIsIl9zZXBhcmF0b3IiLCJEYXRlIiwiZ2V0VGltZSIsImxvYWQiLCJkdXJhdGlvbiIsInBhdXNlZCIsImN1cnJlbnRUaW1lIiwic3RyIiwidHlwZUF0dHIiLCJjcmVhdGVBdHRyaWJ1dGUiLCJjcmVhdGVEb2N1bWVudEZyYWdtZW50IiwiY3JlYXRlRWxlbWVudCIsInNjYWxlVG9GaXQiLCJ2b2x1bWUiLCJ2aWRlb1N0b3JhZ2UiLCJzcGxpdCIsIndpbmRvdyIsImFkZGl0aW9uYWxQYXJhbXMiLCJuYW1lcyIsInZhbHVlcyIsIkpTT04iLCJwYXJzZSIsInByZWZzIiwiaWQiLCJvbmNvbnRleHRtZW51IiwicmVnaXN0ZXIiLCJfZ2FxIiwicHVzaCIsImdhIiwiYXN5bmMiLCJzcmMiLCJsb2NhdGlvbiIsInByb3RvY29sIiwicyIsImdldEVsZW1lbnRzQnlUYWdOYW1lIiwicGFyZW50Tm9kZSIsImluc2VydEJlZm9yZSJdLCJtYXBwaW5ncyI6IkFBRUEsR0FBc0IsbUJBQVhBLFFBQXdCLENBQ2pDLEdBQUlBLFVBSW1CLG9CQUFaQyxXQUNUQSxRQUFRQyxPQUFPLG9DQUNaQyxTQUFTLGlCQUFrQix1REFDM0JBLFNBQVMsZ0JBQWlCLFNBRTdCRixRQUFRQyxPQUFPLG9EQUNaRSxNQUFNLGdCQUFpQixrRkFNOUIsR0FBSUMsWUFBYUEsY0FDakJBLFlBQVdDLFNBRVhELFdBQVdDLE1BQVEsU0FBV0MsRUFBVUMsR0FDdEMsWUFVQSxTQUFTQyxLQUNQRCxFQUFRRSxJQUFJQyxLQUFLLEdBQUksZUFBZ0IsS0FBTUMsRUFBT0MsVUFBVSxPQUk5RCxRQUFTQyxLQUNQTixFQUFRRSxJQUFJQyxLQUFLLEdBQUksZ0JBQWlCLEtBQU1DLEVBQU9DLFVBQVUsT0FDM0QsR0FBTSxHQUFNLEdBQU0sR0FBTSxHQUc1QixRQUFTRSxLQUVQQyxFQUFVLEdBQUlYLFlBQVdDLE1BQU1XLE9BQU9DLEdBQ3RDRixFQUFRRyxPQU1WLFFBQVNDLEtBQ1BKLEVBQVFJLFFBR1YsUUFBU0MsS0FDSEwsRUFBUU0sZ0JBRU5KLEVBQWtCSyxNQUFNQyxVQUMxQlIsRUFBUUssT0FHTEwsRUFBUVMsY0FDWFQsRUFBUUssT0FLZCxRQUFTSyxLQUNQWixJQUdGLFFBQVNhLEdBQW9CQyxHQUMzQmhCLEVBQVMsR0FBSUosR0FBUXFCLE1BQ3JCWCxFQUFvQlUsRUFFcEJyQixFQUFTdUIsZUFBZSxrQkFBa0JDLE1BQU1DLE9BQVNwQixFQUFPcUIsT0FBTyxPQUFTLEtBR2hGQyxFQUFjLEdBQUk3QixZQUFXOEIsT0FBT0MsV0FBV2xCLEdBQy9DZ0IsRUFBWWYsS0FBS0osR0FHbkIsUUFBU3NCLEtBR1BqQixJQUdGLFFBQVNrQixLQUNQN0IsSUFsRUYsR0FBSUcsR0FBUyxLQUNYTSxLQUNBZ0IsRUFBYyxLQUNkbEIsRUFBVSxJQWtFWixRQUNFSSxNQUFTQSxFQUNUQyxLQUFRQSxFQUNSTSxvQkFBdUJBLEVBQ3ZCRCxZQUFlQSxFQUNmVyxLQUFRQSxFQUNSQyxXQUFjQSxJQUdmL0IsU0FBVUMsUUFFYixJQUFJSCxZQUFhQSxjQUNqQkEsWUFBVzhCLE9BQVM5QixXQUFXOEIsV0FFL0I5QixXQUFXOEIsT0FBT0MsV0FBYSxTQUFVRyxHQUN2QyxZQVVBLFNBQVN4QixLQUNQRCxHQUFTLEVBRUwwQixHQUFrQyxrQkFBZEEsSUFDdEJBLElBSUosUUFBU0MsR0FBaUJDLEdBQ3hCQyxFQUFTQyxvQkFBb0Isd0JBQXlCSCxHQUdwRFAsRUFBWUgsTUFBTWMsZ0JBRGhCQyxNQUFNQyxRQUFRTCxFQUFFTSxRQUNrQixPQUFTTixFQUFFTSxPQUFPLEdBQUssSUFFdkIsT0FBU04sRUFBRU0sT0FBUyxJQUUxRGpDLElBR0YsUUFBU2tDLEtBQ1BmLEVBQWMzQixTQUFTdUIsZUFBZSxjQUN0Q2EsRUFBV3BDLFNBQVN1QixlQUFlLHFCQUduQ3ZCLFNBQVMyQyxLQUFLbkIsTUFBTW9CLFdBQWFaLEVBQUtZLFdBQVdDLE1BRTdDbEIsRUFDRUssRUFBS1ksV0FBV0UsVUFDbEJuQixFQUFZb0IsVUFBWWYsRUFBS1ksV0FBV0ksTUFBTUMsU0FDOUN0QixFQUFZb0IsVUFBWWYsRUFBS1ksV0FBV0ksTUFBTUUsTUFBUXZCLEVBQVlvQixVQUFZLGdCQUMxRXBCLEVBQVlvQixVQUVtQyxJQUEvQ0ksT0FBT0MsS0FBS3BCLEVBQUtxQixtQkFBbUJDLFFBQ3RDM0IsRUFBWUgsTUFBTWMsZ0JBQWtCLE9BQVNOLEVBQUtZLFdBQVdJLE1BQU1PLElBQU0sSUFDekUvQyxLQUVJNEIsR0FFRkEsRUFBU29CLGlCQUFpQix3QkFBeUJ0QixHQUVuREUsRUFBU3FCLGFBQWEsU0FBVXpCLEVBQUtxQixrQkFBa0JLLFFBQ3ZEdEIsRUFBU3FCLGFBQWEsV0FBWXpCLEVBQUtxQixrQkFBa0JNLFVBQ3pEdkIsRUFBU3FCLGFBQWEsWUFBYXpCLEVBQUtxQixrQkFBa0JPLFdBQzFEeEIsRUFBU3lCLE1BRVRDLFFBQVFDLElBQUkseURBSWhCdkQsSUFHRnNELFFBQVFDLElBQUksaURBT2hCLFFBQVNuRCxHQUFLb0QsR0FDUHpELEVBT015RCxHQUFvQixrQkFBUEEsSUFDdEJBLEtBUElBLElBQ0YvQixFQUFZK0IsR0FHZHRCLEtBekVKLEdBQUlULEdBQVksS0FDZDFCLEdBQVMsRUFDVG9CLEVBQWMsS0FDZFMsRUFBVyxJQTZFYixRQUNFeEIsS0FBUUEsR0FJWixJQUFJZCxZQUFhQSxjQUNqQkEsWUFBV0MsTUFBUUQsV0FBV0MsVUFFOUJELFdBQVdDLE1BQU1XLE9BQVMsU0FBVXNCLEdBQ2xDLFlBbUJBLFNBQVNFLEdBQWlCQyxHQUN4QkMsRUFBU0Msb0JBQW9CLHdCQUF5QkgsR0FHcEQrQixFQUFTcEUsTUFEUDBDLE1BQU1DLFFBQVFMLEVBQUVNLFFBQ0ROLEVBQUVNLE9BQU8sR0FFVE4sRUFBRU0sT0FHckJ5QixFQUFRQyxpQkFBaUJGLEdBQ3pCRyxFQUFPQyxZQUFZQyxHQUdyQixRQUFTQyxLQUNQLEdBQUlDLEdBQU94QyxFQUFLdUIsSUFBSWtCLE9BQU96QyxFQUFLdUIsSUFBSW1CLFlBQVksS0FBTyxFQU12RCxPQUphLFFBQVRGLElBQ0ZBLEVBQU8sT0FHRkEsRUFHVCxRQUFTRyxLQUVQQyxFQUFnQnBELE1BQU1xRCxXQUFhLFVBRW5DVCxFQUFPL0Isb0JBQW9CLGFBQWNzQyxHQUFlLEdBRzFELFFBQVNHLEtBRVBDLEdBQVcsRUFHTkMsSUFDSGxGLFdBQVdDLE1BQU1vQixjQUNqQjZELEdBQWlCLEdBSW5CWixFQUFPL0Isb0JBQW9CLFVBQVd5QyxHQUFZLEdBRTdDRyxHQUVIQyxFQUFjQyxHQUlsQixRQUFTQyxLQUVQQyxHQUFjLEdBRVRKLEdBQWtCSyxJQUNyQkEsR0FBa0IsRUFDbEJDLEtBSUZ6RixXQUFXQyxNQUFNZ0MsYUFHbkIsUUFBU3lELEtBRVBILEdBQWVJLEVBR2pCLFFBQVNDLEtBQ1BDLEdBQWUsRUFDZk4sR0FBYyxFQUdoQixRQUFTTyxLQUNQQyxXQUFXLFdBRUxkLEVBQ0ZYLEVBQU90RCxPQUVQOEUsS0FHRCxLQUdMLFFBQVNMLEtBQ1BuQixFQUFPWixpQkFBaUIsVUFBV3NCLEdBQVksR0FDL0NWLEVBQU9aLGlCQUFpQixhQUFjbUIsR0FBZSxHQUdyREMsRUFBZ0JwRCxNQUFNcUQsV0FBYSxTQUduQ1gsRUFBUVQsYUFBYSxNQUFPekIsRUFBS3VCLElBQU11QyxFQUFhLE9BQVEsR0FBSUMsT0FBT0MsV0FHdkVqQixHQUFXLEVBRVhYLEVBQU82QixPQUdULFFBQVNmLEdBQWNnQixHQUNyQkwsV0FBVyxXQUVMekIsRUFBTytCLFFBQVUvQixFQUFPZ0MsYUFBZSxFQUV6Q2IsSUFFQUQsR0FBa0IsR0FHbkJZLEdBTUwsUUFBU25GLEtBQ1AsTUFBTzRFLEdBR1QsUUFBUy9FLEtBQ1AsR0FDRXlGLEdBREVDLEVBQVd0RyxTQUFTdUcsZ0JBQWdCLE9BR3hDakMsR0FBWXRFLFNBQVN3Ryx5QkFDckJ0QyxFQUFVSSxFQUFVRCxZQUFZckUsU0FBU3lHLGNBQWMsV0FDdkR4QyxFQUFXakUsU0FBU3VHLGdCQUFnQixPQUcvQnZFLEVBQUtoQixNQUFNQyxVQUNkbUQsRUFBT1gsYUFBYSxXQUFZLElBSWxDVyxFQUFPckIsVUFBWWYsRUFBS2hCLE1BQU0wRixXQUFhdEMsRUFBT3JCLFVBQVksZ0JBQzFEcUIsRUFBT3JCLFVBQVksWUFHdkJxQixFQUFPdUMsT0FBUzNFLEVBQUtoQixNQUFNMkYsT0FBUyxJQUdwQ0wsRUFBU3pHLE1BQVEsU0FBVzBFLElBQzVCTCxFQUFRQyxpQkFBaUJtQyxHQUd6QmxDLEVBQU9aLGlCQUFpQixhQUFjbUIsR0FBZSxHQUNyRFAsRUFBT1osaUJBQWlCLFVBQVdzQixHQUFZLEdBQy9DVixFQUFPWixpQkFBaUIsUUFBUzRCLEdBQVUsR0FDM0NoQixFQUFPWixpQkFBaUIsUUFBU2dDLEdBQVUsR0FDM0NwQixFQUFPWixpQkFBaUIsT0FBUWtDLEdBQVMsR0FFekNULEVBQTRELElBQTFDOUIsT0FBT0MsS0FBS3BCLEVBQUs0RSxjQUFjdEQsT0FFNUMyQixHQWFIN0MsRUFBU29CLGlCQUFpQix3QkFBeUJ0QixHQUVuREUsRUFBU3FCLGFBQWEsU0FBVXpCLEVBQUs0RSxhQUFhbEQsUUFDbER0QixFQUFTcUIsYUFBYSxXQUFZekIsRUFBSzRFLGFBQWFqRCxVQUNwRHZCLEVBQVNxQixhQUFhLFlBQWF6QixFQUFLNEUsYUFBYWhELFdBQ3JEeEIsRUFBU3lCLE9BakJUd0MsRUFBTXJFLEVBQUt1QixJQUFJc0QsTUFBTSxLQUdyQmYsRUFBNkIsSUFBZk8sRUFBSS9DLE9BQWdCLElBQU0sSUFHeENXLEVBQVNwRSxNQUFRbUMsRUFBS3VCLElBQ3RCVyxFQUFRQyxpQkFBaUJGLEdBQ3pCRyxFQUFPQyxZQUFZQyxJQWF2QixRQUFTekQsS0FDUDRFLEdBQWdCLEVBQ2hCckIsRUFBT3ZELFFBR1QsUUFBU0MsS0FDUDZFLEdBQWUsRUFDZkYsR0FBZ0IsRUFFWFYsRUFHSFgsRUFBT3RELE9BRlA4RSxJQU9KLFFBQVMxRSxLQUNQLE1BQU9tRSxHQWxOVCxHQVlFcEIsR0FBVUssRUFBV0osRUFabkJFLEVBQVNwRSxTQUFTdUIsZUFBZSxTQUNuQ3FELEVBQWtCNUUsU0FBU3VCLGVBQWUsa0JBQzFDYSxFQUFXcEMsU0FBU3VCLGVBQWUsZ0JBQ25Db0UsR0FBZSxFQUNmTixHQUFjLEVBQ2RJLEdBQWdCLEVBQ2hCTixFQUFtQixJQUNuQkYsR0FBaUIsRUFDakJLLEdBQWtCLEVBQ2xCTixHQUFpQixFQUNqQkQsR0FBVyxFQUNYZSxFQUFhLEVBME1mLFFBQ0UvRSxjQUFpQkEsRUFDakJILEtBQVFBLEVBQ1JDLE1BQVNBLEVBQ1RDLEtBQVFBLEVBQ1JJLFdBQWNBLElBTWxCLFNBQVc0RixFQUFRN0csR0FDakIsWUFVQSxTQUFTYSxLQUNQaEIsV0FBV0MsTUFBTWUsT0FHbkIsUUFBU0QsS0FDUGYsV0FBV0MsTUFBTWMsUUFHbkIsUUFBU2lCLEtBQ1BoQyxXQUFXQyxNQUFNK0IsT0FHbkIsUUFBU2lGLEdBQWlCQyxFQUFPQyxHQUMzQjFFLE1BQU1DLFFBQVF3RSxJQUFVQSxFQUFNMUQsT0FBUyxHQUFrQixxQkFBYjBELEVBQU0sSUFDaER6RSxNQUFNQyxRQUFReUUsSUFBV0EsRUFBTzNELE9BQVMsR0FDM0N4RCxXQUFXQyxNQUFNcUIsb0JBQW9COEYsS0FBS0MsTUFBTUYsRUFBTyxLQXZCN0QsR0FBSUcsR0FBUSxHQUFJbkgsR0FBUXFCLE1BQ3RCK0YsRUFBS0QsRUFBTTlHLFVBQVUsS0FHdkJ3RyxHQUFPUSxjQUFnQixXQUNyQixPQUFPLEdBdUJMRCxHQUFhLEtBQVBBLElBQ1JwSCxFQUFRRSxJQUFJb0gsU0FBUyxjQUFnQkYsRUFBSXZHLEdBQ3pDYixFQUFRRSxJQUFJb0gsU0FBUyxlQUFpQkYsRUFBSXhHLEdBQzFDWixFQUFRRSxJQUFJb0gsU0FBUyxjQUFnQkYsRUFBSXZGLEdBRXpDN0IsRUFBUUUsSUFBSW9ILFNBQVMsZUFBaUJGLEVBQUlOLEdBQzFDOUcsRUFBUUUsSUFBSUMsS0FBSyxHQUFJLGNBQWUsS0FBTWlILEdBQUssdUJBSWhEUCxPQUFRN0csUUFLWCxJQUFJdUgsTUFBT0EsUUFFWEEsTUFBS0MsTUFBTSxjQUFlLGtCQUMxQkQsS0FBS0MsTUFBTSxtQkFFWCxXQUNFLEdBQUlDLEdBQUsxSCxTQUFTeUcsY0FBYyxTQUFXaUIsR0FBR2xELEtBQU8sa0JBQW1Ca0QsRUFBR0MsT0FBUSxFQUNuRkQsRUFBR0UsS0FBTyxVQUFZNUgsU0FBUzZILFNBQVNDLFNBQVcsY0FBZ0IsY0FBZ0IsNkJBQ25GLElBQUlDLEdBQUkvSCxTQUFTZ0kscUJBQXFCLFVBQVUsRUFBSUQsR0FBRUUsV0FBV0MsYUFBYVIsRUFBSUsiLCJmaWxlIjoianMvd2lkZ2V0Lm1pbi5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8qIGdsb2JhbCBjb25maWc6IHRydWUgKi9cbi8qIGV4cG9ydGVkIGNvbmZpZyAqL1xuaWYgKHR5cGVvZiBjb25maWcgPT09IFwidW5kZWZpbmVkXCIpIHtcbiAgdmFyIGNvbmZpZyA9IHtcbiAgICAvLyB2YXJpYWJsZXMgZ28gaGVyZVxuICB9O1xuXG4gIGlmICh0eXBlb2YgYW5ndWxhciAhPT0gXCJ1bmRlZmluZWRcIikge1xuICAgIGFuZ3VsYXIubW9kdWxlKFwicmlzZXZpc2lvbi5jb21tb24uaTE4bi5jb25maWdcIiwgW10pXG4gICAgICAuY29uc3RhbnQoXCJMT0NBTEVTX1BSRUZJWFwiLCBcImNvbXBvbmVudHMvcnYtY29tbW9uLWkxOG4vZGlzdC9sb2NhbGVzL3RyYW5zbGF0aW9uX1wiKVxuICAgICAgLmNvbnN0YW50KFwiTE9DQUxFU19TVUZJWFwiLCBcIi5qc29uXCIpO1xuXG4gICAgYW5ndWxhci5tb2R1bGUoXCJyaXNldmlzaW9uLndpZGdldC5jb21tb24uc3RvcmFnZS1zZWxlY3Rvci5jb25maWdcIilcbiAgICAgIC52YWx1ZShcIlNUT1JBR0VfTU9EQUxcIiwgXCJodHRwczovL3N0b3JhZ2Utc3RhZ2UucmlzZXZpc2lvbi5jb20vcnZhLXRlc3QvZGlzdC9zdG9yYWdlLW1vZGFsLmh0bWwjL2ZpbGVzL1wiKTtcbiAgfVxufVxuXG4vKiBnbG9iYWwgZ2FkZ2V0cyAqL1xuXG52YXIgUmlzZVZpc2lvbiA9IFJpc2VWaXNpb24gfHwge307XG5SaXNlVmlzaW9uLlZpZGVvID0ge307XG5cblJpc2VWaXNpb24uVmlkZW8gPSAoZnVuY3Rpb24gKGRvY3VtZW50LCBnYWRnZXRzKSB7XG4gIFwidXNlIHN0cmljdFwiO1xuXG4gIHZhciBfcHJlZnMgPSBudWxsLFxuICAgIF9hZGRpdGlvbmFsUGFyYW1zID0ge30sXG4gICAgX2JhY2tncm91bmQgPSBudWxsLFxuICAgIF9wbGF5ZXIgPSBudWxsO1xuXG4gIC8qXG4gICAqICBQcml2YXRlIE1ldGhvZHNcbiAgICovXG4gIGZ1bmN0aW9uIF9kb25lKCkge1xuICAgIGdhZGdldHMucnBjLmNhbGwoXCJcIiwgXCJyc2V2ZW50X2RvbmVcIiwgbnVsbCwgX3ByZWZzLmdldFN0cmluZyhcImlkXCIpKTtcblxuICB9XG5cbiAgZnVuY3Rpb24gX3JlYWR5KCkge1xuICAgIGdhZGdldHMucnBjLmNhbGwoXCJcIiwgXCJyc2V2ZW50X3JlYWR5XCIsIG51bGwsIF9wcmVmcy5nZXRTdHJpbmcoXCJpZFwiKSxcbiAgICAgIHRydWUsIHRydWUsIHRydWUsIHRydWUsIHRydWUpO1xuICB9XG5cbiAgZnVuY3Rpb24gX2JhY2tncm91bmRSZWFkeSgpIHtcbiAgICAvLyBjcmVhdGUgYW5kIGluaXRpYWxpemUgdGhlIFBsYXllciBpbnN0YW5jZVxuICAgIF9wbGF5ZXIgPSBuZXcgUmlzZVZpc2lvbi5WaWRlby5QbGF5ZXIoX2FkZGl0aW9uYWxQYXJhbXMpO1xuICAgIF9wbGF5ZXIuaW5pdCgpO1xuICB9XG5cbiAgLypcbiAgICogIFB1YmxpYyBNZXRob2RzXG4gICAqL1xuICBmdW5jdGlvbiBwYXVzZSgpIHtcbiAgICBfcGxheWVyLnBhdXNlKCk7XG4gIH1cblxuICBmdW5jdGlvbiBwbGF5KCkge1xuICAgIGlmIChfcGxheWVyLmlzSW5pdGlhbFBsYXkoKSkge1xuICAgICAgLy8gXCJhdXRvcGxheVwiIHdhcyBzZWxlY3RlZCBpbiBzZXR0aW5nc1xuICAgICAgaWYgKF9hZGRpdGlvbmFsUGFyYW1zLnZpZGVvLmF1dG9wbGF5KSB7XG4gICAgICAgIF9wbGF5ZXIucGxheSgpO1xuICAgICAgfVxuICAgIH0gZWxzZSB7XG4gICAgICBpZiAoIV9wbGF5ZXIudXNlclBhdXNlZCgpKSB7XG4gICAgICAgIF9wbGF5ZXIucGxheSgpO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIGZ1bmN0aW9uIHBsYXllclJlYWR5KCkge1xuICAgIF9yZWFkeSgpO1xuICB9XG5cbiAgZnVuY3Rpb24gc2V0QWRkaXRpb25hbFBhcmFtcyhwYXJhbXMpIHtcbiAgICBfcHJlZnMgPSBuZXcgZ2FkZ2V0cy5QcmVmcygpO1xuICAgIF9hZGRpdGlvbmFsUGFyYW1zID0gcGFyYW1zO1xuXG4gICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJ2aWRlb0NvbnRhaW5lclwiKS5zdHlsZS5oZWlnaHQgPSBfcHJlZnMuZ2V0SW50KFwicnNIXCIpICsgXCJweFwiO1xuXG4gICAgLy8gY3JlYXRlIGFuZCBpbml0aWFsaXplIHRoZSBCYWNrZ3JvdW5kIGluc3RhbmNlXG4gICAgX2JhY2tncm91bmQgPSBuZXcgUmlzZVZpc2lvbi5Db21tb24uQmFja2dyb3VuZChfYWRkaXRpb25hbFBhcmFtcyk7XG4gICAgX2JhY2tncm91bmQuaW5pdChfYmFja2dyb3VuZFJlYWR5KTtcbiAgfVxuXG4gIGZ1bmN0aW9uIHN0b3AoKSB7XG4gICAgLy8gaHR0cHM6Ly9naXRodWIuY29tL1Jpc2UtVmlzaW9uL3ZpZXdlci9pc3N1ZXMvMzBcbiAgICAvLyBIYXZlIHRvIGNhbGwgcGF1c2UoKSBkdWUgdG8gVmlld2VyIGlzc3VlXG4gICAgcGF1c2UoKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIHZpZGVvRW5kZWQoKSB7XG4gICAgX2RvbmUoKTtcbiAgfVxuXG4gIHJldHVybiB7XG4gICAgXCJwYXVzZVwiOiBwYXVzZSxcbiAgICBcInBsYXlcIjogcGxheSxcbiAgICBcInNldEFkZGl0aW9uYWxQYXJhbXNcIjogc2V0QWRkaXRpb25hbFBhcmFtcyxcbiAgICBcInBsYXllclJlYWR5XCI6IHBsYXllclJlYWR5LFxuICAgIFwic3RvcFwiOiBzdG9wLFxuICAgIFwidmlkZW9FbmRlZFwiOiB2aWRlb0VuZGVkXG4gIH07XG5cbn0pKGRvY3VtZW50LCBnYWRnZXRzKTtcblxudmFyIFJpc2VWaXNpb24gPSBSaXNlVmlzaW9uIHx8IHt9O1xuUmlzZVZpc2lvbi5Db21tb24gPSBSaXNlVmlzaW9uLkNvbW1vbiB8fCB7fTtcblxuUmlzZVZpc2lvbi5Db21tb24uQmFja2dyb3VuZCA9IGZ1bmN0aW9uIChkYXRhKSB7XG4gIFwidXNlIHN0cmljdFwiO1xuXG4gIHZhciBfY2FsbGJhY2sgPSBudWxsLFxuICAgIF9yZWFkeSA9IGZhbHNlLFxuICAgIF9iYWNrZ3JvdW5kID0gbnVsbCxcbiAgICBfc3RvcmFnZSA9IG51bGw7XG5cbiAgLypcbiAgICogUHJpdmF0ZSBNZXRob2RzXG4gICAqL1xuICBmdW5jdGlvbiBfYmFja2dyb3VuZFJlYWR5KCkge1xuICAgIF9yZWFkeSA9IHRydWU7XG5cbiAgICBpZiAoX2NhbGxiYWNrICYmIHR5cGVvZiBfY2FsbGJhY2sgPT09IFwiZnVuY3Rpb25cIikge1xuICAgICAgX2NhbGxiYWNrKCk7XG4gICAgfVxuICB9XG5cbiAgZnVuY3Rpb24gX3N0b3JhZ2VSZXNwb25zZShlKSB7XG4gICAgX3N0b3JhZ2UucmVtb3ZlRXZlbnRMaXN0ZW5lcihcInJpc2Utc3RvcmFnZS1yZXNwb25zZVwiLCBfc3RvcmFnZVJlc3BvbnNlKTtcblxuICAgIGlmIChBcnJheS5pc0FycmF5KGUuZGV0YWlsKSkge1xuICAgICAgX2JhY2tncm91bmQuc3R5bGUuYmFja2dyb3VuZEltYWdlID0gXCJ1cmwoXCIgKyBlLmRldGFpbFswXSArIFwiKVwiO1xuICAgIH0gZWxzZSB7XG4gICAgICBfYmFja2dyb3VuZC5zdHlsZS5iYWNrZ3JvdW5kSW1hZ2UgPSBcInVybChcIiArIGUuZGV0YWlsICsgXCIpXCI7XG4gICAgfVxuICAgIF9iYWNrZ3JvdW5kUmVhZHkoKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIF9jb25maWd1cmUoKSB7XG4gICAgX2JhY2tncm91bmQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcImJhY2tncm91bmRcIik7XG4gICAgX3N0b3JhZ2UgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcImJhY2tncm91bmRTdG9yYWdlXCIpO1xuXG4gICAgLy8gc2V0IHRoZSBkb2N1bWVudCBiYWNrZ3JvdW5kXG4gICAgZG9jdW1lbnQuYm9keS5zdHlsZS5iYWNrZ3JvdW5kID0gZGF0YS5iYWNrZ3JvdW5kLmNvbG9yO1xuXG4gICAgaWYgKF9iYWNrZ3JvdW5kKSB7XG4gICAgICBpZiAoZGF0YS5iYWNrZ3JvdW5kLnVzZUltYWdlKSB7XG4gICAgICAgIF9iYWNrZ3JvdW5kLmNsYXNzTmFtZSA9IGRhdGEuYmFja2dyb3VuZC5pbWFnZS5wb3NpdGlvbjtcbiAgICAgICAgX2JhY2tncm91bmQuY2xhc3NOYW1lID0gZGF0YS5iYWNrZ3JvdW5kLmltYWdlLnNjYWxlID8gX2JhY2tncm91bmQuY2xhc3NOYW1lICsgXCIgc2NhbGUtdG8tZml0XCJcbiAgICAgICAgICA6IF9iYWNrZ3JvdW5kLmNsYXNzTmFtZTtcblxuICAgICAgICBpZiAoT2JqZWN0LmtleXMoZGF0YS5iYWNrZ3JvdW5kU3RvcmFnZSkubGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgX2JhY2tncm91bmQuc3R5bGUuYmFja2dyb3VuZEltYWdlID0gXCJ1cmwoXCIgKyBkYXRhLmJhY2tncm91bmQuaW1hZ2UudXJsICsgXCIpXCI7XG4gICAgICAgICAgX2JhY2tncm91bmRSZWFkeSgpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGlmIChfc3RvcmFnZSkge1xuICAgICAgICAgICAgLy8gUmlzZSBTdG9yYWdlXG4gICAgICAgICAgICBfc3RvcmFnZS5hZGRFdmVudExpc3RlbmVyKFwicmlzZS1zdG9yYWdlLXJlc3BvbnNlXCIsIF9zdG9yYWdlUmVzcG9uc2UpO1xuXG4gICAgICAgICAgICBfc3RvcmFnZS5zZXRBdHRyaWJ1dGUoXCJmb2xkZXJcIiwgZGF0YS5iYWNrZ3JvdW5kU3RvcmFnZS5mb2xkZXIpO1xuICAgICAgICAgICAgX3N0b3JhZ2Uuc2V0QXR0cmlidXRlKFwiZmlsZU5hbWVcIiwgZGF0YS5iYWNrZ3JvdW5kU3RvcmFnZS5maWxlTmFtZSk7XG4gICAgICAgICAgICBfc3RvcmFnZS5zZXRBdHRyaWJ1dGUoXCJjb21wYW55SWRcIiwgZGF0YS5iYWNrZ3JvdW5kU3RvcmFnZS5jb21wYW55SWQpO1xuICAgICAgICAgICAgX3N0b3JhZ2UuZ28oKTtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgY29uc29sZS5sb2coXCJNaXNzaW5nIGVsZW1lbnQgd2l0aCBpZCB2YWx1ZSBvZiAnYmFja2dyb3VuZFN0b3JhZ2UnXCIpO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgX2JhY2tncm91bmRSZWFkeSgpO1xuICAgICAgfVxuICAgIH0gZWxzZSB7XG4gICAgICBjb25zb2xlLmxvZyhcIk1pc3NpbmcgZWxlbWVudCB3aXRoIGlkIHZhbHVlIG9mICdiYWNrZ3JvdW5kJ1wiKTtcbiAgICB9XG4gIH1cblxuICAvKlxuICAgKiAgUHVibGljIE1ldGhvZHNcbiAgICovXG4gIGZ1bmN0aW9uIGluaXQoY2IpIHtcbiAgICBpZiAoIV9yZWFkeSkge1xuICAgICAgaWYgKGNiKSB7XG4gICAgICAgIF9jYWxsYmFjayA9IGNiO1xuICAgICAgfVxuXG4gICAgICBfY29uZmlndXJlKCk7XG5cbiAgICB9IGVsc2UgaWYgKGNiICYmIHR5cGVvZiBjYiA9PT0gXCJmdW5jdGlvblwiKSB7XG4gICAgICBjYigpO1xuICAgIH1cbiAgfVxuXG4gIHJldHVybiB7XG4gICAgXCJpbml0XCI6IGluaXRcbiAgfTtcbn07XG5cbnZhciBSaXNlVmlzaW9uID0gUmlzZVZpc2lvbiB8fCB7fTtcblJpc2VWaXNpb24uVmlkZW8gPSBSaXNlVmlzaW9uLlZpZGVvIHx8IHt9O1xuXG5SaXNlVmlzaW9uLlZpZGVvLlBsYXllciA9IGZ1bmN0aW9uIChkYXRhKSB7XG4gIFwidXNlIHN0cmljdFwiO1xuXG4gIHZhciBfdmlkZW8gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcInZpZGVvXCIpLFxuICAgIF92aWRlb0NvbnRhaW5lciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwidmlkZW9Db250YWluZXJcIiksXG4gICAgX3N0b3JhZ2UgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcInZpZGVvU3RvcmFnZVwiKSxcbiAgICBfaW5pdGlhbFBsYXkgPSB0cnVlLFxuICAgIF91c2VyUGF1c2VkID0gZmFsc2UsXG4gICAgX3ZpZXdlclBhdXNlZCA9IGZhbHNlLFxuICAgIF9yZWZyZXNoRHVyYXRpb24gPSA5MDAwMDAsIC8vIDE1IG1pbnV0ZXNcbiAgICBfaXNTdG9yYWdlRmlsZSA9IGZhbHNlLFxuICAgIF9yZWZyZXNoV2FpdGluZyA9IGZhbHNlLFxuICAgIF9ub3RpZmllZFJlYWR5ID0gZmFsc2UsXG4gICAgX2NhblBsYXkgPSBmYWxzZSxcbiAgICBfc2VwYXJhdG9yID0gXCJcIixcbiAgICBfc3JjQXR0ciwgX2ZyYWdtZW50LCBfc291cmNlO1xuXG4gIC8qXG4gICAqIFByaXZhdGUgTWV0aG9kc1xuICAgKi9cbiAgZnVuY3Rpb24gX3N0b3JhZ2VSZXNwb25zZShlKSB7XG4gICAgX3N0b3JhZ2UucmVtb3ZlRXZlbnRMaXN0ZW5lcihcInJpc2Utc3RvcmFnZS1yZXNwb25zZVwiLCBfc3RvcmFnZVJlc3BvbnNlKTtcblxuICAgIGlmIChBcnJheS5pc0FycmF5KGUuZGV0YWlsKSkge1xuICAgICAgX3NyY0F0dHIudmFsdWUgPSBlLmRldGFpbFswXTtcbiAgICB9IGVsc2Uge1xuICAgICAgX3NyY0F0dHIudmFsdWUgPSBlLmRldGFpbDtcbiAgICB9XG5cbiAgICBfc291cmNlLnNldEF0dHJpYnV0ZU5vZGUoX3NyY0F0dHIpO1xuICAgIF92aWRlby5hcHBlbmRDaGlsZChfZnJhZ21lbnQpO1xuICB9XG5cbiAgZnVuY3Rpb24gX2dldFZpZGVvRmlsZVR5cGUoKSB7XG4gICAgdmFyIHR5cGUgPSBkYXRhLnVybC5zdWJzdHIoZGF0YS51cmwubGFzdEluZGV4T2YoXCIuXCIpICsgMSk7XG5cbiAgICBpZiAodHlwZSA9PT0gXCJvZ3ZcIikge1xuICAgICAgdHlwZSA9IFwib2dnXCI7XG4gICAgfVxuXG4gICAgcmV0dXJuIHR5cGU7XG4gIH1cblxuICBmdW5jdGlvbiBfb25Mb2FkZWREYXRhKCkge1xuICAgIC8vIGF0IGxlYXN0IDFzdCBmcmFtZSBvZiB2aWRlbyBoYXMgbG9hZGVkXG4gICAgX3ZpZGVvQ29udGFpbmVyLnN0eWxlLnZpc2liaWxpdHkgPSBcInZpc2libGVcIjtcbiAgICAvLyByZW1vdmUgdGhpcyBsaXN0ZW5lclxuICAgIF92aWRlby5yZW1vdmVFdmVudExpc3RlbmVyKFwibG9hZGVkZGF0YVwiLCBfb25Mb2FkZWREYXRhLCBmYWxzZSk7XG4gIH1cblxuICBmdW5jdGlvbiBfb25DYW5QbGF5KCkge1xuICAgIC8vIGVub3VnaCBkYXRhIGhhcyBsb2FkZWQgdG8gc2FmZWx5IHBsYXkgd2l0aG91dCBpbnRlcnJ1cHRpb25cbiAgICBfY2FuUGxheSA9IHRydWU7XG5cbiAgICAvLyBvbmx5IGNhbGwgcGxheWVyUmVhZHkoKSBvbmNlXG4gICAgaWYgKCFfbm90aWZpZWRSZWFkeSkge1xuICAgICAgUmlzZVZpc2lvbi5WaWRlby5wbGF5ZXJSZWFkeSgpO1xuICAgICAgX25vdGlmaWVkUmVhZHkgPSB0cnVlO1xuICAgIH1cblxuICAgIC8vIHJlbW92ZSB0aGlzIGxpc3RlbmVyXG4gICAgX3ZpZGVvLnJlbW92ZUV2ZW50TGlzdGVuZXIoXCJjYW5wbGF5XCIsIF9vbkNhblBsYXksIGZhbHNlKTtcblxuICAgIGlmICghX2lzU3RvcmFnZUZpbGUpIHtcbiAgICAgIC8vIGNhbGwgdGhlIHJlZnJlc2ggdGltZXIgZnVuY3Rpb24gZm9yIGEgbm9uLXN0b3JhZ2UgdmlkZW9cbiAgICAgIF9yZWZyZXNoVGltZXIoX3JlZnJlc2hEdXJhdGlvbik7XG4gICAgfVxuICB9XG5cbiAgZnVuY3Rpb24gX29uRW5kZWQoKSB7XG4gICAgLy8gYSBcInBhdXNlXCIgZXZlbnQgaXMgYWx3YXlzIGZpcmVkIGJlZm9yZSBcImVuZGVkXCIgZXZlbnQsIGVuc3VyZSBfdXNlclBhdXNlZCBpcyBmYWxzZVxuICAgIF91c2VyUGF1c2VkID0gZmFsc2U7XG5cbiAgICBpZiAoIV9pc1N0b3JhZ2VGaWxlICYmIF9yZWZyZXNoV2FpdGluZykge1xuICAgICAgX3JlZnJlc2hXYWl0aW5nID0gZmFsc2U7XG4gICAgICBfcmVmcmVzaCgpO1xuICAgIH1cblxuICAgIC8vIHZpZGVvIGVuZGVkXG4gICAgUmlzZVZpc2lvbi5WaWRlby52aWRlb0VuZGVkKCk7XG4gIH1cblxuICBmdW5jdGlvbiBfb25QYXVzZSgpIHtcbiAgICAvLyB0aGlzIGhhbmRsZXIgYWxzbyBnZXRzIGNhbGxlZCB2aWEgcHVibGljIFwicGF1c2UoKVwiIGZ1bmN0aW9uLCBvbmx5IHNldCBcIl91c2VyUGF1c2VkID0gdHJ1ZVwiIGlmIG5vdCB0aGUgY2FzZVxuICAgIF91c2VyUGF1c2VkID0gIV92aWV3ZXJQYXVzZWQ7XG4gIH1cblxuICBmdW5jdGlvbiBfb25QbGF5KCkge1xuICAgIF9pbml0aWFsUGxheSA9IGZhbHNlO1xuICAgIF91c2VyUGF1c2VkID0gZmFsc2U7XG4gIH1cblxuICBmdW5jdGlvbiBfY2FuUGxheVRpbWVyKCkge1xuICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gd2FpdFRvUGxheSgpIHtcblxuICAgICAgaWYgKF9jYW5QbGF5KSB7XG4gICAgICAgIF92aWRlby5wbGF5KCk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBfY2FuUGxheVRpbWVyKCk7XG4gICAgICB9XG5cbiAgICB9LCAyMDApO1xuICB9XG5cbiAgZnVuY3Rpb24gX3JlZnJlc2goKSB7XG4gICAgX3ZpZGVvLmFkZEV2ZW50TGlzdGVuZXIoXCJjYW5wbGF5XCIsIF9vbkNhblBsYXksIGZhbHNlKTtcbiAgICBfdmlkZW8uYWRkRXZlbnRMaXN0ZW5lcihcImxvYWRlZGRhdGFcIiwgX29uTG9hZGVkRGF0YSwgZmFsc2UpO1xuXG4gICAgLy8gaGlkZSB0aGUgdmlkZW8gd2hpbGUgaXQgZ2V0cyBhIGRhdGEgcmVmcmVzaCB0byBhdm9pZCB2aXN1YWwgdWdsaW5lc3NcbiAgICBfdmlkZW9Db250YWluZXIuc3R5bGUudmlzaWJpbGl0eSA9IFwiaGlkZGVuXCI7XG5cbiAgICAvLyBzZXQgbmV3IHNyYyB2YWx1ZSB3aXRoIGEgY2FjaGVidXN0ZXJcbiAgICBfc291cmNlLnNldEF0dHJpYnV0ZShcInNyY1wiLCBkYXRhLnVybCArIF9zZXBhcmF0b3IgKyBcImNiPVwiICsgbmV3IERhdGUoKS5nZXRUaW1lKCkpO1xuXG4gICAgLy8gZmxhZyBhc3NvY2lhdGVkIHdpdGggXCJjYW5wbGF5XCIgZXZlbnQsIGVuc3VyZXMgdmlkZW8gd29uJ3QgYmUgcGxheWVkIHVudGlsIGl0IGhhcyBsb2FkZWQgZW5vdWdoXG4gICAgX2NhblBsYXkgPSBmYWxzZTtcblxuICAgIF92aWRlby5sb2FkKCk7XG4gIH1cblxuICBmdW5jdGlvbiBfcmVmcmVzaFRpbWVyKGR1cmF0aW9uKSB7XG4gICAgc2V0VGltZW91dChmdW5jdGlvbiB2aWRlb1JlZnJlc2goKSB7XG5cbiAgICAgIGlmIChfdmlkZW8ucGF1c2VkICYmIF92aWRlby5jdXJyZW50VGltZSA8PSAwKSB7XG4gICAgICAgIC8vIE9ubHkgcmVmcmVzaGluZyBpbW1lZGlhdGVseSB3aGVuIGluIGEgcGF1c2VkIHN0YXRlIGFuZCB0aGUgdmlkZW8gaXMgYXQgdGhlIGJlZ2lubmluZ1xuICAgICAgICBfcmVmcmVzaCgpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgX3JlZnJlc2hXYWl0aW5nID0gdHJ1ZTtcbiAgICAgIH1cblxuICAgIH0sIGR1cmF0aW9uKTtcbiAgfVxuXG4gIC8qXG4gICAqICBQdWJsaWMgTWV0aG9kc1xuICAgKi9cbiAgZnVuY3Rpb24gaXNJbml0aWFsUGxheSgpIHtcbiAgICByZXR1cm4gX2luaXRpYWxQbGF5O1xuICB9XG5cbiAgZnVuY3Rpb24gaW5pdCgpIHtcbiAgICB2YXIgdHlwZUF0dHIgPSBkb2N1bWVudC5jcmVhdGVBdHRyaWJ1dGUoXCJ0eXBlXCIpLFxuICAgICAgc3RyO1xuXG4gICAgX2ZyYWdtZW50ID0gZG9jdW1lbnQuY3JlYXRlRG9jdW1lbnRGcmFnbWVudCgpO1xuICAgIF9zb3VyY2UgPSBfZnJhZ21lbnQuYXBwZW5kQ2hpbGQoZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcInNvdXJjZVwiKSk7XG4gICAgX3NyY0F0dHIgPSBkb2N1bWVudC5jcmVhdGVBdHRyaWJ1dGUoXCJzcmNcIik7XG5cbiAgICAvLyB1c2UgZGVmYXVsdCBjb250cm9scyBpZiBub3Qgc2V0IHRvIGF1dG9wbGF5XG4gICAgaWYgKCFkYXRhLnZpZGVvLmF1dG9wbGF5KSB7XG4gICAgICBfdmlkZW8uc2V0QXR0cmlidXRlKFwiY29udHJvbHNcIiwgXCJcIik7XG4gICAgfVxuXG4gICAgLy8gc2V0IGFwcHJvcHJpYXRlIHNpemluZyBjbGFzcyBiYXNlZCBvbiBzY2FsZVRvRml0IHZhbHVlXG4gICAgX3ZpZGVvLmNsYXNzTmFtZSA9IGRhdGEudmlkZW8uc2NhbGVUb0ZpdCA/IF92aWRlby5jbGFzc05hbWUgKyBcIiBzY2FsZS10by1maXRcIlxuICAgICAgOiBfdmlkZW8uY2xhc3NOYW1lICsgXCIgbm8tc2NhbGVcIjtcblxuICAgIC8vIHNldCBpbml0aWFsIHZvbHVtZSBvbiA8dmlkZW8+XG4gICAgX3ZpZGVvLnZvbHVtZSA9IGRhdGEudmlkZW8udm9sdW1lIC8gMTAwO1xuXG4gICAgLy8gc2V0IHRoZSBcInR5cGVcIiBhdHRyaWJ1dGUgb24gPHNvdXJjZT5cbiAgICB0eXBlQXR0ci52YWx1ZSA9IFwidmlkZW8vXCIgKyBfZ2V0VmlkZW9GaWxlVHlwZSgpO1xuICAgIF9zb3VyY2Uuc2V0QXR0cmlidXRlTm9kZSh0eXBlQXR0cik7XG5cbiAgICAvLyB2aWRlbyBldmVudHNcbiAgICBfdmlkZW8uYWRkRXZlbnRMaXN0ZW5lcihcImxvYWRlZGRhdGFcIiwgX29uTG9hZGVkRGF0YSwgZmFsc2UpO1xuICAgIF92aWRlby5hZGRFdmVudExpc3RlbmVyKFwiY2FucGxheVwiLCBfb25DYW5QbGF5LCBmYWxzZSk7XG4gICAgX3ZpZGVvLmFkZEV2ZW50TGlzdGVuZXIoXCJlbmRlZFwiLCBfb25FbmRlZCwgZmFsc2UpO1xuICAgIF92aWRlby5hZGRFdmVudExpc3RlbmVyKFwicGF1c2VcIiwgX29uUGF1c2UsIGZhbHNlKTtcbiAgICBfdmlkZW8uYWRkRXZlbnRMaXN0ZW5lcihcInBsYXlcIiwgX29uUGxheSwgZmFsc2UpO1xuXG4gICAgX2lzU3RvcmFnZUZpbGUgPSAoT2JqZWN0LmtleXMoZGF0YS52aWRlb1N0b3JhZ2UpLmxlbmd0aCAhPT0gMCk7XG5cbiAgICBpZiAoIV9pc1N0b3JhZ2VGaWxlKSB7XG4gICAgICBzdHIgPSBkYXRhLnVybC5zcGxpdChcIj9cIik7XG5cbiAgICAgIC8vIHN0b3JlIHRoaXMgZm9yIHRoZSByZWZyZXNoIHRpbWVyXG4gICAgICBfc2VwYXJhdG9yID0gKHN0ci5sZW5ndGggPT09IDEpID8gXCI/XCIgOiBcIiZcIjtcblxuICAgICAgLy8gTm9uIHN0b3JhZ2UgVVJMXG4gICAgICBfc3JjQXR0ci52YWx1ZSA9IGRhdGEudXJsO1xuICAgICAgX3NvdXJjZS5zZXRBdHRyaWJ1dGVOb2RlKF9zcmNBdHRyKTtcbiAgICAgIF92aWRlby5hcHBlbmRDaGlsZChfZnJhZ21lbnQpO1xuXG4gICAgfSBlbHNlIHtcbiAgICAgIC8vIFJpc2UgU3RvcmFnZVxuICAgICAgX3N0b3JhZ2UuYWRkRXZlbnRMaXN0ZW5lcihcInJpc2Utc3RvcmFnZS1yZXNwb25zZVwiLCBfc3RvcmFnZVJlc3BvbnNlKTtcblxuICAgICAgX3N0b3JhZ2Uuc2V0QXR0cmlidXRlKFwiZm9sZGVyXCIsIGRhdGEudmlkZW9TdG9yYWdlLmZvbGRlcik7XG4gICAgICBfc3RvcmFnZS5zZXRBdHRyaWJ1dGUoXCJmaWxlTmFtZVwiLCBkYXRhLnZpZGVvU3RvcmFnZS5maWxlTmFtZSk7XG4gICAgICBfc3RvcmFnZS5zZXRBdHRyaWJ1dGUoXCJjb21wYW55SWRcIiwgZGF0YS52aWRlb1N0b3JhZ2UuY29tcGFueUlkKTtcbiAgICAgIF9zdG9yYWdlLmdvKCk7XG4gICAgfVxuICB9XG5cbiAgZnVuY3Rpb24gcGF1c2UoKSB7XG4gICAgX3ZpZXdlclBhdXNlZCA9IHRydWU7XG4gICAgX3ZpZGVvLnBhdXNlKCk7XG4gIH1cblxuICBmdW5jdGlvbiBwbGF5KCkge1xuICAgIF9pbml0aWFsUGxheSA9IGZhbHNlO1xuICAgIF92aWV3ZXJQYXVzZWQgPSBmYWxzZTtcblxuICAgIGlmICghX2NhblBsYXkpIHtcbiAgICAgIF9jYW5QbGF5VGltZXIoKTtcbiAgICB9IGVsc2Uge1xuICAgICAgX3ZpZGVvLnBsYXkoKTtcbiAgICB9XG5cbiAgfVxuXG4gIGZ1bmN0aW9uIHVzZXJQYXVzZWQoKSB7XG4gICAgcmV0dXJuIF91c2VyUGF1c2VkO1xuICB9XG5cbiAgcmV0dXJuIHtcbiAgICBcImlzSW5pdGlhbFBsYXlcIjogaXNJbml0aWFsUGxheSxcbiAgICBcImluaXRcIjogaW5pdCxcbiAgICBcInBhdXNlXCI6IHBhdXNlLFxuICAgIFwicGxheVwiOiBwbGF5LFxuICAgIFwidXNlclBhdXNlZFwiOiB1c2VyUGF1c2VkXG4gIH07XG59O1xuXG4vKiBnbG9iYWwgZ2FkZ2V0cywgUmlzZVZpc2lvbiAqL1xuXG4oZnVuY3Rpb24gKHdpbmRvdywgZ2FkZ2V0cykge1xuICBcInVzZSBzdHJpY3RcIjtcblxuICB2YXIgcHJlZnMgPSBuZXcgZ2FkZ2V0cy5QcmVmcygpLFxuICAgIGlkID0gcHJlZnMuZ2V0U3RyaW5nKFwiaWRcIik7XG5cbiAgLy8gRGlzYWJsZSBjb250ZXh0IG1lbnUgKHJpZ2h0IGNsaWNrIG1lbnUpXG4gIHdpbmRvdy5vbmNvbnRleHRtZW51ID0gZnVuY3Rpb24gKCkge1xuICAgIHJldHVybiBmYWxzZTtcbiAgfTtcblxuICBmdW5jdGlvbiBwbGF5KCkge1xuICAgIFJpc2VWaXNpb24uVmlkZW8ucGxheSgpO1xuICB9XG5cbiAgZnVuY3Rpb24gcGF1c2UoKSB7XG4gICAgUmlzZVZpc2lvbi5WaWRlby5wYXVzZSgpO1xuICB9XG5cbiAgZnVuY3Rpb24gc3RvcCgpIHtcbiAgICBSaXNlVmlzaW9uLlZpZGVvLnN0b3AoKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIGFkZGl0aW9uYWxQYXJhbXMobmFtZXMsIHZhbHVlcykge1xuICAgIGlmIChBcnJheS5pc0FycmF5KG5hbWVzKSAmJiBuYW1lcy5sZW5ndGggPiAwICYmIG5hbWVzWzBdID09PSBcImFkZGl0aW9uYWxQYXJhbXNcIikge1xuICAgICAgaWYgKEFycmF5LmlzQXJyYXkodmFsdWVzKSAmJiB2YWx1ZXMubGVuZ3RoID4gMCkge1xuICAgICAgICBSaXNlVmlzaW9uLlZpZGVvLnNldEFkZGl0aW9uYWxQYXJhbXMoSlNPTi5wYXJzZSh2YWx1ZXNbMF0pKTtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICBpZiAoaWQgJiYgaWQgIT09IFwiXCIpIHtcbiAgICBnYWRnZXRzLnJwYy5yZWdpc3RlcihcInJzY21kX3BsYXlfXCIgKyBpZCwgcGxheSk7XG4gICAgZ2FkZ2V0cy5ycGMucmVnaXN0ZXIoXCJyc2NtZF9wYXVzZV9cIiArIGlkLCBwYXVzZSk7XG4gICAgZ2FkZ2V0cy5ycGMucmVnaXN0ZXIoXCJyc2NtZF9zdG9wX1wiICsgaWQsIHN0b3ApO1xuXG4gICAgZ2FkZ2V0cy5ycGMucmVnaXN0ZXIoXCJyc3BhcmFtX3NldF9cIiArIGlkLCBhZGRpdGlvbmFsUGFyYW1zKTtcbiAgICBnYWRnZXRzLnJwYy5jYWxsKFwiXCIsIFwicnNwYXJhbV9nZXRcIiwgbnVsbCwgaWQsIFtcImFkZGl0aW9uYWxQYXJhbXNcIl0pO1xuXG4gIH1cblxufSkod2luZG93LCBnYWRnZXRzKTtcblxuXG5cbi8qIGpzaGludCBpZ25vcmU6c3RhcnQgKi9cbnZhciBfZ2FxID0gX2dhcSB8fCBbXTtcblxuX2dhcS5wdXNoKFsnX3NldEFjY291bnQnLCAnVUEtNTcwOTIxNTktMiddKTtcbl9nYXEucHVzaChbJ190cmFja1BhZ2V2aWV3J10pO1xuXG4oZnVuY3Rpb24oKSB7XG4gIHZhciBnYSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3NjcmlwdCcpOyBnYS50eXBlID0gJ3RleHQvamF2YXNjcmlwdCc7IGdhLmFzeW5jID0gdHJ1ZTtcbiAgZ2Euc3JjID0gKCdodHRwczonID09IGRvY3VtZW50LmxvY2F0aW9uLnByb3RvY29sID8gJ2h0dHBzOi8vc3NsJyA6ICdodHRwOi8vd3d3JykgKyAnLmdvb2dsZS1hbmFseXRpY3MuY29tL2dhLmpzJztcbiAgdmFyIHMgPSBkb2N1bWVudC5nZXRFbGVtZW50c0J5VGFnTmFtZSgnc2NyaXB0JylbMF07IHMucGFyZW50Tm9kZS5pbnNlcnRCZWZvcmUoZ2EsIHMpO1xufSkoKTtcbi8qIGpzaGludCBpZ25vcmU6ZW5kICovXG4iXSwic291cmNlUm9vdCI6Ii9zb3VyY2UvIn0=