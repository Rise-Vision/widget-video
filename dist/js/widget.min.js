if("undefined"==typeof config){var config={SKIN:"skin/RVSkin.xml"};"undefined"!=typeof angular&&angular.module("risevision.common.i18n.config",[]).constant("LOCALES_PREFIX","locales/translation_").constant("LOCALES_SUFIX",".json")}var RiseVision=RiseVision||{};RiseVision.Video={},RiseVision.Video=function(e){"use strict";function t(){e.rpc.call("","rsevent_done",null,h.getString("id"))}function n(){e.rpc.call("","rsevent_ready",null,h.getString("id"),!0,!0,!0,!0,!0)}function i(){b=new RiseVision.Common.Video.FrameController,b.add(0),V=0,I=1,b.createFramePlayer(0,y,v,config.SKIN,"player.html")}function o(e){b.remove(e,function(){b.add(e),b.hide(e),b.createFramePlayer(e,y,v,config.SKIN,"player.html")})}function r(){var e,t=b.getFrameObject(V),n=0===V?1:0;A||(clearTimeout(E),E=null),t&&(y.video.controls||(e=t.getPlaybackData(),e.duration-e.position>=15&&o(n)))}function a(e){clearTimeout(E),E=setTimeout(function(){v=y.url+w+"cb="+(new Date).getTime(),r()},e)}function s(e){v=e,i()}function c(e){v=e,r()}function l(){var e=b.getFrameObject(V);e&&e.pause()}function u(){var e=b.getFrameObject(V);_?t():e?e.play():(V=0===V?1:0,e=b.getFrameObject(V),e.play(),A||E||a(C),b.add(0===V?1:0),b.hide(0===V?1:0),b.createFramePlayer(0===V?1:0,y,v,config.SKIN,"player.html"))}function d(){_?(b.remove(V),b.remove(0===V?1:0),t()):(b.show(0===V?1:0),b.remove(V,function(){t()}))}function m(){S||(2===I?(S=!0,A||a(C),n()):(b.add(1),b.hide(1),I=2,b.createFramePlayer(1,y,v,config.SKIN,"player.html")))}function f(t,n){var o;Array.isArray(t)&&t.length>0&&"additionalParams"===t[0]&&Array.isArray(n)&&n.length>0&&(y=JSON.parse(n[0]),h=new e.Prefs,document.getElementById("videoContainer").style.height=h.getInt("rsH")+"px",y.width=h.getInt("rsW"),y.height=h.getInt("rsH"),A=0!==Object.keys(y.storage).length,A?(R=new RiseVision.Video.Storage(y),R.init()):(o=y.url.split("?"),w=1===o.length?"?":"&",v=y.url,i()))}function g(e){console.debug("video-folder::playerError()",e),S?(_=!0,A||(clearTimeout(E),E=null)):b.remove(V)}function p(){l()}var y,v,V,h=null,R=null,b=null,S=!1,_=!1,A=!1,I=0,w="",C=3e5,E=null;return{onStorageInit:s,onStorageRefresh:c,pause:l,play:u,setAdditionalParams:f,playerEnded:d,playerReady:m,playerError:g,stop:p}}(gadgets);var RiseVision=RiseVision||{};RiseVision.Video=RiseVision.Video||{},RiseVision.Video.Storage=function(e){"use strict";function t(){var t=document.getElementById("videoStorage");t&&(t.addEventListener("rise-storage-response",function(e){var t;e.detail&&e.detail.files&&e.detail.files.length>0&&(t=e.detail.files[0].url,n?(n=!1,RiseVision.Video.onStorageInit(t)):RiseVision.Video.onStorageRefresh(t))}),t.setAttribute("folder",e.storage.folder),t.setAttribute("fileName",e.storage.fileName),t.setAttribute("companyId",e.storage.companyId),t.go())}var n=!0;return{init:t}};var RiseVision=RiseVision||{};RiseVision.Common=RiseVision.Common||{},RiseVision.Common.Video=RiseVision.Common.Video||{},RiseVision.Common.Video.FrameController=function(){"use strict";function e(e){return document.getElementById(c+e)}function t(t){var n,i=e(t);return n=i.querySelector("iframe"),n?n.contentWindow?n.contentWindow:n.contentDocument.document?n.contentDocument.document:n.contentDocument:null}function n(n){var i,o=e(n),r=t(n);r&&(i=o.querySelector("iframe"),r.remove(),i.setAttribute("src","about:blank"))}function i(t){var n=e(t),i=document.createElement("iframe");i.setAttribute("allowTransparency",!0),i.setAttribute("frameborder","0"),i.setAttribute("scrolling","no"),n.appendChild(i)}function o(n,i,o,r,a){var s,c=e(n),l=t(n);l&&(s=c.querySelector("iframe"),s.onload=function(){s.onload=null,l.init(i,o,r),l.load()},s.setAttribute("src",a))}function r(t){var n=e(t);n.style.visibility="hidden"}function a(e,t){var i=document.getElementById(c+e);n(e),setTimeout(function(){for(;i.firstChild;)i.removeChild(i.firstChild);t&&"function"==typeof t&&t()},200)}function s(t){var n=e(t);n.style.visibility="visible"}var c="if_";return{add:i,createFramePlayer:o,getFrameContainer:e,getFrameObject:t,hide:r,remove:a,show:s}},function(e,t){"use strict";function n(){RiseVision.Video.play()}function i(){RiseVision.Video.pause()}function o(){RiseVision.Video.stop()}function r(){e.removeEventListener("polymer-ready",r),s&&""!==s&&(t.rpc.register("rscmd_play_"+s,n),t.rpc.register("rscmd_pause_"+s,i),t.rpc.register("rscmd_stop_"+s,o),t.rpc.register("rsparam_set_"+s,RiseVision.Video.setAdditionalParams),t.rpc.call("","rsparam_get",null,s,["additionalParams"]))}var a=new t.Prefs,s=a.getString("id");e.oncontextmenu=function(){return!1},e.addEventListener("polymer-ready",r)}(window,gadgets);var _gaq=_gaq||[];_gaq.push(["_setAccount","UA-57092159-2"]),_gaq.push(["_trackPageview"]),function(){var e=document.createElement("script");e.type="text/javascript",e.async=!0,e.src=("https:"==document.location.protocol?"https://ssl":"http://www")+".google-analytics.com/ga.js";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImpzL3dpZGdldC5taW4uanMiXSwibmFtZXMiOlsiY29uZmlnIiwiU0tJTiIsImFuZ3VsYXIiLCJtb2R1bGUiLCJjb25zdGFudCIsIlJpc2VWaXNpb24iLCJWaWRlbyIsImdhZGdldHMiLCJfZG9uZSIsInJwYyIsImNhbGwiLCJfcHJlZnMiLCJnZXRTdHJpbmciLCJfcmVhZHkiLCJfaW5pdCIsIl9mcmFtZUNvbnRyb2xsZXIiLCJDb21tb24iLCJGcmFtZUNvbnRyb2xsZXIiLCJhZGQiLCJfY3VycmVudEZyYW1lIiwiX2ZyYW1lQ291bnQiLCJjcmVhdGVGcmFtZVBsYXllciIsIl9hZGRpdGlvbmFsUGFyYW1zIiwiX2N1cnJlbnRGaWxlIiwiX3JlZnJlc2hGcmFtZSIsImZyYW1lSW5kZXgiLCJyZW1vdmUiLCJoaWRlIiwiX3JlZnJlc2giLCJjdXJyZW50RnJhbWVEYXRhIiwiY3VycmVudEZyYW1lT2JqIiwiZ2V0RnJhbWVPYmplY3QiLCJoaWRkZW5GcmFtZUluZGV4IiwiX2lzU3RvcmFnZUZpbGUiLCJjbGVhclRpbWVvdXQiLCJfdGltZXIiLCJ2aWRlbyIsImNvbnRyb2xzIiwiZ2V0UGxheWJhY2tEYXRhIiwiZHVyYXRpb24iLCJwb3NpdGlvbiIsIl9yZWZyZXNoVGltZXIiLCJzZXRUaW1lb3V0IiwidXJsIiwiX3NlcGFyYXRvciIsIkRhdGUiLCJnZXRUaW1lIiwib25TdG9yYWdlSW5pdCIsIm9uU3RvcmFnZVJlZnJlc2giLCJwYXVzZSIsImZyYW1lT2JqIiwicGxheSIsIl9wbGF5YmFja0Vycm9yIiwiX3JlZnJlc2hEdXJhdGlvbiIsInBsYXllckVuZGVkIiwic2hvdyIsInBsYXllclJlYWR5IiwiX2luaXRpYWxpemVkIiwic2V0QWRkaXRpb25hbFBhcmFtcyIsIm5hbWVzIiwidmFsdWVzIiwic3RyIiwiQXJyYXkiLCJpc0FycmF5IiwibGVuZ3RoIiwiSlNPTiIsInBhcnNlIiwiUHJlZnMiLCJkb2N1bWVudCIsImdldEVsZW1lbnRCeUlkIiwic3R5bGUiLCJoZWlnaHQiLCJnZXRJbnQiLCJ3aWR0aCIsIk9iamVjdCIsImtleXMiLCJzdG9yYWdlIiwiX3N0b3JhZ2UiLCJTdG9yYWdlIiwiaW5pdCIsInNwbGl0IiwicGxheWVyRXJyb3IiLCJlcnJvciIsImNvbnNvbGUiLCJkZWJ1ZyIsInN0b3AiLCJkYXRhIiwiYWRkRXZlbnRMaXN0ZW5lciIsImUiLCJkZXRhaWwiLCJmaWxlcyIsIl9pbml0aWFsTG9hZCIsInNldEF0dHJpYnV0ZSIsImZvbGRlciIsImZpbGVOYW1lIiwiY29tcGFueUlkIiwiZ28iLCJnZXRGcmFtZUNvbnRhaW5lciIsImluZGV4IiwiUFJFRklYIiwiaWZyYW1lIiwiZnJhbWVDb250YWluZXIiLCJxdWVyeVNlbGVjdG9yIiwiY29udGVudFdpbmRvdyIsImNvbnRlbnREb2N1bWVudCIsIl9jbGVhciIsImNyZWF0ZUVsZW1lbnQiLCJhcHBlbmRDaGlsZCIsInBhcmFtcyIsInNraW4iLCJzcmMiLCJvbmxvYWQiLCJsb2FkIiwidmlzaWJpbGl0eSIsImNhbGxiYWNrIiwiZmlyc3RDaGlsZCIsInJlbW92ZUNoaWxkIiwid2luZG93IiwicG9seW1lclJlYWR5IiwicmVtb3ZlRXZlbnRMaXN0ZW5lciIsImlkIiwicmVnaXN0ZXIiLCJwcmVmcyIsIm9uY29udGV4dG1lbnUiLCJfZ2FxIiwicHVzaCIsImdhIiwidHlwZSIsImFzeW5jIiwibG9jYXRpb24iLCJwcm90b2NvbCIsInMiLCJnZXRFbGVtZW50c0J5VGFnTmFtZSIsInBhcmVudE5vZGUiLCJpbnNlcnRCZWZvcmUiXSwibWFwcGluZ3MiOiJBQUVBLEdBQXNCLG1CQUFYQSxRQUF3QixDQUNqQyxHQUFJQSxTQUNGQyxLQUFNLGtCQUdlLG9CQUFaQyxVQUNUQSxRQUFRQyxPQUFPLG9DQUNaQyxTQUFTLGlCQUFrQix3QkFDM0JBLFNBQVMsZ0JBQWlCLFNBTWpDLEdBQUlDLFlBQWFBLGNBQ2pCQSxZQUFXQyxTQUVYRCxXQUFXQyxNQUFRLFNBQVdDLEdBQzVCLFlBc0JBLFNBQVNDLEtBQ1BELEVBQVFFLElB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LEVBQUlyRSxHQUN6QzVDLEVBQVFFLElBQUlnSCxTQUFTLGVBQWlCRCxFQUFJdkUsR0FDMUMxQyxFQUFRRSxJQUFJZ0gsU0FBUyxjQUFnQkQsRUFBSW5DLEdBRXpDOUUsRUFBUUUsSUFBSWdILFNBQVMsZUFBaUJELEVBQUluSCxXQUFXQyxNQUFNb0QscUJBQzNEbkQsRUFBUUUsSUFBSUMsS0FBSyxHQUFJLGNBQWUsS0FBTThHLEdBQUssc0JBN0JuRCxHQUFJRSxHQUFRLEdBQUluSCxHQUFRNEQsTUFDdEJxRCxFQUFLRSxFQUFNOUcsVUFBVSxLQUd2QnlHLEdBQU9NLGNBQWdCLFdBQ3JCLE9BQU8sR0E0QlROLEVBQU85QixpQkFBaUIsZ0JBQWlCK0IsSUFFeENELE9BQVE5RyxRQUtYLElBQUlxSCxNQUFPQSxRQUVYQSxNQUFLQyxNQUFNLGNBQWUsa0JBQzFCRCxLQUFLQyxNQUFNLG1CQUVYLFdBQ0UsR0FBSUMsR0FBSzFELFNBQVNzQyxjQUFjLFNBQVdvQixHQUFHQyxLQUFPLGtCQUFtQkQsRUFBR0UsT0FBUSxFQUNuRkYsRUFBR2hCLEtBQU8sVUFBWTFDLFNBQVM2RCxTQUFTQyxTQUFXLGNBQWdCLGNBQWdCLDZCQUNuRixJQUFJQyxHQUFJL0QsU0FBU2dFLHFCQUFxQixVQUFVLEVBQUlELEdBQUVFLFdBQVdDLGFBQWFSLEVBQUlLIiwiZmlsZSI6ImpzL3dpZGdldC5taW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyIvKiBnbG9iYWwgY29uZmlnOiB0cnVlICovXG4vKiBleHBvcnRlZCBjb25maWcgKi9cbmlmICh0eXBlb2YgY29uZmlnID09PSBcInVuZGVmaW5lZFwiKSB7XG4gIHZhciBjb25maWcgPSB7XG4gICAgU0tJTjogXCJza2luL1JWU2tpbi54bWxcIlxuICB9O1xuXG4gIGlmICh0eXBlb2YgYW5ndWxhciAhPT0gXCJ1bmRlZmluZWRcIikge1xuICAgIGFuZ3VsYXIubW9kdWxlKFwicmlzZXZpc2lvbi5jb21tb24uaTE4bi5jb25maWdcIiwgW10pXG4gICAgICAuY29uc3RhbnQoXCJMT0NBTEVTX1BSRUZJWFwiLCBcImxvY2FsZXMvdHJhbnNsYXRpb25fXCIpXG4gICAgICAuY29uc3RhbnQoXCJMT0NBTEVTX1NVRklYXCIsIFwiLmpzb25cIik7XG4gIH1cbn1cblxuLyogZ2xvYmFsIGdhZGdldHMsIGNvbmZpZyAqL1xuXG52YXIgUmlzZVZpc2lvbiA9IFJpc2VWaXNpb24gfHwge307XG5SaXNlVmlzaW9uLlZpZGVvID0ge307XG5cblJpc2VWaXNpb24uVmlkZW8gPSAoZnVuY3Rpb24gKGdhZGdldHMpIHtcbiAgXCJ1c2Ugc3RyaWN0XCI7XG5cbiAgdmFyIF9hZGRpdGlvbmFsUGFyYW1zO1xuXG4gIHZhciBfcHJlZnMgPSBudWxsLFxuICAgIF9zdG9yYWdlID0gbnVsbCxcbiAgICBfZnJhbWVDb250cm9sbGVyID0gbnVsbDtcblxuICB2YXIgX2luaXRpYWxpemVkID0gZmFsc2UsXG4gICAgX3BsYXliYWNrRXJyb3IgPSBmYWxzZSxcbiAgICBfaXNTdG9yYWdlRmlsZSA9IGZhbHNlO1xuXG4gIHZhciBfY3VycmVudEZpbGUsIF9jdXJyZW50RnJhbWU7XG5cbiAgdmFyIF9mcmFtZUNvdW50ID0gMCxcbiAgICBfc2VwYXJhdG9yID0gXCJcIixcbiAgICBfcmVmcmVzaER1cmF0aW9uID0gMzAwMDAwLCAgLy8gNSBtaW51dGVzXG4gICAgX3RpbWVyID0gbnVsbDtcblxuICAvKlxuICAgKiAgUHJpdmF0ZSBNZXRob2RzXG4gICAqL1xuICBmdW5jdGlvbiBfZG9uZSgpIHtcbiAgICBnYWRnZXRzLnJwYy5jYWxsKFwiXCIsIFwicnNldmVudF9kb25lXCIsIG51bGwsIF9wcmVmcy5nZXRTdHJpbmcoXCJpZFwiKSk7XG5cbiAgfVxuXG4gIGZ1bmN0aW9uIF9yZWFkeSgpIHtcbiAgICBnYWRnZXRzLnJwYy5jYWxsKFwiXCIsIFwicnNldmVudF9yZWFkeVwiLCBudWxsLCBfcHJlZnMuZ2V0U3RyaW5nKFwiaWRcIiksXG4gICAgICB0cnVlLCB0cnVlLCB0cnVlLCB0cnVlLCB0cnVlKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIF9pbml0KCkge1xuICAgIF9mcmFtZUNvbnRyb2xsZXIgPSBuZXcgUmlzZVZpc2lvbi5Db21tb24uVmlkZW8uRnJhbWVDb250cm9sbGVyKCk7XG5cbiAgICAvLyBhZGQgdGhlIGZpcnN0IGZyYW1lIGFuZCBjcmVhdGUgaXRzIHBsYXllclxuICAgIF9mcmFtZUNvbnRyb2xsZXIuYWRkKDApO1xuICAgIF9jdXJyZW50RnJhbWUgPSAwO1xuICAgIF9mcmFtZUNvdW50ID0gMTtcbiAgICBfZnJhbWVDb250cm9sbGVyLmNyZWF0ZUZyYW1lUGxheWVyKDAsIF9hZGRpdGlvbmFsUGFyYW1zLCBfY3VycmVudEZpbGUsIGNvbmZpZy5TS0lOLCBcInBsYXllci5odG1sXCIpO1xuICB9XG5cbiAgZnVuY3Rpb24gX3JlZnJlc2hGcmFtZShmcmFtZUluZGV4KSB7XG4gICAgX2ZyYW1lQ29udHJvbGxlci5yZW1vdmUoZnJhbWVJbmRleCwgZnVuY3Rpb24gKCkge1xuICAgICAgX2ZyYW1lQ29udHJvbGxlci5hZGQoZnJhbWVJbmRleCk7XG4gICAgICBfZnJhbWVDb250cm9sbGVyLmhpZGUoZnJhbWVJbmRleCk7XG4gICAgICBfZnJhbWVDb250cm9sbGVyLmNyZWF0ZUZyYW1lUGxheWVyKGZyYW1lSW5kZXgsIF9hZGRpdGlvbmFsUGFyYW1zLCBfY3VycmVudEZpbGUsIGNvbmZpZy5TS0lOLCBcInBsYXllci5odG1sXCIpO1xuICAgIH0pO1xuICB9XG5cbiAgZnVuY3Rpb24gX3JlZnJlc2goKSB7XG4gICAgdmFyIGN1cnJlbnRGcmFtZU9iaiA9IF9mcmFtZUNvbnRyb2xsZXIuZ2V0RnJhbWVPYmplY3QoX2N1cnJlbnRGcmFtZSksXG4gICAgICBoaWRkZW5GcmFtZUluZGV4ID0gKF9jdXJyZW50RnJhbWUgPT09IDApID8gMSA6IDAsXG4gICAgICBjdXJyZW50RnJhbWVEYXRhO1xuXG4gICAgaWYgKCFfaXNTdG9yYWdlRmlsZSkge1xuICAgICAgY2xlYXJUaW1lb3V0KF90aW1lcik7XG4gICAgICBfdGltZXIgPSBudWxsO1xuICAgIH1cblxuICAgIC8vIEl0IGlzIGJlc3QgdG8gbGV0IHJlZnJlc2hpbmcgdGhlIGZyYW1lIHBsYXlsaXN0IGhhcHBlbiBpbiB0aGUgbm9ybWFsIGN5Y2xlIG9mIGZyYW1lIHN3YXBwaW5nIChwbGF5bGlzdCBjb21wbGV0aW9uKVxuICAgIC8vIEJlbG93IGlzIHRoZSBvbmx5IGNyaXRlcmlhIGZvciBzYWZlbHkgZm9yY2luZyBhIHJlZnJlc2ggb2YgaGlkZGVuIGZyYW1lIHdoaWxlIFdpZGdldCBpcyBpbiBhIFwicGxheVwiIG9yIFwicGF1c2VcIiBzdGF0ZVxuXG4gICAgLy8gV2lkZ2V0IGlzIGluIGEgc3RhdGUgb2YgXCJwbGF5XCIgb3IgXCJwYXVzZVwiIGFuZCB2aWRlbyBoYXMgbm90IGNvbXBsZXRlZC4gQSBoaWRkZW4gZnJhbWUgZGVmaW5pdGVseSBleGlzdHNcbiAgICBpZiAoY3VycmVudEZyYW1lT2JqKSB7XG4gICAgICAvLyBPbmx5IGlmIHRoZXJlIGFyZSBubyB2aWRlbyBjb250cm9scy5cbiAgICAgIC8vIFVzZXIgaW50ZXJhY3Rpbmcgd2l0aCBjb250cm9scywgcGFydGljdWxhcmx5IHNlZWtpbmcgdGhlIHZpZGVvIHRvIGVuZCwgd291bGQgY2F1c2UgaXNzdWVzXG4gICAgICBpZiAoIV9hZGRpdGlvbmFsUGFyYW1zLnZpZGVvLmNvbnRyb2xzKSB7XG4gICAgICAgIGN1cnJlbnRGcmFtZURhdGEgPSBjdXJyZW50RnJhbWVPYmouZ2V0UGxheWJhY2tEYXRhKCk7XG5cbiAgICAgICAgLy8gVG8gYmUgc2FmZSwgb25seSByZWZyZXNoIHRoZSBmcmFtZSB0aGF0J3MgY3VycmVudGx5IGhpZGRlbiBpZiBhdCBsZWFzdCAxNSBzZWNvbmRzIGFyZSBsZWZ0IG9mIHZpZGVvXG4gICAgICAgIGlmICgoY3VycmVudEZyYW1lRGF0YS5kdXJhdGlvbiAtIGN1cnJlbnRGcmFtZURhdGEucG9zaXRpb24pID49IDE1KSB7XG4gICAgICAgICAgX3JlZnJlc2hGcmFtZShoaWRkZW5GcmFtZUluZGV4KTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIGZ1bmN0aW9uIF9yZWZyZXNoVGltZXIoZHVyYXRpb24pIHtcbiAgICBjbGVhclRpbWVvdXQoX3RpbWVyKTtcblxuICAgIF90aW1lciA9IHNldFRpbWVvdXQoZnVuY3Rpb24gdmlkZW9SZWZyZXNoKCkge1xuICAgICAgLy8gc2V0IG5ldyB2YWx1ZSBvZiBub24gcmlzZS1zdG9yYWdlIHVybCB3aXRoIGEgY2FjaGVidXN0ZXJcbiAgICAgIF9jdXJyZW50RmlsZSA9IF9hZGRpdGlvbmFsUGFyYW1zLnVybCArIF9zZXBhcmF0b3IgKyBcImNiPVwiICsgbmV3IERhdGUoKS5nZXRUaW1lKCk7XG5cbiAgICAgIF9yZWZyZXNoKCk7XG5cbiAgICB9LCBkdXJhdGlvbik7XG4gIH1cblxuICAvKlxuICAgKiAgUHVibGljIE1ldGhvZHNcbiAgICovXG4gIGZ1bmN0aW9uIG9uU3RvcmFnZUluaXQodXJsKSB7XG4gICAgX2N1cnJlbnRGaWxlID0gdXJsO1xuXG4gICAgX2luaXQoKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIG9uU3RvcmFnZVJlZnJlc2godXJsKSB7XG4gICAgX2N1cnJlbnRGaWxlID0gdXJsO1xuXG4gICAgX3JlZnJlc2goKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIHBhdXNlKCkge1xuICAgIHZhciBmcmFtZU9iaiA9IF9mcmFtZUNvbnRyb2xsZXIuZ2V0RnJhbWVPYmplY3QoX2N1cnJlbnRGcmFtZSk7XG5cbiAgICBpZiAoZnJhbWVPYmopIHtcbiAgICAgIGZyYW1lT2JqLnBhdXNlKCk7XG4gICAgfVxuICB9XG5cbiAgZnVuY3Rpb24gcGxheSgpIHtcbiAgICB2YXIgZnJhbWVPYmogPSBfZnJhbWVDb250cm9sbGVyLmdldEZyYW1lT2JqZWN0KF9jdXJyZW50RnJhbWUpO1xuXG4gICAgaWYgKCFfcGxheWJhY2tFcnJvcikge1xuICAgICAgaWYgKGZyYW1lT2JqKSB7XG4gICAgICAgIGZyYW1lT2JqLnBsYXkoKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIC8vIHNldCBjdXJyZW50IGZyYW1lIHRvIGJlIHRoZSBvbmUgdmlzaWJsZVxuICAgICAgICBfY3VycmVudEZyYW1lID0gKF9jdXJyZW50RnJhbWUgPT09IDApID8gMSA6IDA7XG5cbiAgICAgICAgLy8gcGxheSB0aGUgY3VycmVudCBmcmFtZSB2aWRlb1xuICAgICAgICBmcmFtZU9iaiA9IF9mcmFtZUNvbnRyb2xsZXIuZ2V0RnJhbWVPYmplY3QoX2N1cnJlbnRGcmFtZSk7XG4gICAgICAgIGZyYW1lT2JqLnBsYXkoKTtcblxuICAgICAgICBpZiAoIV9pc1N0b3JhZ2VGaWxlICYmICFfdGltZXIpIHtcbiAgICAgICAgICAvLyByZXN0YXJ0IHRoZSByZWZyZXNoIHRpbWVyXG4gICAgICAgICAgX3JlZnJlc2hUaW1lcihfcmVmcmVzaER1cmF0aW9uKTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIHJlLWFkZCBwcmV2aW91c2x5IHJlbW92ZWQgZnJhbWUgYW5kIGNyZWF0ZSB0aGUgcGxheWVyLCBidXQgaGlkZSB2aXNpYmlsaXR5XG4gICAgICAgIF9mcmFtZUNvbnRyb2xsZXIuYWRkKCgoX2N1cnJlbnRGcmFtZSA9PT0gMCkgPyAxIDogMCkpO1xuICAgICAgICBfZnJhbWVDb250cm9sbGVyLmhpZGUoKChfY3VycmVudEZyYW1lID09PSAwKSA/IDEgOiAwKSk7XG4gICAgICAgIF9mcmFtZUNvbnRyb2xsZXIuY3JlYXRlRnJhbWVQbGF5ZXIoKChfY3VycmVudEZyYW1lID09PSAwKSA/IDEgOiAwKSwgX2FkZGl0aW9uYWxQYXJhbXMsIF9jdXJyZW50RmlsZSwgY29uZmlnLlNLSU4sIFwicGxheWVyLmh0bWxcIik7XG5cbiAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgLy8gVGhpcyBmbGFnIG9ubHkgZ290IHNldCB1cG9uIGEgcmVmcmVzaCBvZiBoaWRkZW4gZnJhbWUgYW5kIHRoZXJlIHdhcyBhbiBlcnJvciBpbiBzZXR1cCBvciB2aWRlb1xuICAgICAgLy8gU2VuZCBWaWV3ZXIgXCJkb25lXCJcbiAgICAgIF9kb25lKCk7XG4gICAgfVxuICB9XG5cbiAgZnVuY3Rpb24gcGxheWVyRW5kZWQoKSB7XG4gICAgaWYgKF9wbGF5YmFja0Vycm9yKSB7XG4gICAgICAvLyBUaGlzIGZsYWcgb25seSBnZXRzIHNldCB1cG9uIGEgcmVmcmVzaCBvZiBoaWRkZW4gZnJhbWUgYW5kIHRoZXJlIHdhcyBhbiBlcnJvciBpbiBzZXR1cCBvciB2aWRlb1xuICAgICAgX2ZyYW1lQ29udHJvbGxlci5yZW1vdmUoX2N1cnJlbnRGcmFtZSk7XG4gICAgICBfZnJhbWVDb250cm9sbGVyLnJlbW92ZSgoX2N1cnJlbnRGcmFtZSA9PT0gMCkgPyAxIDogMCk7XG5cbiAgICAgIF9kb25lKCk7XG5cbiAgICB9IGVsc2Uge1xuICAgICAgX2ZyYW1lQ29udHJvbGxlci5zaG93KChfY3VycmVudEZyYW1lID09PSAwKSA/IDEgOiAwKTtcbiAgICAgIF9mcmFtZUNvbnRyb2xsZXIucmVtb3ZlKF9jdXJyZW50RnJhbWUsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgX2RvbmUoKTtcbiAgICAgIH0pO1xuICAgIH1cblxuICB9XG5cbiAgZnVuY3Rpb24gcGxheWVyUmVhZHkoKSB7XG4gICAgaWYgKCFfaW5pdGlhbGl6ZWQpIHtcbiAgICAgIGlmIChfZnJhbWVDb3VudCA9PT0gMikge1xuICAgICAgICAvLyBib3RoIGZyYW1lcyBoYXZlIGJlZW4gY3JlYXRlZCBhbmQgbG9hZGVkLCBjYW4gbm90aWZ5IFZpZXdlciB3aWRnZXQgaXMgcmVhZHlcbiAgICAgICAgX2luaXRpYWxpemVkID0gdHJ1ZTtcblxuICAgICAgICBpZiAoIV9pc1N0b3JhZ2VGaWxlKSB7XG4gICAgICAgICAgX3JlZnJlc2hUaW1lcihfcmVmcmVzaER1cmF0aW9uKTtcbiAgICAgICAgfVxuXG4gICAgICAgIF9yZWFkeSgpO1xuXG4gICAgICB9IGVsc2Uge1xuICAgICAgICAvLyBmaXJzdCBmcmFtZSBwbGF5ZXIgd2FzIHN1Y2Nlc3NmdWwgYW5kIHJlYWR5LCBjcmVhdGUgdGhlIHNlY29uZCBvbmUgYnV0IGhpZGUgaXRcbiAgICAgICAgX2ZyYW1lQ29udHJvbGxlci5hZGQoMSk7XG4gICAgICAgIF9mcmFtZUNvbnRyb2xsZXIuaGlkZSgxKTtcbiAgICAgICAgX2ZyYW1lQ291bnQgPSAyO1xuICAgICAgICBfZnJhbWVDb250cm9sbGVyLmNyZWF0ZUZyYW1lUGxheWVyKDEsIF9hZGRpdGlvbmFsUGFyYW1zLCBfY3VycmVudEZpbGUsIGNvbmZpZy5TS0lOLCBcInBsYXllci5odG1sXCIpO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIGZ1bmN0aW9uIHNldEFkZGl0aW9uYWxQYXJhbXMobmFtZXMsIHZhbHVlcykge1xuICAgIHZhciBzdHI7XG4gICAgaWYgKEFycmF5LmlzQXJyYXkobmFtZXMpICYmIG5hbWVzLmxlbmd0aCA+IDAgJiYgbmFtZXNbMF0gPT09IFwiYWRkaXRpb25hbFBhcmFtc1wiKSB7XG4gICAgICBpZiAoQXJyYXkuaXNBcnJheSh2YWx1ZXMpICYmIHZhbHVlcy5sZW5ndGggPiAwKSB7XG4gICAgICAgIF9hZGRpdGlvbmFsUGFyYW1zID0gSlNPTi5wYXJzZSh2YWx1ZXNbMF0pO1xuICAgICAgICBfcHJlZnMgPSBuZXcgZ2FkZ2V0cy5QcmVmcygpO1xuXG4gICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwidmlkZW9Db250YWluZXJcIikuc3R5bGUuaGVpZ2h0ID0gX3ByZWZzLmdldEludChcInJzSFwiKSArIFwicHhcIjtcblxuICAgICAgICBfYWRkaXRpb25hbFBhcmFtcy53aWR0aCA9IF9wcmVmcy5nZXRJbnQoXCJyc1dcIik7XG4gICAgICAgIF9hZGRpdGlvbmFsUGFyYW1zLmhlaWdodCA9IF9wcmVmcy5nZXRJbnQoXCJyc0hcIik7XG5cbiAgICAgICAgX2lzU3RvcmFnZUZpbGUgPSAoT2JqZWN0LmtleXMoX2FkZGl0aW9uYWxQYXJhbXMuc3RvcmFnZSkubGVuZ3RoICE9PSAwKTtcblxuICAgICAgICBpZiAoIV9pc1N0b3JhZ2VGaWxlKSB7XG4gICAgICAgICAgc3RyID0gX2FkZGl0aW9uYWxQYXJhbXMudXJsLnNwbGl0KFwiP1wiKTtcblxuICAgICAgICAgIC8vIHN0b3JlIHRoaXMgZm9yIHRoZSByZWZyZXNoIHRpbWVyXG4gICAgICAgICAgX3NlcGFyYXRvciA9IChzdHIubGVuZ3RoID09PSAxKSA/IFwiP1wiIDogXCImXCI7XG5cbiAgICAgICAgICBfY3VycmVudEZpbGUgPSBfYWRkaXRpb25hbFBhcmFtcy51cmw7XG5cbiAgICAgICAgICBfaW5pdCgpO1xuXG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgLy8gY3JlYXRlIGFuZCBpbml0aWFsaXplIHRoZSBTdG9yYWdlIG1vZHVsZSBpbnN0YW5jZVxuICAgICAgICAgIF9zdG9yYWdlID0gbmV3IFJpc2VWaXNpb24uVmlkZW8uU3RvcmFnZShfYWRkaXRpb25hbFBhcmFtcyk7XG4gICAgICAgICAgX3N0b3JhZ2UuaW5pdCgpO1xuICAgICAgICB9XG5cbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICBmdW5jdGlvbiBwbGF5ZXJFcnJvcihlcnJvcikge1xuICAgIGNvbnNvbGUuZGVidWcoXCJ2aWRlby1mb2xkZXI6OnBsYXllckVycm9yKClcIiwgZXJyb3IpO1xuXG4gICAgaWYgKCFfaW5pdGlhbGl6ZWQpIHtcbiAgICAgIC8vIFdpZGdldCBoYXMgbm90IHNlbnQgXCJyZWFkeVwiIHlldCBhbmQgdGhlcmUgaXMgYW4gZXJyb3IgKHNldHVwIG9yIHBsYXliYWNrIG9mIHZpZGVvKVxuICAgICAgX2ZyYW1lQ29udHJvbGxlci5yZW1vdmUoX2N1cnJlbnRGcmFtZSk7XG5cbiAgICAgIC8vIGRvIG5vdGhpbmcgbW9yZSwgZW5zdXJlIFwicmVhZHlcIiBpcyBub3Qgc2VudCB0byBWaWV3ZXIgc28gdGhhdCB0aGlzIHdpZGdldCBjYW4gYmUgc2tpcHBlZFxuXG4gICAgfSBlbHNlIHtcbiAgICAgIC8vIFRoaXMgb25seSBoYXBwZW5zIGluIHRoZSBldmVudCBvZiBhIHJlZnJlc2guIE5ldyBmaWxlIGNhdXNlZCBhbiBlcnJvciBpbiBzZXR1cCBvciB2aWRlbyBoYXMgYW4gaXNzdWVcbiAgICAgIC8vIFRoZSBlcnJvciBldmVudCB3aWxsIGJlIGNvbWluZyBmcm9tIHRoZSBjdXJyZW50bHkgaGlkZGVuIGZyYW1lIHdoZW4gaXQgZ290IHJlY3JlYXRlZCB3aXRoIGEgbmV3IGZpbGUgdG8gdXNlXG4gICAgICBfcGxheWJhY2tFcnJvciA9IHRydWU7XG5cbiAgICAgIGlmICghX2lzU3RvcmFnZUZpbGUpIHtcbiAgICAgICAgLy8gcmVtb3ZlIHRoZSByZWZyZXNoIHRpbWVyIChpZiBpdCdzIHJ1bm5pbmcpXG4gICAgICAgIGNsZWFyVGltZW91dChfdGltZXIpO1xuICAgICAgICBfdGltZXIgPSBudWxsO1xuICAgICAgfVxuXG4gICAgfVxuXG4gIH1cblxuICBmdW5jdGlvbiBzdG9wKCkge1xuICAgIHBhdXNlKCk7XG4gIH1cblxuICByZXR1cm4ge1xuICAgIFwib25TdG9yYWdlSW5pdFwiOiBvblN0b3JhZ2VJbml0LFxuICAgIFwib25TdG9yYWdlUmVmcmVzaFwiOiBvblN0b3JhZ2VSZWZyZXNoLFxuICAgIFwicGF1c2VcIjogcGF1c2UsXG4gICAgXCJwbGF5XCI6IHBsYXksXG4gICAgXCJzZXRBZGRpdGlvbmFsUGFyYW1zXCI6IHNldEFkZGl0aW9uYWxQYXJhbXMsXG4gICAgXCJwbGF5ZXJFbmRlZFwiOiBwbGF5ZXJFbmRlZCxcbiAgICBcInBsYXllclJlYWR5XCI6IHBsYXllclJlYWR5LFxuICAgIFwicGxheWVyRXJyb3JcIjogcGxheWVyRXJyb3IsXG4gICAgXCJzdG9wXCI6IHN0b3BcbiAgfTtcblxufSkoZ2FkZ2V0cyk7XG5cbnZhciBSaXNlVmlzaW9uID0gUmlzZVZpc2lvbiB8fCB7fTtcblJpc2VWaXNpb24uVmlkZW8gPSBSaXNlVmlzaW9uLlZpZGVvIHx8IHt9O1xuXG5SaXNlVmlzaW9uLlZpZGVvLlN0b3JhZ2UgPSBmdW5jdGlvbiAoZGF0YSkge1xuICBcInVzZSBzdHJpY3RcIjtcblxuICB2YXIgX2luaXRpYWxMb2FkID0gdHJ1ZTtcblxuICAvKlxuICAgKiAgUHVibGljIE1ldGhvZHNcbiAgICovXG4gIGZ1bmN0aW9uIGluaXQoKSB7XG4gICAgdmFyIHN0b3JhZ2UgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcInZpZGVvU3RvcmFnZVwiKTtcblxuICAgIGlmICghc3RvcmFnZSkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIHN0b3JhZ2UuYWRkRXZlbnRMaXN0ZW5lcihcInJpc2Utc3RvcmFnZS1yZXNwb25zZVwiLCBmdW5jdGlvbihlKSB7XG4gICAgICB2YXIgdXJsO1xuXG4gICAgICBpZiAoZS5kZXRhaWwgJiYgZS5kZXRhaWwuZmlsZXMgJiYgZS5kZXRhaWwuZmlsZXMubGVuZ3RoID4gMCkge1xuICAgICAgICB1cmwgPSBlLmRldGFpbC5maWxlc1swXS51cmw7XG5cbiAgICAgICAgaWYgKF9pbml0aWFsTG9hZCkge1xuICAgICAgICAgIF9pbml0aWFsTG9hZCA9IGZhbHNlO1xuXG4gICAgICAgICAgUmlzZVZpc2lvbi5WaWRlby5vblN0b3JhZ2VJbml0KHVybCk7XG5cbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBSaXNlVmlzaW9uLlZpZGVvLm9uU3RvcmFnZVJlZnJlc2godXJsKTtcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgfSk7XG5cbiAgICBzdG9yYWdlLnNldEF0dHJpYnV0ZShcImZvbGRlclwiLCBkYXRhLnN0b3JhZ2UuZm9sZGVyKTtcbiAgICBzdG9yYWdlLnNldEF0dHJpYnV0ZShcImZpbGVOYW1lXCIsIGRhdGEuc3RvcmFnZS5maWxlTmFtZSk7XG4gICAgc3RvcmFnZS5zZXRBdHRyaWJ1dGUoXCJjb21wYW55SWRcIiwgZGF0YS5zdG9yYWdlLmNvbXBhbnlJZCk7XG4gICAgc3RvcmFnZS5nbygpO1xuICB9XG5cbiAgcmV0dXJuIHtcbiAgICBcImluaXRcIjogaW5pdFxuICB9O1xufTtcblxudmFyIFJpc2VWaXNpb24gPSBSaXNlVmlzaW9uIHx8IHt9O1xuUmlzZVZpc2lvbi5Db21tb24gPSBSaXNlVmlzaW9uLkNvbW1vbiB8fCB7fTtcblxuUmlzZVZpc2lvbi5Db21tb24uVmlkZW8gPSBSaXNlVmlzaW9uLkNvbW1vbi5WaWRlbyB8fCB7fTtcblxuUmlzZVZpc2lvbi5Db21tb24uVmlkZW8uRnJhbWVDb250cm9sbGVyID0gZnVuY3Rpb24gKCkge1xuICBcInVzZSBzdHJpY3RcIjtcblxuICB2YXIgUFJFRklYID0gXCJpZl9cIjtcblxuICBmdW5jdGlvbiBnZXRGcmFtZUNvbnRhaW5lcihpbmRleCkge1xuICAgIHJldHVybiBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChQUkVGSVggKyBpbmRleCk7XG4gIH1cblxuICBmdW5jdGlvbiBnZXRGcmFtZU9iamVjdChpbmRleCkge1xuICAgIHZhciBmcmFtZUNvbnRhaW5lciA9IGdldEZyYW1lQ29udGFpbmVyKGluZGV4KSxcbiAgICAgIGlmcmFtZTtcblxuICAgIGlmcmFtZSA9IGZyYW1lQ29udGFpbmVyLnF1ZXJ5U2VsZWN0b3IoXCJpZnJhbWVcIik7XG5cbiAgICBpZiAoaWZyYW1lKSB7XG4gICAgICByZXR1cm4gKGlmcmFtZS5jb250ZW50V2luZG93KSA/IGlmcmFtZS5jb250ZW50V2luZG93IDpcbiAgICAgICAgKGlmcmFtZS5jb250ZW50RG9jdW1lbnQuZG9jdW1lbnQpID8gaWZyYW1lLmNvbnRlbnREb2N1bWVudC5kb2N1bWVudCA6IGlmcmFtZS5jb250ZW50RG9jdW1lbnQ7XG4gICAgfVxuXG4gICAgcmV0dXJuIG51bGw7XG4gIH1cblxuICBmdW5jdGlvbiBfY2xlYXIoaW5kZXgpIHtcbiAgICB2YXIgZnJhbWVDb250YWluZXIgPSBnZXRGcmFtZUNvbnRhaW5lcihpbmRleCksXG4gICAgICBmcmFtZU9iaiA9IGdldEZyYW1lT2JqZWN0KGluZGV4KSxcbiAgICAgIGlmcmFtZTtcblxuICAgIGlmIChmcmFtZU9iaikge1xuICAgICAgaWZyYW1lID0gZnJhbWVDb250YWluZXIucXVlcnlTZWxlY3RvcihcImlmcmFtZVwiKTtcbiAgICAgIGZyYW1lT2JqLnJlbW92ZSgpO1xuICAgICAgaWZyYW1lLnNldEF0dHJpYnV0ZShcInNyY1wiLCBcImFib3V0OmJsYW5rXCIpO1xuICAgIH1cbiAgfVxuXG4gIGZ1bmN0aW9uIGFkZChpbmRleCkge1xuICAgIHZhciBmcmFtZUNvbnRhaW5lciA9IGdldEZyYW1lQ29udGFpbmVyKGluZGV4KSxcbiAgICAgIGlmcmFtZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJpZnJhbWVcIik7XG5cbiAgICBpZnJhbWUuc2V0QXR0cmlidXRlKFwiYWxsb3dUcmFuc3BhcmVuY3lcIiwgdHJ1ZSk7XG4gICAgaWZyYW1lLnNldEF0dHJpYnV0ZShcImZyYW1lYm9yZGVyXCIsIFwiMFwiKTtcbiAgICBpZnJhbWUuc2V0QXR0cmlidXRlKFwic2Nyb2xsaW5nXCIsIFwibm9cIik7XG5cbiAgICBmcmFtZUNvbnRhaW5lci5hcHBlbmRDaGlsZChpZnJhbWUpO1xuICB9XG5cbiAgZnVuY3Rpb24gY3JlYXRlRnJhbWVQbGF5ZXIoaW5kZXgsIHBhcmFtcywgZmlsZXMsIHNraW4sIHNyYykge1xuICAgIHZhciBmcmFtZUNvbnRhaW5lciA9IGdldEZyYW1lQ29udGFpbmVyKGluZGV4KSxcbiAgICAgIGZyYW1lT2JqID0gZ2V0RnJhbWVPYmplY3QoaW5kZXgpLFxuICAgICAgaWZyYW1lO1xuXG4gICAgaWYgKGZyYW1lT2JqKSB7XG4gICAgICBpZnJhbWUgPSBmcmFtZUNvbnRhaW5lci5xdWVyeVNlbGVjdG9yKFwiaWZyYW1lXCIpO1xuXG4gICAgICBpZnJhbWUub25sb2FkID0gZnVuY3Rpb24gKCkge1xuICAgICAgICBpZnJhbWUub25sb2FkID0gbnVsbDtcblxuICAgICAgICAvLyBpbml0aWFsaXplIGFuZCBsb2FkIHRoZSBwbGF5ZXIgaW5zaWRlIHRoZSBpZnJhbWVcbiAgICAgICAgZnJhbWVPYmouaW5pdChwYXJhbXMsIGZpbGVzLCBza2luKTtcbiAgICAgICAgZnJhbWVPYmoubG9hZCgpO1xuICAgICAgfTtcblxuICAgICAgaWZyYW1lLnNldEF0dHJpYnV0ZShcInNyY1wiLCBzcmMpO1xuICAgIH1cblxuICB9XG5cbiAgZnVuY3Rpb24gaGlkZShpbmRleCkge1xuICAgIHZhciBmcmFtZUNvbnRhaW5lciA9IGdldEZyYW1lQ29udGFpbmVyKGluZGV4KTtcblxuICAgIGZyYW1lQ29udGFpbmVyLnN0eWxlLnZpc2liaWxpdHkgPSBcImhpZGRlblwiO1xuICB9XG5cbiAgZnVuY3Rpb24gcmVtb3ZlKGluZGV4LCBjYWxsYmFjaykge1xuICAgIHZhciBmcmFtZUNvbnRhaW5lciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFBSRUZJWCArIGluZGV4KTtcblxuICAgIF9jbGVhcihpbmRleCk7XG5cbiAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHtcbiAgICAgIC8vIHJlbW92ZSB0aGUgaWZyYW1lIGJ5IGNsZWFyaW5nIGFsbCBlbGVtZW50cyBpbnNpZGUgZGl2IGNvbnRhaW5lclxuICAgICAgd2hpbGUgKGZyYW1lQ29udGFpbmVyLmZpcnN0Q2hpbGQpIHtcbiAgICAgICAgZnJhbWVDb250YWluZXIucmVtb3ZlQ2hpbGQoZnJhbWVDb250YWluZXIuZmlyc3RDaGlsZCk7XG4gICAgICB9XG5cbiAgICAgIGlmIChjYWxsYmFjayAmJiB0eXBlb2YgY2FsbGJhY2sgPT09IFwiZnVuY3Rpb25cIikge1xuICAgICAgICBjYWxsYmFjaygpO1xuICAgICAgfVxuICAgIH0sIDIwMCk7XG4gIH1cblxuICBmdW5jdGlvbiBzaG93KGluZGV4KSB7XG4gICAgdmFyIGZyYW1lQ29udGFpbmVyID0gZ2V0RnJhbWVDb250YWluZXIoaW5kZXgpO1xuXG4gICAgZnJhbWVDb250YWluZXIuc3R5bGUudmlzaWJpbGl0eSA9IFwidmlzaWJsZVwiO1xuICB9XG5cbiAgcmV0dXJuIHtcbiAgICBhZGQ6IGFkZCxcbiAgICBjcmVhdGVGcmFtZVBsYXllcjogY3JlYXRlRnJhbWVQbGF5ZXIsXG4gICAgZ2V0RnJhbWVDb250YWluZXI6IGdldEZyYW1lQ29udGFpbmVyLFxuICAgIGdldEZyYW1lT2JqZWN0OiBnZXRGcmFtZU9iamVjdCxcbiAgICBoaWRlOiBoaWRlLFxuICAgIHJlbW92ZTogcmVtb3ZlLFxuICAgIHNob3c6IHNob3dcbiAgfTtcbn07XG5cbi8qIGdsb2JhbCBnYWRnZXRzLCBSaXNlVmlzaW9uICovXG5cbihmdW5jdGlvbiAod2luZG93LCBnYWRnZXRzKSB7XG4gIFwidXNlIHN0cmljdFwiO1xuXG4gIHZhciBwcmVmcyA9IG5ldyBnYWRnZXRzLlByZWZzKCksXG4gICAgaWQgPSBwcmVmcy5nZXRTdHJpbmcoXCJpZFwiKTtcblxuICAvLyBEaXNhYmxlIGNvbnRleHQgbWVudSAocmlnaHQgY2xpY2sgbWVudSlcbiAgd2luZG93Lm9uY29udGV4dG1lbnUgPSBmdW5jdGlvbiAoKSB7XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9O1xuXG4gIGZ1bmN0aW9uIHBsYXkoKSB7XG4gICAgUmlzZVZpc2lvbi5WaWRlby5wbGF5KCk7XG4gIH1cblxuICBmdW5jdGlvbiBwYXVzZSgpIHtcbiAgICBSaXNlVmlzaW9uLlZpZGVvLnBhdXNlKCk7XG4gIH1cblxuICBmdW5jdGlvbiBzdG9wKCkge1xuICAgIFJpc2VWaXNpb24uVmlkZW8uc3RvcCgpO1xuICB9XG5cbiAgZnVuY3Rpb24gcG9seW1lclJlYWR5KCkge1xuICAgIHdpbmRvdy5yZW1vdmVFdmVudExpc3RlbmVyKFwicG9seW1lci1yZWFkeVwiLCBwb2x5bWVyUmVhZHkpO1xuXG4gICAgaWYgKGlkICYmIGlkICE9PSBcIlwiKSB7XG4gICAgICBnYWRnZXRzLnJwYy5yZWdpc3RlcihcInJzY21kX3BsYXlfXCIgKyBpZCwgcGxheSk7XG4gICAgICBnYWRnZXRzLnJwYy5yZWdpc3RlcihcInJzY21kX3BhdXNlX1wiICsgaWQsIHBhdXNlKTtcbiAgICAgIGdhZGdldHMucnBjLnJlZ2lzdGVyKFwicnNjbWRfc3RvcF9cIiArIGlkLCBzdG9wKTtcblxuICAgICAgZ2FkZ2V0cy5ycGMucmVnaXN0ZXIoXCJyc3BhcmFtX3NldF9cIiArIGlkLCBSaXNlVmlzaW9uLlZpZGVvLnNldEFkZGl0aW9uYWxQYXJhbXMpO1xuICAgICAgZ2FkZ2V0cy5ycGMuY2FsbChcIlwiLCBcInJzcGFyYW1fZ2V0XCIsIG51bGwsIGlkLCBbXCJhZGRpdGlvbmFsUGFyYW1zXCJdKTtcbiAgICB9XG4gIH1cblxuICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcihcInBvbHltZXItcmVhZHlcIiwgcG9seW1lclJlYWR5KTtcblxufSkod2luZG93LCBnYWRnZXRzKTtcblxuXG5cbi8qIGpzaGludCBpZ25vcmU6c3RhcnQgKi9cbnZhciBfZ2FxID0gX2dhcSB8fCBbXTtcblxuX2dhcS5wdXNoKFsnX3NldEFjY291bnQnLCAnVUEtNTcwOTIxNTktMiddKTtcbl9nYXEucHVzaChbJ190cmFja1BhZ2V2aWV3J10pO1xuXG4oZnVuY3Rpb24oKSB7XG4gIHZhciBnYSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3NjcmlwdCcpOyBnYS50eXBlID0gJ3RleHQvamF2YXNjcmlwdCc7IGdhLmFzeW5jID0gdHJ1ZTtcbiAgZ2Euc3JjID0gKCdodHRwczonID09IGRvY3VtZW50LmxvY2F0aW9uLnByb3RvY29sID8gJ2h0dHBzOi8vc3NsJyA6ICdodHRwOi8vd3d3JykgKyAnLmdvb2dsZS1hbmFseXRpY3MuY29tL2dhLmpzJztcbiAgdmFyIHMgPSBkb2N1bWVudC5nZXRFbGVtZW50c0J5VGFnTmFtZSgnc2NyaXB0JylbMF07IHMucGFyZW50Tm9kZS5pbnNlcnRCZWZvcmUoZ2EsIHMpO1xufSkoKTtcbi8qIGpzaGludCBpZ25vcmU6ZW5kICovXG4iXSwic291cmNlUm9vdCI6Ii9zb3VyY2UvIn0=