if("undefined"==typeof config){var config={};"undefined"!=typeof angular&&angular.module("risevision.common.i18n.config",[]).constant("LOCALES_PREFIX","locales/translation_").constant("LOCALES_SUFIX",".json")}var RiseVision=RiseVision||{};RiseVision.Video={},RiseVision.Video=function(e,t){"use strict";function n(){t.rpc.call("","rsevent_done",null,l.getString("id"))}function i(){t.rpc.call("","rsevent_ready",null,l.getString("id"),!0,!0,!0,!0,!0)}function o(){p=new RiseVision.Video.Player(g),p.init()}function a(){y=p.isVideoPlaying(),p.pause()}function r(){f?(f=!1,g.video.autoplay&&p.play()):y&&p.play()}function s(){i()}function d(n){l=new t.Prefs,g=n,e.getElementById("videoContainer").style.height=l.getInt("rsH")+"px",m=new RiseVision.Common.Background(g),m.init(o)}function u(){p.pause()}function c(){y=!0,n()}var l=null,g={},m=null,p=null,f=!0,y=!0;return{pause:a,play:r,setAdditionalParams:d,playerReady:s,stop:u,videoEnded:c}}(document,gadgets);var RiseVision=RiseVision||{};RiseVision.Common=RiseVision.Common||{},RiseVision.Common.Background=function(e){"use strict";function t(){setTimeout(function(){d.style.backgroundImage="url("+e.background.image.url+g+"cb="+(new Date).getTime()+")",t()},c)}function n(){s=!0,e.background.useImage&&!l&&t(),r&&"function"==typeof r&&r()}function i(e){u.removeEventListener("rise-storage-response",i),d.style.backgroundImage=Array.isArray(e.detail)?"url("+e.detail[0]+")":"url("+e.detail+")",n()}function o(){var t;d=document.getElementById("background"),u=document.getElementById("backgroundStorage"),document.body.style.background=e.background.color,d?e.background.useImage?(d.className=e.background.image.position,d.className=e.background.image.scale?d.className+" scale-to-fit":d.className,l=0!==Object.keys(e.backgroundStorage).length,l?u?(u.addEventListener("rise-storage-response",i),u.setAttribute("folder",e.backgroundStorage.folder),u.setAttribute("fileName",e.backgroundStorage.fileName),u.setAttribute("companyId",e.backgroundStorage.companyId),u.go()):console.log("Missing element with id value of 'backgroundStorage'"):(t=e.background.image.url.split("?"),g=1===t.length?"?":"&",d.style.backgroundImage="url("+e.background.image.url+")",n())):n():console.log("Missing element with id value of 'background'")}function a(e){s?e&&"function"==typeof e&&e():(e&&(r=e),o())}var r=null,s=!1,d=null,u=null,c=9e5,l=!1,g="";return{init:a}};var RiseVision=RiseVision||{};RiseVision.Video=RiseVision.Video||{},RiseVision.Video.Player=function(e){"use strict";function t(){var t=e.url.substr(e.url.lastIndexOf(".")+1);return"ogv"===t&&(t="ogg"),t}function n(){var e=document.getElementById("video");e.removeEventListener("canplaythrough",n,!1),p||(RiseVision.Video.playerReady(),p=!0),g||(m&&(m=!1,RiseVision.Video.videoEnded()),r(l))}function i(){!g&&m?a():RiseVision.Video.videoEnded()}function o(e){var t,n=document.getElementById("video");n&&(t=n.getElementsByTagName("source")[0]),Array.isArray(e.detail)?t.setAttribute("src",e.detail[0]):t.setAttribute("src",e.detail),n.load()}function a(){var t,i=document.getElementById("video");t=i.getElementsByTagName("source")[0],i.addEventListener("canplaythrough",n,!1),t.setAttribute("src",e.url+f+"cb="+(new Date).getTime()),i.load()}function r(e){var t=document.getElementById("video");setTimeout(function(){t&&t.paused&&t.currentTime<=0?a(!1):m=!0},e)}function s(){var a,r=document.getElementById("video"),s=document.getElementById("videoStorage"),d=document.createDocumentFragment(),u=document.createElement("source");r&&s&&(e.video.autoplay||r.setAttribute("controls",""),r.className=e.video.scaleToFit?r.className+" scale-to-fit":r.className+" no-scale",r.volume=e.video.volume/100,u.setAttribute("type","video/"+t()),r.addEventListener("canplaythrough",n,!1),r.addEventListener("ended",i,!1),g=0!==Object.keys(e.videoStorage).length,g?(d.appendChild(u),r.appendChild(d),s.addEventListener("rise-storage-response",o),s.setAttribute("folder",e.videoStorage.folder),s.setAttribute("fileName",e.videoStorage.fileName),s.setAttribute("companyId",e.videoStorage.companyId),s.go()):(a=e.url.split("?"),f=1===a.length?"?":"&",u.setAttribute("src",e.url),d.appendChild(u),r.appendChild(d)))}function d(){var e=document.getElementById("video");return!e||"undefined"==typeof e.pause||e.paused||e.ended?!1:!0}function u(){var e=document.getElementById("video");e&&"undefined"!=typeof e.pause&&e.pause()}function c(){var e=document.getElementById("video");e&&"undefined"!=typeof e.pause&&e.play()}var l=9e5,g=!1,m=!1,p=!1,f="";return{init:s,pause:u,play:c,isVideoPlaying:d}},function(e,t){"use strict";function n(){RiseVision.Video.play()}function i(){RiseVision.Video.pause()}function o(){RiseVision.Video.stop()}function a(e,t){Array.isArray(e)&&e.length>0&&"additionalParams"===e[0]&&Array.isArray(t)&&t.length>0&&RiseVision.Video.setAdditionalParams(JSON.parse(t[0]))}var r=new t.Prefs,s=r.getString("id");e.oncontextmenu=function(){return!1},s&&""!==s&&(t.rpc.register("rscmd_play_"+s,n),t.rpc.register("rscmd_pause_"+s,i),t.rpc.register("rscmd_stop_"+s,o),t.rpc.register("rsparam_set_"+s,a),t.rpc.call("","rsparam_get",null,s,["additionalParams"]))}(window,gadgets);var _gaq=_gaq||[];_gaq.push(["_setAccount","UA-57092159-2"]),_gaq.push(["_trackPageview"]),function(){var e=document.createElement("script");e.type="text/javascript",e.async=!0,e.src=("https:"==document.location.protocol?"https://ssl":"http://www")+".google-analytics.com/ga.js";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImpzL3dpZGdldC5taW4uanMiXSwibmFtZXMiOlsiY29uZmlnIiwiYW5ndWxhciIsIm1vZHVsZSIsImNvbnN0YW50IiwiUmlzZVZpc2lvbiIsIlZpZGVvIiwiZG9jdW1lbnQiLCJnYWRnZXRzIiwiX2RvbmUiLCJycGMiLCJjYWxsIiwiX3ByZWZzIiwiZ2V0U3RyaW5nIiwiX3JlYWR5IiwiX2JhY2tncm91bmRSZWFkeSIsIl9wbGF5ZXIiLCJQbGF5ZXIiLCJfYWRkaXRpb25hbFBhcmFtcyIsImluaXQiLCJwYXVzZSIsIl9wcmV2aW91c2x5UGxheWluZyIsImlzVmlkZW9QbGF5aW5nIiwicGxheSIsIl9pbml0aWFsUGxheSIsInZpZGVvIiwiYXV0b3BsYXkiLCJwbGF5ZXJSZWFkeSIsInNldEFkZGl0aW9uYWxQYXJhbXMiLCJwYXJhbXMiLCJQcmVmcyIsImdldEVsZW1lbnRCeUlkIiwic3R5bGUiLCJoZWlnaHQiLCJnZXRJbnQiLCJfYmFja2dyb3VuZCIsIkNvbW1vbiIsIkJhY2tncm91bmQiLCJzdG9wIiwidmlkZW9FbmRlZCIsImRhdGEiLCJfcmVmcmVzaFRpbWVyIiwic2V0VGltZW91dCIsImJhY2tncm91bmRJbWFnZSIsImJhY2tncm91bmQiLCJpbWFnZSIsInVybCIsIl9zZXBhcmF0b3IiLCJEYXRlIiwiZ2V0VGltZSIsIl9yZWZyZXNoRHVyYXRpb24iLCJ1c2VJbWFnZSIsIl9pc1N0b3JhZ2VGaWxlIiwiX2NhbGxiYWNrIiwiX3N0b3JhZ2VSZXNwb25zZSIsImUiLCJfc3RvcmFnZSIsInJlbW92ZUV2ZW50TGlzdGVuZXIiLCJBcnJheSIsImlzQXJyYXkiLCJkZXRhaWwiLCJfY29uZmlndXJlIiwic3RyIiwiYm9keSIsImNvbG9yIiwiY2xhc3NOYW1lIiwicG9zaXRpb24iLCJzY2FsZSIsIk9iamVjdCIsImtleXMiLCJiYWNrZ3JvdW5kU3RvcmFnZSIsImxlbmd0aCIsImFkZEV2ZW50TGlzdGVuZXIiLCJzZXRBdHRyaWJ1dGUiLCJmb2xkZXIiLCJmaWxlTmFtZSIsImNvbXBhbnlJZCIsImdvIiwiY29uc29sZSIsImxvZyIsInNwbGl0IiwiY2IiLCJfZ2V0VmlkZW9GaWxlVHlwZSIsInR5cGUiLCJzdWJzdHIiLCJsYXN0SW5kZXhPZiIsIl9vbkNhblBsYXlUaHJvdWdoIiwiX25vdGlmaWVkUmVhZHkiLCJfcmVmcmVzaFdhaXRpbmciLCJfb25FbmRlZCIsIl9yZWZyZXNoIiwiX29uUmlzZVN0b3JhZ2VSZXNwb25zZSIsInNvdXJjZSIsImdldEVsZW1lbnRzQnlUYWdOYW1lIiwibG9hZCIsImR1cmF0aW9uIiwicGF1c2VkIiwiY3VycmVudFRpbWUiLCJzdG9yYWdlIiwiZnJhZ21lbnQiLCJjcmVhdGVEb2N1bWVudEZyYWdtZW50IiwiY3JlYXRlRWxlbWVudCIsInNjYWxlVG9GaXQiLCJ2b2x1bWUiLCJ2aWRlb1N0b3JhZ2UiLCJhcHBlbmRDaGlsZCIsImVuZGVkIiwid2luZG93IiwiYWRkaXRpb25hbFBhcmFtcyIsIm5hbWVzIiwidmFsdWVzIiwiSlNPTiIsInBhcnNlIiwicHJlZnMiLCJpZCIsIm9uY29udGV4dG1lbnUiLCJyZWdpc3RlciIsIl9nYXEiLCJwdXNoIiwiZ2EiLCJhc3luYyIsInNyYyIsImxvY2F0aW9uIiwicHJvdG9jb2wiLCJzIiwicGFyZW50Tm9kZSIsImluc2VydEJlZm9yZSJdLCJtYXBwaW5ncyI6IkFBRUEsR0FBc0IsbUJBQVhBLFFBQXdCLENBQ2pDLEdBQUlBLFVBSW1CLG9CQUFaQyxVQUNUQSxRQUFRQyxPQUFPLG9DQUNaQyxTQUFTLGlCQUFrQix3QkFDM0JBLFNBQVMsZ0JBQWlCLFNBTWpDLEdBQUlDLFlBQWFBLGNBQ2pCQSxZQUFXQyxTQUVYRCxXQUFXQyxNQUFRLFNBQVdDLEVBQVVDLEdBQ3RDLFlBWUEsU0FBU0MsS0FDUEQsRUFBUUUsSUFBSUMsS0FBSyxHQUFJLGVBQWdCLEtBQU1DLEVBQU9DLFVBQVUsT0FJOUQsUUFBU0MsS0FDUE4sRUFBUUUsSUFBSUMsS0FBSyxHQUFJLGdCQUFpQixLQUFNQyxFQUFPQyxVQUFVLE9BQzNE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LEVBQVFFLElBQUkwRyxTQUFTLGNBQWdCRixFQUFJM0YsR0FDekNmLEVBQVFFLElBQUkwRyxTQUFTLGVBQWlCRixFQUFJOUYsR0FDMUNaLEVBQVFFLElBQUkwRyxTQUFTLGNBQWdCRixFQUFJNUUsR0FFekM5QixFQUFRRSxJQUFJMEcsU0FBUyxlQUFpQkYsRUFBSU4sR0FDMUNwRyxFQUFRRSxJQUFJQyxLQUFLLEdBQUksY0FBZSxLQUFNdUcsR0FBSyx1QkFJaERQLE9BQVFuRyxRQUtYLElBQUk2RyxNQUFPQSxRQUVYQSxNQUFLQyxNQUFNLGNBQWUsa0JBQzFCRCxLQUFLQyxNQUFNLG1CQUVYLFdBQ0UsR0FBSUMsR0FBS2hILFNBQVM4RixjQUFjLFNBQVdrQixHQUFHcEMsS0FBTyxrQkFBbUJvQyxFQUFHQyxPQUFRLEVBQ25GRCxFQUFHRSxLQUFPLFVBQVlsSCxTQUFTbUgsU0FBU0MsU0FBVyxjQUFnQixjQUFnQiw2QkFDbkYsSUFBSUMsR0FBSXJILFNBQVNzRixxQkFBcUIsVUFBVSxFQUFJK0IsR0FBRUMsV0FBV0MsYUFBYVAsRUFBSUsiLCJmaWxlIjoianMvd2lkZ2V0Lm1pbi5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8qIGdsb2JhbCBjb25maWc6IHRydWUgKi9cbi8qIGV4cG9ydGVkIGNvbmZpZyAqL1xuaWYgKHR5cGVvZiBjb25maWcgPT09IFwidW5kZWZpbmVkXCIpIHtcbiAgdmFyIGNvbmZpZyA9IHtcbiAgICAvLyB2YXJpYWJsZXMgZ28gaGVyZVxuICB9O1xuXG4gIGlmICh0eXBlb2YgYW5ndWxhciAhPT0gXCJ1bmRlZmluZWRcIikge1xuICAgIGFuZ3VsYXIubW9kdWxlKFwicmlzZXZpc2lvbi5jb21tb24uaTE4bi5jb25maWdcIiwgW10pXG4gICAgICAuY29uc3RhbnQoXCJMT0NBTEVTX1BSRUZJWFwiLCBcImxvY2FsZXMvdHJhbnNsYXRpb25fXCIpXG4gICAgICAuY29uc3RhbnQoXCJMT0NBTEVTX1NVRklYXCIsIFwiLmpzb25cIik7XG4gIH1cbn1cblxuLyogZ2xvYmFsIGdhZGdldHMgKi9cblxudmFyIFJpc2VWaXNpb24gPSBSaXNlVmlzaW9uIHx8IHt9O1xuUmlzZVZpc2lvbi5WaWRlbyA9IHt9O1xuXG5SaXNlVmlzaW9uLlZpZGVvID0gKGZ1bmN0aW9uIChkb2N1bWVudCwgZ2FkZ2V0cykge1xuICBcInVzZSBzdHJpY3RcIjtcblxuICB2YXIgX3ByZWZzID0gbnVsbCxcbiAgICBfYWRkaXRpb25hbFBhcmFtcyA9IHt9LFxuICAgIF9iYWNrZ3JvdW5kID0gbnVsbCxcbiAgICBfcGxheWVyID0gbnVsbCxcbiAgICBfaW5pdGlhbFBsYXkgPSB0cnVlLFxuICAgIF9wcmV2aW91c2x5UGxheWluZyA9IHRydWU7XG5cbiAgLypcbiAgICogIFByaXZhdGUgTWV0aG9kc1xuICAgKi9cbiAgZnVuY3Rpb24gX2RvbmUoKSB7XG4gICAgZ2FkZ2V0cy5ycGMuY2FsbChcIlwiLCBcInJzZXZlbnRfZG9uZVwiLCBudWxsLCBfcHJlZnMuZ2V0U3RyaW5nKFwiaWRcIikpO1xuXG4gIH1cblxuICBmdW5jdGlvbiBfcmVhZHkoKSB7XG4gICAgZ2FkZ2V0cy5ycGMuY2FsbChcIlwiLCBcInJzZXZlbnRfcmVhZHlcIiwgbnVsbCwgX3ByZWZzLmdldFN0cmluZyhcImlkXCIpLFxuICAgICAgdHJ1ZSwgdHJ1ZSwgdHJ1ZSwgdHJ1ZSwgdHJ1ZSk7XG4gIH1cblxuICBmdW5jdGlvbiBfYmFja2dyb3VuZFJlYWR5KCkge1xuICAgIC8vIGNyZWF0ZSBhbmQgaW5pdGlhbGl6ZSB0aGUgUGxheWVyIGluc3RhbmNlXG4gICAgX3BsYXllciA9IG5ldyBSaXNlVmlzaW9uLlZpZGVvLlBsYXllcihfYWRkaXRpb25hbFBhcmFtcyk7XG4gICAgX3BsYXllci5pbml0KCk7XG4gIH1cblxuICAvKlxuICAgKiAgUHVibGljIE1ldGhvZHNcbiAgICovXG4gIGZ1bmN0aW9uIHBhdXNlKCkge1xuICAgIF9wcmV2aW91c2x5UGxheWluZyA9IF9wbGF5ZXIuaXNWaWRlb1BsYXlpbmcoKTtcblxuICAgIF9wbGF5ZXIucGF1c2UoKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIHBsYXkoKSB7XG4gICAgaWYgKF9pbml0aWFsUGxheSkge1xuICAgICAgX2luaXRpYWxQbGF5ID0gZmFsc2U7XG5cbiAgICAgIC8vIFwiYXV0b3BsYXlcIiB3YXMgc2VsZWN0ZWQgaW4gc2V0dGluZ3NcbiAgICAgIGlmIChfYWRkaXRpb25hbFBhcmFtcy52aWRlby5hdXRvcGxheSkge1xuICAgICAgICBfcGxheWVyLnBsYXkoKTtcbiAgICAgIH1cblxuICAgIH0gZWxzZSB7XG4gICAgICBpZiAoX3ByZXZpb3VzbHlQbGF5aW5nKSB7XG4gICAgICAgIF9wbGF5ZXIucGxheSgpO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIGZ1bmN0aW9uIHBsYXllclJlYWR5KCkge1xuICAgIF9yZWFkeSgpO1xuICB9XG5cbiAgZnVuY3Rpb24gc2V0QWRkaXRpb25hbFBhcmFtcyhwYXJhbXMpIHtcbiAgICBfcHJlZnMgPSBuZXcgZ2FkZ2V0cy5QcmVmcygpO1xuICAgIF9hZGRpdGlvbmFsUGFyYW1zID0gcGFyYW1zO1xuXG4gICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJ2aWRlb0NvbnRhaW5lclwiKS5zdHlsZS5oZWlnaHQgPSBfcHJlZnMuZ2V0SW50KFwicnNIXCIpICsgXCJweFwiO1xuXG4gICAgLy8gY3JlYXRlIGFuZCBpbml0aWFsaXplIHRoZSBCYWNrZ3JvdW5kIGluc3RhbmNlXG4gICAgX2JhY2tncm91bmQgPSBuZXcgUmlzZVZpc2lvbi5Db21tb24uQmFja2dyb3VuZChfYWRkaXRpb25hbFBhcmFtcyk7XG4gICAgX2JhY2tncm91bmQuaW5pdChfYmFja2dyb3VuZFJlYWR5KTtcbiAgfVxuXG4gIGZ1bmN0aW9uIHN0b3AoKSB7XG4gICAgLy8gaHR0cHM6Ly9naXRodWIuY29tL1Jpc2UtVmlzaW9uL3ZpZXdlci9pc3N1ZXMvMzBcbiAgICAvLyBIYXZlIHRvIGNhbGwgcGF1c2UoKSBvbiB0aGUgcGxheWVyIGR1ZSB0byBWaWV3ZXIgaXNzdWVcbiAgICBfcGxheWVyLnBhdXNlKCk7XG4gIH1cblxuICBmdW5jdGlvbiB2aWRlb0VuZGVkKCkge1xuICAgIF9wcmV2aW91c2x5UGxheWluZyA9IHRydWU7XG4gICAgX2RvbmUoKTtcbiAgfVxuXG4gIHJldHVybiB7XG4gICAgXCJwYXVzZVwiOiBwYXVzZSxcbiAgICBcInBsYXlcIjogcGxheSxcbiAgICBcInNldEFkZGl0aW9uYWxQYXJhbXNcIjogc2V0QWRkaXRpb25hbFBhcmFtcyxcbiAgICBcInBsYXllclJlYWR5XCI6IHBsYXllclJlYWR5LFxuICAgIFwic3RvcFwiOiBzdG9wLFxuICAgIFwidmlkZW9FbmRlZFwiOiB2aWRlb0VuZGVkXG4gIH07XG5cbn0pKGRvY3VtZW50LCBnYWRnZXRzKTtcblxudmFyIFJpc2VWaXNpb24gPSBSaXNlVmlzaW9uIHx8IHt9O1xuUmlzZVZpc2lvbi5Db21tb24gPSBSaXNlVmlzaW9uLkNvbW1vbiB8fCB7fTtcblxuUmlzZVZpc2lvbi5Db21tb24uQmFja2dyb3VuZCA9IGZ1bmN0aW9uIChkYXRhKSB7XG4gIFwidXNlIHN0cmljdFwiO1xuXG4gIHZhciBfY2FsbGJhY2sgPSBudWxsLFxuICAgIF9yZWFkeSA9IGZhbHNlLFxuICAgIF9iYWNrZ3JvdW5kID0gbnVsbCxcbiAgICBfc3RvcmFnZSA9IG51bGwsXG4gICAgX3JlZnJlc2hEdXJhdGlvbiA9IDkwMDAwMCwgLy8gMTUgbWludXRlc1xuICAgIF9pc1N0b3JhZ2VGaWxlID0gZmFsc2UsXG4gICAgX3NlcGFyYXRvciA9IFwiXCI7XG5cbiAgLypcbiAgICogUHJpdmF0ZSBNZXRob2RzXG4gICAqL1xuICBmdW5jdGlvbiBfcmVmcmVzaFRpbWVyKCkge1xuICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gYmFja2dyb3VuZFJlZnJlc2goKSB7XG4gICAgICBfYmFja2dyb3VuZC5zdHlsZS5iYWNrZ3JvdW5kSW1hZ2UgPSBcInVybChcIiArIGRhdGEuYmFja2dyb3VuZC5pbWFnZS51cmwgKyBfc2VwYXJhdG9yICsgXCJjYj1cIiArIG5ldyBEYXRlKCkuZ2V0VGltZSgpICsgXCIpXCI7XG4gICAgICBfcmVmcmVzaFRpbWVyKCk7XG4gICAgfSwgX3JlZnJlc2hEdXJhdGlvbik7XG4gIH1cblxuICBmdW5jdGlvbiBfYmFja2dyb3VuZFJlYWR5KCkge1xuICAgIF9yZWFkeSA9IHRydWU7XG5cbiAgICBpZiAoZGF0YS5iYWNrZ3JvdW5kLnVzZUltYWdlICYmICFfaXNTdG9yYWdlRmlsZSkge1xuICAgICAgLy8gc3RhcnQgdGhlIHJlZnJlc2ggcG9sbCBmb3Igbm9uLXN0b3JhZ2UgYmFja2dyb3VuZCBpbWFnZVxuICAgICAgX3JlZnJlc2hUaW1lcigpO1xuICAgIH1cblxuICAgIGlmIChfY2FsbGJhY2sgJiYgdHlwZW9mIF9jYWxsYmFjayA9PT0gXCJmdW5jdGlvblwiKSB7XG4gICAgICBfY2FsbGJhY2soKTtcbiAgICB9XG4gIH1cblxuICBmdW5jdGlvbiBfc3RvcmFnZVJlc3BvbnNlKGUpIHtcbiAgICBfc3RvcmFnZS5yZW1vdmVFdmVudExpc3RlbmVyKFwicmlzZS1zdG9yYWdlLXJlc3BvbnNlXCIsIF9zdG9yYWdlUmVzcG9uc2UpO1xuXG4gICAgaWYgKEFycmF5LmlzQXJyYXkoZS5kZXRhaWwpKSB7XG4gICAgICBfYmFja2dyb3VuZC5zdHlsZS5iYWNrZ3JvdW5kSW1hZ2UgPSBcInVybChcIiArIGUuZGV0YWlsWzBdICsgXCIpXCI7XG4gICAgfSBlbHNlIHtcbiAgICAgIF9iYWNrZ3JvdW5kLnN0eWxlLmJhY2tncm91bmRJbWFnZSA9IFwidXJsKFwiICsgZS5kZXRhaWwgKyBcIilcIjtcbiAgICB9XG4gICAgX2JhY2tncm91bmRSZWFkeSgpO1xuICB9XG5cbiAgZnVuY3Rpb24gX2NvbmZpZ3VyZSgpIHtcbiAgICB2YXIgc3RyO1xuXG4gICAgX2JhY2tncm91bmQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcImJhY2tncm91bmRcIik7XG4gICAgX3N0b3JhZ2UgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcImJhY2tncm91bmRTdG9yYWdlXCIpO1xuXG4gICAgLy8gc2V0IHRoZSBkb2N1bWVudCBiYWNrZ3JvdW5kXG4gICAgZG9jdW1lbnQuYm9keS5zdHlsZS5iYWNrZ3JvdW5kID0gZGF0YS5iYWNrZ3JvdW5kLmNvbG9yO1xuXG4gICAgaWYgKF9iYWNrZ3JvdW5kKSB7XG4gICAgICBpZiAoZGF0YS5iYWNrZ3JvdW5kLnVzZUltYWdlKSB7XG4gICAgICAgIF9iYWNrZ3JvdW5kLmNsYXNzTmFtZSA9IGRhdGEuYmFja2dyb3VuZC5pbWFnZS5wb3NpdGlvbjtcbiAgICAgICAgX2JhY2tncm91bmQuY2xhc3NOYW1lID0gZGF0YS5iYWNrZ3JvdW5kLmltYWdlLnNjYWxlID8gX2JhY2tncm91bmQuY2xhc3NOYW1lICsgXCIgc2NhbGUtdG8tZml0XCJcbiAgICAgICAgICA6IF9iYWNrZ3JvdW5kLmNsYXNzTmFtZTtcblxuICAgICAgICBfaXNTdG9yYWdlRmlsZSA9IChPYmplY3Qua2V5cyhkYXRhLmJhY2tncm91bmRTdG9yYWdlKS5sZW5ndGggIT09IDApO1xuXG4gICAgICAgIGlmICghX2lzU3RvcmFnZUZpbGUpIHtcbiAgICAgICAgICBzdHIgPSBkYXRhLmJhY2tncm91bmQuaW1hZ2UudXJsLnNwbGl0KFwiP1wiKTtcblxuICAgICAgICAgIC8vIHN0b3JlIHRoaXMgZm9yIHRoZSByZWZyZXNoIHRpbWVyXG4gICAgICAgICAgX3NlcGFyYXRvciA9IChzdHIubGVuZ3RoID09PSAxKSA/IFwiP1wiIDogXCImXCI7XG5cbiAgICAgICAgICBfYmFja2dyb3VuZC5zdHlsZS5iYWNrZ3JvdW5kSW1hZ2UgPSBcInVybChcIiArIGRhdGEuYmFja2dyb3VuZC5pbWFnZS51cmwgKyBcIilcIjtcbiAgICAgICAgICBfYmFja2dyb3VuZFJlYWR5KCk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgaWYgKF9zdG9yYWdlKSB7XG4gICAgICAgICAgICAvLyBSaXNlIFN0b3JhZ2VcbiAgICAgICAgICAgIF9zdG9yYWdlLmFkZEV2ZW50TGlzdGVuZXIoXCJyaXNlLXN0b3JhZ2UtcmVzcG9uc2VcIiwgX3N0b3JhZ2VSZXNwb25zZSk7XG5cbiAgICAgICAgICAgIF9zdG9yYWdlLnNldEF0dHJpYnV0ZShcImZvbGRlclwiLCBkYXRhLmJhY2tncm91bmRTdG9yYWdlLmZvbGRlcik7XG4gICAgICAgICAgICBfc3RvcmFnZS5zZXRBdHRyaWJ1dGUoXCJmaWxlTmFtZVwiLCBkYXRhLmJhY2tncm91bmRTdG9yYWdlLmZpbGVOYW1lKTtcbiAgICAgICAgICAgIF9zdG9yYWdlLnNldEF0dHJpYnV0ZShcImNvbXBhbnlJZFwiLCBkYXRhLmJhY2tncm91bmRTdG9yYWdlLmNvbXBhbnlJZCk7XG4gICAgICAgICAgICBfc3RvcmFnZS5nbygpO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZyhcIk1pc3NpbmcgZWxlbWVudCB3aXRoIGlkIHZhbHVlIG9mICdiYWNrZ3JvdW5kU3RvcmFnZSdcIik7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBfYmFja2dyb3VuZFJlYWR5KCk7XG4gICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgIGNvbnNvbGUubG9nKFwiTWlzc2luZyBlbGVtZW50IHdpdGggaWQgdmFsdWUgb2YgJ2JhY2tncm91bmQnXCIpO1xuICAgIH1cbiAgfVxuXG4gIC8qXG4gICAqICBQdWJsaWMgTWV0aG9kc1xuICAgKi9cbiAgZnVuY3Rpb24gaW5pdChjYikge1xuICAgIGlmICghX3JlYWR5KSB7XG4gICAgICBpZiAoY2IpIHtcbiAgICAgICAgX2NhbGxiYWNrID0gY2I7XG4gICAgICB9XG5cbiAgICAgIF9jb25maWd1cmUoKTtcblxuICAgIH0gZWxzZSBpZiAoY2IgJiYgdHlwZW9mIGNiID09PSBcImZ1bmN0aW9uXCIpIHtcbiAgICAgIGNiKCk7XG4gICAgfVxuICB9XG5cbiAgcmV0dXJuIHtcbiAgICBcImluaXRcIjogaW5pdFxuICB9O1xufTtcblxudmFyIFJpc2VWaXNpb24gPSBSaXNlVmlzaW9uIHx8IHt9O1xuUmlzZVZpc2lvbi5WaWRlbyA9IFJpc2VWaXNpb24uVmlkZW8gfHwge307XG5cblJpc2VWaXNpb24uVmlkZW8uUGxheWVyID0gZnVuY3Rpb24gKGRhdGEpIHtcbiAgXCJ1c2Ugc3RyaWN0XCI7XG5cbiAgdmFyIF9yZWZyZXNoRHVyYXRpb24gPSA5MDAwMDAsIC8vIDE1IG1pbnV0ZXNcbiAgICBfaXNTdG9yYWdlRmlsZSA9IGZhbHNlLFxuICAgIF9yZWZyZXNoV2FpdGluZyA9IGZhbHNlLFxuICAgIF9ub3RpZmllZFJlYWR5ID0gZmFsc2UsXG4gICAgX3NlcGFyYXRvciA9IFwiXCI7XG5cbiAgLypcbiAgICogUHJpdmF0ZSBNZXRob2RzXG4gICAqL1xuICBmdW5jdGlvbiBfZ2V0VmlkZW9GaWxlVHlwZSgpIHtcbiAgICB2YXIgdHlwZSA9IGRhdGEudXJsLnN1YnN0cihkYXRhLnVybC5sYXN0SW5kZXhPZihcIi5cIikgKyAxKTtcblxuICAgIGlmICh0eXBlID09PSBcIm9ndlwiKSB7XG4gICAgICB0eXBlID0gXCJvZ2dcIjtcbiAgICB9XG5cbiAgICByZXR1cm4gdHlwZTtcbiAgfVxuXG4gIGZ1bmN0aW9uIF9vbkNhblBsYXlUaHJvdWdoKCkge1xuICAgIHZhciB2aWRlbyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwidmlkZW9cIik7XG5cbiAgICAvLyByZW1vdmUgdGhpcyBsaXN0ZW5lclxuICAgIHZpZGVvLnJlbW92ZUV2ZW50TGlzdGVuZXIoXCJjYW5wbGF5dGhyb3VnaFwiLCBfb25DYW5QbGF5VGhyb3VnaCwgZmFsc2UpO1xuXG4gICAgLy8gb25seSBjYWxsIHBsYXllclJlYWR5KCkgb25jZVxuICAgIGlmICghX25vdGlmaWVkUmVhZHkpIHtcbiAgICAgIFJpc2VWaXNpb24uVmlkZW8ucGxheWVyUmVhZHkoKTtcbiAgICAgIF9ub3RpZmllZFJlYWR5ID0gdHJ1ZTtcbiAgICB9XG5cbiAgICBpZiAoIV9pc1N0b3JhZ2VGaWxlKSB7XG4gICAgICBpZiAoX3JlZnJlc2hXYWl0aW5nKSB7XG4gICAgICAgIC8vIHJlZnJlc2ggaGFwcGVuZWQgYWZ0ZXIgYSB2aWRlbyBmaW5pc2hlZCBwbGF5aW5nIGluc3RlYWQgb2YgaW1tZWRpYXRlbHksIG5vdGlmeSB2aWV3ZXIgdGhhdCB2aWRlbyBlbmRlZFxuICAgICAgICBfcmVmcmVzaFdhaXRpbmcgPSBmYWxzZTtcblxuICAgICAgICBSaXNlVmlzaW9uLlZpZGVvLnZpZGVvRW5kZWQoKTtcbiAgICAgIH1cblxuICAgICAgLy8gY2FsbCB0aGUgcmVmcmVzaCB0aW1lciBmdW5jdGlvbiBmb3IgYSBub24tc3RvcmFnZSB2aWRlb1xuICAgICAgX3JlZnJlc2hUaW1lcihfcmVmcmVzaER1cmF0aW9uKTtcbiAgICB9XG4gIH1cblxuICBmdW5jdGlvbiBfb25FbmRlZCgpIHtcbiAgICBpZiAoIV9pc1N0b3JhZ2VGaWxlICYmIF9yZWZyZXNoV2FpdGluZykge1xuICAgICAgX3JlZnJlc2goKTtcbiAgICB9IGVsc2Uge1xuICAgICAgUmlzZVZpc2lvbi5WaWRlby52aWRlb0VuZGVkKCk7XG4gICAgfVxuICB9XG5cbiAgZnVuY3Rpb24gX29uUmlzZVN0b3JhZ2VSZXNwb25zZShlKSB7XG4gICAgdmFyIHZpZGVvID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJ2aWRlb1wiKSxcbiAgICAgIHNvdXJjZTtcblxuICAgIGlmICh2aWRlbykge1xuICAgICAgc291cmNlID0gdmlkZW8uZ2V0RWxlbWVudHNCeVRhZ05hbWUoXCJzb3VyY2VcIilbMF07XG4gICAgfVxuXG4gICAgaWYgKEFycmF5LmlzQXJyYXkoZS5kZXRhaWwpKSB7XG4gICAgICBzb3VyY2Uuc2V0QXR0cmlidXRlKFwic3JjXCIsIGUuZGV0YWlsWzBdKTtcbiAgICB9IGVsc2Uge1xuICAgICAgc291cmNlLnNldEF0dHJpYnV0ZShcInNyY1wiLCBlLmRldGFpbCk7XG4gICAgfVxuXG4gICAgdmlkZW8ubG9hZCgpO1xuICB9XG5cbiAgZnVuY3Rpb24gX3JlZnJlc2goKSB7XG4gICAgdmFyIHZpZGVvID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJ2aWRlb1wiKSxcbiAgICAgIHNvdXJjZTtcblxuICAgIHNvdXJjZSA9IHZpZGVvLmdldEVsZW1lbnRzQnlUYWdOYW1lKFwic291cmNlXCIpWzBdO1xuXG4gICAgdmlkZW8uYWRkRXZlbnRMaXN0ZW5lcihcImNhbnBsYXl0aHJvdWdoXCIsIF9vbkNhblBsYXlUaHJvdWdoLCBmYWxzZSk7XG5cbiAgICAvLyBzZXQgbmV3IHNyYyB2YWx1ZSB3aXRoIGEgY2FjaGVidXN0ZXJcbiAgICBzb3VyY2Uuc2V0QXR0cmlidXRlKFwic3JjXCIsIGRhdGEudXJsICsgX3NlcGFyYXRvciArIFwiY2I9XCIgKyBuZXcgRGF0ZSgpLmdldFRpbWUoKSk7XG5cbiAgICB2aWRlby5sb2FkKCk7XG4gIH1cblxuICBmdW5jdGlvbiBfcmVmcmVzaFRpbWVyKGR1cmF0aW9uKSB7XG4gICAgdmFyIHZpZGVvID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJ2aWRlb1wiKTtcblxuICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkge1xuXG4gICAgICBpZiAodmlkZW8gJiYgdmlkZW8ucGF1c2VkICYmIHZpZGVvLmN1cnJlbnRUaW1lIDw9IDApIHtcbiAgICAgICAgLy8gT25seSByZWZyZXNoaW5nIGltbWVkaWF0ZWx5IHdoZW4gaW4gYSBwYXVzZWQgc3RhdGUgYW5kIHRoZSB2aWRlbyBpcyBhdCB0aGUgYmVnaW5uaW5nXG4gICAgICAgIF9yZWZyZXNoKGZhbHNlKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIF9yZWZyZXNoV2FpdGluZyA9IHRydWU7XG4gICAgICB9XG5cbiAgICB9LCBkdXJhdGlvbik7XG4gIH1cblxuICAvKlxuICAgKiAgUHVibGljIE1ldGhvZHNcbiAgICovXG4gIGZ1bmN0aW9uIGluaXQoKSB7XG4gICAgdmFyIHZpZGVvID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJ2aWRlb1wiKSxcbiAgICAgIHN0b3JhZ2UgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcInZpZGVvU3RvcmFnZVwiKSxcbiAgICAgIGZyYWdtZW50ID0gZG9jdW1lbnQuY3JlYXRlRG9jdW1lbnRGcmFnbWVudCgpLFxuICAgICAgc291cmNlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcInNvdXJjZVwiKSxcbiAgICAgIHN0cjtcblxuICAgIGlmICghdmlkZW8gfHwgIXN0b3JhZ2UpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICAvLyB1c2UgZGVmYXVsdCBjb250cm9scyBpZiBub3Qgc2V0IHRvIGF1dG9wbGF5XG4gICAgaWYgKCFkYXRhLnZpZGVvLmF1dG9wbGF5KSB7XG4gICAgICB2aWRlby5zZXRBdHRyaWJ1dGUoXCJjb250cm9sc1wiLCBcIlwiKTtcbiAgICB9XG5cbiAgICAvLyBzZXQgYXBwcm9wcmlhdGUgc2l6aW5nIGNsYXNzIGJhc2VkIG9uIHNjYWxlVG9GaXQgdmFsdWVcbiAgICB2aWRlby5jbGFzc05hbWUgPSBkYXRhLnZpZGVvLnNjYWxlVG9GaXQgPyB2aWRlby5jbGFzc05hbWUgKyBcIiBzY2FsZS10by1maXRcIlxuICAgICAgOiB2aWRlby5jbGFzc05hbWUgKyBcIiBuby1zY2FsZVwiO1xuXG4gICAgLy8gc2V0IGluaXRpYWwgdm9sdW1lIG9uIDx2aWRlbz5cbiAgICB2aWRlby52b2x1bWUgPSBkYXRhLnZpZGVvLnZvbHVtZSAvIDEwMDtcblxuICAgIC8vIHNldCB0aGUgXCJ0eXBlXCIgYXR0cmlidXRlIG9uIDxzb3VyY2U+XG4gICAgc291cmNlLnNldEF0dHJpYnV0ZShcInR5cGVcIiwgXCJ2aWRlby9cIiArIF9nZXRWaWRlb0ZpbGVUeXBlKCkpO1xuXG4gICAgLy8gdmlkZW8gZXZlbnRzXG4gICAgdmlkZW8uYWRkRXZlbnRMaXN0ZW5lcihcImNhbnBsYXl0aHJvdWdoXCIsIF9vbkNhblBsYXlUaHJvdWdoLCBmYWxzZSk7XG4gICAgdmlkZW8uYWRkRXZlbnRMaXN0ZW5lcihcImVuZGVkXCIsIF9vbkVuZGVkLCBmYWxzZSk7XG5cbiAgICBfaXNTdG9yYWdlRmlsZSA9IChPYmplY3Qua2V5cyhkYXRhLnZpZGVvU3RvcmFnZSkubGVuZ3RoICE9PSAwKTtcblxuICAgIGlmICghX2lzU3RvcmFnZUZpbGUpIHtcbiAgICAgIHN0ciA9IGRhdGEudXJsLnNwbGl0KFwiP1wiKTtcblxuICAgICAgLy8gc3RvcmUgdGhpcyBmb3IgdGhlIHJlZnJlc2ggdGltZXJcbiAgICAgIF9zZXBhcmF0b3IgPSAoc3RyLmxlbmd0aCA9PT0gMSkgPyBcIj9cIiA6IFwiJlwiO1xuXG4gICAgICAvLyBOb24gc3RvcmFnZSBVUkxcbiAgICAgIHNvdXJjZS5zZXRBdHRyaWJ1dGUoXCJzcmNcIiwgZGF0YS51cmwpO1xuXG4gICAgICBmcmFnbWVudC5hcHBlbmRDaGlsZChzb3VyY2UpO1xuICAgICAgdmlkZW8uYXBwZW5kQ2hpbGQoZnJhZ21lbnQpO1xuXG4gICAgfSBlbHNlIHtcbiAgICAgIGZyYWdtZW50LmFwcGVuZENoaWxkKHNvdXJjZSk7XG4gICAgICB2aWRlby5hcHBlbmRDaGlsZChmcmFnbWVudCk7XG5cbiAgICAgIC8vIFJpc2UgU3RvcmFnZVxuICAgICAgc3RvcmFnZS5hZGRFdmVudExpc3RlbmVyKFwicmlzZS1zdG9yYWdlLXJlc3BvbnNlXCIsIF9vblJpc2VTdG9yYWdlUmVzcG9uc2UpO1xuXG4gICAgICBzdG9yYWdlLnNldEF0dHJpYnV0ZShcImZvbGRlclwiLCBkYXRhLnZpZGVvU3RvcmFnZS5mb2xkZXIpO1xuICAgICAgc3RvcmFnZS5zZXRBdHRyaWJ1dGUoXCJmaWxlTmFtZVwiLCBkYXRhLnZpZGVvU3RvcmFnZS5maWxlTmFtZSk7XG4gICAgICBzdG9yYWdlLnNldEF0dHJpYnV0ZShcImNvbXBhbnlJZFwiLCBkYXRhLnZpZGVvU3RvcmFnZS5jb21wYW55SWQpO1xuICAgICAgc3RvcmFnZS5nbygpO1xuICAgIH1cbiAgfVxuXG4gIGZ1bmN0aW9uIGlzVmlkZW9QbGF5aW5nKCkge1xuICAgIHZhciB2aWRlbyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwidmlkZW9cIik7XG5cbiAgICByZXR1cm4gKHZpZGVvICYmIHR5cGVvZih2aWRlby5wYXVzZSkgIT09IFwidW5kZWZpbmVkXCIgJiYgIXZpZGVvLnBhdXNlZCAmJiAhdmlkZW8uZW5kZWQpID8gdHJ1ZSA6IGZhbHNlO1xuICB9XG5cbiAgZnVuY3Rpb24gcGF1c2UoKSB7XG4gICAgdmFyIHZpZGVvID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJ2aWRlb1wiKTtcblxuICAgIGlmICh2aWRlbyAmJiB0eXBlb2YodmlkZW8ucGF1c2UpICE9PSBcInVuZGVmaW5lZFwiKSB7XG4gICAgICB2aWRlby5wYXVzZSgpO1xuICAgIH1cblxuICB9XG5cbiAgZnVuY3Rpb24gcGxheSgpIHtcbiAgICB2YXIgdmlkZW8gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcInZpZGVvXCIpO1xuXG4gICAgaWYgKHZpZGVvICYmIHR5cGVvZih2aWRlby5wYXVzZSkgIT09IFwidW5kZWZpbmVkXCIpIHtcbiAgICAgIHZpZGVvLnBsYXkoKTtcbiAgICB9XG5cbiAgfVxuXG4gIHJldHVybiB7XG4gICAgXCJpbml0XCI6IGluaXQsXG4gICAgXCJwYXVzZVwiOiBwYXVzZSxcbiAgICBcInBsYXlcIjogcGxheSxcbiAgICBcImlzVmlkZW9QbGF5aW5nXCI6IGlzVmlkZW9QbGF5aW5nXG4gIH07XG59O1xuXG4vKiBnbG9iYWwgZ2FkZ2V0cywgUmlzZVZpc2lvbiAqL1xuXG4oZnVuY3Rpb24gKHdpbmRvdywgZ2FkZ2V0cykge1xuICBcInVzZSBzdHJpY3RcIjtcblxuICB2YXIgcHJlZnMgPSBuZXcgZ2FkZ2V0cy5QcmVmcygpLFxuICAgIGlkID0gcHJlZnMuZ2V0U3RyaW5nKFwiaWRcIik7XG5cbiAgLy8gRGlzYWJsZSBjb250ZXh0IG1lbnUgKHJpZ2h0IGNsaWNrIG1lbnUpXG4gIHdpbmRvdy5vbmNvbnRleHRtZW51ID0gZnVuY3Rpb24gKCkge1xuICAgIHJldHVybiBmYWxzZTtcbiAgfTtcblxuICBmdW5jdGlvbiBwbGF5KCkge1xuICAgIFJpc2VWaXNpb24uVmlkZW8ucGxheSgpO1xuICB9XG5cbiAgZnVuY3Rpb24gcGF1c2UoKSB7XG4gICAgUmlzZVZpc2lvbi5WaWRlby5wYXVzZSgpO1xuICB9XG5cbiAgZnVuY3Rpb24gc3RvcCgpIHtcbiAgICBSaXNlVmlzaW9uLlZpZGVvLnN0b3AoKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIGFkZGl0aW9uYWxQYXJhbXMobmFtZXMsIHZhbHVlcykge1xuICAgIGlmIChBcnJheS5pc0FycmF5KG5hbWVzKSAmJiBuYW1lcy5sZW5ndGggPiAwICYmIG5hbWVzWzBdID09PSBcImFkZGl0aW9uYWxQYXJhbXNcIikge1xuICAgICAgaWYgKEFycmF5LmlzQXJyYXkodmFsdWVzKSAmJiB2YWx1ZXMubGVuZ3RoID4gMCkge1xuICAgICAgICBSaXNlVmlzaW9uLlZpZGVvLnNldEFkZGl0aW9uYWxQYXJhbXMoSlNPTi5wYXJzZSh2YWx1ZXNbMF0pKTtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICBpZiAoaWQgJiYgaWQgIT09IFwiXCIpIHtcbiAgICBnYWRnZXRzLnJwYy5yZWdpc3RlcihcInJzY21kX3BsYXlfXCIgKyBpZCwgcGxheSk7XG4gICAgZ2FkZ2V0cy5ycGMucmVnaXN0ZXIoXCJyc2NtZF9wYXVzZV9cIiArIGlkLCBwYXVzZSk7XG4gICAgZ2FkZ2V0cy5ycGMucmVnaXN0ZXIoXCJyc2NtZF9zdG9wX1wiICsgaWQsIHN0b3ApO1xuXG4gICAgZ2FkZ2V0cy5ycGMucmVnaXN0ZXIoXCJyc3BhcmFtX3NldF9cIiArIGlkLCBhZGRpdGlvbmFsUGFyYW1zKTtcbiAgICBnYWRnZXRzLnJwYy5jYWxsKFwiXCIsIFwicnNwYXJhbV9nZXRcIiwgbnVsbCwgaWQsIFtcImFkZGl0aW9uYWxQYXJhbXNcIl0pO1xuXG4gIH1cblxufSkod2luZG93LCBnYWRnZXRzKTtcblxuXG5cbi8qIGpzaGludCBpZ25vcmU6c3RhcnQgKi9cbnZhciBfZ2FxID0gX2dhcSB8fCBbXTtcblxuX2dhcS5wdXNoKFsnX3NldEFjY291bnQnLCAnVUEtNTcwOTIxNTktMiddKTtcbl9nYXEucHVzaChbJ190cmFja1BhZ2V2aWV3J10pO1xuXG4oZnVuY3Rpb24oKSB7XG4gIHZhciBnYSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3NjcmlwdCcpOyBnYS50eXBlID0gJ3RleHQvamF2YXNjcmlwdCc7IGdhLmFzeW5jID0gdHJ1ZTtcbiAgZ2Euc3JjID0gKCdodHRwczonID09IGRvY3VtZW50LmxvY2F0aW9uLnByb3RvY29sID8gJ2h0dHBzOi8vc3NsJyA6ICdodHRwOi8vd3d3JykgKyAnLmdvb2dsZS1hbmFseXRpY3MuY29tL2dhLmpzJztcbiAgdmFyIHMgPSBkb2N1bWVudC5nZXRFbGVtZW50c0J5VGFnTmFtZSgnc2NyaXB0JylbMF07IHMucGFyZW50Tm9kZS5pbnNlcnRCZWZvcmUoZ2EsIHMpO1xufSkoKTtcbi8qIGpzaGludCBpZ25vcmU6ZW5kICovXG4iXSwic291cmNlUm9vdCI6Ii9zb3VyY2UvIn0=