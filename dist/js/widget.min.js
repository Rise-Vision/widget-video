if("undefined"==typeof config){var config={};"undefined"!=typeof angular&&(angular.module("risevision.common.i18n.config",[]).constant("LOCALES_PREFIX","components/rv-common-i18n/dist/locales/translation_").constant("LOCALES_SUFIX",".json"),angular.module("risevision.widget.common.storage-selector.config").value("STORAGE_MODAL","http://storage.risevision.com/~rvi/storage-client-rva-test/storage-modal.html#/files/"))}var RiseVision=RiseVision||{};RiseVision.Video={},RiseVision.Video=function(e,i){"use strict";function t(){i.rpc.call("","rsevent_ready",null,u.getString("id"),!0,!0,!0,!0,!0)}function n(){p=new RiseVision.Video.Player(l,g),p.init()}function o(){p.pause(),y=!0}function a(){p.isInitialPlay()?l.video.autoplay&&p.play():y&&(p.play(),y=!1)}function s(){e.getElementById("videoContainer").style.visibility="visible",t()}function r(e){g=e}function d(t){u=new i.Prefs,l=t,e.getElementById("videoContainer").style.height=u.getInt("rsH")+"px",m=new RiseVision.Video.Background(l,g),m.init()}function c(){}var u=null,l={},g=null,m=null,p=null,y=!1;return{backgroundReady:n,pause:o,play:a,setCompanyId:r,setAdditionalParams:d,playerReady:s,stop:c}}(document,gadgets);var RiseVision=RiseVision||{};RiseVision.Video=RiseVision.Video||{},RiseVision.Video.Background=function(e,i){"use strict";function t(){var t=document.getElementById("background"),n=document.getElementById("backgroundStorage");document.body.style.background=e.background.color,e.background.useImage?(t.className=e.background.image.position,t.className=e.background.image.scale?t.className+" scale-to-fit":t.className,0===Object.keys(e.backgroundStorage).length?(t.style.backgroundImage="url("+e.background.image.url+")",RiseVision.Video.backgroundReady()):(n.addEventListener("rise-storage-response",function(e){t.style.backgroundImage="url("+e.detail[0]+")",RiseVision.Video.backgroundReady()}),n.setAttribute("folder",e.backgroundStorage.folder),n.setAttribute("fileName",e.backgroundStorage.fileName),n.setAttribute("companyId",i),n.go())):RiseVision.Video.backgroundReady()}return{init:t}};var RiseVision=RiseVision||{};RiseVision.Video=RiseVision.Video||{},RiseVision.Video.Player=function(e,i){"use strict";function t(){return r}function n(){var t=document.getElementById("videoStorage"),n=document.createDocumentFragment(),o=n.appendChild(document.createElement("source")),a=document.createAttribute("src"),r=document.createAttribute("type");s.volume=e.video.volume/100,r.value="video/webm",o.setAttributeNode(r),s.addEventListener("loadeddata",function(){RiseVision.Video.playerReady()},!1),0===Object.keys(e.videoStorage).length?(a.value=e.url,o.setAttributeNode(a),s.appendChild(n)):(t.addEventListener("rise-storage-response",function(e){a.value=e.detail[0],o.setAttributeNode(a),s.appendChild(n)}),t.setAttribute("folder",e.videoStorage.folder),t.setAttribute("fileName",e.videoStorage.fileName),t.setAttribute("companyId",i),t.go())}function o(){s.pause()}function a(){s.play(),r&&(r=!1)}var s=document.getElementById("video"),r=!0;return{isInitialPlay:t,init:n,pause:o,play:a}},function(e,i){"use strict";function t(){RiseVision.Video.play()}function n(){RiseVision.Video.pause()}function o(){RiseVision.Video.stop()}function a(e,i){Array.isArray(e)&&e.length>0&&"additionalParams"===e[0]&&Array.isArray(i)&&i.length>0&&RiseVision.Video.setAdditionalParams(JSON.parse(i[0]))}function s(e,t){e&&"companyId"===e&&RiseVision.Video.setCompanyId(t),i.rpc.register("rsparam_set_"+d,a),i.rpc.call("","rsparam_get",null,d,["additionalParams"])}var r=new i.Prefs,d=r.getString("id");e.oncontextmenu=function(){return!1},d&&""!==d&&(i.rpc.register("rscmd_play_"+d,t),i.rpc.register("rscmd_pause_"+d,n),i.rpc.register("rscmd_stop_"+d,o),i.rpc.register("rsparam_set_"+d,s),i.rpc.call("","rsparam_get",null,d,"companyId"))}(window,gadgets);var _gaq=_gaq||[];_gaq.push(["_setAccount","UA-57092159-2"]),_gaq.push(["_trackPageview"]),function(){var e=document.createElement("script");e.type="text/javascript",e.async=!0,e.src=("https:"==document.location.protocol?"https://ssl":"http://www")+".google-analytics.com/ga.js";var i=document.getElementsByTagName("script")[0];i.parentNode.insertBefore(e,i)}();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImpzL3dpZGdldC5taW4uanMiXSwibmFtZXMiOlsiY29uZmlnIiwiYW5ndWxhciIsIm1vZHVsZSIsImNvbnN0YW50IiwidmFsdWUiLCJSaXNlVmlzaW9uIiwiVmlkZW8iLCJkb2N1bWVudCIsImdhZGdldHMiLCJfcmVhZHkiLCJycGMiLCJjYWxsIiwiX3ByZWZzIiwiZ2V0U3RyaW5nIiwiYmFja2dyb3VuZFJlYWR5IiwiX3BsYXllciIsIlBsYXllciIsIl9hZGRpdGlvbmFsUGFyYW1zIiwiX2NvbXBhbnlJZCIsImluaXQiLCJwYXVzZSIsIl92aWV3ZXJQYXVzZWQiLCJwbGF5IiwiaXNJbml0aWFsUGxheSIsInZpZGVvIiwiYXV0b3BsYXkiLCJwbGF5ZXJSZWFkeSIsImdldEVsZW1lbnRCeUlkIiwic3R5bGUiLCJ2aXNpYmlsaXR5Iiwic2V0Q29tcGFueUlkIiwic2V0QWRkaXRpb25hbFBhcmFtcyIsInBhcmFtcyIsIlByZWZzIiwiaGVpZ2h0IiwiZ2V0SW50IiwiX2JhY2tncm91bmQiLCJCYWNrZ3JvdW5kIiwic3RvcCIsImRhdGEiLCJjb21wYW55SWQiLCJiYWNrZ3JvdW5kIiwic3RvcmFnZSIsImJvZHkiLCJjb2xvciIsInVzZUltYWdlIiwiY2xhc3NOYW1lIiwiaW1hZ2UiLCJwb3NpdGlvbiIsInNjYWxlIiwiT2JqZWN0Iiwia2V5cyIsImJhY2tncm91bmRTdG9yYWdlIiwibGVuZ3RoIiwiYmFja2dyb3VuZEltYWdlIiwidXJsIiwiYWRkRXZlbnRMaXN0ZW5lciIsImUiLCJkZXRhaWwiLCJzZXRBdHRyaWJ1dGUiLCJmb2xkZXIiLCJmaWxlTmFtZSIsImdvIiwiX2luaXRpYWxQbGF5IiwiZnJhZ21lbnQiLCJjcmVhdGVEb2N1bWVudEZyYWdtZW50Iiwic291cmNlIiwiYXBwZW5kQ2hpbGQiLCJjcmVhdGVFbGVtZW50Iiwic3JjQXR0ciIsImNyZWF0ZUF0dHJpYnV0ZSIsInR5cGVBdHRyIiwiX3ZpZGVvIiwidm9sdW1lIiwic2V0QXR0cmlidXRlTm9kZSIsInZpZGVvU3RvcmFnZSIsIndpbmRvdyIsImFkZGl0aW9uYWxQYXJhbXMiLCJuYW1lcyIsInZhbHVlcyIsIkFycmF5IiwiaXNBcnJheSIsIkpTT04iLCJwYXJzZSIsIm5hbWUiLCJyZWdpc3RlciIsImlkIiwicHJlZnMiLCJvbmNvbnRleHRtZW51IiwiX2dhcSIsInB1c2giLCJnYSIsInR5cGUiLCJhc3luYyIsInNyYyIsImxvY2F0aW9uIiwicHJvdG9jb2wiLCJzIiwiZ2V0RWxlbWVudHNCeVRhZ05hbWUiLCJwYXJlbnROb2RlIiwiaW5zZXJ0QmVmb3JlIl0sIm1hcHBpbmdzIjoiQUFFQSxHQUFzQixtQkFBWEEsUUFBd0IsQ0FDakMsR0FBSUEsVUFJbUIsb0JBQVpDLFdBQ1RBLFFBQVFDLE9BQU8sb0NBQ1pDLFNBQVMsaUJBQWtCLHVEQUMzQkEsU0FBUyxnQkFBaUIsU0FFN0JGLFFBQVFDLE9BQU8sb0RBQ1pFLE1BQU0sZ0JBQWlCLDBGQU05QixHQUFJQyxZQUFhQSxjQUNqQkEsWUFBV0MsU0FFWEQsV0FBV0MsTUFBUSxTQUFXQyxFQUFVQyxHQUN0QyxZQVlBLFNBQVNDLEtBQ1BELEVBQVFFLElBQUlDLEtBQUssR0FBSSxnQkFBaUIsS0FBTUMsRUFBT0MsVUFBVSxPQUMzRCxHQUFNLEdBQU0sR0FBTSxHQUFNLEdBTTVCLFFBQVNDLEtBQ1BDLEVBQVUsR0FBSVYsWUFBV0MsTUFBTVUsT0FBT0MsRUFBbUJDLEdBQ3pESCxFQUFRSSxPQUdWLFFBQVNDLEtBQ1BMLEVBQVFLLFFBQ1JDLEdBQWdCLEVBR2xCLFFBQVNDLEtBQ0hQLEVBQVFRLGdCQUVOTixFQUFrQk8sTUFBTUMsVUFDMUJWLEVBQVFPLE9BR05ELElBQ0ZOLEVBQVFPLE9BQ1JELEdBQWdCLEdBS3RCLFFBQVNLLEtBRVBuQixFQUFTb0IsZUFBZSxrQkFBa0JDLE1BQU1DLFdBQWEsVUFFN0RwQixJQUdGLFFBQVNxQixHQUFhMUIsR0FDcEJjLEVBQWFkLEVBR2YsUUFBUzJCLEdBQW9CQyxHQUMzQnBCLEVBQVMsR0FBSUosR0FBUXlCLE1BQ3JCaEIs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LE9BQVFwRSxRQUtYLElBQUlpRixNQUFPQSxRQUVYQSxNQUFLQyxNQUFNLGNBQWUsa0JBQzFCRCxLQUFLQyxNQUFNLG1CQUVYLFdBQ0UsR0FBSUMsR0FBS3BGLFNBQVM2RCxjQUFjLFNBQVd1QixHQUFHQyxLQUFPLGtCQUFtQkQsRUFBR0UsT0FBUSxFQUNuRkYsRUFBR0csS0FBTyxVQUFZdkYsU0FBU3dGLFNBQVNDLFNBQVcsY0FBZ0IsY0FBZ0IsNkJBQ25GLElBQUlDLEdBQUkxRixTQUFTMkYscUJBQXFCLFVBQVUsRUFBSUQsR0FBRUUsV0FBV0MsYUFBYVQsRUFBSU0iLCJmaWxlIjoianMvd2lkZ2V0Lm1pbi5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8qIGdsb2JhbCBjb25maWc6IHRydWUgKi9cbi8qIGV4cG9ydGVkIGNvbmZpZyAqL1xuaWYgKHR5cGVvZiBjb25maWcgPT09IFwidW5kZWZpbmVkXCIpIHtcbiAgdmFyIGNvbmZpZyA9IHtcbiAgICAvLyB2YXJpYWJsZXMgZ28gaGVyZVxuICB9O1xuXG4gIGlmICh0eXBlb2YgYW5ndWxhciAhPT0gXCJ1bmRlZmluZWRcIikge1xuICAgIGFuZ3VsYXIubW9kdWxlKFwicmlzZXZpc2lvbi5jb21tb24uaTE4bi5jb25maWdcIiwgW10pXG4gICAgICAuY29uc3RhbnQoXCJMT0NBTEVTX1BSRUZJWFwiLCBcImNvbXBvbmVudHMvcnYtY29tbW9uLWkxOG4vZGlzdC9sb2NhbGVzL3RyYW5zbGF0aW9uX1wiKVxuICAgICAgLmNvbnN0YW50KFwiTE9DQUxFU19TVUZJWFwiLCBcIi5qc29uXCIpO1xuXG4gICAgYW5ndWxhci5tb2R1bGUoXCJyaXNldmlzaW9uLndpZGdldC5jb21tb24uc3RvcmFnZS1zZWxlY3Rvci5jb25maWdcIilcbiAgICAgIC52YWx1ZShcIlNUT1JBR0VfTU9EQUxcIiwgXCJodHRwOi8vc3RvcmFnZS5yaXNldmlzaW9uLmNvbS9+cnZpL3N0b3JhZ2UtY2xpZW50LXJ2YS10ZXN0L3N0b3JhZ2UtbW9kYWwuaHRtbCMvZmlsZXMvXCIpO1xuICB9XG59XG5cbi8qIGdsb2JhbCBnYWRnZXRzICovXG5cbnZhciBSaXNlVmlzaW9uID0gUmlzZVZpc2lvbiB8fCB7fTtcblJpc2VWaXNpb24uVmlkZW8gPSB7fTtcblxuUmlzZVZpc2lvbi5WaWRlbyA9IChmdW5jdGlvbiAoZG9jdW1lbnQsIGdhZGdldHMpIHtcbiAgXCJ1c2Ugc3RyaWN0XCI7XG5cbiAgdmFyIF9wcmVmcyA9IG51bGwsXG4gICAgX2FkZGl0aW9uYWxQYXJhbXMgPSB7fSxcbiAgICBfY29tcGFueUlkID0gbnVsbCxcbiAgICBfYmFja2dyb3VuZCA9IG51bGwsXG4gICAgX3BsYXllciA9IG51bGwsXG4gICAgX3ZpZXdlclBhdXNlZCA9IGZhbHNlO1xuXG4gIC8qXG4gICAqICBQcml2YXRlIE1ldGhvZHNcbiAgICovXG4gIGZ1bmN0aW9uIF9yZWFkeSgpIHtcbiAgICBnYWRnZXRzLnJwYy5jYWxsKFwiXCIsIFwicnNldmVudF9yZWFkeVwiLCBudWxsLCBfcHJlZnMuZ2V0U3RyaW5nKFwiaWRcIiksXG4gICAgICB0cnVlLCB0cnVlLCB0cnVlLCB0cnVlLCB0cnVlKTtcbiAgfVxuXG4gIC8qXG4gICAqICBQdWJsaWMgTWV0aG9kc1xuICAgKi9cbiAgZnVuY3Rpb24gYmFja2dyb3VuZFJlYWR5KCkge1xuICAgIF9wbGF5ZXIgPSBuZXcgUmlzZVZpc2lvbi5WaWRlby5QbGF5ZXIoX2FkZGl0aW9uYWxQYXJhbXMsIF9jb21wYW55SWQpO1xuICAgIF9wbGF5ZXIuaW5pdCgpO1xuICB9XG5cbiAgZnVuY3Rpb24gcGF1c2UoKSB7XG4gICAgX3BsYXllci5wYXVzZSgpO1xuICAgIF92aWV3ZXJQYXVzZWQgPSB0cnVlO1xuICB9XG5cbiAgZnVuY3Rpb24gcGxheSgpIHtcbiAgICBpZiAoX3BsYXllci5pc0luaXRpYWxQbGF5KCkpIHtcbiAgICAgIC8vIFwiYXV0b3BsYXlcIiB3YXMgc2VsZWN0ZWQgaW4gc2V0dGluZ3NcbiAgICAgIGlmIChfYWRkaXRpb25hbFBhcmFtcy52aWRlby5hdXRvcGxheSkge1xuICAgICAgICBfcGxheWVyLnBsYXkoKTtcbiAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgaWYgKF92aWV3ZXJQYXVzZWQpIHtcbiAgICAgICAgX3BsYXllci5wbGF5KCk7XG4gICAgICAgIF92aWV3ZXJQYXVzZWQgPSBmYWxzZTtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICBmdW5jdGlvbiBwbGF5ZXJSZWFkeSgpIHtcbiAgICAvLyBTaG93IHRoZSB2aWRlbyBwbGF5ZXJcbiAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcInZpZGVvQ29udGFpbmVyXCIpLnN0eWxlLnZpc2liaWxpdHkgPSBcInZpc2libGVcIjtcblxuICAgIF9yZWFkeSgpO1xuICB9XG5cbiAgZnVuY3Rpb24gc2V0Q29tcGFueUlkKHZhbHVlKSB7XG4gICAgX2NvbXBhbnlJZCA9IHZhbHVlO1xuICB9XG5cbiAgZnVuY3Rpb24gc2V0QWRkaXRpb25hbFBhcmFtcyhwYXJhbXMpIHtcbiAgICBfcHJlZnMgPSBuZXcgZ2FkZ2V0cy5QcmVmcygpO1xuICAgIF9hZGRpdGlvbmFsUGFyYW1zID0gcGFyYW1zO1xuXG4gICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJ2aWRlb0NvbnRhaW5lclwiKS5zdHlsZS5oZWlnaHQgPSBfcHJlZnMuZ2V0SW50KFwicnNIXCIpICsgXCJweFwiO1xuXG4gICAgLy8gY3JlYXRlIG5ldyBCYWNrZ3JvdW5kIGluc3RhbmNlXG4gICAgX2JhY2tncm91bmQgPSBuZXcgUmlzZVZpc2lvbi5WaWRlby5CYWNrZ3JvdW5kKF9hZGRpdGlvbmFsUGFyYW1zLCBfY29tcGFueUlkKTtcbiAgICBfYmFja2dyb3VuZC5pbml0KCk7XG4gIH1cblxuICBmdW5jdGlvbiBzdG9wKCkge1xuICAgIC8vIFRPRE86IG5lZWQgYSByZXNldCBvbiBvbiB0aGUgcGxheWVyXG4gIH1cblxuICByZXR1cm4ge1xuICAgIFwiYmFja2dyb3VuZFJlYWR5XCI6IGJhY2tncm91bmRSZWFkeSxcbiAgICBcInBhdXNlXCI6IHBhdXNlLFxuICAgIFwicGxheVwiOiBwbGF5LFxuICAgIFwic2V0Q29tcGFueUlkXCI6IHNldENvbXBhbnlJZCxcbiAgICBcInNldEFkZGl0aW9uYWxQYXJhbXNcIjogc2V0QWRkaXRpb25hbFBhcmFtcyxcbiAgICBcInBsYXllclJlYWR5XCI6IHBsYXllclJlYWR5LFxuICAgIFwic3RvcFwiOiBzdG9wXG4gIH07XG5cbn0pKGRvY3VtZW50LCBnYWRnZXRzKTtcblxudmFyIFJpc2VWaXNpb24gPSBSaXNlVmlzaW9uIHx8IHt9O1xuUmlzZVZpc2lvbi5WaWRlbyA9IFJpc2VWaXNpb24uVmlkZW8gfHwge307XG5cblJpc2VWaXNpb24uVmlkZW8uQmFja2dyb3VuZCA9IGZ1bmN0aW9uIChkYXRhLCBjb21wYW55SWQpIHtcbiAgXCJ1c2Ugc3RyaWN0XCI7XG5cbiAgLypcbiAgICogIFB1YmxpYyBNZXRob2RzXG4gICAqL1xuICBmdW5jdGlvbiBpbml0KCkge1xuICAgIHZhciBiYWNrZ3JvdW5kID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJiYWNrZ3JvdW5kXCIpLFxuICAgICAgc3RvcmFnZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwiYmFja2dyb3VuZFN0b3JhZ2VcIik7XG5cbiAgICAvLyBzZXQgdGhlIGRvY3VtZW50IGJhY2tncm91bmRcbiAgICBkb2N1bWVudC5ib2R5LnN0eWxlLmJhY2tncm91bmQgPSBkYXRhLmJhY2tncm91bmQuY29sb3I7XG5cbiAgICBpZiAoZGF0YS5iYWNrZ3JvdW5kLnVzZUltYWdlKSB7XG4gICAgICBiYWNrZ3JvdW5kLmNsYXNzTmFtZSA9IGRhdGEuYmFja2dyb3VuZC5pbWFnZS5wb3NpdGlvbjtcbiAgICAgIGJhY2tncm91bmQuY2xhc3NOYW1lID0gZGF0YS5iYWNrZ3JvdW5kLmltYWdlLnNjYWxlID8gYmFja2dyb3VuZC5jbGFzc05hbWUgKyBcIiBzY2FsZS10by1maXRcIlxuICAgICAgICA6IGJhY2tncm91bmQuY2xhc3NOYW1lO1xuXG4gICAgICBpZiAoT2JqZWN0LmtleXMoZGF0YS5iYWNrZ3JvdW5kU3RvcmFnZSkubGVuZ3RoID09PSAwKSB7XG4gICAgICAgIGJhY2tncm91bmQuc3R5bGUuYmFja2dyb3VuZEltYWdlID0gXCJ1cmwoXCIgKyBkYXRhLmJhY2tncm91bmQuaW1hZ2UudXJsICsgXCIpXCI7XG4gICAgICAgIFJpc2VWaXNpb24uVmlkZW8uYmFja2dyb3VuZFJlYWR5KCk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICAvLyBSaXNlIFN0b3JhZ2VcbiAgICAgICAgc3RvcmFnZS5hZGRFdmVudExpc3RlbmVyKFwicmlzZS1zdG9yYWdlLXJlc3BvbnNlXCIsIGZ1bmN0aW9uKGUpIHtcbiAgICAgICAgICBiYWNrZ3JvdW5kLnN0eWxlLmJhY2tncm91bmRJbWFnZSA9IFwidXJsKFwiICsgZS5kZXRhaWxbMF0gKyBcIilcIjtcbiAgICAgICAgICBSaXNlVmlzaW9uLlZpZGVvLmJhY2tncm91bmRSZWFkeSgpO1xuICAgICAgICB9KTtcblxuICAgICAgICBzdG9yYWdlLnNldEF0dHJpYnV0ZShcImZvbGRlclwiLCBkYXRhLmJhY2tncm91bmRTdG9yYWdlLmZvbGRlcik7XG4gICAgICAgIHN0b3JhZ2Uuc2V0QXR0cmlidXRlKFwiZmlsZU5hbWVcIiwgZGF0YS5iYWNrZ3JvdW5kU3RvcmFnZS5maWxlTmFtZSk7XG4gICAgICAgIHN0b3JhZ2Uuc2V0QXR0cmlidXRlKFwiY29tcGFueUlkXCIsIGNvbXBhbnlJZCk7XG4gICAgICAgIHN0b3JhZ2UuZ28oKTtcbiAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgUmlzZVZpc2lvbi5WaWRlby5iYWNrZ3JvdW5kUmVhZHkoKTtcbiAgICB9XG4gIH1cblxuICByZXR1cm4ge1xuICAgIFwiaW5pdFwiOiBpbml0XG4gIH07XG59O1xuXG52YXIgUmlzZVZpc2lvbiA9IFJpc2VWaXNpb24gfHwge307XG5SaXNlVmlzaW9uLlZpZGVvID0gUmlzZVZpc2lvbi5WaWRlbyB8fCB7fTtcblxuUmlzZVZpc2lvbi5WaWRlby5QbGF5ZXIgPSBmdW5jdGlvbiAoZGF0YSwgY29tcGFueUlkKSB7XG4gIFwidXNlIHN0cmljdFwiO1xuXG4gIHZhciBfdmlkZW8gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcInZpZGVvXCIpLFxuICAgIF9pbml0aWFsUGxheSA9IHRydWU7XG5cbiAgLypcbiAgICogIFB1YmxpYyBNZXRob2RzXG4gICAqL1xuICBmdW5jdGlvbiBpc0luaXRpYWxQbGF5KCkge1xuICAgIHJldHVybiBfaW5pdGlhbFBsYXk7XG4gIH1cblxuICBmdW5jdGlvbiBpbml0KCkge1xuICAgIHZhciBzdG9yYWdlID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJ2aWRlb1N0b3JhZ2VcIiksXG4gICAgICBmcmFnbWVudCA9IGRvY3VtZW50LmNyZWF0ZURvY3VtZW50RnJhZ21lbnQoKSxcbiAgICAgIHNvdXJjZSA9IGZyYWdtZW50LmFwcGVuZENoaWxkKGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJzb3VyY2VcIikpLFxuICAgICAgc3JjQXR0ciA9IGRvY3VtZW50LmNyZWF0ZUF0dHJpYnV0ZShcInNyY1wiKSxcbiAgICAgIHR5cGVBdHRyID0gZG9jdW1lbnQuY3JlYXRlQXR0cmlidXRlKFwidHlwZVwiKTtcblxuICAgIC8vIHNldCBpbml0aWFsIHZvbHVtZSBvbiA8dmlkZW8+XG4gICAgX3ZpZGVvLnZvbHVtZSA9IGRhdGEudmlkZW8udm9sdW1lLzEwMDtcblxuICAgIC8vIHNldCB0aGUgXCJ0eXBlXCIgYXR0cmlidXRlIG9uIDxzb3VyY2U+XG4gICAgdHlwZUF0dHIudmFsdWUgPSBcInZpZGVvL3dlYm1cIjtcbiAgICBzb3VyY2Uuc2V0QXR0cmlidXRlTm9kZSh0eXBlQXR0cik7XG5cbiAgICAvLyBsaXN0ZW4gZm9yIHZpZGVvIGRhdGEgbG9hZGVkXG4gICAgX3ZpZGVvLmFkZEV2ZW50TGlzdGVuZXIoXCJsb2FkZWRkYXRhXCIsIGZ1bmN0aW9uKCkge1xuICAgICAgUmlzZVZpc2lvbi5WaWRlby5wbGF5ZXJSZWFkeSgpO1xuICAgIH0sIGZhbHNlKTtcblxuICAgIGlmIChPYmplY3Qua2V5cyhkYXRhLnZpZGVvU3RvcmFnZSkubGVuZ3RoID09PSAwKSB7XG4gICAgICAvLyBOb24gc3RvcmFnZSBVUkxcbiAgICAgIHNyY0F0dHIudmFsdWUgPSBkYXRhLnVybDtcbiAgICAgIHNvdXJjZS5zZXRBdHRyaWJ1dGVOb2RlKHNyY0F0dHIpO1xuICAgICAgX3ZpZGVvLmFwcGVuZENoaWxkKGZyYWdtZW50KTtcblxuICAgIH0gZWxzZSB7XG4gICAgICAvLyBSaXNlIFN0b3JhZ2VcbiAgICAgIHN0b3JhZ2UuYWRkRXZlbnRMaXN0ZW5lcihcInJpc2Utc3RvcmFnZS1yZXNwb25zZVwiLCBmdW5jdGlvbihlKSB7XG4gICAgICAgIHNyY0F0dHIudmFsdWUgPSBlLmRldGFpbFswXTtcbiAgICAgICAgc291cmNlLnNldEF0dHJpYnV0ZU5vZGUoc3JjQXR0cik7XG4gICAgICAgIF92aWRlby5hcHBlbmRDaGlsZChmcmFnbWVudCk7XG4gICAgICB9KTtcblxuICAgICAgc3RvcmFnZS5zZXRBdHRyaWJ1dGUoXCJmb2xkZXJcIiwgZGF0YS52aWRlb1N0b3JhZ2UuZm9sZGVyKTtcbiAgICAgIHN0b3JhZ2Uuc2V0QXR0cmlidXRlKFwiZmlsZU5hbWVcIiwgZGF0YS52aWRlb1N0b3JhZ2UuZmlsZU5hbWUpO1xuICAgICAgc3RvcmFnZS5zZXRBdHRyaWJ1dGUoXCJjb21wYW55SWRcIiwgY29tcGFueUlkKTtcbiAgICAgIHN0b3JhZ2UuZ28oKTtcbiAgICB9XG4gIH1cblxuICBmdW5jdGlvbiBwYXVzZSgpIHtcbiAgICBfdmlkZW8ucGF1c2UoKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIHBsYXkoKSB7XG4gICAgX3ZpZGVvLnBsYXkoKTtcblxuICAgIGlmIChfaW5pdGlhbFBsYXkpIHtcbiAgICAgIF9pbml0aWFsUGxheSA9IGZhbHNlO1xuICAgIH1cbiAgfVxuXG4gIHJldHVybiB7XG4gICAgXCJpc0luaXRpYWxQbGF5XCI6IGlzSW5pdGlhbFBsYXksXG4gICAgXCJpbml0XCI6IGluaXQsXG4gICAgXCJwYXVzZVwiOiBwYXVzZSxcbiAgICBcInBsYXlcIjogcGxheVxuICB9O1xufTtcblxuLyogZ2xvYmFsIGdhZGdldHMsIFJpc2VWaXNpb24gKi9cblxuKGZ1bmN0aW9uICh3aW5kb3csIGdhZGdldHMpIHtcbiAgXCJ1c2Ugc3RyaWN0XCI7XG5cbiAgdmFyIHByZWZzID0gbmV3IGdhZGdldHMuUHJlZnMoKSxcbiAgICBpZCA9IHByZWZzLmdldFN0cmluZyhcImlkXCIpO1xuXG4gIC8vIERpc2FibGUgY29udGV4dCBtZW51IChyaWdodCBjbGljayBtZW51KVxuICB3aW5kb3cub25jb250ZXh0bWVudSA9IGZ1bmN0aW9uICgpIHtcbiAgICByZXR1cm4gZmFsc2U7XG4gIH07XG5cbiAgZnVuY3Rpb24gcGxheSgpIHtcbiAgICBSaXNlVmlzaW9uLlZpZGVvLnBsYXkoKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIHBhdXNlKCkge1xuICAgIFJpc2VWaXNpb24uVmlkZW8ucGF1c2UoKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIHN0b3AoKSB7XG4gICAgUmlzZVZpc2lvbi5WaWRlby5zdG9wKCk7XG4gIH1cblxuICBmdW5jdGlvbiBhZGRpdGlvbmFsUGFyYW1zKG5hbWVzLCB2YWx1ZXMpIHtcbiAgICBpZiAoQXJyYXkuaXNBcnJheShuYW1lcykgJiYgbmFtZXMubGVuZ3RoID4gMCAmJiBuYW1lc1swXSA9PT0gXCJhZGRpdGlvbmFsUGFyYW1zXCIpIHtcbiAgICAgIGlmIChBcnJheS5pc0FycmF5KHZhbHVlcykgJiYgdmFsdWVzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgUmlzZVZpc2lvbi5WaWRlby5zZXRBZGRpdGlvbmFsUGFyYW1zKEpTT04ucGFyc2UodmFsdWVzWzBdKSk7XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgZnVuY3Rpb24gY29tcGFueUlkKG5hbWUsIHZhbHVlKSB7XG4gICAgaWYgKG5hbWUgJiYgbmFtZSA9PT0gXCJjb21wYW55SWRcIikge1xuICAgICAgUmlzZVZpc2lvbi5WaWRlby5zZXRDb21wYW55SWQodmFsdWUpO1xuICAgIH1cblxuICAgIGdhZGdldHMucnBjLnJlZ2lzdGVyKFwicnNwYXJhbV9zZXRfXCIgKyBpZCwgYWRkaXRpb25hbFBhcmFtcyk7XG4gICAgZ2FkZ2V0cy5ycGMuY2FsbChcIlwiLCBcInJzcGFyYW1fZ2V0XCIsIG51bGwsIGlkLCBbXCJhZGRpdGlvbmFsUGFyYW1zXCJdKTtcbiAgfVxuXG4gIGlmIChpZCAmJiBpZCAhPT0gXCJcIikge1xuICAgIGdhZGdldHMucnBjLnJlZ2lzdGVyKFwicnNjbWRfcGxheV9cIiArIGlkLCBwbGF5KTtcbiAgICBnYWRnZXRzLnJwYy5yZWdpc3RlcihcInJzY21kX3BhdXNlX1wiICsgaWQsIHBhdXNlKTtcbiAgICBnYWRnZXRzLnJwYy5yZWdpc3RlcihcInJzY21kX3N0b3BfXCIgKyBpZCwgc3RvcCk7XG4gICAgZ2FkZ2V0cy5ycGMucmVnaXN0ZXIoXCJyc3BhcmFtX3NldF9cIiArIGlkLCBjb21wYW55SWQpO1xuXG4gICAgZ2FkZ2V0cy5ycGMuY2FsbChcIlwiLCBcInJzcGFyYW1fZ2V0XCIsIG51bGwsIGlkLCBcImNvbXBhbnlJZFwiKTtcblxuICB9XG5cbn0pKHdpbmRvdywgZ2FkZ2V0cyk7XG5cblxuXG4vKiBqc2hpbnQgaWdub3JlOnN0YXJ0ICovXG52YXIgX2dhcSA9IF9nYXEgfHwgW107XG5cbl9nYXEucHVzaChbJ19zZXRBY2NvdW50JywgJ1VBLTU3MDkyMTU5LTInXSk7XG5fZ2FxLnB1c2goWydfdHJhY2tQYWdldmlldyddKTtcblxuKGZ1bmN0aW9uKCkge1xuICB2YXIgZ2EgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdzY3JpcHQnKTsgZ2EudHlwZSA9ICd0ZXh0L2phdmFzY3JpcHQnOyBnYS5hc3luYyA9IHRydWU7XG4gIGdhLnNyYyA9ICgnaHR0cHM6JyA9PSBkb2N1bWVudC5sb2NhdGlvbi5wcm90b2NvbCA/ICdodHRwczovL3NzbCcgOiAnaHR0cDovL3d3dycpICsgJy5nb29nbGUtYW5hbHl0aWNzLmNvbS9nYS5qcyc7XG4gIHZhciBzID0gZG9jdW1lbnQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoJ3NjcmlwdCcpWzBdOyBzLnBhcmVudE5vZGUuaW5zZXJ0QmVmb3JlKGdhLCBzKTtcbn0pKCk7XG4vKiBqc2hpbnQgaWdub3JlOmVuZCAqL1xuIl0sInNvdXJjZVJvb3QiOiIvc291cmNlLyJ9