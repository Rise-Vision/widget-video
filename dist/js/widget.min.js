if("undefined"==typeof config){var config={};"undefined"!=typeof angular&&(angular.module("risevision.common.i18n.config",[]).constant("LOCALES_PREFIX","components/rv-common-i18n/dist/locales/translation_").constant("LOCALES_SUFIX",".json"),angular.module("risevision.widget.common.storage-selector.config").value("STORAGE_MODAL","http://storage.risevision.com/~rvi/storage-client-rva-test/storage-modal.html#/files/"))}var RiseVision=RiseVision||{};RiseVision.Video={},RiseVision.Video=function(e,t){"use strict";function n(){t.rpc.call("","rsevent_done",null,g.getString("id"))}function i(){t.rpc.call("","rsevent_ready",null,g.getString("id"),!0,!0,!0,!0,!0)}function o(){v=new RiseVision.Video.Player(m,p),v.init()}function a(){v.pause()}function s(){v.isInitialPlay()?m.video.autoplay&&v.play():v.userPaused()||v.play()}function r(){i()}function d(e){p=e}function u(n){g=new t.Prefs,m=n,e.getElementById("videoContainer").style.height=g.getInt("rsH")+"px",f=new RiseVision.Common.Background(m,p),f.init(o)}function c(){a()}function l(){n()}var g=null,m={},p=null,f=null,v=null;return{pause:a,play:s,setCompanyId:d,setAdditionalParams:u,playerReady:r,stop:c,videoEnded:l}}(document,gadgets);var RiseVision=RiseVision||{};RiseVision.Common=RiseVision.Common||{},RiseVision.Common.Background=function(e,t){"use strict";function n(){r=!0,s&&"function"==typeof s&&s()}function i(e){u.removeEventListener("rise-storage-response",i),d.style.backgroundImage=Array.isArray(e.detail)?"url("+e.detail[0]+")":"url("+e.detail+")",n()}function o(){d=document.getElementById("background"),u=document.getElementById("backgroundStorage"),document.body.style.background=e.background.color,d?e.background.useImage?(d.className=e.background.image.position,d.className=e.background.image.scale?d.className+" scale-to-fit":d.className,0===Object.keys(e.backgroundStorage).length?(d.style.backgroundImage="url("+e.background.image.url+")",n()):u?(u.addEventListener("rise-storage-response",i),u.setAttribute("folder",e.backgroundStorage.folder),u.setAttribute("fileName",e.backgroundStorage.fileName),u.setAttribute("companyId",t),u.go()):console.log("Missing element with id value of 'backgroundStorage'")):n():console.log("Missing element with id value of 'background'")}function a(e){r?e&&"function"==typeof e&&e():(e&&(s=e),o())}var s=null,r=!1,d=null,u=null;return{init:a}};var RiseVision=RiseVision||{};RiseVision.Video=RiseVision.Video||{},RiseVision.Video.Player=function(e,t){"use strict";function n(){var t=e.url.substr(e.url.lastIndexOf(".")+1);return"ogv"===t&&(t="ogg"),t}function i(){p.style.visibility="visible",m.removeEventListener("loadeddata",i,!1)}function o(){RiseVision.Video.playerReady(),m.removeEventListener("canplay",o,!1)}function a(){v=!1,RiseVision.Video.videoEnded()}function s(){v=!y}function r(){f=!1,v=!1}function d(){return f}function u(){var d=document.getElementById("videoStorage"),u=document.createDocumentFragment(),c=u.appendChild(document.createElement("source")),l=document.createAttribute("src"),g=document.createAttribute("type");m.volume=e.video.volume/100,g.value="video/"+n(),c.setAttributeNode(g),m.addEventListener("loadeddata",i,!1),m.addEventListener("canplay",o,!1),m.addEventListener("ended",a,!1),m.addEventListener("pause",s,!1),m.addEventListener("play",r,!1),0===Object.keys(e.videoStorage).length?(l.value=e.url,c.setAttributeNode(l),m.appendChild(u)):(d.addEventListener("rise-storage-response",function(e){l.value=e.detail[0],c.setAttributeNode(l),m.appendChild(u)}),d.setAttribute("folder",e.videoStorage.folder),d.setAttribute("fileName",e.videoStorage.fileName),d.setAttribute("companyId",t),d.go())}function c(){y=!0,m.pause()}function l(){f=!1,y=!1,m.play()}function g(){return v}var m=document.getElementById("video"),p=document.getElementById("videoContainer"),f=!0,v=!1,y=!1;return{isInitialPlay:d,init:u,pause:c,play:l,userPaused:g}},function(e,t){"use strict";function n(){RiseVision.Video.play()}function i(){RiseVision.Video.pause()}function o(){RiseVision.Video.stop()}function a(e,t){Array.isArray(e)&&e.length>0&&"additionalParams"===e[0]&&Array.isArray(t)&&t.length>0&&RiseVision.Video.setAdditionalParams(JSON.parse(t[0]))}function s(e,n){e&&"companyId"===e&&RiseVision.Video.setCompanyId(n),t.rpc.register("rsparam_set_"+d,a),t.rpc.call("","rsparam_get",null,d,["additionalParams"])}var r=new t.Prefs,d=r.getString("id");e.oncontextmenu=function(){return!1},d&&""!==d&&(t.rpc.register("rscmd_play_"+d,n),t.rpc.register("rscmd_pause_"+d,i),t.rpc.register("rscmd_stop_"+d,o),t.rpc.register("rsparam_set_"+d,s),t.rpc.call("","rsparam_get",null,d,"companyId"))}(window,gadgets);var _gaq=_gaq||[];_gaq.push(["_setAccount","UA-57092159-2"]),_gaq.push(["_trackPageview"]),function(){var e=document.createElement("script");e.type="text/javascript",e.async=!0,e.src=("https:"==document.location.protocol?"https://ssl":"http://www")+".google-analytics.com/ga.js";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImpzL3dpZGdldC5taW4uanMiXSwibmFtZXMiOlsiY29uZmlnIiwiYW5ndWxhciIsIm1vZHVsZSIsImNvbnN0YW50IiwidmFsdWUiLCJSaXNlVmlzaW9uIiwiVmlkZW8iLCJkb2N1bWVudCIsImdhZGdldHMiLCJfZG9uZSIsInJwYyIsImNhbGwiLCJfcHJlZnMiLCJnZXRTdHJpbmciLCJfcmVhZHkiLCJfYmFja2dyb3VuZFJlYWR5IiwiX3BsYXllciIsIlBsYXllciIsIl9hZGRpdGlvbmFsUGFyYW1zIiwiX2NvbXBhbnlJZCIsImluaXQiLCJwYXVzZSIsInBsYXkiLCJpc0luaXRpYWxQbGF5IiwidmlkZW8iLCJhdXRvcGxheSIsInVzZXJQYXVzZWQiLCJwbGF5ZXJSZWFkeSIsInNldENvbXBhbnlJZCIsInNldEFkZGl0aW9uYWxQYXJhbXMiLCJwYXJhbXMiLCJQcmVmcyIsImdldEVsZW1lbnRCeUlkIiwic3R5bGUiLCJoZWlnaHQiLCJnZXRJbnQiLCJfYmFja2dyb3VuZCIsIkNvbW1vbiIsIkJhY2tncm91bmQiLCJzdG9wIiwidmlkZW9FbmRlZCIsImRhdGEiLCJjb21wYW55SWQiLCJfY2FsbGJhY2siLCJfc3RvcmFnZVJlc3BvbnNlIiwiZSIsIl9zdG9yYWdlIiwicmVtb3ZlRXZlbnRMaXN0ZW5lciIsImJhY2tncm91bmRJbWFnZSIsIkFycmF5IiwiaXNBcnJheSIsImRldGFpbCIsIl9jb25maWd1cmUiLCJib2R5IiwiYmFja2dyb3VuZCIsImNvbG9yIiwidXNlSW1hZ2UiLCJjbGFzc05hbWUiLCJpbWFnZSIsInBvc2l0aW9uIiwic2NhbGUiLCJPYmplY3QiLCJrZXlzIiwiYmFja2dyb3VuZFN0b3JhZ2UiLCJsZW5ndGgiLCJ1cmwiLCJhZGRFdmVudExpc3RlbmVyIiwic2V0QXR0cmlidXRlIiwiZm9sZGVyIiwiZmlsZU5hbWUiLCJnbyIsImNvbnNvbGUiLCJsb2ciLCJjYiIsIl9nZXRWaWRlb0ZpbGVUeXBlIiwidHlwZSIsInN1YnN0ciIsImxhc3RJbmRleE9mIiwiX29uTG9hZGVkRGF0YSIsIl92aWRlb0NvbnRhaW5lciIsInZpc2liaWxpdHkiLCJfdmlkZW8iLCJfb25DYW5QbGF5IiwiX29uRW5kZWQiLCJfdXNlclBhdXNlZCIsIl9vblBhdXNlIiwiX3ZpZXdlclBhdXNlZCIsIl9vblBsYXkiLCJfaW5pdGlhbFBsYXkiLCJzdG9yYWdlIiwiZnJhZ21lbnQiLCJjcmVhdGVEb2N1bWVudEZyYWdtZW50Iiwic291cmNlIiwiYXBwZW5kQ2hpbGQiLCJjcmVhdGVFbGVtZW50Iiwic3JjQXR0ciIsImNyZWF0ZUF0dHJpYnV0ZSIsInR5cGVBdHRyIiwidm9sdW1lIiwic2V0QXR0cmlidXRlTm9kZSIsInZpZGVvU3RvcmFnZSIsIndpbmRvdyIsImFkZGl0aW9uYWxQYXJhbXMiLCJuYW1lcyIsInZhbHVlcyIsIkpTT04iLCJwYXJzZSIsIm5hbWUiLCJyZWdpc3RlciIsImlkIiwicHJlZnMiLCJvbmNvbnRleHRtZW51IiwiX2dhcSIsInB1c2giLCJnYSIsImFzeW5jIiwic3JjIiwibG9jYXRpb24iLCJwcm90b2NvbCIsInMiLCJnZXRFbGVtZW50c0J5VGFnTmFtZSIsInBhcmVudE5vZGUiLCJpbnNlcnRCZWZvcmUiXSwibWFwcGluZ3MiOiJBQUVBLEdBQXNCLG1CQUFYQSxRQUF3QixDQUNqQyxHQUFJQSxVQUltQixvQkFBWkMsV0FDVEEsUUFBUUMsT0FBTyxvQ0FDWkMsU0FBUyxpQkFBa0IsdURBQzNCQSxTQUFTLGdCQUFpQixTQUU3QkYsUUFBUUMsT0FBTyxvREFDWkUsTUFBTSxnQkFBaUIsMEZBTTlCLEdBQUlDLFlBQWFBLGNBQ2pCQSxZQUFXQyxTQUVYRCxXQUFXQyxNQUFRLFNBQVdDLEVBQVVDLEdBQ3RDLFlBV0EsU0FBU0MsS0FDUEQsRUFBUUUsSUFBSUMsS0FBSyxHQUFJLGVBQWdCLEtBQU1DLEVBQU9DLFVBQVUsT0FJOUQsUUFBU0MsS0FDUE4sRUFBUUUsSUFBSUMsS0FBSyxHQUFJLGdCQUFpQixLQUFNQyxFQUFPQyxVQUFVLE9BQzNELEdBQU0sR0FBTSxH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RUFBTWpHLFVBQVUsS0FHdkJ3RixHQUFPVSxjQUFnQixXQUNyQixPQUFPLEdBZ0NMRixHQUFhLEtBQVBBLElBQ1JyRyxFQUFRRSxJQUFJa0csU0FBUyxjQUFnQkMsRUFBSXZGLEdBQ3pDZCxFQUFRRSxJQUFJa0csU0FBUyxlQUFpQkMsRUFBSXhGLEdBQzFDYixFQUFRRSxJQUFJa0csU0FBUyxjQUFnQkMsRUFBSXRFLEdBQ3pDL0IsRUFBUUUsSUFBSWtHLFNBQVMsZUFBaUJDLEVBQUluRSxHQUUxQ2xDLEVBQVFFLElBQUlDLEtBQUssR0FBSSxjQUFlLEtBQU1rRyxFQUFJLGVBSS9DUixPQUFRN0YsUUFLWCxJQUFJd0csTUFBT0EsUUFFWEEsTUFBS0MsTUFBTSxjQUFlLGtCQUMxQkQsS0FBS0MsTUFBTSxtQkFFWCxXQUNFLEdBQUlDLEdBQUszRyxTQUFTdUYsY0FBYyxTQUFXb0IsR0FBR3ZDLEtBQU8sa0JBQW1CdUMsRUFBR0MsT0FBUSxFQUNuRkQsRUFBR0UsS0FBTyxVQUFZN0csU0FBUzhHLFNBQVNDLFNBQVcsY0FBZ0IsY0FBZ0IsNkJBQ25GLElBQUlDLEdBQUloSCxTQUFTaUgscUJBQXFCLFVBQVUsRUFBSUQsR0FBRUUsV0FBV0MsYUFBYVIsRUFBSUsiLCJmaWxlIjoianMvd2lkZ2V0Lm1pbi5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8qIGdsb2JhbCBjb25maWc6IHRydWUgKi9cbi8qIGV4cG9ydGVkIGNvbmZpZyAqL1xuaWYgKHR5cGVvZiBjb25maWcgPT09IFwidW5kZWZpbmVkXCIpIHtcbiAgdmFyIGNvbmZpZyA9IHtcbiAgICAvLyB2YXJpYWJsZXMgZ28gaGVyZVxuICB9O1xuXG4gIGlmICh0eXBlb2YgYW5ndWxhciAhPT0gXCJ1bmRlZmluZWRcIikge1xuICAgIGFuZ3VsYXIubW9kdWxlKFwicmlzZXZpc2lvbi5jb21tb24uaTE4bi5jb25maWdcIiwgW10pXG4gICAgICAuY29uc3RhbnQoXCJMT0NBTEVTX1BSRUZJWFwiLCBcImNvbXBvbmVudHMvcnYtY29tbW9uLWkxOG4vZGlzdC9sb2NhbGVzL3RyYW5zbGF0aW9uX1wiKVxuICAgICAgLmNvbnN0YW50KFwiTE9DQUxFU19TVUZJWFwiLCBcIi5qc29uXCIpO1xuXG4gICAgYW5ndWxhci5tb2R1bGUoXCJyaXNldmlzaW9uLndpZGdldC5jb21tb24uc3RvcmFnZS1zZWxlY3Rvci5jb25maWdcIilcbiAgICAgIC52YWx1ZShcIlNUT1JBR0VfTU9EQUxcIiwgXCJodHRwOi8vc3RvcmFnZS5yaXNldmlzaW9uLmNvbS9+cnZpL3N0b3JhZ2UtY2xpZW50LXJ2YS10ZXN0L3N0b3JhZ2UtbW9kYWwuaHRtbCMvZmlsZXMvXCIpO1xuICB9XG59XG5cbi8qIGdsb2JhbCBnYWRnZXRzICovXG5cbnZhciBSaXNlVmlzaW9uID0gUmlzZVZpc2lvbiB8fCB7fTtcblJpc2VWaXNpb24uVmlkZW8gPSB7fTtcblxuUmlzZVZpc2lvbi5WaWRlbyA9IChmdW5jdGlvbiAoZG9jdW1lbnQsIGdhZGdldHMpIHtcbiAgXCJ1c2Ugc3RyaWN0XCI7XG5cbiAgdmFyIF9wcmVmcyA9IG51bGwsXG4gICAgX2FkZGl0aW9uYWxQYXJhbXMgPSB7fSxcbiAgICBfY29tcGFueUlkID0gbnVsbCxcbiAgICBfYmFja2dyb3VuZCA9IG51bGwsXG4gICAgX3BsYXllciA9IG51bGw7XG5cbiAgLypcbiAgICogIFByaXZhdGUgTWV0aG9kc1xuICAgKi9cbiAgZnVuY3Rpb24gX2RvbmUoKSB7XG4gICAgZ2FkZ2V0cy5ycGMuY2FsbChcIlwiLCBcInJzZXZlbnRfZG9uZVwiLCBudWxsLCBfcHJlZnMuZ2V0U3RyaW5nKFwiaWRcIikpO1xuXG4gIH1cblxuICBmdW5jdGlvbiBfcmVhZHkoKSB7XG4gICAgZ2FkZ2V0cy5ycGMuY2FsbChcIlwiLCBcInJzZXZlbnRfcmVhZHlcIiwgbnVsbCwgX3ByZWZzLmdldFN0cmluZyhcImlkXCIpLFxuICAgICAgdHJ1ZSwgdHJ1ZSwgdHJ1ZSwgdHJ1ZSwgdHJ1ZSk7XG4gIH1cblxuICBmdW5jdGlvbiBfYmFja2dyb3VuZFJlYWR5KCkge1xuICAgIC8vIGNyZWF0ZSBhbmQgaW5pdGlhbGl6ZSB0aGUgUGxheWVyIGluc3RhbmNlXG4gICAgX3BsYXllciA9IG5ldyBSaXNlVmlzaW9uLlZpZGVvLlBsYXllcihfYWRkaXRpb25hbFBhcmFtcywgX2NvbXBhbnlJZCk7XG4gICAgX3BsYXllci5pbml0KCk7XG4gIH1cblxuICAvKlxuICAgKiAgUHVibGljIE1ldGhvZHNcbiAgICovXG4gIGZ1bmN0aW9uIHBhdXNlKCkge1xuICAgIF9wbGF5ZXIucGF1c2UoKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIHBsYXkoKSB7XG4gICAgaWYgKF9wbGF5ZXIuaXNJbml0aWFsUGxheSgpKSB7XG4gICAgICAvLyBcImF1dG9wbGF5XCIgd2FzIHNlbGVjdGVkIGluIHNldHRpbmdzXG4gICAgICBpZiAoX2FkZGl0aW9uYWxQYXJhbXMudmlkZW8uYXV0b3BsYXkpIHtcbiAgICAgICAgX3BsYXllci5wbGF5KCk7XG4gICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgIGlmICghX3BsYXllci51c2VyUGF1c2VkKCkpIHtcbiAgICAgICAgX3BsYXllci5wbGF5KCk7XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgZnVuY3Rpb24gcGxheWVyUmVhZHkoKSB7XG4gICAgX3JlYWR5KCk7XG4gIH1cblxuICBmdW5jdGlvbiBzZXRDb21wYW55SWQodmFsdWUpIHtcbiAgICBfY29tcGFueUlkID0gdmFsdWU7XG4gIH1cblxuICBmdW5jdGlvbiBzZXRBZGRpdGlvbmFsUGFyYW1zKHBhcmFtcykge1xuICAgIF9wcmVmcyA9IG5ldyBnYWRnZXRzLlByZWZzKCk7XG4gICAgX2FkZGl0aW9uYWxQYXJhbXMgPSBwYXJhbXM7XG5cbiAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcInZpZGVvQ29udGFpbmVyXCIpLnN0eWxlLmhlaWdodCA9IF9wcmVmcy5nZXRJbnQoXCJyc0hcIikgKyBcInB4XCI7XG5cbiAgICAvLyBjcmVhdGUgYW5kIGluaXRpYWxpemUgdGhlIEJhY2tncm91bmQgaW5zdGFuY2VcbiAgICBfYmFja2dyb3VuZCA9IG5ldyBSaXNlVmlzaW9uLkNvbW1vbi5CYWNrZ3JvdW5kKF9hZGRpdGlvbmFsUGFyYW1zLCBfY29tcGFueUlkKTtcbiAgICBfYmFja2dyb3VuZC5pbml0KF9iYWNrZ3JvdW5kUmVhZHkpO1xuICB9XG5cbiAgZnVuY3Rpb24gc3RvcCgpIHtcbiAgICAvLyBodHRwczovL2dpdGh1Yi5jb20vUmlzZS1WaXNpb24vdmlld2VyL2lzc3Vlcy8zMFxuICAgIC8vIEhhdmUgdG8gY2FsbCBwYXVzZSgpIGR1ZSB0byBWaWV3ZXIgaXNzdWVcbiAgICBwYXVzZSgpO1xuICB9XG5cbiAgZnVuY3Rpb24gdmlkZW9FbmRlZCgpIHtcbiAgICBfZG9uZSgpO1xuICB9XG5cbiAgcmV0dXJuIHtcbiAgICBcInBhdXNlXCI6IHBhdXNlLFxuICAgIFwicGxheVwiOiBwbGF5LFxuICAgIFwic2V0Q29tcGFueUlkXCI6IHNldENvbXBhbnlJZCxcbiAgICBcInNldEFkZGl0aW9uYWxQYXJhbXNcIjogc2V0QWRkaXRpb25hbFBhcmFtcyxcbiAgICBcInBsYXllclJlYWR5XCI6IHBsYXllclJlYWR5LFxuICAgIFwic3RvcFwiOiBzdG9wLFxuICAgIFwidmlkZW9FbmRlZFwiOiB2aWRlb0VuZGVkXG4gIH07XG5cbn0pKGRvY3VtZW50LCBnYWRnZXRzKTtcblxudmFyIFJpc2VWaXNpb24gPSBSaXNlVmlzaW9uIHx8IHt9O1xuUmlzZVZpc2lvbi5Db21tb24gPSBSaXNlVmlzaW9uLkNvbW1vbiB8fCB7fTtcblxuUmlzZVZpc2lvbi5Db21tb24uQmFja2dyb3VuZCA9IGZ1bmN0aW9uIChkYXRhLCBjb21wYW55SWQpIHtcbiAgXCJ1c2Ugc3RyaWN0XCI7XG5cbiAgdmFyIF9jYWxsYmFjayA9IG51bGwsXG4gICAgX3JlYWR5ID0gZmFsc2UsXG4gICAgX2JhY2tncm91bmQgPSBudWxsLFxuICAgIF9zdG9yYWdlID0gbnVsbDtcblxuICAvKlxuICAgKiBQcml2YXRlIE1ldGhvZHNcbiAgICovXG4gIGZ1bmN0aW9uIF9iYWNrZ3JvdW5kUmVhZHkoKSB7XG4gICAgX3JlYWR5ID0gdHJ1ZTtcblxuICAgIGlmIChfY2FsbGJhY2sgJiYgdHlwZW9mIF9jYWxsYmFjayA9PT0gXCJmdW5jdGlvblwiKSB7XG4gICAgICBfY2FsbGJhY2soKTtcbiAgICB9XG4gIH1cblxuICBmdW5jdGlvbiBfc3RvcmFnZVJlc3BvbnNlKGUpIHtcbiAgICBfc3RvcmFnZS5yZW1vdmVFdmVudExpc3RlbmVyKFwicmlzZS1zdG9yYWdlLXJlc3BvbnNlXCIsIF9zdG9yYWdlUmVzcG9uc2UpO1xuXG4gICAgaWYgKEFycmF5LmlzQXJyYXkoZS5kZXRhaWwpKSB7XG4gICAgICBfYmFja2dyb3VuZC5zdHlsZS5iYWNrZ3JvdW5kSW1hZ2UgPSBcInVybChcIiArIGUuZGV0YWlsWzBdICsgXCIpXCI7XG4gICAgfSBlbHNlIHtcbiAgICAgIF9iYWNrZ3JvdW5kLnN0eWxlLmJhY2tncm91bmRJbWFnZSA9IFwidXJsKFwiICsgZS5kZXRhaWwgKyBcIilcIjtcbiAgICB9XG4gICAgX2JhY2tncm91bmRSZWFkeSgpO1xuICB9XG5cbiAgZnVuY3Rpb24gX2NvbmZpZ3VyZSgpIHtcbiAgICBfYmFja2dyb3VuZCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwiYmFja2dyb3VuZFwiKTtcbiAgICBfc3RvcmFnZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwiYmFja2dyb3VuZFN0b3JhZ2VcIik7XG5cbiAgICAvLyBzZXQgdGhlIGRvY3VtZW50IGJhY2tncm91bmRcbiAgICBkb2N1bWVudC5ib2R5LnN0eWxlLmJhY2tncm91bmQgPSBkYXRhLmJhY2tncm91bmQuY29sb3I7XG5cbiAgICBpZiAoX2JhY2tncm91bmQpIHtcbiAgICAgIGlmIChkYXRhLmJhY2tncm91bmQudXNlSW1hZ2UpIHtcbiAgICAgICAgX2JhY2tncm91bmQuY2xhc3NOYW1lID0gZGF0YS5iYWNrZ3JvdW5kLmltYWdlLnBvc2l0aW9uO1xuICAgICAgICBfYmFja2dyb3VuZC5jbGFzc05hbWUgPSBkYXRhLmJhY2tncm91bmQuaW1hZ2Uuc2NhbGUgPyBfYmFja2dyb3VuZC5jbGFzc05hbWUgKyBcIiBzY2FsZS10by1maXRcIlxuICAgICAgICAgIDogX2JhY2tncm91bmQuY2xhc3NOYW1lO1xuXG4gICAgICAgIGlmIChPYmplY3Qua2V5cyhkYXRhLmJhY2tncm91bmRTdG9yYWdlKS5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICBfYmFja2dyb3VuZC5zdHlsZS5iYWNrZ3JvdW5kSW1hZ2UgPSBcInVybChcIiArIGRhdGEuYmFja2dyb3VuZC5pbWFnZS51cmwgKyBcIilcIjtcbiAgICAgICAgICBfYmFja2dyb3VuZFJlYWR5KCk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgaWYgKF9zdG9yYWdlKSB7XG4gICAgICAgICAgICAvLyBSaXNlIFN0b3JhZ2VcbiAgICAgICAgICAgIF9zdG9yYWdlLmFkZEV2ZW50TGlzdGVuZXIoXCJyaXNlLXN0b3JhZ2UtcmVzcG9uc2VcIiwgX3N0b3JhZ2VSZXNwb25zZSk7XG5cbiAgICAgICAgICAgIF9zdG9yYWdlLnNldEF0dHJpYnV0ZShcImZvbGRlclwiLCBkYXRhLmJhY2tncm91bmRTdG9yYWdlLmZvbGRlcik7XG4gICAgICAgICAgICBfc3RvcmFnZS5zZXRBdHRyaWJ1dGUoXCJmaWxlTmFtZVwiLCBkYXRhLmJhY2tncm91bmRTdG9yYWdlLmZpbGVOYW1lKTtcbiAgICAgICAgICAgIF9zdG9yYWdlLnNldEF0dHJpYnV0ZShcImNvbXBhbnlJZFwiLCBjb21wYW55SWQpO1xuICAgICAgICAgICAgX3N0b3JhZ2UuZ28oKTtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgY29uc29sZS5sb2coXCJNaXNzaW5nIGVsZW1lbnQgd2l0aCBpZCB2YWx1ZSBvZiAnYmFja2dyb3VuZFN0b3JhZ2UnXCIpO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgX2JhY2tncm91bmRSZWFkeSgpO1xuICAgICAgfVxuICAgIH0gZWxzZSB7XG4gICAgICBjb25zb2xlLmxvZyhcIk1pc3NpbmcgZWxlbWVudCB3aXRoIGlkIHZhbHVlIG9mICdiYWNrZ3JvdW5kJ1wiKTtcbiAgICB9XG4gIH1cblxuICAvKlxuICAgKiAgUHVibGljIE1ldGhvZHNcbiAgICovXG4gIGZ1bmN0aW9uIGluaXQoY2IpIHtcbiAgICBpZiAoIV9yZWFkeSkge1xuICAgICAgaWYgKGNiKSB7XG4gICAgICAgIF9jYWxsYmFjayA9IGNiO1xuICAgICAgfVxuXG4gICAgICBfY29uZmlndXJlKCk7XG5cbiAgICB9IGVsc2UgaWYgKGNiICYmIHR5cGVvZiBjYiA9PT0gXCJmdW5jdGlvblwiKSB7XG4gICAgICBjYigpO1xuICAgIH1cbiAgfVxuXG4gIHJldHVybiB7XG4gICAgXCJpbml0XCI6IGluaXRcbiAgfTtcbn07XG5cbnZhciBSaXNlVmlzaW9uID0gUmlzZVZpc2lvbiB8fCB7fTtcblJpc2VWaXNpb24uVmlkZW8gPSBSaXNlVmlzaW9uLlZpZGVvIHx8IHt9O1xuXG5SaXNlVmlzaW9uLlZpZGVvLlBsYXllciA9IGZ1bmN0aW9uIChkYXRhLCBjb21wYW55SWQpIHtcbiAgXCJ1c2Ugc3RyaWN0XCI7XG5cbiAgdmFyIF92aWRlbyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwidmlkZW9cIiksXG4gICAgX3ZpZGVvQ29udGFpbmVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJ2aWRlb0NvbnRhaW5lclwiKSxcbiAgICBfaW5pdGlhbFBsYXkgPSB0cnVlLFxuICAgIF91c2VyUGF1c2VkID0gZmFsc2UsXG4gICAgX3ZpZXdlclBhdXNlZCA9IGZhbHNlO1xuXG4gIC8qXG4gICAqIFByaXZhdGUgTWV0aG9kc1xuICAgKi9cbiAgZnVuY3Rpb24gX2dldFZpZGVvRmlsZVR5cGUoKSB7XG4gICAgdmFyIHR5cGUgPSBkYXRhLnVybC5zdWJzdHIoZGF0YS51cmwubGFzdEluZGV4T2YoXCIuXCIpICsgMSk7XG5cbiAgICBpZiAodHlwZSA9PT0gXCJvZ3ZcIikge1xuICAgICAgdHlwZSA9IFwib2dnXCI7XG4gICAgfVxuXG4gICAgcmV0dXJuIHR5cGU7XG4gIH1cblxuICBmdW5jdGlvbiBfb25Mb2FkZWREYXRhKCkge1xuICAgIC8vIGF0IGxlYXNlIDFzdCBmcmFtZSBvZiB2aWRlbyBoYXMgbG9hZGVkXG4gICAgX3ZpZGVvQ29udGFpbmVyLnN0eWxlLnZpc2liaWxpdHkgPSBcInZpc2libGVcIjtcbiAgICAvLyByZW1vdmUgdGhpcyBsaXN0ZW5lclxuICAgIF92aWRlby5yZW1vdmVFdmVudExpc3RlbmVyKFwibG9hZGVkZGF0YVwiLCBfb25Mb2FkZWREYXRhLCBmYWxzZSk7XG4gIH1cblxuICBmdW5jdGlvbiBfb25DYW5QbGF5KCkge1xuICAgIC8vIGVub3VnaCBkYXRhIGhhcyBsb2FkZWQgdG8gc2FmZWx5IHBsYXkgd2l0aG91dCBpbnRlcnJ1cHRpb25cbiAgICBSaXNlVmlzaW9uLlZpZGVvLnBsYXllclJlYWR5KCk7XG4gICAgLy8gcmVtb3ZlIHRoaXMgbGlzdGVuZXJcbiAgICBfdmlkZW8ucmVtb3ZlRXZlbnRMaXN0ZW5lcihcImNhbnBsYXlcIiwgX29uQ2FuUGxheSwgZmFsc2UpO1xuICB9XG5cbiAgZnVuY3Rpb24gX29uRW5kZWQoKSB7XG4gICAgLy8gYSBcInBhdXNlXCIgZXZlbnQgaXMgYWx3YXlzIGZpcmVkIGJlZm9yZSBcImVuZGVkXCIgZXZlbnQsIGVuc3VyZSBfdXNlclBhdXNlZCBpcyBmYWxzZVxuICAgIF91c2VyUGF1c2VkID0gZmFsc2U7XG4gICAgLy8gdmlkZW8gZW5kZWRcbiAgICBSaXNlVmlzaW9uLlZpZGVvLnZpZGVvRW5kZWQoKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIF9vblBhdXNlKCkge1xuICAgIC8vIHRoaXMgaGFuZGxlciBhbHNvIGdldHMgY2FsbGVkIHZpYSBwdWJsaWMgXCJwYXVzZSgpXCIgZnVuY3Rpb24sIG9ubHkgc2V0IFwiX3VzZXJQYXVzZWQgPSB0cnVlXCIgaWYgbm90IHRoZSBjYXNlXG4gICAgX3VzZXJQYXVzZWQgPSAhX3ZpZXdlclBhdXNlZDtcbiAgfVxuXG4gIGZ1bmN0aW9uIF9vblBsYXkoKSB7XG4gICAgX2luaXRpYWxQbGF5ID0gZmFsc2U7XG4gICAgX3VzZXJQYXVzZWQgPSBmYWxzZTtcbiAgfVxuXG4gIC8qXG4gICAqICBQdWJsaWMgTWV0aG9kc1xuICAgKi9cbiAgZnVuY3Rpb24gaXNJbml0aWFsUGxheSgpIHtcbiAgICByZXR1cm4gX2luaXRpYWxQbGF5O1xuICB9XG5cbiAgZnVuY3Rpb24gaW5pdCgpIHtcbiAgICB2YXIgc3RvcmFnZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwidmlkZW9TdG9yYWdlXCIpLFxuICAgICAgZnJhZ21lbnQgPSBkb2N1bWVudC5jcmVhdGVEb2N1bWVudEZyYWdtZW50KCksXG4gICAgICBzb3VyY2UgPSBmcmFnbWVudC5hcHBlbmRDaGlsZChkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwic291cmNlXCIpKSxcbiAgICAgIHNyY0F0dHIgPSBkb2N1bWVudC5jcmVhdGVBdHRyaWJ1dGUoXCJzcmNcIiksXG4gICAgICB0eXBlQXR0ciA9IGRvY3VtZW50LmNyZWF0ZUF0dHJpYnV0ZShcInR5cGVcIik7XG5cbiAgICAvLyBzZXQgaW5pdGlhbCB2b2x1bWUgb24gPHZpZGVvPlxuICAgIF92aWRlby52b2x1bWUgPSBkYXRhLnZpZGVvLnZvbHVtZSAvIDEwMDtcblxuICAgIC8vIHNldCB0aGUgXCJ0eXBlXCIgYXR0cmlidXRlIG9uIDxzb3VyY2U+XG4gICAgdHlwZUF0dHIudmFsdWUgPSBcInZpZGVvL1wiICsgX2dldFZpZGVvRmlsZVR5cGUoKTtcbiAgICBzb3VyY2Uuc2V0QXR0cmlidXRlTm9kZSh0eXBlQXR0cik7XG5cbiAgICAvLyB2aWRlbyBldmVudHNcbiAgICBfdmlkZW8uYWRkRXZlbnRMaXN0ZW5lcihcImxvYWRlZGRhdGFcIiwgX29uTG9hZGVkRGF0YSwgZmFsc2UpO1xuICAgIF92aWRlby5hZGRFdmVudExpc3RlbmVyKFwiY2FucGxheVwiLCBfb25DYW5QbGF5LCBmYWxzZSk7XG4gICAgX3ZpZGVvLmFkZEV2ZW50TGlzdGVuZXIoXCJlbmRlZFwiLCBfb25FbmRlZCwgZmFsc2UpO1xuICAgIF92aWRlby5hZGRFdmVudExpc3RlbmVyKFwicGF1c2VcIiwgX29uUGF1c2UsIGZhbHNlKTtcbiAgICBfdmlkZW8uYWRkRXZlbnRMaXN0ZW5lcihcInBsYXlcIiwgX29uUGxheSwgZmFsc2UpO1xuXG4gICAgaWYgKE9iamVjdC5rZXlzKGRhdGEudmlkZW9TdG9yYWdlKS5sZW5ndGggPT09IDApIHtcbiAgICAgIC8vIE5vbiBzdG9yYWdlIFVSTFxuICAgICAgc3JjQXR0ci52YWx1ZSA9IGRhdGEudXJsO1xuICAgICAgc291cmNlLnNldEF0dHJpYnV0ZU5vZGUoc3JjQXR0cik7XG4gICAgICBfdmlkZW8uYXBwZW5kQ2hpbGQoZnJhZ21lbnQpO1xuXG4gICAgfSBlbHNlIHtcbiAgICAgIC8vIFJpc2UgU3RvcmFnZVxuICAgICAgc3RvcmFnZS5hZGRFdmVudExpc3RlbmVyKFwicmlzZS1zdG9yYWdlLXJlc3BvbnNlXCIsIGZ1bmN0aW9uIChlKSB7XG4gICAgICAgIHNyY0F0dHIudmFsdWUgPSBlLmRldGFpbFswXTtcbiAgICAgICAgc291cmNlLnNldEF0dHJpYnV0ZU5vZGUoc3JjQXR0cik7XG4gICAgICAgIF92aWRlby5hcHBlbmRDaGlsZChmcmFnbWVudCk7XG4gICAgICB9KTtcblxuICAgICAgc3RvcmFnZS5zZXRBdHRyaWJ1dGUoXCJmb2xkZXJcIiwgZGF0YS52aWRlb1N0b3JhZ2UuZm9sZGVyKTtcbiAgICAgIHN0b3JhZ2Uuc2V0QXR0cmlidXRlKFwiZmlsZU5hbWVcIiwgZGF0YS52aWRlb1N0b3JhZ2UuZmlsZU5hbWUpO1xuICAgICAgc3RvcmFnZS5zZXRBdHRyaWJ1dGUoXCJjb21wYW55SWRcIiwgY29tcGFueUlkKTtcbiAgICAgIHN0b3JhZ2UuZ28oKTtcbiAgICB9XG4gIH1cblxuICBmdW5jdGlvbiBwYXVzZSgpIHtcbiAgICBfdmlld2VyUGF1c2VkID0gdHJ1ZTtcbiAgICBfdmlkZW8ucGF1c2UoKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIHBsYXkoKSB7XG4gICAgX2luaXRpYWxQbGF5ID0gZmFsc2U7XG4gICAgX3ZpZXdlclBhdXNlZCA9IGZhbHNlO1xuICAgIF92aWRlby5wbGF5KCk7XG4gIH1cblxuICBmdW5jdGlvbiB1c2VyUGF1c2VkKCkge1xuICAgIHJldHVybiBfdXNlclBhdXNlZDtcbiAgfVxuXG4gIHJldHVybiB7XG4gICAgXCJpc0luaXRpYWxQbGF5XCI6IGlzSW5pdGlhbFBsYXksXG4gICAgXCJpbml0XCI6IGluaXQsXG4gICAgXCJwYXVzZVwiOiBwYXVzZSxcbiAgICBcInBsYXlcIjogcGxheSxcbiAgICBcInVzZXJQYXVzZWRcIjogdXNlclBhdXNlZFxuICB9O1xufTtcblxuLyogZ2xvYmFsIGdhZGdldHMsIFJpc2VWaXNpb24gKi9cblxuKGZ1bmN0aW9uICh3aW5kb3csIGdhZGdldHMpIHtcbiAgXCJ1c2Ugc3RyaWN0XCI7XG5cbiAgdmFyIHByZWZzID0gbmV3IGdhZGdldHMuUHJlZnMoKSxcbiAgICBpZCA9IHByZWZzLmdldFN0cmluZyhcImlkXCIpO1xuXG4gIC8vIERpc2FibGUgY29udGV4dCBtZW51IChyaWdodCBjbGljayBtZW51KVxuICB3aW5kb3cub25jb250ZXh0bWVudSA9IGZ1bmN0aW9uICgpIHtcbiAgICByZXR1cm4gZmFsc2U7XG4gIH07XG5cbiAgZnVuY3Rpb24gcGxheSgpIHtcbiAgICBSaXNlVmlzaW9uLlZpZGVvLnBsYXkoKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIHBhdXNlKCkge1xuICAgIFJpc2VWaXNpb24uVmlkZW8ucGF1c2UoKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIHN0b3AoKSB7XG4gICAgUmlzZVZpc2lvbi5WaWRlby5zdG9wKCk7XG4gIH1cblxuICBmdW5jdGlvbiBhZGRpdGlvbmFsUGFyYW1zKG5hbWVzLCB2YWx1ZXMpIHtcbiAgICBpZiAoQXJyYXkuaXNBcnJheShuYW1lcykgJiYgbmFtZXMubGVuZ3RoID4gMCAmJiBuYW1lc1swXSA9PT0gXCJhZGRpdGlvbmFsUGFyYW1zXCIpIHtcbiAgICAgIGlmIChBcnJheS5pc0FycmF5KHZhbHVlcykgJiYgdmFsdWVzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgUmlzZVZpc2lvbi5WaWRlby5zZXRBZGRpdGlvbmFsUGFyYW1zKEpTT04ucGFyc2UodmFsdWVzWzBdKSk7XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgZnVuY3Rpb24gY29tcGFueUlkKG5hbWUsIHZhbHVlKSB7XG4gICAgaWYgKG5hbWUgJiYgbmFtZSA9PT0gXCJjb21wYW55SWRcIikge1xuICAgICAgUmlzZVZpc2lvbi5WaWRlby5zZXRDb21wYW55SWQodmFsdWUpO1xuICAgIH1cblxuICAgIGdhZGdldHMucnBjLnJlZ2lzdGVyKFwicnNwYXJhbV9zZXRfXCIgKyBpZCwgYWRkaXRpb25hbFBhcmFtcyk7XG4gICAgZ2FkZ2V0cy5ycGMuY2FsbChcIlwiLCBcInJzcGFyYW1fZ2V0XCIsIG51bGwsIGlkLCBbXCJhZGRpdGlvbmFsUGFyYW1zXCJdKTtcbiAgfVxuXG4gIGlmIChpZCAmJiBpZCAhPT0gXCJcIikge1xuICAgIGdhZGdldHMucnBjLnJlZ2lzdGVyKFwicnNjbWRfcGxheV9cIiArIGlkLCBwbGF5KTtcbiAgICBnYWRnZXRzLnJwYy5yZWdpc3RlcihcInJzY21kX3BhdXNlX1wiICsgaWQsIHBhdXNlKTtcbiAgICBnYWRnZXRzLnJwYy5yZWdpc3RlcihcInJzY21kX3N0b3BfXCIgKyBpZCwgc3RvcCk7XG4gICAgZ2FkZ2V0cy5ycGMucmVnaXN0ZXIoXCJyc3BhcmFtX3NldF9cIiArIGlkLCBjb21wYW55SWQpO1xuXG4gICAgZ2FkZ2V0cy5ycGMuY2FsbChcIlwiLCBcInJzcGFyYW1fZ2V0XCIsIG51bGwsIGlkLCBcImNvbXBhbnlJZFwiKTtcblxuICB9XG5cbn0pKHdpbmRvdywgZ2FkZ2V0cyk7XG5cblxuXG4vKiBqc2hpbnQgaWdub3JlOnN0YXJ0ICovXG52YXIgX2dhcSA9IF9nYXEgfHwgW107XG5cbl9nYXEucHVzaChbJ19zZXRBY2NvdW50JywgJ1VBLTU3MDkyMTU5LTInXSk7XG5fZ2FxLnB1c2goWydfdHJhY2tQYWdldmlldyddKTtcblxuKGZ1bmN0aW9uKCkge1xuICB2YXIgZ2EgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdzY3JpcHQnKTsgZ2EudHlwZSA9ICd0ZXh0L2phdmFzY3JpcHQnOyBnYS5hc3luYyA9IHRydWU7XG4gIGdhLnNyYyA9ICgnaHR0cHM6JyA9PSBkb2N1bWVudC5sb2NhdGlvbi5wcm90b2NvbCA/ICdodHRwczovL3NzbCcgOiAnaHR0cDovL3d3dycpICsgJy5nb29nbGUtYW5hbHl0aWNzLmNvbS9nYS5qcyc7XG4gIHZhciBzID0gZG9jdW1lbnQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoJ3NjcmlwdCcpWzBdOyBzLnBhcmVudE5vZGUuaW5zZXJ0QmVmb3JlKGdhLCBzKTtcbn0pKCk7XG4vKiBqc2hpbnQgaWdub3JlOmVuZCAqL1xuIl0sInNvdXJjZVJvb3QiOiIvc291cmNlLyJ9