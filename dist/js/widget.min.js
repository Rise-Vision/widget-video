if("undefined"==typeof config){var config={SKIN:"skin/RVSkin.xml"};"undefined"!=typeof angular&&angular.module("risevision.common.i18n.config",[]).constant("LOCALES_PREFIX","locales/translation_").constant("LOCALES_SUFIX",".json")}var RiseVision=RiseVision||{};RiseVision.Video={},RiseVision.Video=function(e){"use strict";function t(){e.rpc.call("","rsevent_done",null,v.getString("id"))}function n(){console.log("video.js::_ready()",g.storage.fileName),e.rpc.call("","rsevent_ready",null,v.getString("id"),!0,!0,!0,!0,!0)}function i(){R=new RiseVision.Common.Video.FrameController,R.add(0),y=0,R.createFramePlayer(0,g,p,config.SKIN,"player.html")}function o(e){I=setInterval(function(){p=g.url+S+"cb="+(new Date).getTime(),_=!1},e)}function r(e){p=e,i()}function a(e){p=e,_=!1}function s(){var e=R.getFrameObject(y);e&&e.pause()}function l(){var e=R.getFrameObject(y);_?t():e?e.play():(R.add(0),R.createFramePlayer(0,g,p,config.SKIN,"player.html"))}function c(){R.remove(y,function(){t()})}function u(){var e;h?(e=R.getFrameObject(y),e.play()):(h=!0,b||null!==I||o(A),n())}function d(t,n){var o;Array.isArray(t)&&t.length>0&&"additionalParams"===t[0]&&Array.isArray(n)&&n.length>0&&(g=JSON.parse(n[0]),v=new e.Prefs,document.getElementById("videoContainer").style.height=v.getInt("rsH")+"px",g.width=v.getInt("rsW"),g.height=v.getInt("rsH"),b=0!==Object.keys(g.storage).length,b?(V=new RiseVision.Video.Storage(g),V.init()):(o=g.url.split("?"),S=1===o.length?"?":"&",p=g.url,i()))}function m(e){console.debug("video-folder::playerError()",e),h?(_=!0,c()):R.remove(y)}function f(){s()}var g,p,y,v=null,V=null,R=null,h=!1,_=!1,b=!1,S="",A=9e5,I=null;return{onStorageInit:r,onStorageRefresh:a,pause:s,play:l,setAdditionalParams:d,playerEnded:c,playerReady:u,playerError:m,stop:f}}(gadgets);var RiseVision=RiseVision||{};RiseVision.Video=RiseVision.Video||{},RiseVision.Video.Storage=function(e){"use strict";function t(){var t=document.getElementById("videoStorage");t&&(t.addEventListener("rise-storage-response",function(e){var t;e.detail&&e.detail.files&&e.detail.files.length>0&&(t=e.detail.files[0].url,n?(n=!1,RiseVision.Video.onStorageInit(t)):RiseVision.Video.onStorageRefresh(t))}),t.setAttribute("folder",e.storage.folder),t.setAttribute("fileName",e.storage.fileName),t.setAttribute("companyId",e.storage.companyId),t.go())}var n=!0;return{init:t}};var RiseVision=RiseVision||{};RiseVision.Common=RiseVision.Common||{},RiseVision.Common.Video=RiseVision.Common.Video||{},RiseVision.Common.Video.FrameController=function(){"use strict";function e(e){return document.getElementById(l+e)}function t(t){var n,i=e(t);return n=i.querySelector("iframe"),n?n.contentWindow?n.contentWindow:n.contentDocument.document?n.contentDocument.document:n.contentDocument:null}function n(n){var i,o=e(n),r=t(n);r&&(i=o.querySelector("iframe"),r.remove(),i.setAttribute("src","about:blank"))}function i(t){var n=e(t),i=document.createElement("iframe");i.setAttribute("allowTransparency",!0),i.setAttribute("frameborder","0"),i.setAttribute("scrolling","no"),n.appendChild(i)}function o(n,i,o,r,a){var s,l=e(n),c=t(n);c&&(s=l.querySelector("iframe"),s.onload=function(){s.onload=null,c.init(i,o,r),c.load()},s.setAttribute("src",a))}function r(t){var n=e(t);n.style.visibility="hidden"}function a(e,t){var i=document.getElementById(l+e);n(e),setTimeout(function(){for(;i.firstChild;)i.removeChild(i.firstChild);t&&"function"==typeof t&&t()},200)}function s(t){var n=e(t);n.style.visibility="visible"}var l="if_";return{add:i,createFramePlayer:o,getFrameContainer:e,getFrameObject:t,hide:r,remove:a,show:s}},function(e,t){"use strict";function n(){RiseVision.Video.play()}function i(){RiseVision.Video.pause()}function o(){RiseVision.Video.stop()}function r(){e.removeEventListener("polymer-ready",r),s&&""!==s&&(t.rpc.register("rscmd_play_"+s,n),t.rpc.register("rscmd_pause_"+s,i),t.rpc.register("rscmd_stop_"+s,o),t.rpc.register("rsparam_set_"+s,RiseVision.Video.setAdditionalParams),t.rpc.call("","rsparam_get",null,s,["additionalParams"]))}var a=new t.Prefs,s=a.getString("id");e.oncontextmenu=function(){return!1},e.addEventListener("polymer-ready",r)}(window,gadgets);var _gaq=_gaq||[];_gaq.push(["_setAccount","UA-57092159-2"]),_gaq.push(["_trackPageview"]),function(){var e=document.createElement("script");e.type="text/javascript",e.async=!0,e.src=("https:"==document.location.protocol?"https://ssl":"http://www")+".google-analytics.com/ga.js";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImpzL3dpZGdldC5taW4uanMiXSwibmFtZXMiOlsiY29uZmlnIiwiU0tJTiIsImFuZ3VsYXIiLCJtb2R1bGUiLCJjb25zdGFudCIsIlJpc2VWaXNpb24iLCJWaWRlbyIsImdhZGdldHMiLCJfZG9uZSIsInJwYyIsImNhbGwiLCJfcHJlZnMiLCJnZXRTdHJpbmciLCJfcmVhZHkiLCJjb25zb2xlIiwibG9nIiwiX2FkZGl0aW9uYWxQYXJhbXMiLCJzdG9yYWdlIiwiZmlsZU5hbWUiLCJfaW5pdCIsIl9mcmFtZUNvbnRyb2xsZXIiLCJDb21tb24iLCJGcmFtZUNvbnRyb2xsZXIiLCJhZGQiLCJfY3VycmVudEZyYW1lIiwiY3JlYXRlRnJhbWVQbGF5ZXIiLCJfY3VycmVudEZpbGUiLCJfcmVmcmVzaEludGVydmFsIiwiZHVyYXRpb24iLCJfcmVmcmVzaEludGVydmFsSWQiLCJzZXRJbnRlcnZhbCIsInVybCIsIl9zZXBhcmF0b3IiLCJEYXRlIiwiZ2V0VGltZSIsIl9wbGF5YmFja0Vycm9yIiwib25TdG9yYWdlSW5pdCIsIm9uU3RvcmFnZVJlZnJlc2giLCJwYXVzZSIsImZyYW1lT2JqIiwiZ2V0RnJhbWVPYmplY3QiLCJwbGF5IiwicGxheWVyRW5kZWQiLCJyZW1vdmUiLCJwbGF5ZXJSZWFkeSIsIl9pbml0aWFsaXplZCIsIl9pc1N0b3JhZ2VGaWxlIiwiX3JlZnJlc2hEdXJhdGlvbiIsInNldEFkZGl0aW9uYWxQYXJhbXMiLCJuYW1lcyIsInZhbHVlcyIsInN0ciIsIkFycmF5IiwiaXNBcnJheSIsImxlbmd0aCIsIkpTT04iLCJwYXJzZSIsIlByZWZzIiwiZG9jdW1lbnQiLCJnZXRFbGVtZW50QnlJZCIsInN0eWxlIiwiaGVpZ2h0IiwiZ2V0SW50Iiwid2lkdGgiLCJPYmplY3QiLCJrZXlzIiwiX3N0b3JhZ2UiLCJTdG9yYWdlIiwiaW5pdCIsInNwbGl0IiwicGxheWVyRXJyb3IiLCJlcnJvciIsImRlYnVnIiwic3RvcCIsImRhdGEiLCJhZGRFdmVudExpc3RlbmVyIiwiZSIsImRldGFpbCIsImZpbGVzIiwiX2luaXRpYWxMb2FkIiwic2V0QXR0cmlidXRlIiwiZm9sZGVyIiwiY29tcGFueUlkIiwiZ28iLCJnZXRGcmFtZUNvbnRhaW5lciIsImluZGV4IiwiUFJFRklYIiwiaWZyYW1lIiwiZnJhbWVDb250YWluZXIiLCJxdWVyeVNlbGVjdG9yIiwiY29udGVudFdpbmRvdyIsImNvbnRlbnREb2N1bWVudCIsIl9jbGVhciIsImNyZWF0ZUVsZW1lbnQiLCJhcHBlbmRDaGlsZCIsInBhcmFtcyIsInNraW4iLCJzcmMiLCJvbmxvYWQiLCJsb2FkIiwiaGlkZSIsInZpc2liaWxpdHkiLCJjYWxsYmFjayIsInNldFRpbWVvdXQiLCJmaXJzdENoaWxkIiwicmVtb3ZlQ2hpbGQiLCJzaG93Iiwid2luZG93IiwicG9seW1lclJlYWR5IiwicmVtb3ZlRXZlbnRMaXN0ZW5lciIsImlkIiwicmVnaXN0ZXIiLCJwcmVmcyIsIm9uY29udGV4dG1lbnUiLCJfZ2FxIiwicHVzaCIsImdhIiwidHlwZSIsImFzeW5jIiwibG9jYXRpb24iLCJwcm90b2NvbCIsInMiLCJnZXRFbGVtZW50c0J5VGFnTmFtZSIsInBhcmVudE5vZGUiLCJpbnNlcnRCZWZvcmUiXSwibWFwcGluZ3MiOiJBQUVBLEdBQXNCLG1CQUFYQSxRQUF3QixDQUNqQyxHQUFJQSxTQUNGQyxLQUFNLGtCQUdlLG9CQUFaQyxVQUNUQSxRQUFRQyxPQUFPLG9DQUNaQyxTQUFTLGlCQUFrQix3QkFDM0JBLFNBQVMsZ0JBQWlCLFNBTWpDLEdBQUlDLFlBQWFBLGNBQ2pCQSxZQUFXQyxTQUVYRCxXQUFXQyxNQUFRLFNBQVdDLEdBQzVCLFlBcUJBLFNBQVNDLEtBQ1BELEVBQVFFLElBQUlDLEtBQUssR0FBSSxlQUFnQixLQUFNQyxFQUFPQyxVQUFVLE9BSTlELFFBQVNDLEtBQ1BDLFFBQVFDLElBQUkscUJBQXNCQyxFQUFrQkMsUUFBUUMsVUFFNURYLEVBQVFFLElBQUlDLEtBQUssR0FBSSxnQkFBaUIsS0FBTUMsRUFBT0MsVUFB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QixRQUFTbUMsS0FDUEQsRUFBT0Usb0JBQW9CLGdCQUFpQkQsR0FFeENFLEdBQWEsS0FBUEEsSUFDUnZHLEVBQVFFLElBQUlzRyxTQUFTLGNBQWdCRCxFQUFJckUsR0FDekNsQyxFQUFRRSxJQUFJc0csU0FBUyxlQUFpQkQsRUFBSXhFLEdBQzFDL0IsRUFBUUUsSUFBSXNHLFNBQVMsY0FBZ0JELEVBQUlyQyxHQUV6Q2xFLEVBQVFFLElBQUlzRyxTQUFTLGVBQWlCRCxFQUFJekcsV0FBV0MsTUFBTTBDLHFCQUMzRHpDLEVBQVFFLElBQUlDLEtBQUssR0FBSSxjQUFlLEtBQU1vRyxHQUFLLHNCQTdCbkQsR0FBSUUsR0FBUSxHQUFJekcsR0FBUWtELE1BQ3RCcUQsRUFBS0UsRUFBTXBHLFVBQVUsS0FHdkIrRixHQUFPTSxjQUFnQixXQUNyQixPQUFPLEdBNEJUTixFQUFPaEMsaUJBQWlCLGdCQUFpQmlDLElBRXhDRCxPQUFRcEcsUUFLWCxJQUFJMkcsTUFBT0EsUUFFWEEsTUFBS0MsTUFBTSxjQUFlLGtCQUMxQkQsS0FBS0MsTUFBTSxtQkFFWCxXQUNFLEdBQUlDLEdBQUsxRCxTQUFTbUMsY0FBYyxTQUFXdUIsR0FBR0MsS0FBTyxrQkFBbUJELEVBQUdFLE9BQVEsRUFDbkZGLEVBQUduQixLQUFPLFVBQVl2QyxTQUFTNkQsU0FBU0MsU0FBVyxjQUFnQixjQUFnQiw2QkFDbkYsSUFBSUMsR0FBSS9ELFNBQVNnRSxxQkFBcUIsVUFBVSxFQUFJRCxHQUFFRSxXQUFXQyxhQUFhUixFQUFJSyIsImZpbGUiOiJqcy93aWRnZXQubWluLmpzIiwic291cmNlc0NvbnRlbnQiOlsiLyogZ2xvYmFsIGNvbmZpZzogdHJ1ZSAqL1xuLyogZXhwb3J0ZWQgY29uZmlnICovXG5pZiAodHlwZW9mIGNvbmZpZyA9PT0gXCJ1bmRlZmluZWRcIikge1xuICB2YXIgY29uZmlnID0ge1xuICAgIFNLSU46IFwic2tpbi9SVlNraW4ueG1sXCJcbiAgfTtcblxuICBpZiAodHlwZW9mIGFuZ3VsYXIgIT09IFwidW5kZWZpbmVkXCIpIHtcbiAgICBhbmd1bGFyLm1vZHVsZShcInJpc2V2aXNpb24uY29tbW9uLmkxOG4uY29uZmlnXCIsIFtdKVxuICAgICAgLmNvbnN0YW50KFwiTE9DQUxFU19QUkVGSVhcIiwgXCJsb2NhbGVzL3RyYW5zbGF0aW9uX1wiKVxuICAgICAgLmNvbnN0YW50KFwiTE9DQUxFU19TVUZJWFwiLCBcIi5qc29uXCIpO1xuICB9XG59XG5cbi8qIGdsb2JhbCBnYWRnZXRzLCBjb25maWcgKi9cblxudmFyIFJpc2VWaXNpb24gPSBSaXNlVmlzaW9uIHx8IHt9O1xuUmlzZVZpc2lvbi5WaWRlbyA9IHt9O1xuXG5SaXNlVmlzaW9uLlZpZGVvID0gKGZ1bmN0aW9uIChnYWRnZXRzKSB7XG4gIFwidXNlIHN0cmljdFwiO1xuXG4gIHZhciBfYWRkaXRpb25hbFBhcmFtcztcblxuICB2YXIgX3ByZWZzID0gbnVsbCxcbiAgICBfc3RvcmFnZSA9IG51bGwsXG4gICAgX2ZyYW1lQ29udHJvbGxlciA9IG51bGw7XG5cbiAgdmFyIF9pbml0aWFsaXplZCA9IGZhbHNlLFxuICAgIF9wbGF5YmFja0Vycm9yID0gZmFsc2UsXG4gICAgX2lzU3RvcmFnZUZpbGUgPSBmYWxzZTtcblxuICB2YXIgX2N1cnJlbnRGaWxlLCBfY3VycmVudEZyYW1lO1xuXG4gIHZhciBfc2VwYXJhdG9yID0gXCJcIixcbiAgICBfcmVmcmVzaER1cmF0aW9uID0gOTAwMDAwLCAgLy8gMTUgbWludXRlc1xuICAgIF9yZWZyZXNoSW50ZXJ2YWxJZCA9IG51bGw7XG5cbiAgLypcbiAgICogIFByaXZhdGUgTWV0aG9kc1xuICAgKi9cbiAgZnVuY3Rpb24gX2RvbmUoKSB7XG4gICAgZ2FkZ2V0cy5ycGMuY2FsbChcIlwiLCBcInJzZXZlbnRfZG9uZVwiLCBudWxsLCBfcHJlZnMuZ2V0U3RyaW5nKFwiaWRcIikpO1xuXG4gIH1cblxuICBmdW5jdGlvbiBfcmVhZHkoKSB7XG4gICAgY29uc29sZS5sb2coXCJ2aWRlby5qczo6X3JlYWR5KClcIiwgX2FkZGl0aW9uYWxQYXJhbXMuc3RvcmFnZS5maWxlTmFtZSk7XG5cbiAgICBnYWRnZXRzLnJwYy5jYWxsKFwiXCIsIFwicnNldmVudF9yZWFkeVwiLCBudWxsLCBfcHJlZnMuZ2V0U3RyaW5nKFwiaWRcIiksXG4gICAgICB0cnVlLCB0cnVlLCB0cnVlLCB0cnVlLCB0cnVlKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIF9pbml0KCkge1xuICAgIF9mcmFtZUNvbnRyb2xsZXIgPSBuZXcgUmlzZVZpc2lvbi5Db21tb24uVmlkZW8uRnJhbWVDb250cm9sbGVyKCk7XG5cbiAgICAvLyBhZGQgdGhlIGZpcnN0IGZyYW1lIGFuZCBjcmVhdGUgaXRzIHBsYXllclxuICAgIF9mcmFtZUNvbnRyb2xsZXIuYWRkKDApO1xuICAgIF9jdXJyZW50RnJhbWUgPSAwO1xuICAgIF9mcmFtZUNvbnRyb2xsZXIuY3JlYXRlRnJhbWVQbGF5ZXIoMCwgX2FkZGl0aW9uYWxQYXJhbXMsIF9jdXJyZW50RmlsZSwgY29uZmlnLlNLSU4sIFwicGxheWVyLmh0bWxcIik7XG4gIH1cblxuICBmdW5jdGlvbiBfcmVmcmVzaEludGVydmFsKGR1cmF0aW9uKSB7XG4gICAgX3JlZnJlc2hJbnRlcnZhbElkID0gc2V0SW50ZXJ2YWwoZnVuY3Rpb24gdmlkZW9SZWZyZXNoKCkge1xuICAgICAgLy8gc2V0IG5ldyB2YWx1ZSBvZiBub24gcmlzZS1zdG9yYWdlIHVybCB3aXRoIGEgY2FjaGVidXN0ZXJcbiAgICAgIF9jdXJyZW50RmlsZSA9IF9hZGRpdGlvbmFsUGFyYW1zLnVybCArIF9zZXBhcmF0b3IgKyBcImNiPVwiICsgbmV3IERhdGUoKS5nZXRUaW1lKCk7XG5cbiAgICAgIC8vIGluIGNhc2UgcmVmcmVzaGVkIGZpbGUgZml4ZXMgYW4gZXJyb3Igd2l0aCBwcmV2aW91cyBmaWxlLCBlbnN1cmUgZmxhZyBpcyByZW1vdmVkIHNvIHBsYXliYWNrIGlzIGF0dGVtcHRlZCBhZ2FpblxuICAgICAgX3BsYXliYWNrRXJyb3IgPSBmYWxzZTtcblxuICAgIH0sIGR1cmF0aW9uKTtcbiAgfVxuXG4gIC8qXG4gICAqICBQdWJsaWMgTWV0aG9kc1xuICAgKi9cbiAgZnVuY3Rpb24gb25TdG9yYWdlSW5pdCh1cmwpIHtcbiAgICBfY3VycmVudEZpbGUgPSB1cmw7XG5cbiAgICBfaW5pdCgpO1xuICB9XG5cbiAgZnVuY3Rpb24gb25TdG9yYWdlUmVmcmVzaCh1cmwpIHtcbiAgICBfY3VycmVudEZpbGUgPSB1cmw7XG5cbiAgICAvLyBpbiBjYXNlIHJlZnJlc2hlZCBmaWxlIGZpeGVzIGFuIGVycm9yIHdpdGggcHJldmlvdXMgZmlsZSwgZW5zdXJlIGZsYWcgaXMgcmVtb3ZlZCBzbyBwbGF5YmFjayBpcyBhdHRlbXB0ZWQgYWdhaW5cbiAgICBfcGxheWJhY2tFcnJvciA9IGZhbHNlO1xuICB9XG5cbiAgZnVuY3Rpb24gcGF1c2UoKSB7XG4gICAgdmFyIGZyYW1lT2JqID0gX2ZyYW1lQ29udHJvbGxlci5nZXRGcmFtZU9iamVjdChfY3VycmVudEZyYW1lKTtcblxuICAgIGlmIChmcmFtZU9iaikge1xuICAgICAgZnJhbWVPYmoucGF1c2UoKTtcbiAgICB9XG4gIH1cblxuICBmdW5jdGlvbiBwbGF5KCkge1xuICAgIHZhciBmcmFtZU9iaiA9IF9mcmFtZUNvbnRyb2xsZXIuZ2V0RnJhbWVPYmplY3QoX2N1cnJlbnRGcmFtZSk7XG5cbiAgICBpZiAoIV9wbGF5YmFja0Vycm9yKSB7XG4gICAgICBpZiAoZnJhbWVPYmopIHtcbiAgICAgICAgZnJhbWVPYmoucGxheSgpO1xuICAgICAgfSBlbHNlIHtcblxuICAgICAgICAvLyByZS1hZGQgcHJldmlvdXNseSByZW1vdmVkIGZyYW1lIGFuZCBjcmVhdGUgdGhlIHBsYXllciwgYnV0IGhpZGUgdmlzaWJpbGl0eVxuICAgICAgICBfZnJhbWVDb250cm9sbGVyLmFkZCgwKTtcbiAgICAgICAgX2ZyYW1lQ29udHJvbGxlci5jcmVhdGVGcmFtZVBsYXllcigwLCBfYWRkaXRpb25hbFBhcmFtcywgX2N1cnJlbnRGaWxlLCBjb25maWcuU0tJTiwgXCJwbGF5ZXIuaHRtbFwiKTtcblxuICAgICAgfVxuICAgIH0gZWxzZSB7XG4gICAgICAvLyBUaGlzIGZsYWcgb25seSBnb3Qgc2V0IHVwb24gYSByZWZyZXNoIG9mIGhpZGRlbiBmcmFtZSBhbmQgdGhlcmUgd2FzIGFuIGVycm9yIGluIHNldHVwIG9yIHZpZGVvXG4gICAgICAvLyBTZW5kIFZpZXdlciBcImRvbmVcIlxuICAgICAgX2RvbmUoKTtcbiAgICB9XG4gIH1cblxuICBmdW5jdGlvbiBwbGF5ZXJFbmRlZCgpIHtcbiAgICBfZnJhbWVDb250cm9sbGVyLnJlbW92ZShfY3VycmVudEZyYW1lLCBmdW5jdGlvbiAoKSB7XG4gICAgICBfZG9uZSgpO1xuICAgIH0pO1xuICB9XG5cbiAgZnVuY3Rpb24gcGxheWVyUmVhZHkoKSB7XG4gICAgdmFyIGZyYW1lT2JqO1xuXG4gICAgaWYgKCFfaW5pdGlhbGl6ZWQpIHtcbiAgICAgIF9pbml0aWFsaXplZCA9IHRydWU7XG5cbiAgICAgIGlmICghX2lzU3RvcmFnZUZpbGUgJiYgX3JlZnJlc2hJbnRlcnZhbElkID09PSBudWxsKSB7XG4gICAgICAgIF9yZWZyZXNoSW50ZXJ2YWwoX3JlZnJlc2hEdXJhdGlvbik7XG4gICAgICB9XG5cbiAgICAgIF9yZWFkeSgpO1xuXG4gICAgfSBlbHNlIHtcbiAgICAgIGZyYW1lT2JqID0gX2ZyYW1lQ29udHJvbGxlci5nZXRGcmFtZU9iamVjdChfY3VycmVudEZyYW1lKTtcbiAgICAgIGZyYW1lT2JqLnBsYXkoKTtcbiAgICB9XG4gIH1cblxuICBmdW5jdGlvbiBzZXRBZGRpdGlvbmFsUGFyYW1zKG5hbWVzLCB2YWx1ZXMpIHtcbiAgICB2YXIgc3RyO1xuXG4gICAgaWYgKEFycmF5LmlzQXJyYXkobmFtZXMpICYmIG5hbWVzLmxlbmd0aCA+IDAgJiYgbmFtZXNbMF0gPT09IFwiYWRkaXRpb25hbFBhcmFtc1wiKSB7XG4gICAgICBpZiAoQXJyYXkuaXNBcnJheSh2YWx1ZXMpICYmIHZhbHVlcy5sZW5ndGggPiAwKSB7XG4gICAgICAgIF9hZGRpdGlvbmFsUGFyYW1zID0gSlNPTi5wYXJzZSh2YWx1ZXNbMF0pO1xuICAgICAgICBfcHJlZnMgPSBuZXcgZ2FkZ2V0cy5QcmVmcygpO1xuXG4gICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwidmlkZW9Db250YWluZXJcIikuc3R5bGUuaGVpZ2h0ID0gX3ByZWZzLmdldEludChcInJzSFwiKSArIFwicHhcIjtcblxuICAgICAgICBfYWRkaXRpb25hbFBhcmFtcy53aWR0aCA9IF9wcmVmcy5nZXRJbnQoXCJyc1dcIik7XG4gICAgICAgIF9hZGRpdGlvbmFsUGFyYW1zLmhlaWdodCA9IF9wcmVmcy5nZXRJbnQoXCJyc0hcIik7XG5cbiAgICAgICAgX2lzU3RvcmFnZUZpbGUgPSAoT2JqZWN0LmtleXMoX2FkZGl0aW9uYWxQYXJhbXMuc3RvcmFnZSkubGVuZ3RoICE9PSAwKTtcblxuICAgICAgICBpZiAoIV9pc1N0b3JhZ2VGaWxlKSB7XG4gICAgICAgICAgc3RyID0gX2FkZGl0aW9uYWxQYXJhbXMudXJsLnNwbGl0KFwiP1wiKTtcblxuICAgICAgICAgIC8vIHN0b3JlIHRoaXMgZm9yIHRoZSByZWZyZXNoIHRpbWVyXG4gICAgICAgICAgX3NlcGFyYXRvciA9IChzdHIubGVuZ3RoID09PSAxKSA/IFwiP1wiIDogXCImXCI7XG5cbiAgICAgICAgICBfY3VycmVudEZpbGUgPSBfYWRkaXRpb25hbFBhcmFtcy51cmw7XG5cbiAgICAgICAgICBfaW5pdCgpO1xuXG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgLy8gY3JlYXRlIGFuZCBpbml0aWFsaXplIHRoZSBTdG9yYWdlIG1vZHVsZSBpbnN0YW5jZVxuICAgICAgICAgIF9zdG9yYWdlID0gbmV3IFJpc2VWaXNpb24uVmlkZW8uU3RvcmFnZShfYWRkaXRpb25hbFBhcmFtcyk7XG4gICAgICAgICAgX3N0b3JhZ2UuaW5pdCgpO1xuICAgICAgICB9XG5cbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICBmdW5jdGlvbiBwbGF5ZXJFcnJvcihlcnJvcikge1xuICAgIGNvbnNvbGUuZGVidWcoXCJ2aWRlby1mb2xkZXI6OnBsYXllckVycm9yKClcIiwgZXJyb3IpO1xuXG4gICAgaWYgKCFfaW5pdGlhbGl6ZWQpIHtcbiAgICAgIC8vIFdpZGdldCBoYXMgbm90IHNlbnQgXCJyZWFkeVwiIHlldCBzbyB0aGVyZSBoYXMgYmVlbiBhIHNldHVwIGVycm9yXG4gICAgICBfZnJhbWVDb250cm9sbGVyLnJlbW92ZShfY3VycmVudEZyYW1lKTtcblxuICAgICAgLy8gZG8gbm90aGluZyBtb3JlLCBlbnN1cmUgXCJyZWFkeVwiIGlzIG5vdCBzZW50IHRvIFZpZXdlciBzbyB0aGF0IHRoaXMgd2lkZ2V0IGNhbiBiZSBza2lwcGVkXG5cbiAgICB9IGVsc2Uge1xuICAgICAgLy8gZmxhZyB0aGUgdmlkZW8gaGFzIGFuIGVycm9yXG4gICAgICBfcGxheWJhY2tFcnJvciA9IHRydWU7XG5cbiAgICAgIC8vIGFjdCBhcyB0aG91Z2ggdmlkZW8gaGFzIGVuZGVkXG4gICAgICBwbGF5ZXJFbmRlZCgpO1xuICAgIH1cblxuICB9XG5cbiAgZnVuY3Rpb24gc3RvcCgpIHtcbiAgICBwYXVzZSgpO1xuICB9XG5cbiAgcmV0dXJuIHtcbiAgICBcIm9uU3RvcmFnZUluaXRcIjogb25TdG9yYWdlSW5pdCxcbiAgICBcIm9uU3RvcmFnZVJlZnJlc2hcIjogb25TdG9yYWdlUmVmcmVzaCxcbiAgICBcInBhdXNlXCI6IHBhdXNlLFxuICAgIFwicGxheVwiOiBwbGF5LFxuICAgIFwic2V0QWRkaXRpb25hbFBhcmFtc1wiOiBzZXRBZGRpdGlvbmFsUGFyYW1zLFxuICAgIFwicGxheWVyRW5kZWRcIjogcGxheWVyRW5kZWQsXG4gICAgXCJwbGF5ZXJSZWFkeVwiOiBwbGF5ZXJSZWFkeSxcbiAgICBcInBsYXllckVycm9yXCI6IHBsYXllckVycm9yLFxuICAgIFwic3RvcFwiOiBzdG9wXG4gIH07XG5cbn0pKGdhZGdldHMpO1xuXG52YXIgUmlzZVZpc2lvbiA9IFJpc2VWaXNpb24gfHwge307XG5SaXNlVmlzaW9uLlZpZGVvID0gUmlzZVZpc2lvbi5WaWRlbyB8fCB7fTtcblxuUmlzZVZpc2lvbi5WaWRlby5TdG9yYWdlID0gZnVuY3Rpb24gKGRhdGEpIHtcbiAgXCJ1c2Ugc3RyaWN0XCI7XG5cbiAgdmFyIF9pbml0aWFsTG9hZCA9IHRydWU7XG5cbiAgLypcbiAgICogIFB1YmxpYyBNZXRob2RzXG4gICAqL1xuICBmdW5jdGlvbiBpbml0KCkge1xuICAgIHZhciBzdG9yYWdlID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJ2aWRlb1N0b3JhZ2VcIik7XG5cbiAgICBpZiAoIXN0b3JhZ2UpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBzdG9yYWdlLmFkZEV2ZW50TGlzdGVuZXIoXCJyaXNlLXN0b3JhZ2UtcmVzcG9uc2VcIiwgZnVuY3Rpb24oZSkge1xuICAgICAgdmFyIHVybDtcblxuICAgICAgaWYgKGUuZGV0YWlsICYmIGUuZGV0YWlsLmZpbGVzICYmIGUuZGV0YWlsLmZpbGVzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgdXJsID0gZS5kZXRhaWwuZmlsZXNbMF0udXJsO1xuXG4gICAgICAgIGlmIChfaW5pdGlhbExvYWQpIHtcbiAgICAgICAgICBfaW5pdGlhbExvYWQgPSBmYWxzZTtcblxuICAgICAgICAgIFJpc2VWaXNpb24uVmlkZW8ub25TdG9yYWdlSW5pdCh1cmwpO1xuXG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgUmlzZVZpc2lvbi5WaWRlby5vblN0b3JhZ2VSZWZyZXNoKHVybCk7XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgIH0pO1xuXG4gICAgc3RvcmFnZS5zZXRBdHRyaWJ1dGUoXCJmb2xkZXJcIiwgZGF0YS5zdG9yYWdlLmZvbGRlcik7XG4gICAgc3RvcmFnZS5zZXRBdHRyaWJ1dGUoXCJmaWxlTmFtZVwiLCBkYXRhLnN0b3JhZ2UuZmlsZU5hbWUpO1xuICAgIHN0b3JhZ2Uuc2V0QXR0cmlidXRlKFwiY29tcGFueUlkXCIsIGRhdGEuc3RvcmFnZS5jb21wYW55SWQpO1xuICAgIHN0b3JhZ2UuZ28oKTtcbiAgfVxuXG4gIHJldHVybiB7XG4gICAgXCJpbml0XCI6IGluaXRcbiAgfTtcbn07XG5cbnZhciBSaXNlVmlzaW9uID0gUmlzZVZpc2lvbiB8fCB7fTtcblJpc2VWaXNpb24uQ29tbW9uID0gUmlzZVZpc2lvbi5Db21tb24gfHwge307XG5cblJpc2VWaXNpb24uQ29tbW9uLlZpZGVvID0gUmlzZVZpc2lvbi5Db21tb24uVmlkZW8gfHwge307XG5cblJpc2VWaXNpb24uQ29tbW9uLlZpZGVvLkZyYW1lQ29udHJvbGxlciA9IGZ1bmN0aW9uICgpIHtcbiAgXCJ1c2Ugc3RyaWN0XCI7XG5cbiAgdmFyIFBSRUZJWCA9IFwiaWZfXCI7XG5cbiAgZnVuY3Rpb24gZ2V0RnJhbWVDb250YWluZXIoaW5kZXgpIHtcbiAgICByZXR1cm4gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoUFJFRklYICsgaW5kZXgpO1xuICB9XG5cbiAgZnVuY3Rpb24gZ2V0RnJhbWVPYmplY3QoaW5kZXgpIHtcbiAgICB2YXIgZnJhbWVDb250YWluZXIgPSBnZXRGcmFtZUNvbnRhaW5lcihpbmRleCksXG4gICAgICBpZnJhbWU7XG5cbiAgICBpZnJhbWUgPSBmcmFtZUNvbnRhaW5lci5xdWVyeVNlbGVjdG9yKFwiaWZyYW1lXCIpO1xuXG4gICAgaWYgKGlmcmFtZSkge1xuICAgICAgcmV0dXJuIChpZnJhbWUuY29udGVudFdpbmRvdykgPyBpZnJhbWUuY29udGVudFdpbmRvdyA6XG4gICAgICAgIChpZnJhbWUuY29udGVudERvY3VtZW50LmRvY3VtZW50KSA/IGlmcmFtZS5jb250ZW50RG9jdW1lbnQuZG9jdW1lbnQgOiBpZnJhbWUuY29udGVudERvY3VtZW50O1xuICAgIH1cblxuICAgIHJldHVybiBudWxsO1xuICB9XG5cbiAgZnVuY3Rpb24gX2NsZWFyKGluZGV4KSB7XG4gICAgdmFyIGZyYW1lQ29udGFpbmVyID0gZ2V0RnJhbWVDb250YWluZXIoaW5kZXgpLFxuICAgICAgZnJhbWVPYmogPSBnZXRGcmFtZU9iamVjdChpbmRleCksXG4gICAgICBpZnJhbWU7XG5cbiAgICBpZiAoZnJhbWVPYmopIHtcbiAgICAgIGlmcmFtZSA9IGZyYW1lQ29udGFpbmVyLnF1ZXJ5U2VsZWN0b3IoXCJpZnJhbWVcIik7XG4gICAgICBmcmFtZU9iai5yZW1vdmUoKTtcbiAgICAgIGlmcmFtZS5zZXRBdHRyaWJ1dGUoXCJzcmNcIiwgXCJhYm91dDpibGFua1wiKTtcbiAgICB9XG4gIH1cblxuICBmdW5jdGlvbiBhZGQoaW5kZXgpIHtcbiAgICB2YXIgZnJhbWVDb250YWluZXIgPSBnZXRGcmFtZUNvbnRhaW5lcihpbmRleCksXG4gICAgICBpZnJhbWUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiaWZyYW1lXCIpO1xuXG4gICAgaWZyYW1lLnNldEF0dHJpYnV0ZShcImFsbG93VHJhbnNwYXJlbmN5XCIsIHRydWUpO1xuICAgIGlmcmFtZS5zZXRBdHRyaWJ1dGUoXCJmcmFtZWJvcmRlclwiLCBcIjBcIik7XG4gICAgaWZyYW1lLnNldEF0dHJpYnV0ZShcInNjcm9sbGluZ1wiLCBcIm5vXCIpO1xuXG4gICAgZnJhbWVDb250YWluZXIuYXBwZW5kQ2hpbGQoaWZyYW1lKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIGNyZWF0ZUZyYW1lUGxheWVyKGluZGV4LCBwYXJhbXMsIGZpbGVzLCBza2luLCBzcmMpIHtcbiAgICB2YXIgZnJhbWVDb250YWluZXIgPSBnZXRGcmFtZUNvbnRhaW5lcihpbmRleCksXG4gICAgICBmcmFtZU9iaiA9IGdldEZyYW1lT2JqZWN0KGluZGV4KSxcbiAgICAgIGlmcmFtZTtcblxuICAgIGlmIChmcmFtZU9iaikge1xuICAgICAgaWZyYW1lID0gZnJhbWVDb250YWluZXIucXVlcnlTZWxlY3RvcihcImlmcmFtZVwiKTtcblxuICAgICAgaWZyYW1lLm9ubG9hZCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgaWZyYW1lLm9ubG9hZCA9IG51bGw7XG5cbiAgICAgICAgLy8gaW5pdGlhbGl6ZSBhbmQgbG9hZCB0aGUgcGxheWVyIGluc2lkZSB0aGUgaWZyYW1lXG4gICAgICAgIGZyYW1lT2JqLmluaXQocGFyYW1zLCBmaWxlcywgc2tpbik7XG4gICAgICAgIGZyYW1lT2JqLmxvYWQoKTtcbiAgICAgIH07XG5cbiAgICAgIGlmcmFtZS5zZXRBdHRyaWJ1dGUoXCJzcmNcIiwgc3JjKTtcbiAgICB9XG5cbiAgfVxuXG4gIGZ1bmN0aW9uIGhpZGUoaW5kZXgpIHtcbiAgICB2YXIgZnJhbWVDb250YWluZXIgPSBnZXRGcmFtZUNvbnRhaW5lcihpbmRleCk7XG5cbiAgICBmcmFtZUNvbnRhaW5lci5zdHlsZS52aXNpYmlsaXR5ID0gXCJoaWRkZW5cIjtcbiAgfVxuXG4gIGZ1bmN0aW9uIHJlbW92ZShpbmRleCwgY2FsbGJhY2spIHtcbiAgICB2YXIgZnJhbWVDb250YWluZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChQUkVGSVggKyBpbmRleCk7XG5cbiAgICBfY2xlYXIoaW5kZXgpO1xuXG4gICAgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7XG4gICAgICAvLyByZW1vdmUgdGhlIGlmcmFtZSBieSBjbGVhcmluZyBhbGwgZWxlbWVudHMgaW5zaWRlIGRpdiBjb250YWluZXJcbiAgICAgIHdoaWxlIChmcmFtZUNvbnRhaW5lci5maXJzdENoaWxkKSB7XG4gICAgICAgIGZyYW1lQ29udGFpbmVyLnJlbW92ZUNoaWxkKGZyYW1lQ29udGFpbmVyLmZpcnN0Q2hpbGQpO1xuICAgICAgfVxuXG4gICAgICBpZiAoY2FsbGJhY2sgJiYgdHlwZW9mIGNhbGxiYWNrID09PSBcImZ1bmN0aW9uXCIpIHtcbiAgICAgICAgY2FsbGJhY2soKTtcbiAgICAgIH1cbiAgICB9LCAyMDApO1xuICB9XG5cbiAgZnVuY3Rpb24gc2hvdyhpbmRleCkge1xuICAgIHZhciBmcmFtZUNvbnRhaW5lciA9IGdldEZyYW1lQ29udGFpbmVyKGluZGV4KTtcblxuICAgIGZyYW1lQ29udGFpbmVyLnN0eWxlLnZpc2liaWxpdHkgPSBcInZpc2libGVcIjtcbiAgfVxuXG4gIHJldHVybiB7XG4gICAgYWRkOiBhZGQsXG4gICAgY3JlYXRlRnJhbWVQbGF5ZXI6IGNyZWF0ZUZyYW1lUGxheWVyLFxuICAgIGdldEZyYW1lQ29udGFpbmVyOiBnZXRGcmFtZUNvbnRhaW5lcixcbiAgICBnZXRGcmFtZU9iamVjdDogZ2V0RnJhbWVPYmplY3QsXG4gICAgaGlkZTogaGlkZSxcbiAgICByZW1vdmU6IHJlbW92ZSxcbiAgICBzaG93OiBzaG93XG4gIH07XG59O1xuXG4vKiBnbG9iYWwgZ2FkZ2V0cywgUmlzZVZpc2lvbiAqL1xuXG4oZnVuY3Rpb24gKHdpbmRvdywgZ2FkZ2V0cykge1xuICBcInVzZSBzdHJpY3RcIjtcblxuICB2YXIgcHJlZnMgPSBuZXcgZ2FkZ2V0cy5QcmVmcygpLFxuICAgIGlkID0gcHJlZnMuZ2V0U3RyaW5nKFwiaWRcIik7XG5cbiAgLy8gRGlzYWJsZSBjb250ZXh0IG1lbnUgKHJpZ2h0IGNsaWNrIG1lbnUpXG4gIHdpbmRvdy5vbmNvbnRleHRtZW51ID0gZnVuY3Rpb24gKCkge1xuICAgIHJldHVybiBmYWxzZTtcbiAgfTtcblxuICBmdW5jdGlvbiBwbGF5KCkge1xuICAgIFJpc2VWaXNpb24uVmlkZW8ucGxheSgpO1xuICB9XG5cbiAgZnVuY3Rpb24gcGF1c2UoKSB7XG4gICAgUmlzZVZpc2lvbi5WaWRlby5wYXVzZSgpO1xuICB9XG5cbiAgZnVuY3Rpb24gc3RvcCgpIHtcbiAgICBSaXNlVmlzaW9uLlZpZGVvLnN0b3AoKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIHBvbHltZXJSZWFkeSgpIHtcbiAgICB3aW5kb3cucmVtb3ZlRXZlbnRMaXN0ZW5lcihcInBvbHltZXItcmVhZHlcIiwgcG9seW1lclJlYWR5KTtcblxuICAgIGlmIChpZCAmJiBpZCAhPT0gXCJcIikge1xuICAgICAgZ2FkZ2V0cy5ycGMucmVnaXN0ZXIoXCJyc2NtZF9wbGF5X1wiICsgaWQsIHBsYXkpO1xuICAgICAgZ2FkZ2V0cy5ycGMucmVnaXN0ZXIoXCJyc2NtZF9wYXVzZV9cIiArIGlkLCBwYXVzZSk7XG4gICAgICBnYWRnZXRzLnJwYy5yZWdpc3RlcihcInJzY21kX3N0b3BfXCIgKyBpZCwgc3RvcCk7XG5cbiAgICAgIGdhZGdldHMucnBjLnJlZ2lzdGVyKFwicnNwYXJhbV9zZXRfXCIgKyBpZCwgUmlzZVZpc2lvbi5WaWRlby5zZXRBZGRpdGlvbmFsUGFyYW1zKTtcbiAgICAgIGdhZGdldHMucnBjLmNhbGwoXCJcIiwgXCJyc3BhcmFtX2dldFwiLCBudWxsLCBpZCwgW1wiYWRkaXRpb25hbFBhcmFtc1wiXSk7XG4gICAgfVxuICB9XG5cbiAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoXCJwb2x5bWVyLXJlYWR5XCIsIHBvbHltZXJSZWFkeSk7XG5cbn0pKHdpbmRvdywgZ2FkZ2V0cyk7XG5cblxuXG4vKiBqc2hpbnQgaWdub3JlOnN0YXJ0ICovXG52YXIgX2dhcSA9IF9nYXEgfHwgW107XG5cbl9nYXEucHVzaChbJ19zZXRBY2NvdW50JywgJ1VBLTU3MDkyMTU5LTInXSk7XG5fZ2FxLnB1c2goWydfdHJhY2tQYWdldmlldyddKTtcblxuKGZ1bmN0aW9uKCkge1xuICB2YXIgZ2EgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdzY3JpcHQnKTsgZ2EudHlwZSA9ICd0ZXh0L2phdmFzY3JpcHQnOyBnYS5hc3luYyA9IHRydWU7XG4gIGdhLnNyYyA9ICgnaHR0cHM6JyA9PSBkb2N1bWVudC5sb2NhdGlvbi5wcm90b2NvbCA/ICdodHRwczovL3NzbCcgOiAnaHR0cDovL3d3dycpICsgJy5nb29nbGUtYW5hbHl0aWNzLmNvbS9nYS5qcyc7XG4gIHZhciBzID0gZG9jdW1lbnQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoJ3NjcmlwdCcpWzBdOyBzLnBhcmVudE5vZGUuaW5zZXJ0QmVmb3JlKGdhLCBzKTtcbn0pKCk7XG4vKiBqc2hpbnQgaWdub3JlOmVuZCAqL1xuIl0sInNvdXJjZVJvb3QiOiIvc291cmNlLyJ9